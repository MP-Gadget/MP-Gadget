<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MP-Gadget: libgadget/timestep.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MP-Gadget
   &#160;<span id="projectnumber">5.0.1.dev1-76bc7d4726-dirty</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_8db5bc7a24c620673ff2e44953ca6f6c.html">libgadget</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">timestep.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>routines for 'kicking' particles in momentum space and assigning new timesteps  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;mpi.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;<a class="el" href="string_8h_source.html">string.h</a>&gt;</code><br />
<code>#include &lt;math.h&gt;</code><br />
<code>#include &lt;omp.h&gt;</code><br />
<code>#include &quot;<a class="el" href="utils_8h_source.html">utils.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="physconst_8h_source.html">physconst.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="timebinmgr_8h_source.html">timebinmgr.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="domain_8h_source.html">domain.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="timefac_8h_source.html">timefac.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="cosmology_8h_source.html">cosmology.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="checkpoint_8h_source.html">checkpoint.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="slotsmanager_8h_source.html">slotsmanager.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="partmanager_8h_source.html">partmanager.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hydra_8h_source.html">hydra.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="walltime_8h_source.html">walltime.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="timestep_8h_source.html">timestep.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="gravity_8h_source.html">gravity.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for timestep.c:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c__incl.svg" width="2372" height="784"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<p><a href="timestep_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structtimestep__params.html">timestep_params</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:ad2dde160974c283ccf8f0ce280f791ba"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791ba">TimeStepType</a> { <br />
&#160;&#160;<a class="el" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baa76b68035165a9358aa74f58389fdbd45">TI_ACCEL</a> = 0
, <a class="el" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baa6611ae5ddb582819d2082b4e841fde29">TI_COURANT</a> = 1
, <a class="el" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baae9a49bc969dbba59dcea2fc12fbf3f36">TI_ACCRETE</a> = 2
, <a class="el" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baa1ce55196388f86c21f1c542260078268">TI_NEIGH</a> = 3
, <br />
&#160;&#160;<a class="el" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baaecf5a22337645488f735250e6a0efe43">TI_HSML</a> = 4
<br />
 }</td></tr>
<tr class="separator:ad2dde160974c283ccf8f0ce280f791ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a27b2f11d07d3c2d3c0d2f095c270a3cf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#a27b2f11d07d3c2d3c0d2f095c270a3cf">set_timestep_params</a> (<a class="el" href="structParameterSet.html">ParameterSet</a> *ps)</td></tr>
<tr class="separator:a27b2f11d07d3c2d3c0d2f095c270a3cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82baea7f4465d0b1372006d6d1898e69"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#a82baea7f4465d0b1372006d6d1898e69">get_active_particle</a> (const <a class="el" href="structActiveParticles.html">ActiveParticles</a> *act, int pa)</td></tr>
<tr class="separator:a82baea7f4465d0b1372006d6d1898e69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f89b5c29a35ca695a22d09f18d2807a"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#a7f89b5c29a35ca695a22d09f18d2807a">timestep_eh_slots_fork</a> (<a class="el" href="structEIBase.html">EIBase</a> *event, void *userdata)</td></tr>
<tr class="separator:a7f89b5c29a35ca695a22d09f18d2807a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8b84367ec16a894fbc4510defa6a167"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#ac8b84367ec16a894fbc4510defa6a167">get_timestep_ti</a> (const int p, const <a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> dti_max, const <a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> Ti_Current, const double atime, const double hubble, enum <a class="el" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791ba">TimeStepType</a> *titype)</td></tr>
<tr class="separator:ac8b84367ec16a894fbc4510defa6a167"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd31a672ca9dfbbf3c03f14f1e3baec6"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#acd31a672ca9dfbbf3c03f14f1e3baec6">get_timestep_bin</a> (<a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> dti)</td></tr>
<tr class="separator:acd31a672ca9dfbbf3c03f14f1e3baec6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12af8c51e47a2a92db7746c4ede67946"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#a12af8c51e47a2a92db7746c4ede67946">do_the_short_range_kick</a> (int i, double dt_entr, double Fgravkick, double Fhydrokick, const double atime, const double MinEgySpec)</td></tr>
<tr class="separator:a12af8c51e47a2a92db7746c4ede67946"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf0018d0dda92e6c10da475d5a8ffd1d"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#aaf0018d0dda92e6c10da475d5a8ffd1d">get_PM_timestep_ti</a> (const <a class="el" href="structDriftKickTimes.html">DriftKickTimes</a> *const times, const double atime, const <a class="el" href="structCosmology.html">Cosmology</a> *<a class="el" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, const int FastParticleType, const double asmth)</td></tr>
<tr class="separator:aaf0018d0dda92e6c10da475d5a8ffd1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a573e730c561dfb971b96703c6711d09e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#a573e730c561dfb971b96703c6711d09e">init_timebins</a> (double TimeInit)</td></tr>
<tr class="separator:a573e730c561dfb971b96703c6711d09e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46b8fcbd4991e9d216fc8825d5bdfb36"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structDriftKickTimes.html">DriftKickTimes</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#a46b8fcbd4991e9d216fc8825d5bdfb36">init_driftkicktime</a> (<a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> Ti_Current)</td></tr>
<tr class="separator:a46b8fcbd4991e9d216fc8825d5bdfb36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a896d6e80e5dd9d14008709479a0f8a66"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#a896d6e80e5dd9d14008709479a0f8a66">is_timebin_active</a> (int i, <a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> current)</td></tr>
<tr class="separator:a896d6e80e5dd9d14008709479a0f8a66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1da56439eb88b453b1ae0122f15d8dc1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#a1da56439eb88b453b1ae0122f15d8dc1">is_PM_timestep</a> (const <a class="el" href="structDriftKickTimes.html">DriftKickTimes</a> *const times)</td></tr>
<tr class="separator:a1da56439eb88b453b1ae0122f15d8dc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a359495157e1978aa5922615da9432a4d"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#a359495157e1978aa5922615da9432a4d">get_atime</a> (const <a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> Ti_Current)</td></tr>
<tr class="separator:a359495157e1978aa5922615da9432a4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f8bb9951920bdc3a2138d91f1cfc61c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#a7f8bb9951920bdc3a2138d91f1cfc61c">find_timesteps</a> (const <a class="el" href="structActiveParticles.html">ActiveParticles</a> *act, <a class="el" href="structDriftKickTimes.html">DriftKickTimes</a> *times, const double atime, int FastParticleType, const <a class="el" href="structCosmology.html">Cosmology</a> *<a class="el" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, const double asmth, const int isFirstTimeStep)</td></tr>
<tr class="separator:a7f8bb9951920bdc3a2138d91f1cfc61c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace9e5cdcc776609e46189b2268155ca7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#ace9e5cdcc776609e46189b2268155ca7">update_lastactive_drift</a> (<a class="el" href="structDriftKickTimes.html">DriftKickTimes</a> *times)</td></tr>
<tr class="separator:ace9e5cdcc776609e46189b2268155ca7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8cd9d7c91611cbf3493edfa7d5491be9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#a8cd9d7c91611cbf3493edfa7d5491be9">apply_half_kick</a> (const <a class="el" href="structActiveParticles.html">ActiveParticles</a> *act, <a class="el" href="structCosmology.html">Cosmology</a> *<a class="el" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, <a class="el" href="structDriftKickTimes.html">DriftKickTimes</a> *times, const double atime, const double MinEgySpec)</td></tr>
<tr class="separator:a8cd9d7c91611cbf3493edfa7d5491be9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02c7db8f2f113f9e606ec6a500074f8c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#a02c7db8f2f113f9e606ec6a500074f8c">apply_PM_half_kick</a> (<a class="el" href="structCosmology.html">Cosmology</a> *<a class="el" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, <a class="el" href="structDriftKickTimes.html">DriftKickTimes</a> *times)</td></tr>
<tr class="separator:a02c7db8f2f113f9e606ec6a500074f8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1295174fe809392e15215f2a3585a04d"><td class="memItemLeft" align="right" valign="top">static double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#a1295174fe809392e15215f2a3585a04d">get_timestep_dloga</a> (const int p, const <a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> Ti_Current, const double atime, const double hubble, enum <a class="el" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791ba">TimeStepType</a> *titype)</td></tr>
<tr class="separator:a1295174fe809392e15215f2a3585a04d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7de7f3fa793e7794724b27aa49b08c60"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#a7de7f3fa793e7794724b27aa49b08c60">get_long_range_timestep_dloga</a> (const double atime, const <a class="el" href="structCosmology.html">Cosmology</a> *<a class="el" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, const int FastParticleType, const double asmth)</td></tr>
<tr class="separator:a7de7f3fa793e7794724b27aa49b08c60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7119c29751fcd9275f395e6ea08965f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#aa7119c29751fcd9275f395e6ea08965f">find_next_kick</a> (<a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> Ti_Current, int minTimeBin)</td></tr>
<tr class="separator:aa7119c29751fcd9275f395e6ea08965f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af09ee9d6b74189aeb58a368e2e810936"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#af09ee9d6b74189aeb58a368e2e810936">print_timebin_statistics</a> (const <a class="el" href="structDriftKickTimes.html">DriftKickTimes</a> *const times, const int NumCurrentTiStep, int *TimeBinCountType, const double Time)</td></tr>
<tr class="separator:af09ee9d6b74189aeb58a368e2e810936"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8102740bf0615adc840060e1101d6d3e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#a8102740bf0615adc840060e1101d6d3e">rebuild_activelist</a> (<a class="el" href="structActiveParticles.html">ActiveParticles</a> *act, const <a class="el" href="structDriftKickTimes.html">DriftKickTimes</a> *const times, int NumCurrentTiStep, const double Time)</td></tr>
<tr class="separator:a8102740bf0615adc840060e1101d6d3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec3f9fb84aa5cda053a144da6588ffcd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#aec3f9fb84aa5cda053a144da6588ffcd">free_activelist</a> (<a class="el" href="structActiveParticles.html">ActiveParticles</a> *act)</td></tr>
<tr class="separator:aec3f9fb84aa5cda053a144da6588ffcd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a9a9520c05fd90139cd00f4581dbea57a"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structtimestep__params.html">timestep_params</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a></td></tr>
<tr class="separator:a9a9520c05fd90139cd00f4581dbea57a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>routines for 'kicking' particles in momentum space and assigning new timesteps </p>

<p class="definition">Definition in file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
</div><h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="ad2dde160974c283ccf8f0ce280f791ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad2dde160974c283ccf8f0ce280f791ba">&#9670;&nbsp;</a></span>TimeStepType</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791ba">TimeStepType</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ad2dde160974c283ccf8f0ce280f791baa76b68035165a9358aa74f58389fdbd45"></a>TI_ACCEL&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ad2dde160974c283ccf8f0ce280f791baa6611ae5ddb582819d2082b4e841fde29"></a>TI_COURANT&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ad2dde160974c283ccf8f0ce280f791baae9a49bc969dbba59dcea2fc12fbf3f36"></a>TI_ACCRETE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ad2dde160974c283ccf8f0ce280f791baa1ce55196388f86c21f1c542260078268"></a>TI_NEIGH&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ad2dde160974c283ccf8f0ce280f791baaecf5a22337645488f735250e6a0efe43"></a>TI_HSML&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00106">106</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;{</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <a class="code" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baa76b68035165a9358aa74f58389fdbd45">TI_ACCEL</a> = 0,</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <a class="code" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baa6611ae5ddb582819d2082b4e841fde29">TI_COURANT</a> = 1,</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <a class="code" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baae9a49bc969dbba59dcea2fc12fbf3f36">TI_ACCRETE</a> = 2,</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <a class="code" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baa1ce55196388f86c21f1c542260078268">TI_NEIGH</a> = 3,</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="code" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baaecf5a22337645488f735250e6a0efe43">TI_HSML</a> = 4,</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;};</div>
<div class="ttc" id="atimestep_8c_html_ad2dde160974c283ccf8f0ce280f791baa1ce55196388f86c21f1c542260078268"><div class="ttname"><a href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baa1ce55196388f86c21f1c542260078268">TI_NEIGH</a></div><div class="ttdeci">@ TI_NEIGH</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00111">timestep.c:111</a></div></div>
<div class="ttc" id="atimestep_8c_html_ad2dde160974c283ccf8f0ce280f791baa6611ae5ddb582819d2082b4e841fde29"><div class="ttname"><a href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baa6611ae5ddb582819d2082b4e841fde29">TI_COURANT</a></div><div class="ttdeci">@ TI_COURANT</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00109">timestep.c:109</a></div></div>
<div class="ttc" id="atimestep_8c_html_ad2dde160974c283ccf8f0ce280f791baa76b68035165a9358aa74f58389fdbd45"><div class="ttname"><a href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baa76b68035165a9358aa74f58389fdbd45">TI_ACCEL</a></div><div class="ttdeci">@ TI_ACCEL</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00108">timestep.c:108</a></div></div>
<div class="ttc" id="atimestep_8c_html_ad2dde160974c283ccf8f0ce280f791baae9a49bc969dbba59dcea2fc12fbf3f36"><div class="ttname"><a href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baae9a49bc969dbba59dcea2fc12fbf3f36">TI_ACCRETE</a></div><div class="ttdeci">@ TI_ACCRETE</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00110">timestep.c:110</a></div></div>
<div class="ttc" id="atimestep_8c_html_ad2dde160974c283ccf8f0ce280f791baaecf5a22337645488f735250e6a0efe43"><div class="ttname"><a href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baaecf5a22337645488f735250e6a0efe43">TI_HSML</a></div><div class="ttdeci">@ TI_HSML</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00112">timestep.c:112</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a8cd9d7c91611cbf3493edfa7d5491be9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8cd9d7c91611cbf3493edfa7d5491be9">&#9670;&nbsp;</a></span>apply_half_kick()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void apply_half_kick </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structActiveParticles.html">ActiveParticles</a> *&#160;</td>
          <td class="paramname"><em>act</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structCosmology.html">Cosmology</a> *&#160;</td>
          <td class="paramname"><em>CP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDriftKickTimes.html">DriftKickTimes</a> *&#160;</td>
          <td class="paramname"><em>times</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>atime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>MinEgySpec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00323">323</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;{</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordtype">int</span> pa, bin;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Misc&quot;</span>);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordtype">double</span> gravkick[<a class="code" href="timebinmgr_8h.html#a4668a3a5f210b5742a179c8d258a703d">TIMEBINS</a>+1] = {0}, hydrokick[<a class="code" href="timebinmgr_8h.html#a4668a3a5f210b5742a179c8d258a703d">TIMEBINS</a>+1] = {0};</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="comment">/* Do nothing for the first timestep when the kicks are always zero*/</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">if</span>(times-&gt;<a class="code" href="structDriftKickTimes.html#ad3b4fe6ff2b0e0be706882c59323621e">mintimebin</a> == 0 &amp;&amp; times-&gt;<a class="code" href="structDriftKickTimes.html#a456360252b612364b9b5888d75e5c7f0">maxtimebin</a> == 0)</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="preprocessor">    #pragma omp parallel for</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordflow">for</span>(bin = times-&gt;<a class="code" href="structDriftKickTimes.html#ad3b4fe6ff2b0e0be706882c59323621e">mintimebin</a>; bin &lt;= <a class="code" href="timebinmgr_8h.html#a4668a3a5f210b5742a179c8d258a703d">TIMEBINS</a>; bin++)</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    {</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="comment">/* Kick the active timebins*/</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="timestep_8c.html#a896d6e80e5dd9d14008709479a0f8a66">is_timebin_active</a>(bin, times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>)) {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <span class="comment">/* do the kick for half a step*/</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            <a class="code" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> dti = <a class="code" href="timebinmgr_8h.html#af676ea14ddc4ab85d634f5a18015038d">dti_from_timebin</a>(bin);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            <a class="code" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> newkick = times-&gt;<a class="code" href="structDriftKickTimes.html#ac18ed0905144485b014ce19c6db2a4d5">Ti_kick</a>[bin] + dti/2;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            <span class="comment">/* Compute kick factors for occupied bins*/</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            gravkick[bin] = <a class="code" href="timefac_8c.html#ae45524bb6dcfabd035dd6edfda728079">get_exact_gravkick_factor</a>(<a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, times-&gt;<a class="code" href="structDriftKickTimes.html#ac18ed0905144485b014ce19c6db2a4d5">Ti_kick</a>[bin], newkick);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            hydrokick[bin] = <a class="code" href="timefac_8c.html#a2bfd65177ba7cde60bbe22eb0a84f96b">get_exact_hydrokick_factor</a>(<a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, times-&gt;<a class="code" href="structDriftKickTimes.html#ac18ed0905144485b014ce19c6db2a4d5">Ti_kick</a>[bin], newkick);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      <span class="comment">//      message(0, &quot;drift %d bin %d kick: %d-&gt;%d\n&quot;, times-&gt;Ti_Current, bin, times-&gt;Ti_kick[bin], newkick);</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            times-&gt;<a class="code" href="structDriftKickTimes.html#ac18ed0905144485b014ce19c6db2a4d5">Ti_kick</a>[bin] = newkick;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        }</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    }</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="comment">/* Advance the shorter bins without particles by the minimum occupied timestep.*/</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">for</span>(bin=1; bin &lt; times-&gt;<a class="code" href="structDriftKickTimes.html#ad3b4fe6ff2b0e0be706882c59323621e">mintimebin</a>; bin++)</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        times-&gt;<a class="code" href="structDriftKickTimes.html#ac18ed0905144485b014ce19c6db2a4d5">Ti_kick</a>[bin] += <a class="code" href="timebinmgr_8h.html#af676ea14ddc4ab85d634f5a18015038d">dti_from_timebin</a>(times-&gt;<a class="code" href="structDriftKickTimes.html#ad3b4fe6ff2b0e0be706882c59323621e">mintimebin</a>)/2;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="comment">//    message(0, &quot;drift %d bin %d kick: %d\n&quot;, times-&gt;Ti_Current, bin, times-&gt;Ti_kick[bin]);</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="comment">/* Now assign new timesteps and kick */</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="preprocessor">    #pragma omp parallel for</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">for</span>(pa = 0; pa &lt; act-&gt;<a class="code" href="structActiveParticles.html#a847ab898fdabc62a4723c7c3a66038d4">NumActiveParticle</a>; pa++)</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> i = <a class="code" href="timestep_8c.html#a82baea7f4465d0b1372006d6d1898e69">get_active_particle</a>(act, pa);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Swallowed || <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].IsGarbage)</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="keywordtype">int</span> bin = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].TimeBin;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <span class="keywordflow">if</span>(bin &gt; <a class="code" href="timebinmgr_8h.html#a4668a3a5f210b5742a179c8d258a703d">TIMEBINS</a>)</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(4, <span class="stringliteral">&quot;Particle %d (type %d, id %ld) had unexpected timebin %d\n&quot;</span>, i, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Type, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].ID, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].TimeBin);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <span class="keywordflow">if</span>(isnan(gravkick[bin]) || gravkick[bin] == 0.)</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(5, <span class="stringliteral">&quot;Bad kicks %lg bin %d tik %d\n&quot;</span>, gravkick[bin], bin, times-&gt;<a class="code" href="structDriftKickTimes.html#ac18ed0905144485b014ce19c6db2a4d5">Ti_kick</a>[bin]);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <a class="code" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> dti = <a class="code" href="timebinmgr_8h.html#af676ea14ddc4ab85d634f5a18015038d">dti_from_timebin</a>(bin);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> dt_entr = <a class="code" href="timebinmgr_8c.html#a7166c93d068baea59abf2ef8cee3c7aa">dloga_from_dti</a>(dti/2, times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="comment">/*This only changes particle i, so is thread-safe.*/</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <a class="code" href="timestep_8c.html#a12af8c51e47a2a92db7746c4ede67946">do_the_short_range_kick</a>(i, dt_entr, gravkick[bin], hydrokick[bin], atime, MinEgySpec);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    }</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Timeline/HalfKick/Short&quot;</span>);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;}</div>
<div class="ttc" id="aendrun_8c_html_ad963d7efdb9f10f7a2298c8ccd222ab0"><div class="ttname"><a href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a></div><div class="ttdeci">void endrun(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00147">endrun.c:147</a></div></div>
<div class="ttc" id="apartmanager_8h_html_a2748566f4c443ee77aa831e63dbb5ebe"><div class="ttname"><a href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a></div><div class="ttdeci">#define P</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00088">partmanager.h:88</a></div></div>
<div class="ttc" id="apower_8c_html_aaca257a58f3e957a7db5fc91431eadf5"><div class="ttname"><a href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a></div><div class="ttdeci">static Cosmology * CP</div><div class="ttdef"><b>Definition:</b> <a href="power_8c_source.html#l00027">power.c:27</a></div></div>
<div class="ttc" id="astructActiveParticles_html_a847ab898fdabc62a4723c7c3a66038d4"><div class="ttname"><a href="structActiveParticles.html#a847ab898fdabc62a4723c7c3a66038d4">ActiveParticles::NumActiveParticle</a></div><div class="ttdeci">int64_t NumActiveParticle</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8h_source.html#l00012">timestep.h:12</a></div></div>
<div class="ttc" id="astructDriftKickTimes_html_a456360252b612364b9b5888d75e5c7f0"><div class="ttname"><a href="structDriftKickTimes.html#a456360252b612364b9b5888d75e5c7f0">DriftKickTimes::maxtimebin</a></div><div class="ttdeci">int maxtimebin</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8h_source.html#l00021">timestep.h:21</a></div></div>
<div class="ttc" id="astructDriftKickTimes_html_a8cbfa406f883f7f7e6ef53cfa4608f7d"><div class="ttname"><a href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">DriftKickTimes::Ti_Current</a></div><div class="ttdeci">inttime_t Ti_Current</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8h_source.html#l00027">timestep.h:27</a></div></div>
<div class="ttc" id="astructDriftKickTimes_html_ac18ed0905144485b014ce19c6db2a4d5"><div class="ttname"><a href="structDriftKickTimes.html#ac18ed0905144485b014ce19c6db2a4d5">DriftKickTimes::Ti_kick</a></div><div class="ttdeci">inttime_t Ti_kick[TIMEBINS+1]</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8h_source.html#l00023">timestep.h:23</a></div></div>
<div class="ttc" id="astructDriftKickTimes_html_ad3b4fe6ff2b0e0be706882c59323621e"><div class="ttname"><a href="structDriftKickTimes.html#ad3b4fe6ff2b0e0be706882c59323621e">DriftKickTimes::mintimebin</a></div><div class="ttdeci">int mintimebin</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8h_source.html#l00020">timestep.h:20</a></div></div>
<div class="ttc" id="atimebinmgr_8c_html_a7166c93d068baea59abf2ef8cee3c7aa"><div class="ttname"><a href="timebinmgr_8c.html#a7166c93d068baea59abf2ef8cee3c7aa">dloga_from_dti</a></div><div class="ttdeci">double dloga_from_dti(inttime_t dti, const inttime_t Ti_Current)</div><div class="ttdef"><b>Definition:</b> <a href="timebinmgr_8c_source.html#l00256">timebinmgr.c:256</a></div></div>
<div class="ttc" id="atimebinmgr_8h_html_a4668a3a5f210b5742a179c8d258a703d"><div class="ttname"><a href="timebinmgr_8h.html#a4668a3a5f210b5742a179c8d258a703d">TIMEBINS</a></div><div class="ttdeci">#define TIMEBINS</div><div class="ttdef"><b>Definition:</b> <a href="timebinmgr_8h_source.html#l00013">timebinmgr.h:13</a></div></div>
<div class="ttc" id="atimebinmgr_8h_html_af676ea14ddc4ab85d634f5a18015038d"><div class="ttname"><a href="timebinmgr_8h.html#af676ea14ddc4ab85d634f5a18015038d">dti_from_timebin</a></div><div class="ttdeci">static inttime_t dti_from_timebin(int bin)</div><div class="ttdef"><b>Definition:</b> <a href="timebinmgr_8h_source.html#l00044">timebinmgr.h:44</a></div></div>
<div class="ttc" id="atimefac_8c_html_a2bfd65177ba7cde60bbe22eb0a84f96b"><div class="ttname"><a href="timefac_8c.html#a2bfd65177ba7cde60bbe22eb0a84f96b">get_exact_hydrokick_factor</a></div><div class="ttdeci">double get_exact_hydrokick_factor(Cosmology *CP, inttime_t ti0, inttime_t ti1)</div><div class="ttdef"><b>Definition:</b> <a href="timefac_8c_source.html#l00075">timefac.c:75</a></div></div>
<div class="ttc" id="atimefac_8c_html_ae45524bb6dcfabd035dd6edfda728079"><div class="ttname"><a href="timefac_8c.html#ae45524bb6dcfabd035dd6edfda728079">get_exact_gravkick_factor</a></div><div class="ttdeci">double get_exact_gravkick_factor(Cosmology *CP, inttime_t ti0, inttime_t ti1)</div><div class="ttdef"><b>Definition:</b> <a href="timefac_8c_source.html#l00070">timefac.c:70</a></div></div>
<div class="ttc" id="atimestep_8c_html_a12af8c51e47a2a92db7746c4ede67946"><div class="ttname"><a href="timestep_8c.html#a12af8c51e47a2a92db7746c4ede67946">do_the_short_range_kick</a></div><div class="ttdeci">static void do_the_short_range_kick(int i, double dt_entr, double Fgravkick, double Fhydrokick, const double atime, const double MinEgySpec)</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00396">timestep.c:396</a></div></div>
<div class="ttc" id="atimestep_8c_html_a82baea7f4465d0b1372006d6d1898e69"><div class="ttname"><a href="timestep_8c.html#a82baea7f4465d0b1372006d6d1898e69">get_active_particle</a></div><div class="ttdeci">static int get_active_particle(const ActiveParticles *act, int pa)</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00068">timestep.c:68</a></div></div>
<div class="ttc" id="atimestep_8c_html_a896d6e80e5dd9d14008709479a0f8a66"><div class="ttname"><a href="timestep_8c.html#a896d6e80e5dd9d14008709479a0f8a66">is_timebin_active</a></div><div class="ttdeci">int is_timebin_active(int i, inttime_t current)</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00149">timestep.c:149</a></div></div>
<div class="ttc" id="atypes_8h_html_ab7f8779710efa655135cf9cbee3137a7"><div class="ttname"><a href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a></div><div class="ttdeci">int32_t inttime_t</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00008">types.h:8</a></div></div>
<div class="ttc" id="awalltime_8h_html_a2d23071e44d020b4a0b3f2876667d370"><div class="ttname"><a href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a></div><div class="ttdeci">#define walltime_measure(name)</div><div class="ttdef"><b>Definition:</b> <a href="walltime_8h_source.html#l00008">walltime.h:8</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="power_8c_source.html#l00027">CP</a>, <a class="el" href="timebinmgr_8c_source.html#l00256">dloga_from_dti()</a>, <a class="el" href="timestep_8c_source.html#l00396">do_the_short_range_kick()</a>, <a class="el" href="timebinmgr_8h_source.html#l00044">dti_from_timebin()</a>, <a class="el" href="endrun_8c_source.html#l00147">endrun()</a>, <a class="el" href="timestep_8c_source.html#l00068">get_active_particle()</a>, <a class="el" href="timefac_8c_source.html#l00070">get_exact_gravkick_factor()</a>, <a class="el" href="timefac_8c_source.html#l00075">get_exact_hydrokick_factor()</a>, <a class="el" href="timestep_8c_source.html#l00149">is_timebin_active()</a>, <a class="el" href="timestep_8h_source.html#l00021">DriftKickTimes::maxtimebin</a>, <a class="el" href="timestep_8h_source.html#l00020">DriftKickTimes::mintimebin</a>, <a class="el" href="timestep_8h_source.html#l00012">ActiveParticles::NumActiveParticle</a>, <a class="el" href="partmanager_8h_source.html#l00088">P</a>, <a class="el" href="timestep_8h_source.html#l00027">DriftKickTimes::Ti_Current</a>, <a class="el" href="timestep_8h_source.html#l00023">DriftKickTimes::Ti_kick</a>, <a class="el" href="timebinmgr_8h_source.html#l00013">TIMEBINS</a>, and <a class="el" href="walltime_8h_source.html#l00008">walltime_measure</a>.</p>

<p class="reference">Referenced by <a class="el" href="run_8c_source.html#l00284">run()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a8cd9d7c91611cbf3493edfa7d5491be9_cgraph.svg" width="1395" height="432"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a8cd9d7c91611cbf3493edfa7d5491be9_icgraph.svg" width="328" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a02c7db8f2f113f9e606ec6a500074f8c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02c7db8f2f113f9e606ec6a500074f8c">&#9670;&nbsp;</a></span>apply_PM_half_kick()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void apply_PM_half_kick </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structCosmology.html">Cosmology</a> *&#160;</td>
          <td class="paramname"><em>CP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDriftKickTimes.html">DriftKickTimes</a> *&#160;</td>
          <td class="paramname"><em>times</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00373">373</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;{</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="comment">/*Always do a PM half-kick, because this should be called just after a PM step*/</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keyword">const</span> <a class="code" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> tistart = times-&gt;<a class="code" href="structDriftKickTimes.html#a1c5fe7d114a58455177e26d13db726cf">PM_kick</a>;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="keyword">const</span> <a class="code" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> tiend =  tistart + times-&gt;<a class="code" href="structDriftKickTimes.html#a83e635aaf487ba9d6262105227babaaa">PM_length</a> / 2;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="comment">/* Do long-range kick */</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> Fgravkick = <a class="code" href="timefac_8c.html#ae45524bb6dcfabd035dd6edfda728079">get_exact_gravkick_factor</a>(<a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, tistart, tiend);</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="preprocessor">    #pragma omp parallel for</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a>; i++)</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    {</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <span class="keywordtype">int</span> j;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Swallowed || <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].IsGarbage)</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)  <span class="comment">/* do the kick */</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Vel[j] += <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].<a class="code" href="gravpm_8c.html#ad87ae67d47af9b3b87d59c50c4f2f781">GravPM</a>[j] * Fgravkick;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    }</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    times-&gt;<a class="code" href="structDriftKickTimes.html#a1c5fe7d114a58455177e26d13db726cf">PM_kick</a> = tiend;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Timeline/HalfKick/Long&quot;</span>);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;}</div>
<div class="ttc" id="agravpm_8c_html_ad87ae67d47af9b3b87d59c50c4f2f781"><div class="ttname"><a href="gravpm_8c.html#ad87ae67d47af9b3b87d59c50c4f2f781">GravPM</a></div><div class="ttdeci">static struct gravpm_params GravPM</div></div>
<div class="ttc" id="apartmanager_8c_html_a6cef44682776e476d8f9f1b9e1f9fe16"><div class="ttname"><a href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a></div><div class="ttdeci">struct part_manager_type PartManager[1]</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8c_source.html#l00001">partmanager.c:11</a></div></div>
<div class="ttc" id="astructDriftKickTimes_html_a1c5fe7d114a58455177e26d13db726cf"><div class="ttname"><a href="structDriftKickTimes.html#a1c5fe7d114a58455177e26d13db726cf">DriftKickTimes::PM_kick</a></div><div class="ttdeci">inttime_t PM_kick</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8h_source.html#l00031">timestep.h:31</a></div></div>
<div class="ttc" id="astructDriftKickTimes_html_a83e635aaf487ba9d6262105227babaaa"><div class="ttname"><a href="structDriftKickTimes.html#a83e635aaf487ba9d6262105227babaaa">DriftKickTimes::PM_length</a></div><div class="ttdeci">inttime_t PM_length</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8h_source.html#l00029">timestep.h:29</a></div></div>
<div class="ttc" id="astructpart__manager__type_html_a45e1f95715be50e4081af78f4ee99cb5"><div class="ttname"><a href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">part_manager_type::NumPart</a></div><div class="ttdeci">int64_t NumPart</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00076">partmanager.h:76</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="power_8c_source.html#l00027">CP</a>, <a class="el" href="timefac_8c_source.html#l00070">get_exact_gravkick_factor()</a>, <a class="el" href="gravpm_8c.html#ad87ae67d47af9b3b87d59c50c4f2f781">GravPM</a>, <a class="el" href="partmanager_8h_source.html#l00076">part_manager_type::NumPart</a>, <a class="el" href="partmanager_8h_source.html#l00088">P</a>, <a class="el" href="partmanager_8c_source.html#l00011">PartManager</a>, <a class="el" href="timestep_8h_source.html#l00031">DriftKickTimes::PM_kick</a>, <a class="el" href="timestep_8h_source.html#l00029">DriftKickTimes::PM_length</a>, and <a class="el" href="walltime_8h_source.html#l00008">walltime_measure</a>.</p>

<p class="reference">Referenced by <a class="el" href="run_8c_source.html#l00284">run()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a02c7db8f2f113f9e606ec6a500074f8c_cgraph.svg" width="1383" height="114"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a02c7db8f2f113f9e606ec6a500074f8c_icgraph.svg" width="355" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a12af8c51e47a2a92db7746c4ede67946"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12af8c51e47a2a92db7746c4ede67946">&#9670;&nbsp;</a></span>do_the_short_range_kick()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void do_the_short_range_kick </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>dt_entr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Fgravkick</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Fhydrokick</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>atime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>MinEgySpec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00396">396</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;{</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordtype">int</span> j;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Vel[j] += <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].GravAccel[j] * Fgravkick;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="comment">/* Add kick from dynamic friction and hydro drag for BHs. */</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Type == 5) {</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++){</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Vel[j] += <a class="code" href="slotsmanager_8h.html#a57267616e3ede141780cbe94358d827f">BHP</a>(i).DFAccel[j] * Fgravkick;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Vel[j] += <a class="code" href="slotsmanager_8h.html#a57267616e3ede141780cbe94358d827f">BHP</a>(i).DragAccel[j] * Fgravkick;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        }</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    }</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Type == 0) {</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="comment">/* Add kick from hydro and SPH stuff */</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++) {</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Vel[j] += <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).HydroAccel[j] * Fhydrokick;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        }</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="comment">/* Code here imposes a hard limit (default to speed of light)</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">         * on the gas velocity. This should rarely be hit.*/</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <span class="keywordtype">double</span> vv=0;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keywordflow">for</span>(j=0; j &lt; 3; j++)</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            vv += <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Vel[j] * <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Vel[j];</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        vv = sqrt(vv);</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160; </div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <span class="keywordflow">if</span>(vv &gt; 0 &amp;&amp; vv/atime &gt; <a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#a443eea8dbfadc8c5caa0734ec1ff68ec">MaxGasVel</a>) {</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(1,<span class="stringliteral">&quot;Gas Particle ID %ld exceeded the gas velocity limit: %g &gt; %g\n&quot;</span>,<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].ID, vv / atime, <a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#a443eea8dbfadc8c5caa0734ec1ff68ec">MaxGasVel</a>);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            <span class="keywordflow">for</span>(j=0;j &lt; 3; j++)</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Vel[j] *= <a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#a443eea8dbfadc8c5caa0734ec1ff68ec">MaxGasVel</a> * atime / vv;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            }</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        }</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160; </div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <span class="comment">/* Update entropy for adiabatic change*/</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Entropy += <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).DtEntropy * dt_entr;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160; </div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="comment">/* Limit entropy in simulations with cooling disabled*/</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="keywordtype">double</span> a3inv = 1/(atime * atime * atime);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> enttou = pow(<a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Density * a3inv, <a class="code" href="physconst_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a>) / <a class="code" href="physconst_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a>;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Entropy &lt; MinEgySpec/enttou)</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Entropy = MinEgySpec / enttou;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    }</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="comment">/* Check we have reasonable velocities. If we do not, try to explain why*/</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordflow">if</span>(isnan(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Vel[0]) || isnan(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Vel[1]) || isnan(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Vel[2])) {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(1, <span class="stringliteral">&quot;Vel = %g %g %g Type = %d gk = %g a_g = %g %g %g\n&quot;</span>,</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Vel[0], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Vel[1], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Vel[2], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Type,</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                Fgravkick, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].GravAccel[0], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].GravAccel[1], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].GravAccel[2]);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    }</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;}</div>
<div class="ttc" id="aendrun_8c_html_a6567cd867c5549fb6586e19ccd819764"><div class="ttname"><a href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a></div><div class="ttdeci">void message(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00175">endrun.c:175</a></div></div>
<div class="ttc" id="aphysconst_8h_html_a75216f9bf4030240b1fc0e1855e032d2"><div class="ttname"><a href="physconst_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a></div><div class="ttdeci">#define GAMMA_MINUS1</div><div class="ttdef"><b>Definition:</b> <a href="physconst_8h_source.html#l00035">physconst.h:35</a></div></div>
<div class="ttc" id="aslotsmanager_8h_html_a57267616e3ede141780cbe94358d827f"><div class="ttname"><a href="slotsmanager_8h.html#a57267616e3ede141780cbe94358d827f">BHP</a></div><div class="ttdeci">#define BHP(i)</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00125">slotsmanager.h:125</a></div></div>
<div class="ttc" id="aslotsmanager_8h_html_a681d502f5cbf25161ff026312cd1498c"><div class="ttname"><a href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a></div><div class="ttdeci">#define SPHP(i)</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00124">slotsmanager.h:124</a></div></div>
<div class="ttc" id="astructtimestep__params_html_a443eea8dbfadc8c5caa0734ec1ff68ec"><div class="ttname"><a href="structtimestep__params.html#a443eea8dbfadc8c5caa0734ec1ff68ec">timestep_params::MaxGasVel</a></div><div class="ttdeci">double MaxGasVel</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00045">timestep.c:45</a></div></div>
<div class="ttc" id="atimestep_8c_html_a9a9520c05fd90139cd00f4581dbea57a"><div class="ttname"><a href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a></div><div class="ttdeci">static struct timestep_params TimestepParams</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="slotsmanager_8h_source.html#l00125">BHP</a>, <a class="el" href="physconst_8h_source.html#l00035">GAMMA_MINUS1</a>, <a class="el" href="timestep_8c_source.html#l00045">timestep_params::MaxGasVel</a>, <a class="el" href="endrun_8c_source.html#l00175">message()</a>, <a class="el" href="partmanager_8h_source.html#l00088">P</a>, <a class="el" href="slotsmanager_8h_source.html#l00124">SPHP</a>, and <a class="el" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.</p>

<p class="reference">Referenced by <a class="el" href="timestep_8c_source.html#l00323">apply_half_kick()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a12af8c51e47a2a92db7746c4ede67946_cgraph.svg" width="592" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a12af8c51e47a2a92db7746c4ede67946_icgraph.svg" width="560" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aa7119c29751fcd9275f395e6ea08965f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7119c29751fcd9275f395e6ea08965f">&#9670;&nbsp;</a></span>find_next_kick()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> find_next_kick </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a>&#160;</td>
          <td class="paramname"><em>Ti_Current</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>minTimeBin</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function finds the next synchronization point of the system (i.e. the earliest point of time any of the particles needs a force computation), and drifts the system to this point of time. If the system drifts over the desired time of a snapshot file, the function will drift to this moment, generate an output, and then resume the drift. </p>

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00712">712</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;{</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="comment">/* Current value plus the increment for the smallest active bin. */</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keywordflow">return</span> Ti_Current + <a class="code" href="timebinmgr_8h.html#af676ea14ddc4ab85d634f5a18015038d">dti_from_timebin</a>(minTimeBin);</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="timebinmgr_8h_source.html#l00044">dti_from_timebin()</a>.</p>

<p class="reference">Referenced by <a class="el" href="run_8c_source.html#l00284">run()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_aa7119c29751fcd9275f395e6ea08965f_cgraph.svg" width="310" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_aa7119c29751fcd9275f395e6ea08965f_icgraph.svg" width="320" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a7f8bb9951920bdc3a2138d91f1cfc61c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f8bb9951920bdc3a2138d91f1cfc61c">&#9670;&nbsp;</a></span>find_timesteps()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int find_timesteps </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structActiveParticles.html">ActiveParticles</a> *&#160;</td>
          <td class="paramname"><em>act</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDriftKickTimes.html">DriftKickTimes</a> *&#160;</td>
          <td class="paramname"><em>times</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>atime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>FastParticleType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structCosmology.html">Cosmology</a> *&#160;</td>
          <td class="paramname"><em>CP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>asmth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>isFirstTimeStep</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00176">176</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;{</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordtype">int</span> pa;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <a class="code" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> dti_min = <a class="code" href="timebinmgr_8h.html#ad44dabdb7a0bef8536e2d34a01177d48">TIMEBASE</a>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160; </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Misc&quot;</span>);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">/*Update the PM timestep size */</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> isPM = <a class="code" href="timestep_8c.html#a1da56439eb88b453b1ae0122f15d8dc1">is_PM_timestep</a>(times);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <a class="code" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> dti_max = times-&gt;<a class="code" href="structDriftKickTimes.html#a83e635aaf487ba9d6262105227babaaa">PM_length</a>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordflow">if</span>(isPM) {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        dti_max = <a class="code" href="timestep_8c.html#aaf0018d0dda92e6c10da475d5a8ffd1d">get_PM_timestep_ti</a>(times, atime, <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, FastParticleType, asmth);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        times-&gt;<a class="code" href="structDriftKickTimes.html#a83e635aaf487ba9d6262105227babaaa">PM_length</a> = dti_max;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        times-&gt;<a class="code" href="structDriftKickTimes.html#a91cbbd31ecae58c72055b9248e457e85">PM_start</a> = times-&gt;<a class="code" href="structDriftKickTimes.html#a1c5fe7d114a58455177e26d13db726cf">PM_kick</a>;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    }</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> hubble = <a class="code" href="cosmology_8c.html#ab425f16e6fe06110e2fb4944065b81bb">hubble_function</a>(<a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, atime);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="comment">/* Now assign new timesteps and kick */</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#a97d08be54a1ba3a50904f948c75705e9">ForceEqualTimesteps</a>) {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="preprocessor">        #pragma omp parallel for reduction(min:dti_min)</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a>; i++)</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <span class="keyword">enum</span> <a class="code" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791ba">TimeStepType</a> titype;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <span class="comment">/* Because we don&#39;t GC on short timesteps, there can be garbage here.</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">             * Avoid making it active. */</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].IsGarbage || <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Swallowed)</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            <a class="code" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> dti = <a class="code" href="timestep_8c.html#ac8b84367ec16a894fbc4510defa6a167">get_timestep_ti</a>(i, dti_max, times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>, atime, hubble, &amp;titype);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            <span class="keywordflow">if</span>(dti &lt; dti_min)</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                dti_min = dti;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        MPI_Allreduce(MPI_IN_PLACE, &amp;dti_min, 1, MPI_INT, MPI_MIN, MPI_COMM_WORLD);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    int64_t ntiaccel=0, nticourant=0, ntiaccrete=0, ntineighbour=0, ntihsml=0;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordtype">int</span> badstepsizecount = 0;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordtype">int</span> mTimeBin = <a class="code" href="timebinmgr_8h.html#a4668a3a5f210b5742a179c8d258a703d">TIMEBINS</a>, maxTimeBin = 0;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="preprocessor">    #pragma omp parallel for reduction(min: mTimeBin) reduction(+: badstepsizecount, ntiaccel, nticourant, ntiaccrete, ntineighbour, ntihsml) reduction(max:maxTimeBin)</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">for</span>(pa = 0; pa &lt; act-&gt;<a class="code" href="structActiveParticles.html#a847ab898fdabc62a4723c7c3a66038d4">NumActiveParticle</a>; pa++)</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    {</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> i = <a class="code" href="timestep_8c.html#a82baea7f4465d0b1372006d6d1898e69">get_active_particle</a>(act, pa);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].IsGarbage || <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Swallowed)</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="keyword">enum</span> <a class="code" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791ba">TimeStepType</a> titype;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <a class="code" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> dti;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#a97d08be54a1ba3a50904f948c75705e9">ForceEqualTimesteps</a>) {</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            dti = dti_min;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            dti = <a class="code" href="timestep_8c.html#ac8b84367ec16a894fbc4510defa6a167">get_timestep_ti</a>(i, dti_max, times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>, atime, hubble, &amp;titype);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            <span class="keywordflow">if</span>(titype == <a class="code" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baa76b68035165a9358aa74f58389fdbd45">TI_ACCEL</a>)</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                ntiaccel++;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (titype == <a class="code" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baa6611ae5ddb582819d2082b4e841fde29">TI_COURANT</a>)</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                nticourant++;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (titype == <a class="code" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baae9a49bc969dbba59dcea2fc12fbf3f36">TI_ACCRETE</a>)</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                ntiaccrete++;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (titype == <a class="code" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baa1ce55196388f86c21f1c542260078268">TI_NEIGH</a>)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                ntineighbour++;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (titype == <a class="code" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baaecf5a22337645488f735250e6a0efe43">TI_HSML</a>)</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                ntihsml++;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160; </div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="comment">/* make it a power 2 subdivision */</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        dti = <a class="code" href="timebinmgr_8c.html#a670638d37437095012fe1effdc9c1098">round_down_power_of_two</a>(dti);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="keywordtype">int</span> bin = <a class="code" href="timestep_8c.html#acd31a672ca9dfbbf3c03f14f1e3baec6">get_timestep_bin</a>(dti);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="keywordflow">if</span>(bin &lt; 1) {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(1, <span class="stringliteral">&quot;Time-step of integer size %d not allowed, id = %lu, debugging info follows.\n&quot;</span>, dti, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].ID);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            badstepsizecount++;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        }</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordtype">int</span> binold = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].TimeBin;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="comment">/* timestep wants to increase */</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="keywordflow">if</span>(bin &gt; binold)</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        {</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            <span class="comment">/* make sure the new step is currently active,</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">             * so that particles do not miss a step */</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            <span class="keywordflow">while</span>(!<a class="code" href="timestep_8c.html#a896d6e80e5dd9d14008709479a0f8a66">is_timebin_active</a>(bin, times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>) &amp;&amp; bin &gt; binold &amp;&amp; bin &gt; 1)</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                bin--;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        }</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="comment">/* This moves particles between time bins:</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">         * active particles always remain active</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">         * until rebuild_activelist is called</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">         * (after domain, on new timestep).*/</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].TimeBin = bin;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="comment">/*Find max and min*/</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="keywordflow">if</span>(bin &lt; mTimeBin)</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            mTimeBin = bin;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="keywordflow">if</span>(bin &gt; maxTimeBin)</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            maxTimeBin = bin;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    }</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    MPI_Allreduce(MPI_IN_PLACE, &amp;badstepsizecount, 1, MPI_INT, MPI_SUM, MPI_COMM_WORLD);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    MPI_Allreduce(MPI_IN_PLACE, &amp;mTimeBin, 1, MPI_INT, MPI_MIN, MPI_COMM_WORLD);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    MPI_Allreduce(MPI_IN_PLACE, &amp;maxTimeBin, 1, MPI_INT, MPI_MAX, MPI_COMM_WORLD);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    MPI_Allreduce(MPI_IN_PLACE, &amp;ntiaccel, 1, <a class="code" href="system_8h.html#abb95c0be39c73f8e6b0978a9a374d92b">MPI_INT64</a>, MPI_SUM, MPI_COMM_WORLD);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    MPI_Allreduce(MPI_IN_PLACE, &amp;nticourant, 1, <a class="code" href="system_8h.html#abb95c0be39c73f8e6b0978a9a374d92b">MPI_INT64</a>, MPI_SUM, MPI_COMM_WORLD);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    MPI_Allreduce(MPI_IN_PLACE, &amp;ntihsml, 1, <a class="code" href="system_8h.html#abb95c0be39c73f8e6b0978a9a374d92b">MPI_INT64</a>, MPI_SUM, MPI_COMM_WORLD);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    MPI_Allreduce(MPI_IN_PLACE, &amp;ntiaccrete, 1, <a class="code" href="system_8h.html#abb95c0be39c73f8e6b0978a9a374d92b">MPI_INT64</a>, MPI_SUM, MPI_COMM_WORLD);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    MPI_Allreduce(MPI_IN_PLACE, &amp;ntineighbour, 1, <a class="code" href="system_8h.html#abb95c0be39c73f8e6b0978a9a374d92b">MPI_INT64</a>, MPI_SUM, MPI_COMM_WORLD);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160; </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">/* Ensure that the PM timestep is not longer than the longest tree timestep;</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">     * this prevents particles in the longest timestep being active and moving into a higher bin</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">     * between PM timesteps, thus skipping the PM step entirely.*/</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">if</span>(isPM &amp;&amp; times-&gt;<a class="code" href="structDriftKickTimes.html#a83e635aaf487ba9d6262105227babaaa">PM_length</a> &gt; <a class="code" href="timebinmgr_8h.html#af676ea14ddc4ab85d634f5a18015038d">dti_from_timebin</a>(maxTimeBin))</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        times-&gt;<a class="code" href="structDriftKickTimes.html#a83e635aaf487ba9d6262105227babaaa">PM_length</a> = <a class="code" href="timebinmgr_8h.html#af676ea14ddc4ab85d634f5a18015038d">dti_from_timebin</a>(maxTimeBin);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;PM timebin: %x (dloga: %g Max: %g). Criteria: Accel: %ld Soundspeed: %ld DivVel: %ld Accrete: %ld Neighbour: %ld\n&quot;</span>,</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            times-&gt;<a class="code" href="structDriftKickTimes.html#a83e635aaf487ba9d6262105227babaaa">PM_length</a>, <a class="code" href="timebinmgr_8c.html#a7166c93d068baea59abf2ef8cee3c7aa">dloga_from_dti</a>(times-&gt;<a class="code" href="structDriftKickTimes.html#a83e635aaf487ba9d6262105227babaaa">PM_length</a>, times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>), <a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#a03e0c2042baceb109e580450df0e2075">MaxSizeTimestep</a>,</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            ntiaccel, nticourant, ntihsml, ntiaccrete, ntineighbour);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160; </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="comment">/* BH particles have their timesteps set by a timestep limiter.</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">     * On the first timestep this is not effective because all the particles have zero timestep.</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">     * So on the first timestep only set all BH particles to the smallest allowable timestep*/</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">if</span>(isFirstTimeStep) {</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="preprocessor">        #pragma omp parallel for</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordflow">for</span>(pa = 0; pa &lt; <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a>; pa++)</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[pa].Type == 5)</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[pa].TimeBin = mTimeBin;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        }</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    }</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Timeline&quot;</span>);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    times-&gt;<a class="code" href="structDriftKickTimes.html#ad3b4fe6ff2b0e0be706882c59323621e">mintimebin</a> = mTimeBin;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    times-&gt;<a class="code" href="structDriftKickTimes.html#a456360252b612364b9b5888d75e5c7f0">maxtimebin</a> = maxTimeBin;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordflow">return</span> badstepsizecount;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;}</div>
<div class="ttc" id="acosmology_8c_html_ab425f16e6fe06110e2fb4944065b81bb"><div class="ttname"><a href="cosmology_8c.html#ab425f16e6fe06110e2fb4944065b81bb">hubble_function</a></div><div class="ttdeci">double hubble_function(const Cosmology *CP, double a)</div><div class="ttdef"><b>Definition:</b> <a href="cosmology_8c_source.html#l00058">cosmology.c:58</a></div></div>
<div class="ttc" id="astructDriftKickTimes_html_a91cbbd31ecae58c72055b9248e457e85"><div class="ttname"><a href="structDriftKickTimes.html#a91cbbd31ecae58c72055b9248e457e85">DriftKickTimes::PM_start</a></div><div class="ttdeci">inttime_t PM_start</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8h_source.html#l00030">timestep.h:30</a></div></div>
<div class="ttc" id="astructtimestep__params_html_a03e0c2042baceb109e580450df0e2075"><div class="ttname"><a href="structtimestep__params.html#a03e0c2042baceb109e580450df0e2075">timestep_params::MaxSizeTimestep</a></div><div class="ttdeci">double MaxSizeTimestep</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00036">timestep.c:36</a></div></div>
<div class="ttc" id="astructtimestep__params_html_a97d08be54a1ba3a50904f948c75705e9"><div class="ttname"><a href="structtimestep__params.html#a97d08be54a1ba3a50904f948c75705e9">timestep_params::ForceEqualTimesteps</a></div><div class="ttdeci">int ForceEqualTimesteps</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00033">timestep.c:33</a></div></div>
<div class="ttc" id="asystem_8h_html_abb95c0be39c73f8e6b0978a9a374d92b"><div class="ttname"><a href="system_8h.html#abb95c0be39c73f8e6b0978a9a374d92b">MPI_INT64</a></div><div class="ttdeci">#define MPI_INT64</div><div class="ttdef"><b>Definition:</b> <a href="system_8h_source.html#l00012">system.h:12</a></div></div>
<div class="ttc" id="atimebinmgr_8c_html_a670638d37437095012fe1effdc9c1098"><div class="ttname"><a href="timebinmgr_8c.html#a670638d37437095012fe1effdc9c1098">round_down_power_of_two</a></div><div class="ttdeci">inttime_t round_down_power_of_two(inttime_t dti)</div><div class="ttdef"><b>Definition:</b> <a href="timebinmgr_8c_source.html#l00286">timebinmgr.c:286</a></div></div>
<div class="ttc" id="atimebinmgr_8h_html_ad44dabdb7a0bef8536e2d34a01177d48"><div class="ttname"><a href="timebinmgr_8h.html#ad44dabdb7a0bef8536e2d34a01177d48">TIMEBASE</a></div><div class="ttdeci">#define TIMEBASE</div><div class="ttdef"><b>Definition:</b> <a href="timebinmgr_8h_source.html#l00014">timebinmgr.h:14</a></div></div>
<div class="ttc" id="atimestep_8c_html_a1da56439eb88b453b1ae0122f15d8dc1"><div class="ttname"><a href="timestep_8c.html#a1da56439eb88b453b1ae0122f15d8dc1">is_PM_timestep</a></div><div class="ttdeci">int is_PM_timestep(const DriftKickTimes *const times)</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00160">timestep.c:160</a></div></div>
<div class="ttc" id="atimestep_8c_html_aaf0018d0dda92e6c10da475d5a8ffd1d"><div class="ttname"><a href="timestep_8c.html#aaf0018d0dda92e6c10da475d5a8ffd1d">get_PM_timestep_ti</a></div><div class="ttdeci">static inttime_t get_PM_timestep_ti(const DriftKickTimes *const times, const double atime, const Cosmology *CP, const int FastParticleType, const double asmth)</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00667">timestep.c:667</a></div></div>
<div class="ttc" id="atimestep_8c_html_ac8b84367ec16a894fbc4510defa6a167"><div class="ttname"><a href="timestep_8c.html#ac8b84367ec16a894fbc4510defa6a167">get_timestep_ti</a></div><div class="ttdeci">static inttime_t get_timestep_ti(const int p, const inttime_t dti_max, const inttime_t Ti_Current, const double atime, const double hubble, enum TimeStepType *titype)</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00537">timestep.c:537</a></div></div>
<div class="ttc" id="atimestep_8c_html_acd31a672ca9dfbbf3c03f14f1e3baec6"><div class="ttname"><a href="timestep_8c.html#acd31a672ca9dfbbf3c03f14f1e3baec6">get_timestep_bin</a></div><div class="ttdeci">static int get_timestep_bin(inttime_t dti)</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00686">timestep.c:686</a></div></div>
<div class="ttc" id="atimestep_8c_html_ad2dde160974c283ccf8f0ce280f791ba"><div class="ttname"><a href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791ba">TimeStepType</a></div><div class="ttdeci">TimeStepType</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00106">timestep.c:107</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="power_8c_source.html#l00027">CP</a>, <a class="el" href="timebinmgr_8c_source.html#l00256">dloga_from_dti()</a>, <a class="el" href="timebinmgr_8h_source.html#l00044">dti_from_timebin()</a>, <a class="el" href="timestep_8c_source.html#l00033">timestep_params::ForceEqualTimesteps</a>, <a class="el" href="timestep_8c_source.html#l00068">get_active_particle()</a>, <a class="el" href="timestep_8c_source.html#l00667">get_PM_timestep_ti()</a>, <a class="el" href="timestep_8c_source.html#l00686">get_timestep_bin()</a>, <a class="el" href="timestep_8c_source.html#l00537">get_timestep_ti()</a>, <a class="el" href="cosmology_8c_source.html#l00058">hubble_function()</a>, <a class="el" href="timestep_8c_source.html#l00160">is_PM_timestep()</a>, <a class="el" href="timestep_8c_source.html#l00149">is_timebin_active()</a>, <a class="el" href="timestep_8c_source.html#l00036">timestep_params::MaxSizeTimestep</a>, <a class="el" href="timestep_8h_source.html#l00021">DriftKickTimes::maxtimebin</a>, <a class="el" href="endrun_8c_source.html#l00175">message()</a>, <a class="el" href="timestep_8h_source.html#l00020">DriftKickTimes::mintimebin</a>, <a class="el" href="system_8h_source.html#l00012">MPI_INT64</a>, <a class="el" href="timestep_8h_source.html#l00012">ActiveParticles::NumActiveParticle</a>, <a class="el" href="partmanager_8h_source.html#l00076">part_manager_type::NumPart</a>, <a class="el" href="partmanager_8h_source.html#l00088">P</a>, <a class="el" href="partmanager_8c_source.html#l00011">PartManager</a>, <a class="el" href="timestep_8h_source.html#l00031">DriftKickTimes::PM_kick</a>, <a class="el" href="timestep_8h_source.html#l00029">DriftKickTimes::PM_length</a>, <a class="el" href="timestep_8h_source.html#l00030">DriftKickTimes::PM_start</a>, <a class="el" href="timebinmgr_8c_source.html#l00286">round_down_power_of_two()</a>, <a class="el" href="timestep_8c_source.html#l00108">TI_ACCEL</a>, <a class="el" href="timestep_8c_source.html#l00110">TI_ACCRETE</a>, <a class="el" href="timestep_8c_source.html#l00109">TI_COURANT</a>, <a class="el" href="timestep_8h_source.html#l00027">DriftKickTimes::Ti_Current</a>, <a class="el" href="timestep_8c_source.html#l00112">TI_HSML</a>, <a class="el" href="timestep_8c_source.html#l00111">TI_NEIGH</a>, <a class="el" href="timebinmgr_8h_source.html#l00014">TIMEBASE</a>, <a class="el" href="timebinmgr_8h_source.html#l00013">TIMEBINS</a>, <a class="el" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>, and <a class="el" href="walltime_8h_source.html#l00008">walltime_measure</a>.</p>

<p class="reference">Referenced by <a class="el" href="run_8c_source.html#l00284">run()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a7f8bb9951920bdc3a2138d91f1cfc61c_cgraph.svg" width="1516" height="800"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a7f8bb9951920bdc3a2138d91f1cfc61c_icgraph.svg" width="323" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aec3f9fb84aa5cda053a144da6588ffcd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aec3f9fb84aa5cda053a144da6588ffcd">&#9670;&nbsp;</a></span>free_activelist()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_activelist </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structActiveParticles.html">ActiveParticles</a> *&#160;</td>
          <td class="paramname"><em>act</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00795">795</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;{</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="keywordflow">if</span>(act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a>) {</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a>);</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    }</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <a class="code" href="event_8c.html#a4b5347d345f55b1b454c1eeb02916ca8">event_unlisten</a>(&amp;<a class="code" href="event_8c.html#aafc3f0c1fffb6f0a19f5f3ecd24474c7">EventSlotsFork</a>, <a class="code" href="timestep_8c.html#a7f89b5c29a35ca695a22d09f18d2807a">timestep_eh_slots_fork</a>, act);</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;}</div>
<div class="ttc" id="aevent_8c_html_a4b5347d345f55b1b454c1eeb02916ca8"><div class="ttname"><a href="event_8c.html#a4b5347d345f55b1b454c1eeb02916ca8">event_unlisten</a></div><div class="ttdeci">int event_unlisten(EventSpec *eh, eventfunc func, void *userdata)</div><div class="ttdef"><b>Definition:</b> <a href="event_8c_source.html#l00026">event.c:26</a></div></div>
<div class="ttc" id="aevent_8c_html_aafc3f0c1fffb6f0a19f5f3ecd24474c7"><div class="ttname"><a href="event_8c.html#aafc3f0c1fffb6f0a19f5f3ecd24474c7">EventSlotsFork</a></div><div class="ttdeci">EventSpec EventSlotsFork</div><div class="ttdef"><b>Definition:</b> <a href="event_8c_source.html#l00054">event.c:54</a></div></div>
<div class="ttc" id="amymalloc_8h_html_af469c2f7e504a771f5d8a91ac9623240"><div class="ttname"><a href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a></div><div class="ttdeci">#define myfree(x)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00019">mymalloc.h:19</a></div></div>
<div class="ttc" id="astructActiveParticles_html_a1b0b230f3890d70bae976516719b7d07"><div class="ttname"><a href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticles::ActiveParticle</a></div><div class="ttdeci">int * ActiveParticle</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8h_source.html#l00013">timestep.h:13</a></div></div>
<div class="ttc" id="atimestep_8c_html_a7f89b5c29a35ca695a22d09f18d2807a"><div class="ttname"><a href="timestep_8c.html#a7f89b5c29a35ca695a22d09f18d2807a">timestep_eh_slots_fork</a></div><div class="ttdeci">static int timestep_eh_slots_fork(EIBase *event, void *userdata)</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00077">timestep.c:77</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="timestep_8h_source.html#l00013">ActiveParticles::ActiveParticle</a>, <a class="el" href="event_8c_source.html#l00026">event_unlisten()</a>, <a class="el" href="event_8c_source.html#l00054">EventSlotsFork</a>, <a class="el" href="mymalloc_8h_source.html#l00019">myfree</a>, and <a class="el" href="timestep_8c_source.html#l00077">timestep_eh_slots_fork()</a>.</p>

<p class="reference">Referenced by <a class="el" href="run_8c_source.html#l00284">run()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_aec3f9fb84aa5cda053a144da6588ffcd_cgraph.svg" width="886" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_aec3f9fb84aa5cda053a144da6588ffcd_icgraph.svg" width="319" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a82baea7f4465d0b1372006d6d1898e69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82baea7f4465d0b1372006d6d1898e69">&#9670;&nbsp;</a></span>get_active_particle()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int get_active_particle </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structActiveParticles.html">ActiveParticles</a> *&#160;</td>
          <td class="paramname"><em>act</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pa</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00068">68</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;{</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordflow">if</span>(act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a>)</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="keywordflow">return</span> act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a>[pa];</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keywordflow">return</span> pa;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="timestep_8h_source.html#l00013">ActiveParticles::ActiveParticle</a>.</p>

<p class="reference">Referenced by <a class="el" href="timestep_8c_source.html#l00323">apply_half_kick()</a>, and <a class="el" href="timestep_8c_source.html#l00176">find_timesteps()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a82baea7f4465d0b1372006d6d1898e69_icgraph.svg" width="523" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a359495157e1978aa5922615da9432a4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a359495157e1978aa5922615da9432a4d">&#9670;&nbsp;</a></span>get_atime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double get_atime </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a>&#160;</td>
          <td class="paramname"><em>Ti_Current</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00168">168</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                                      {</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">return</span> exp(<a class="code" href="test__timefac_8c.html#a5b77523ed91eb413cb28b12d8c2ceb46">loga_from_ti</a>(Ti_Current));</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;}</div>
<div class="ttc" id="atest__timefac_8c_html_a5b77523ed91eb413cb28b12d8c2ceb46"><div class="ttname"><a href="test__timefac_8c.html#a5b77523ed91eb413cb28b12d8c2ceb46">loga_from_ti</a></div><div class="ttdeci">double loga_from_ti(int ti)</div><div class="ttdef"><b>Definition:</b> <a href="test__timefac_8c_source.html#l00051">test_timefac.c:51</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="test__timefac_8c_source.html#l00051">loga_from_ti()</a>.</p>

<p class="reference">Referenced by <a class="el" href="run_8c_source.html#l00284">run()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a359495157e1978aa5922615da9432a4d_cgraph.svg" width="251" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a359495157e1978aa5922615da9432a4d_icgraph.svg" width="292" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a7de7f3fa793e7794724b27aa49b08c60"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7de7f3fa793e7794724b27aa49b08c60">&#9670;&nbsp;</a></span>get_long_range_timestep_dloga()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double get_long_range_timestep_dloga </td>
          <td>(</td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>atime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structCosmology.html">Cosmology</a> *&#160;</td>
          <td class="paramname"><em>CP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>FastParticleType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>asmth</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function computes the PM timestep of the system based on the rms velocities of particles. For cosmological simulations, the criterion used is that the rms displacement should be at most a fraction MaxRMSDisplacementFac of the mean particle separation. Note that the latter is estimated using the assigned particle masses, separately for each particle type. </p>

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00584">584</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;{</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keywordtype">int</span> i, type;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordtype">int</span> count[6];</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    int64_t <a class="code" href="system_8c.html#a1d471d98379273269e8045d2998eca73">count_sum</a>[6];</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordtype">double</span> v[6], v_sum[6], mim[6], min_mass[6];</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> = <a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#a03e0c2042baceb109e580450df0e2075">MaxSizeTimestep</a>;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160; </div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keywordflow">for</span>(type = 0; type &lt; 6; type++)</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    {</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        count[type] = 0;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        v[type] = 0;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        mim[type] = 1.0e30;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    }</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160; </div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a>; i++)</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    {</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        v[<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Type] += <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Vel[0] * <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Vel[0] + <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Vel[1] * <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Vel[1] + <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Vel[2] * <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Vel[2];</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Mass &gt; 0)</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        {</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            <span class="keywordflow">if</span>(mim[<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Type] &gt; <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Mass)</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                mim[<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Type] = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Mass;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        }</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        count[<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Type]++;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    }</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160; </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    MPI_Allreduce(v, v_sum, 6, MPI_DOUBLE, MPI_SUM, MPI_COMM_WORLD);</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    MPI_Allreduce(mim, min_mass, 6, MPI_DOUBLE, MPI_MIN, MPI_COMM_WORLD);</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160; </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <a class="code" href="system_8c.html#a866c4b0425665030c89933c11752b1fe">sumup_large_ints</a>(6, count, <a class="code" href="system_8c.html#a1d471d98379273269e8045d2998eca73">count_sum</a>);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160; </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="comment">/* add star, gas and black hole particles together to treat them on equal footing,</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment">     * using the original gas particle spacing. */</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    v_sum[0] += v_sum[4];</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <a class="code" href="system_8c.html#a1d471d98379273269e8045d2998eca73">count_sum</a>[0] += <a class="code" href="system_8c.html#a1d471d98379273269e8045d2998eca73">count_sum</a>[4];</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    v_sum[4] = v_sum[0];</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <a class="code" href="system_8c.html#a1d471d98379273269e8045d2998eca73">count_sum</a>[4] = <a class="code" href="system_8c.html#a1d471d98379273269e8045d2998eca73">count_sum</a>[0];</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    v_sum[0] += v_sum[5];</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <a class="code" href="system_8c.html#a1d471d98379273269e8045d2998eca73">count_sum</a>[0] += <a class="code" href="system_8c.html#a1d471d98379273269e8045d2998eca73">count_sum</a>[5];</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    v_sum[5] = v_sum[0];</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <a class="code" href="system_8c.html#a1d471d98379273269e8045d2998eca73">count_sum</a>[5] = <a class="code" href="system_8c.html#a1d471d98379273269e8045d2998eca73">count_sum</a>[0];</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    min_mass[5] = min_mass[0];</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160; </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> hubble = <a class="code" href="cosmology_8c.html#ab425f16e6fe06110e2fb4944065b81bb">hubble_function</a>(<a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, atime);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="keywordflow">for</span>(type = 0; type &lt; 6; type++)</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    {</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="system_8c.html#a1d471d98379273269e8045d2998eca73">count_sum</a>[type] &gt; 0)</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        {</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            <span class="keywordtype">double</span> omega, dmean, dloga1;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            <span class="comment">/* Type 4 is stars, type 5 is BHs, both baryons*/</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            <span class="keywordflow">if</span>(type == 0 || type == 4 || type == 5) {</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                omega = <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#ac818659114fd72f09039b088e43e8624">OmegaBaryon</a>;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            <span class="comment">/* In practice usually FastParticleType == 2</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="comment">             * so this doesn&#39;t matter. */</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == 2) {</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                omega = <a class="code" href="omega__nu__single_8c.html#aca4b20af5bd369bcd096c670c27c6e36">get_omega_nu</a>(&amp;<a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#af03043a56ad2b2b697762d127b8b906b">ONu</a>, 1);</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                omega = <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#a995952fa5ad4fbba9dbb634dff24bdde">OmegaCDM</a>;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;            }</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            <span class="comment">/* &quot;Avg. radius&quot; of smallest particle: (min_mass/total_mass)^1/3 */</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            dmean = pow(min_mass[type] / (omega * 3 * <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#af1c6029696c00e5405054f00e849e972">Hubble</a> * <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#af1c6029696c00e5405054f00e849e972">Hubble</a> / (8 * M_PI * <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#a0970aac048f04a9ccd8778aaf07a0bbc">GravInternal</a>)), 1.0 / 3);</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160; </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            dloga1 = <a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#a77809e5f4e2fc3387e743eaa9fc329dc">MaxRMSDisplacementFac</a> * hubble * atime * atime * <a class="code" href="test__interp_8c.html#a1db59759040598e9d64b7319d1e64c32">DMIN</a>(asmth, dmean) / sqrt(v_sum[type] / <a class="code" href="system_8c.html#a1d471d98379273269e8045d2998eca73">count_sum</a>[type]);</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;type=%d  dmean=%g asmth=%g minmass=%g a=%g  sqrt(&lt;p^2&gt;)=%g  dloga=%g\n&quot;</span>,</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                    type, dmean, asmth, min_mass[type], atime, sqrt(v_sum[type] / <a class="code" href="system_8c.html#a1d471d98379273269e8045d2998eca73">count_sum</a>[type]), dloga1);</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;            <span class="comment">/* don&#39;t constrain the step to the neutrinos */</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            <span class="keywordflow">if</span>(type != FastParticleType &amp;&amp; dloga1 &lt; <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a>)</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> = dloga1;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        }</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    }</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> &lt; <a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#a638b86b8ff28a851bb56a9ed17ec039c">MinSizeTimestep</a>) {</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> = <a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#a638b86b8ff28a851bb56a9ed17ec039c">MinSizeTimestep</a>;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    }</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160; </div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a>;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;}</div>
<div class="ttc" id="alightcone_8c_html_a8f3ab427b30a3327076ffcc7c683562c"><div class="ttname"><a href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a></div><div class="ttdeci">static double dloga</div><div class="ttdef"><b>Definition:</b> <a href="lightcone_8c_source.html#l00021">lightcone.c:21</a></div></div>
<div class="ttc" id="aomega__nu__single_8c_html_aca4b20af5bd369bcd096c670c27c6e36"><div class="ttname"><a href="omega__nu__single_8c.html#aca4b20af5bd369bcd096c670c27c6e36">get_omega_nu</a></div><div class="ttdeci">double get_omega_nu(const _omega_nu *const omnu, const double a)</div><div class="ttdef"><b>Definition:</b> <a href="omega__nu__single_8c_source.html#l00057">omega_nu_single.c:57</a></div></div>
<div class="ttc" id="astructCosmology_html_a0970aac048f04a9ccd8778aaf07a0bbc"><div class="ttname"><a href="structCosmology.html#a0970aac048f04a9ccd8778aaf07a0bbc">Cosmology::GravInternal</a></div><div class="ttdeci">double GravInternal</div><div class="ttdef"><b>Definition:</b> <a href="cosmology_8h_source.html#l00032">cosmology.h:32</a></div></div>
<div class="ttc" id="astructCosmology_html_a995952fa5ad4fbba9dbb634dff24bdde"><div class="ttname"><a href="structCosmology.html#a995952fa5ad4fbba9dbb634dff24bdde">Cosmology::OmegaCDM</a></div><div class="ttdeci">double OmegaCDM</div><div class="ttdef"><b>Definition:</b> <a href="cosmology_8h_source.html#l00011">cosmology.h:11</a></div></div>
<div class="ttc" id="astructCosmology_html_ac818659114fd72f09039b088e43e8624"><div class="ttname"><a href="structCosmology.html#ac818659114fd72f09039b088e43e8624">Cosmology::OmegaBaryon</a></div><div class="ttdeci">double OmegaBaryon</div><div class="ttdef"><b>Definition:</b> <a href="cosmology_8h_source.html#l00019">cosmology.h:19</a></div></div>
<div class="ttc" id="astructCosmology_html_af03043a56ad2b2b697762d127b8b906b"><div class="ttname"><a href="structCosmology.html#af03043a56ad2b2b697762d127b8b906b">Cosmology::ONu</a></div><div class="ttdeci">_omega_nu ONu</div><div class="ttdef"><b>Definition:</b> <a href="cosmology_8h_source.html#l00024">cosmology.h:24</a></div></div>
<div class="ttc" id="astructCosmology_html_af1c6029696c00e5405054f00e849e972"><div class="ttname"><a href="structCosmology.html#af1c6029696c00e5405054f00e849e972">Cosmology::Hubble</a></div><div class="ttdeci">double Hubble</div><div class="ttdef"><b>Definition:</b> <a href="cosmology_8h_source.html#l00021">cosmology.h:21</a></div></div>
<div class="ttc" id="astructtimestep__params_html_a638b86b8ff28a851bb56a9ed17ec039c"><div class="ttname"><a href="structtimestep__params.html#a638b86b8ff28a851bb56a9ed17ec039c">timestep_params::MinSizeTimestep</a></div><div class="ttdeci">double MinSizeTimestep</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00034">timestep.c:35</a></div></div>
<div class="ttc" id="astructtimestep__params_html_a77809e5f4e2fc3387e743eaa9fc329dc"><div class="ttname"><a href="structtimestep__params.html#a77809e5f4e2fc3387e743eaa9fc329dc">timestep_params::MaxRMSDisplacementFac</a></div><div class="ttdeci">double MaxRMSDisplacementFac</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00038">timestep.c:38</a></div></div>
<div class="ttc" id="asystem_8c_html_a1d471d98379273269e8045d2998eca73"><div class="ttname"><a href="system_8c.html#a1d471d98379273269e8045d2998eca73">count_sum</a></div><div class="ttdeci">int64_t count_sum(int64_t countLocal)</div><div class="ttdef"><b>Definition:</b> <a href="system_8c_source.html#l00264">system.c:264</a></div></div>
<div class="ttc" id="asystem_8c_html_a866c4b0425665030c89933c11752b1fe"><div class="ttname"><a href="system_8c.html#a866c4b0425665030c89933c11752b1fe">sumup_large_ints</a></div><div class="ttdeci">void sumup_large_ints(int n, int *src, int64_t *res)</div><div class="ttdef"><b>Definition:</b> <a href="system_8c_source.html#l00192">system.c:192</a></div></div>
<div class="ttc" id="atest__interp_8c_html_a1db59759040598e9d64b7319d1e64c32"><div class="ttname"><a href="test__interp_8c.html#a1db59759040598e9d64b7319d1e64c32">DMIN</a></div><div class="ttdeci">#define DMIN(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="test__interp_8c_source.html#l00012">test_interp.c:12</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="system_8c_source.html#l00264">count_sum()</a>, <a class="el" href="power_8c_source.html#l00027">CP</a>, <a class="el" href="lightcone_8c_source.html#l00021">dloga</a>, <a class="el" href="test__interp_8c_source.html#l00012">DMIN</a>, <a class="el" href="omega__nu__single_8c_source.html#l00057">get_omega_nu()</a>, <a class="el" href="cosmology_8h_source.html#l00032">Cosmology::GravInternal</a>, <a class="el" href="cosmology_8h_source.html#l00021">Cosmology::Hubble</a>, <a class="el" href="cosmology_8c_source.html#l00058">hubble_function()</a>, <a class="el" href="timestep_8c_source.html#l00038">timestep_params::MaxRMSDisplacementFac</a>, <a class="el" href="timestep_8c_source.html#l00036">timestep_params::MaxSizeTimestep</a>, <a class="el" href="endrun_8c_source.html#l00175">message()</a>, <a class="el" href="timestep_8c_source.html#l00035">timestep_params::MinSizeTimestep</a>, <a class="el" href="partmanager_8h_source.html#l00076">part_manager_type::NumPart</a>, <a class="el" href="cosmology_8h_source.html#l00019">Cosmology::OmegaBaryon</a>, <a class="el" href="cosmology_8h_source.html#l00011">Cosmology::OmegaCDM</a>, <a class="el" href="cosmology_8h_source.html#l00024">Cosmology::ONu</a>, <a class="el" href="partmanager_8h_source.html#l00088">P</a>, <a class="el" href="partmanager_8c_source.html#l00011">PartManager</a>, <a class="el" href="system_8c_source.html#l00192">sumup_large_ints()</a>, and <a class="el" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.</p>

<p class="reference">Referenced by <a class="el" href="timestep_8c_source.html#l00667">get_PM_timestep_ti()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a7de7f3fa793e7794724b27aa49b08c60_cgraph.svg" width="1054" height="240"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a7de7f3fa793e7794724b27aa49b08c60_icgraph.svg" width="756" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aaf0018d0dda92e6c10da475d5a8ffd1d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf0018d0dda92e6c10da475d5a8ffd1d">&#9670;&nbsp;</a></span>get_PM_timestep_ti()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> get_PM_timestep_ti </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structDriftKickTimes.html">DriftKickTimes</a> *const&#160;</td>
          <td class="paramname"><em>times</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>atime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structCosmology.html">Cosmology</a> *&#160;</td>
          <td class="paramname"><em>CP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>FastParticleType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>asmth</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00667">667</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;{</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> = <a class="code" href="timestep_8c.html#a7de7f3fa793e7794724b27aa49b08c60">get_long_range_timestep_dloga</a>(atime, <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, FastParticleType, asmth);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160; </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <a class="code" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> dti = <a class="code" href="timebinmgr_8c.html#a1ecd8823814b8d41c2ad8bc62bd4b6a0">dti_from_dloga</a>(<a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a>, times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>);</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    dti = <a class="code" href="timebinmgr_8c.html#a670638d37437095012fe1effdc9c1098">round_down_power_of_two</a>(dti);</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160; </div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <a class="code" href="structSyncPoint.html">SyncPoint</a> * next = <a class="code" href="timebinmgr_8c.html#a4a7f3606a4cb958089f232db3fc51dd2">find_next_sync_point</a>(times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>);</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="keywordflow">if</span>(next == NULL)</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(0, <span class="stringliteral">&quot;Trying to go beyond the last sync point. This happens only at TimeMax \n&quot;</span>);</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="comment">/* go no more than the next sync point */</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <a class="code" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> dti_max = next-&gt;<a class="code" href="structSyncPoint.html#a0ef743b554ff1b0bae3e6c3e6a7c7987">ti</a> - times-&gt;<a class="code" href="structDriftKickTimes.html#a1c5fe7d114a58455177e26d13db726cf">PM_kick</a>;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160; </div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="keywordflow">if</span>(dti &gt; dti_max)</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        dti = dti_max;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="keywordflow">return</span> dti;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;}</div>
<div class="ttc" id="astructSyncPoint_html"><div class="ttname"><a href="structSyncPoint.html">SyncPoint</a></div><div class="ttdef"><b>Definition:</b> <a href="timebinmgr_8h_source.html#l00022">timebinmgr.h:23</a></div></div>
<div class="ttc" id="astructSyncPoint_html_a0ef743b554ff1b0bae3e6c3e6a7c7987"><div class="ttname"><a href="structSyncPoint.html#a0ef743b554ff1b0bae3e6c3e6a7c7987">SyncPoint::ti</a></div><div class="ttdeci">inttime_t ti</div><div class="ttdef"><b>Definition:</b> <a href="timebinmgr_8h_source.html#l00028">timebinmgr.h:28</a></div></div>
<div class="ttc" id="atimebinmgr_8c_html_a1ecd8823814b8d41c2ad8bc62bd4b6a0"><div class="ttname"><a href="timebinmgr_8c.html#a1ecd8823814b8d41c2ad8bc62bd4b6a0">dti_from_dloga</a></div><div class="ttdeci">inttime_t dti_from_dloga(double loga, const inttime_t Ti_Current)</div><div class="ttdef"><b>Definition:</b> <a href="timebinmgr_8c_source.html#l00271">timebinmgr.c:271</a></div></div>
<div class="ttc" id="atimebinmgr_8c_html_a4a7f3606a4cb958089f232db3fc51dd2"><div class="ttname"><a href="timebinmgr_8c.html#a4a7f3606a4cb958089f232db3fc51dd2">find_next_sync_point</a></div><div class="ttdeci">SyncPoint * find_next_sync_point(inttime_t ti)</div><div class="ttdef"><b>Definition:</b> <a href="timebinmgr_8c_source.html#l00174">timebinmgr.c:174</a></div></div>
<div class="ttc" id="atimestep_8c_html_a7de7f3fa793e7794724b27aa49b08c60"><div class="ttname"><a href="timestep_8c.html#a7de7f3fa793e7794724b27aa49b08c60">get_long_range_timestep_dloga</a></div><div class="ttdeci">double get_long_range_timestep_dloga(const double atime, const Cosmology *CP, const int FastParticleType, const double asmth)</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00584">timestep.c:584</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="power_8c_source.html#l00027">CP</a>, <a class="el" href="lightcone_8c_source.html#l00021">dloga</a>, <a class="el" href="timebinmgr_8c_source.html#l00271">dti_from_dloga()</a>, <a class="el" href="endrun_8c_source.html#l00147">endrun()</a>, <a class="el" href="timebinmgr_8c_source.html#l00174">find_next_sync_point()</a>, <a class="el" href="timestep_8c_source.html#l00584">get_long_range_timestep_dloga()</a>, <a class="el" href="timestep_8h_source.html#l00031">DriftKickTimes::PM_kick</a>, <a class="el" href="timebinmgr_8c_source.html#l00286">round_down_power_of_two()</a>, <a class="el" href="timebinmgr_8h_source.html#l00028">SyncPoint::ti</a>, and <a class="el" href="timestep_8h_source.html#l00027">DriftKickTimes::Ti_Current</a>.</p>

<p class="reference">Referenced by <a class="el" href="timestep_8c_source.html#l00176">find_timesteps()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_aaf0018d0dda92e6c10da475d5a8ffd1d_cgraph.svg" width="1339" height="374"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_aaf0018d0dda92e6c10da475d5a8ffd1d_icgraph.svg" width="522" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="acd31a672ca9dfbbf3c03f14f1e3baec6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd31a672ca9dfbbf3c03f14f1e3baec6">&#9670;&nbsp;</a></span>get_timestep_bin()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int get_timestep_bin </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a>&#160;</td>
          <td class="paramname"><em>dti</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00686">686</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;{</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;   <span class="keywordtype">int</span> bin = -1;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160; </div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;   <span class="keywordflow">if</span>(dti &lt;= 0)</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;       <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160; </div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;   <span class="keywordflow">if</span>(dti == 1)</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;       <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160; </div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;   <span class="keywordflow">while</span>(dti)</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;   {</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;       bin++;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;       dti &gt;&gt;= 1;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;   }</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160; </div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;   <span class="keywordflow">return</span> bin;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="timestep_8c_source.html#l00176">find_timesteps()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_acd31a672ca9dfbbf3c03f14f1e3baec6_icgraph.svg" width="506" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a1295174fe809392e15215f2a3585a04d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1295174fe809392e15215f2a3585a04d">&#9670;&nbsp;</a></span>get_timestep_dloga()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static double get_timestep_dloga </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a>&#160;</td>
          <td class="paramname"><em>Ti_Current</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>atime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>hubble</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791ba">TimeStepType</a> *&#160;</td>
          <td class="paramname"><em>titype</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00450">450</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;{</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordtype">double</span> ac = 0;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordtype">double</span> dt = 0, dt_courant = 0, dt_hsml = 0;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="comment">/*Compute physical acceleration*/</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    {</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> a2inv = 1/(atime * atime);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="keywordtype">double</span> ax = a2inv * <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].GravAccel[0];</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <span class="keywordtype">double</span> ay = a2inv * <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].GravAccel[1];</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="keywordtype">double</span> az = a2inv * <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].GravAccel[2];</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160; </div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        ay += a2inv * <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].GravPM[1];</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        ax += a2inv * <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].GravPM[0];</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        az += a2inv * <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].GravPM[2];</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160; </div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].Type == 0)</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> fac2 = 1 / pow(atime, 3 * <a class="code" href="physconst_8h.html#a8659b9de3e544ff142b153b076f30fd5">GAMMA</a> - 2);</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            ax += fac2 * <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(p).HydroAccel[0];</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            ay += fac2 * <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(p).HydroAccel[1];</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            az += fac2 * <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(p).HydroAccel[2];</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        }</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        ac = sqrt(ax * ax + ay * ay + az * az); <span class="comment">/* this is now the physical acceleration */</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    }</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">if</span>(ac == 0)</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        ac = 1.0e-30;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160; </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="comment">/* mind the factor 2.8 difference between gravity and softening used here. */</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    dt = sqrt(2 * <a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#a8a5ae74e923d6105e3b256704c1cdc3d">ErrTolIntAccuracy</a> * atime * (<a class="code" href="gravity_8h.html#ad2fea9ffa95e668ed71b563e817d2e1b">FORCE_SOFTENING</a>(p, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].Type) / 2.8) / ac);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    *titype = <a class="code" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baa76b68035165a9358aa74f58389fdbd45">TI_ACCEL</a>;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].Type == 0)</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    {</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> fac3 = pow(atime, 3 * (1 - <a class="code" href="physconst_8h.html#a8659b9de3e544ff142b153b076f30fd5">GAMMA</a>) / 2.0);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        dt_courant = 2 * <a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#aef33cb2560126749c17dbf6c6b40ed77">CourantFac</a> * atime * <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].Hsml / (fac3 * <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(p).MaxSignalVel);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <span class="keywordflow">if</span>(dt_courant &lt; dt) {</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            dt = dt_courant;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            *titype = <a class="code" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baa6611ae5ddb582819d2082b4e841fde29">TI_COURANT</a>;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        }</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="comment">/* This timestep criterion is from Gadget-4, eq. 0 of 2010.03567 and stops</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">         * particles having too large a density change.*/</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        dt_hsml = <a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#aef33cb2560126749c17dbf6c6b40ed77">CourantFac</a> * atime * atime * fabs(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].Hsml / (<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].DtHsml + 1e-20));</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="keywordflow">if</span>(dt_hsml &lt; dt) {</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            dt = dt_hsml;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            *titype = <a class="code" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baaecf5a22337645488f735250e6a0efe43">TI_HSML</a>;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        }</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    }</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160; </div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].Type == 5)</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="slotsmanager_8h.html#a57267616e3ede141780cbe94358d827f">BHP</a>(p).Mdot &gt; 0 &amp;&amp; <a class="code" href="slotsmanager_8h.html#a57267616e3ede141780cbe94358d827f">BHP</a>(p).Mass &gt; 0)</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        {</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            <span class="keywordtype">double</span> dt_accr = 0.25 * <a class="code" href="slotsmanager_8h.html#a57267616e3ede141780cbe94358d827f">BHP</a>(p).Mass / <a class="code" href="slotsmanager_8h.html#a57267616e3ede141780cbe94358d827f">BHP</a>(p).Mdot;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            <span class="keywordflow">if</span>(dt_accr &lt; dt) {</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                dt = dt_accr;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                *titype = <a class="code" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baae9a49bc969dbba59dcea2fc12fbf3f36">TI_ACCRETE</a>;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            }</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        }</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="slotsmanager_8h.html#a57267616e3ede141780cbe94358d827f">BHP</a>(p).minTimeBin &gt; 0 &amp;&amp; <a class="code" href="slotsmanager_8h.html#a57267616e3ede141780cbe94358d827f">BHP</a>(p).minTimeBin+1 &lt; <a class="code" href="timebinmgr_8h.html#a4668a3a5f210b5742a179c8d258a703d">TIMEBINS</a>) {</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            <span class="keywordtype">double</span> dt_limiter = <a class="code" href="timebinmgr_8c.html#a716e51b694540af2851fb51c081bcf5d">get_dloga_for_bin</a>(<a class="code" href="slotsmanager_8h.html#a57267616e3ede141780cbe94358d827f">BHP</a>(p).minTimeBin+1, Ti_Current) / hubble;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            <span class="comment">/* Set the black hole timestep to the minimum timesteps of neighbouring gas particles.</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">             * It should be at least this for accretion accuracy, and it does not make sense to</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">             * make it less than this. We go one timestep up because often the smallest</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">             * timebin particle is cooling, and so increases its timestep. Then the smallest timebin</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">             * contains only the BH which doesn&#39;t make much numerical sense. Accretion accuracy is not much changed</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">             * by one timestep difference.*/</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            dt = dt_limiter;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            *titype = <a class="code" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791baa1ce55196388f86c21f1c542260078268">TI_NEIGH</a>;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        }</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    }</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="comment">/* d a / a = dt * H */</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> = dt * hubble;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160; </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a>;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;}</div>
<div class="ttc" id="agravity_8h_html_ad2fea9ffa95e668ed71b563e817d2e1b"><div class="ttname"><a href="gravity_8h.html#ad2fea9ffa95e668ed71b563e817d2e1b">FORCE_SOFTENING</a></div><div class="ttdeci">double FORCE_SOFTENING(int i, int type)</div><div class="ttdef"><b>Definition:</b> <a href="gravshort-tree_8c_source.html#l00036">gravshort-tree.c:36</a></div></div>
<div class="ttc" id="aphysconst_8h_html_a8659b9de3e544ff142b153b076f30fd5"><div class="ttname"><a href="physconst_8h.html#a8659b9de3e544ff142b153b076f30fd5">GAMMA</a></div><div class="ttdeci">#define GAMMA</div><div class="ttdef"><b>Definition:</b> <a href="physconst_8h_source.html#l00034">physconst.h:34</a></div></div>
<div class="ttc" id="astructtimestep__params_html_a8a5ae74e923d6105e3b256704c1cdc3d"><div class="ttname"><a href="structtimestep__params.html#a8a5ae74e923d6105e3b256704c1cdc3d">timestep_params::ErrTolIntAccuracy</a></div><div class="ttdeci">double ErrTolIntAccuracy</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00030">timestep.c:30</a></div></div>
<div class="ttc" id="astructtimestep__params_html_aef33cb2560126749c17dbf6c6b40ed77"><div class="ttname"><a href="structtimestep__params.html#aef33cb2560126749c17dbf6c6b40ed77">timestep_params::CourantFac</a></div><div class="ttdeci">double CourantFac</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00046">timestep.c:46</a></div></div>
<div class="ttc" id="atimebinmgr_8c_html_a716e51b694540af2851fb51c081bcf5d"><div class="ttname"><a href="timebinmgr_8c.html#a716e51b694540af2851fb51c081bcf5d">get_dloga_for_bin</a></div><div class="ttdeci">double get_dloga_for_bin(int timebin, const inttime_t Ti_Current)</div><div class="ttdef"><b>Definition:</b> <a href="timebinmgr_8c_source.html#l00279">timebinmgr.c:279</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="slotsmanager_8h_source.html#l00125">BHP</a>, <a class="el" href="timestep_8c_source.html#l00046">timestep_params::CourantFac</a>, <a class="el" href="lightcone_8c_source.html#l00021">dloga</a>, <a class="el" href="timestep_8c_source.html#l00030">timestep_params::ErrTolIntAccuracy</a>, <a class="el" href="gravshort-tree_8c_source.html#l00036">FORCE_SOFTENING()</a>, <a class="el" href="physconst_8h_source.html#l00034">GAMMA</a>, <a class="el" href="timebinmgr_8c_source.html#l00279">get_dloga_for_bin()</a>, <a class="el" href="partmanager_8h_source.html#l00088">P</a>, <a class="el" href="slotsmanager_8h_source.html#l00124">SPHP</a>, <a class="el" href="timestep_8c_source.html#l00108">TI_ACCEL</a>, <a class="el" href="timestep_8c_source.html#l00110">TI_ACCRETE</a>, <a class="el" href="timestep_8c_source.html#l00109">TI_COURANT</a>, <a class="el" href="timestep_8c_source.html#l00112">TI_HSML</a>, <a class="el" href="timestep_8c_source.html#l00111">TI_NEIGH</a>, <a class="el" href="timebinmgr_8h_source.html#l00013">TIMEBINS</a>, and <a class="el" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.</p>

<p class="reference">Referenced by <a class="el" href="timestep_8c_source.html#l00537">get_timestep_ti()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a1295174fe809392e15215f2a3585a04d_cgraph.svg" width="539" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a1295174fe809392e15215f2a3585a04d_icgraph.svg" width="694" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ac8b84367ec16a894fbc4510defa6a167"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac8b84367ec16a894fbc4510defa6a167">&#9670;&nbsp;</a></span>get_timestep_ti()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> get_timestep_ti </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a>&#160;</td>
          <td class="paramname"><em>dti_max</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a>&#160;</td>
          <td class="paramname"><em>Ti_Current</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>atime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>hubble</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="timestep_8c.html#ad2dde160974c283ccf8f0ce280f791ba">TimeStepType</a> *&#160;</td>
          <td class="paramname"><em>titype</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This function returns the maximum allowed timestep of a particle, expressed in terms of the integer mapping that is used to represent the total simulated timespan. Arguments: p -&gt; particle index dti_max -&gt; maximal timestep. <br  />
 </p>

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00537">537</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;{</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <a class="code" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> dti;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="comment">/*Give a useful message if we are broken*/</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keywordflow">if</span>(dti_max == 0)</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> = <a class="code" href="timestep_8c.html#a1295174fe809392e15215f2a3585a04d">get_timestep_dloga</a>(p, Ti_Current, atime, hubble, titype);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160; </div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> &lt; <a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#a638b86b8ff28a851bb56a9ed17ec039c">MinSizeTimestep</a>)</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> = <a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#a638b86b8ff28a851bb56a9ed17ec039c">MinSizeTimestep</a>;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160; </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    dti = <a class="code" href="timebinmgr_8c.html#a1ecd8823814b8d41c2ad8bc62bd4b6a0">dti_from_dloga</a>(<a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a>, Ti_Current);</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="comment">/* Check for overflow*/</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">if</span>(dti &gt; dti_max || dti &lt; 0)</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        dti = dti_max;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordflow">if</span>(dti &lt;= 1 || dti &gt; (<a class="code" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a>) <a class="code" href="timebinmgr_8h.html#ad44dabdb7a0bef8536e2d34a01177d48">TIMEBASE</a>)</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    {</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].Type == 0)</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(1, <span class="stringliteral">&quot;Bad timestep (%x)! titype %d. ID=%lu Type=%d dloga=%g dtmax=%x xyz=(%g|%g|%g) tree=(%g|%g|%g) PM=(%g|%g|%g) hydro-frc=(%g|%g|%g) dens=%g hsml=%g dh = %g Entropy=%g, dtEntropy=%g maxsignal=%g\n&quot;</span>,</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                dti, *titype, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].ID, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].Type, <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a>, dti_max,</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].Pos[0], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].Pos[1], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].Pos[2],</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].GravAccel[0], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].GravAccel[1], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].GravAccel[2],</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].<a class="code" href="gravpm_8c.html#ad87ae67d47af9b3b87d59c50c4f2f781">GravPM</a>[0], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].<a class="code" href="gravpm_8c.html#ad87ae67d47af9b3b87d59c50c4f2f781">GravPM</a>[1], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].<a class="code" href="gravpm_8c.html#ad87ae67d47af9b3b87d59c50c4f2f781">GravPM</a>[2],</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(p).HydroAccel[0], <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(p).HydroAccel[1], <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(p).HydroAccel[2],</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(p).Density, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].Hsml, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].DtHsml, <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(p).Entropy, <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(p).DtEntropy, <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(p).MaxSignalVel);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(1, <span class="stringliteral">&quot;Bad timestep (%x)! titype %d. ID=%lu Type=%d dloga=%g dtmax=%x xyz=(%g|%g|%g) tree=(%g|%g|%g) PM=(%g|%g|%g)\n&quot;</span>,</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                dti, *titype, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].ID, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].Type, <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a>, dti_max,</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].Pos[0], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].Pos[1], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].Pos[2],</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].GravAccel[0], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].GravAccel[1], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].GravAccel[2],</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].<a class="code" href="gravpm_8c.html#ad87ae67d47af9b3b87d59c50c4f2f781">GravPM</a>[0], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].<a class="code" href="gravpm_8c.html#ad87ae67d47af9b3b87d59c50c4f2f781">GravPM</a>[1], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p].<a class="code" href="gravpm_8c.html#ad87ae67d47af9b3b87d59c50c4f2f781">GravPM</a>[2]</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;              );</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    }</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160; </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keywordflow">return</span> dti;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;}</div>
<div class="ttc" id="atimestep_8c_html_a1295174fe809392e15215f2a3585a04d"><div class="ttname"><a href="timestep_8c.html#a1295174fe809392e15215f2a3585a04d">get_timestep_dloga</a></div><div class="ttdeci">static double get_timestep_dloga(const int p, const inttime_t Ti_Current, const double atime, const double hubble, enum TimeStepType *titype)</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00450">timestep.c:450</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="lightcone_8c_source.html#l00021">dloga</a>, <a class="el" href="timebinmgr_8c_source.html#l00271">dti_from_dloga()</a>, <a class="el" href="timestep_8c_source.html#l00450">get_timestep_dloga()</a>, <a class="el" href="gravpm_8c.html#ad87ae67d47af9b3b87d59c50c4f2f781">GravPM</a>, <a class="el" href="endrun_8c_source.html#l00175">message()</a>, <a class="el" href="timestep_8c_source.html#l00035">timestep_params::MinSizeTimestep</a>, <a class="el" href="partmanager_8h_source.html#l00088">P</a>, <a class="el" href="slotsmanager_8h_source.html#l00124">SPHP</a>, <a class="el" href="timebinmgr_8h_source.html#l00014">TIMEBASE</a>, and <a class="el" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.</p>

<p class="reference">Referenced by <a class="el" href="timestep_8c_source.html#l00176">find_timesteps()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_ac8b84367ec16a894fbc4510defa6a167_cgraph.svg" width="1000" height="206"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_ac8b84367ec16a894fbc4510defa6a167_icgraph.svg" width="495" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a46b8fcbd4991e9d216fc8825d5bdfb36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46b8fcbd4991e9d216fc8825d5bdfb36">&#9670;&nbsp;</a></span>init_driftkicktime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structDriftKickTimes.html">DriftKickTimes</a> init_driftkicktime </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a>&#160;</td>
          <td class="paramname"><em>Ti_Current</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00133">133</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;{</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <a class="code" href="structDriftKickTimes.html">DriftKickTimes</a> times = {0};</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    times.<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a> = Ti_Current;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt;= <a class="code" href="timebinmgr_8h.html#a4668a3a5f210b5742a179c8d258a703d">TIMEBINS</a>; i++) {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        times.<a class="code" href="structDriftKickTimes.html#ac18ed0905144485b014ce19c6db2a4d5">Ti_kick</a>[i] = times.<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        times.<a class="code" href="structDriftKickTimes.html#a3082835582bba0baf28c10ba766e3939">Ti_lastactivedrift</a>[i] = times.<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">/* this makes sure the first step is a PM step. */</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    times.<a class="code" href="structDriftKickTimes.html#a83e635aaf487ba9d6262105227babaaa">PM_length</a> = 0;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    times.<a class="code" href="structDriftKickTimes.html#a1c5fe7d114a58455177e26d13db726cf">PM_kick</a> = times.<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    times.<a class="code" href="structDriftKickTimes.html#a91cbbd31ecae58c72055b9248e457e85">PM_start</a> = times.<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">return</span> times;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;}</div>
<div class="ttc" id="astructDriftKickTimes_html"><div class="ttname"><a href="structDriftKickTimes.html">DriftKickTimes</a></div><div class="ttdef"><b>Definition:</b> <a href="timestep_8h_source.html#l00017">timestep.h:18</a></div></div>
<div class="ttc" id="astructDriftKickTimes_html_a3082835582bba0baf28c10ba766e3939"><div class="ttname"><a href="structDriftKickTimes.html#a3082835582bba0baf28c10ba766e3939">DriftKickTimes::Ti_lastactivedrift</a></div><div class="ttdeci">inttime_t Ti_lastactivedrift[TIMEBINS+1]</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8h_source.html#l00025">timestep.h:25</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="timestep_8h_source.html#l00031">DriftKickTimes::PM_kick</a>, <a class="el" href="timestep_8h_source.html#l00029">DriftKickTimes::PM_length</a>, <a class="el" href="timestep_8h_source.html#l00030">DriftKickTimes::PM_start</a>, <a class="el" href="timestep_8h_source.html#l00027">DriftKickTimes::Ti_Current</a>, <a class="el" href="timestep_8h_source.html#l00023">DriftKickTimes::Ti_kick</a>, <a class="el" href="timestep_8h_source.html#l00025">DriftKickTimes::Ti_lastactivedrift</a>, and <a class="el" href="timebinmgr_8h_source.html#l00013">TIMEBINS</a>.</p>

<p class="reference">Referenced by <a class="el" href="run_8c_source.html#l00284">run()</a>, <a class="el" href="runtests_8c_source.html#l00071">run_gravity_test()</a>, <a class="el" href="run_8c_source.html#l00652">runfof()</a>, <a class="el" href="init_8c_source.html#l00384">setup_density_indep_entropy()</a>, and <a class="el" href="init_8c_source.html#l00439">setup_smoothinglengths()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a46b8fcbd4991e9d216fc8825d5bdfb36_icgraph.svg" width="804" height="232"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a573e730c561dfb971b96703c6711d09e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a573e730c561dfb971b96703c6711d09e">&#9670;&nbsp;</a></span>init_timebins()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> init_timebins </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>TimeInit</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00123">123</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;{</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <a class="code" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a> Ti_Current = <a class="code" href="timebinmgr_8c.html#a2e2b7b549c7ebcd90457efb5330c1955">ti_from_loga</a>(log(TimeInit));</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="comment">/*Enforce Ti_Current is initially even*/</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordflow">if</span>(Ti_Current % 2 == 1)</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        Ti_Current++;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;Initial TimeStep at TimeInit %g Ti_Current = %d \n&quot;</span>, TimeInit, Ti_Current);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordflow">return</span> Ti_Current;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;}</div>
<div class="ttc" id="atimebinmgr_8c_html_a2e2b7b549c7ebcd90457efb5330c1955"><div class="ttname"><a href="timebinmgr_8c.html#a2e2b7b549c7ebcd90457efb5330c1955">ti_from_loga</a></div><div class="ttdeci">inttime_t ti_from_loga(double loga)</div><div class="ttdef"><b>Definition:</b> <a href="timebinmgr_8c_source.html#l00236">timebinmgr.c:236</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="endrun_8c_source.html#l00175">message()</a>, and <a class="el" href="timebinmgr_8c_source.html#l00236">ti_from_loga()</a>.</p>

<p class="reference">Referenced by <a class="el" href="init_8c_source.html#l00086">init()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a573e730c561dfb971b96703c6711d09e_cgraph.svg" width="538" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a573e730c561dfb971b96703c6711d09e_icgraph.svg" width="426" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a1da56439eb88b453b1ae0122f15d8dc1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1da56439eb88b453b1ae0122f15d8dc1">&#9670;&nbsp;</a></span>is_PM_timestep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int is_PM_timestep </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structDriftKickTimes.html">DriftKickTimes</a> *const&#160;</td>
          <td class="paramname"><em>times</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00160">160</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;{</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">if</span>(times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a> &gt; times-&gt;<a class="code" href="structDriftKickTimes.html#a91cbbd31ecae58c72055b9248e457e85">PM_start</a> + times-&gt;<a class="code" href="structDriftKickTimes.html#a83e635aaf487ba9d6262105227babaaa">PM_length</a>)</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(12, <span class="stringliteral">&quot;Passed end of PM step! ti=%d, PM = %d + %d\n&quot;</span>,times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>, times-&gt;<a class="code" href="structDriftKickTimes.html#a91cbbd31ecae58c72055b9248e457e85">PM_start</a>, times-&gt;<a class="code" href="structDriftKickTimes.html#a83e635aaf487ba9d6262105227babaaa">PM_length</a>);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">return</span> times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a> == times-&gt;<a class="code" href="structDriftKickTimes.html#a91cbbd31ecae58c72055b9248e457e85">PM_start</a> + times-&gt;<a class="code" href="structDriftKickTimes.html#a83e635aaf487ba9d6262105227babaaa">PM_length</a>;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="endrun_8c_source.html#l00147">endrun()</a>, <a class="el" href="timestep_8h_source.html#l00029">DriftKickTimes::PM_length</a>, <a class="el" href="timestep_8h_source.html#l00030">DriftKickTimes::PM_start</a>, and <a class="el" href="timestep_8h_source.html#l00027">DriftKickTimes::Ti_Current</a>.</p>

<p class="reference">Referenced by <a class="el" href="timestep_8c_source.html#l00176">find_timesteps()</a>, <a class="el" href="timestep_8c_source.html#l00807">print_timebin_statistics()</a>, <a class="el" href="timestep_8c_source.html#l00721">rebuild_activelist()</a>, and <a class="el" href="run_8c_source.html#l00284">run()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a1da56439eb88b453b1ae0122f15d8dc1_cgraph.svg" width="540" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a1da56439eb88b453b1ae0122f15d8dc1_icgraph.svg" width="943" height="159"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a896d6e80e5dd9d14008709479a0f8a66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a896d6e80e5dd9d14008709479a0f8a66">&#9670;&nbsp;</a></span>is_timebin_active()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int is_timebin_active </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#ab7f8779710efa655135cf9cbee3137a7">inttime_t</a>&#160;</td>
          <td class="paramname"><em>current</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00149">149</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                                                {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">/*Bin 0 is always active and at time 0 all bins are active*/</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">if</span>(i &lt;= 0 || current &lt;= 0)</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">if</span>(current % <a class="code" href="timebinmgr_8h.html#af676ea14ddc4ab85d634f5a18015038d">dti_from_timebin</a>(i) == 0)</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="timebinmgr_8h_source.html#l00044">dti_from_timebin()</a>.</p>

<p class="reference">Referenced by <a class="el" href="timestep_8c_source.html#l00323">apply_half_kick()</a>, <a class="el" href="timestep_8c_source.html#l00176">find_timesteps()</a>, <a class="el" href="hydra_8c_source.html#l00147">hydro_force()</a>, <a class="el" href="timestep_8c_source.html#l00807">print_timebin_statistics()</a>, <a class="el" href="timestep_8c_source.html#l00721">rebuild_activelist()</a>, <a class="el" href="run_8c_source.html#l00284">run()</a>, <a class="el" href="timestep_8c_source.html#l00077">timestep_eh_slots_fork()</a>, and <a class="el" href="timestep_8c_source.html#l00309">update_lastactive_drift()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a896d6e80e5dd9d14008709479a0f8a66_cgraph.svg" width="331" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a896d6e80e5dd9d14008709479a0f8a66_icgraph.svg" width="955" height="374"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="af09ee9d6b74189aeb58a368e2e810936"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af09ee9d6b74189aeb58a368e2e810936">&#9670;&nbsp;</a></span>print_timebin_statistics()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void print_timebin_statistics </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structDriftKickTimes.html">DriftKickTimes</a> *const&#160;</td>
          <td class="paramname"><em>times</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>NumCurrentTiStep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>TimeBinCountType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>Time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This routine writes one line for every timestep. FdCPU the cumulative cpu-time consumption in various parts of the code is stored. </p>

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00807">807</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;{</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    int64_t tot = 0, tot_type[6] = {0};</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    int64_t tot_count[<a class="code" href="timebinmgr_8h.html#a4668a3a5f210b5742a179c8d258a703d">TIMEBINS</a>+1] = {0};</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    int64_t tot_count_type[6][<a class="code" href="timebinmgr_8h.html#a4668a3a5f210b5742a179c8d258a703d">TIMEBINS</a>+1] = {{0}};</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    int64_t tot_num_force = 0;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    int64_t <a class="code" href="test__exchange_8c.html#a73eab74927dfbb4060edd1ee7f3af699">TotNumPart</a> = 0, TotNumType[6] = {0};</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160; </div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="keywordtype">int</span> NumThreads = omp_get_max_threads();</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <span class="comment">/*Sum the thread-local memory*/</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordflow">for</span>(i = 1; i &lt; NumThreads; i ++) {</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        <span class="keywordtype">int</span> j;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        <span class="keywordflow">for</span>(j=0; j &lt; 6 * (<a class="code" href="timebinmgr_8h.html#a4668a3a5f210b5742a179c8d258a703d">TIMEBINS</a>+1); j++)</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;            TimeBinCountType[j] += TimeBinCountType[6 * (<a class="code" href="timebinmgr_8h.html#a4668a3a5f210b5742a179c8d258a703d">TIMEBINS</a>+1) * i + j];</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    }</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160; </div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; 6; i ++) {</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        <a class="code" href="system_8c.html#a866c4b0425665030c89933c11752b1fe">sumup_large_ints</a>(<a class="code" href="timebinmgr_8h.html#a4668a3a5f210b5742a179c8d258a703d">TIMEBINS</a>+1, &amp;TimeBinCountType[(<a class="code" href="timebinmgr_8h.html#a4668a3a5f210b5742a179c8d258a703d">TIMEBINS</a>+1) * i], tot_count_type[i]);</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    }</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160; </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keywordflow">for</span>(i = 0; i&lt;<a class="code" href="timebinmgr_8h.html#a4668a3a5f210b5742a179c8d258a703d">TIMEBINS</a>+1; i++) {</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        <span class="keywordtype">int</span> j;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <span class="keywordflow">for</span>(j=0; j&lt;6; j++) {</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;            tot_count[i] += tot_count_type[j][i];</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;            <span class="comment">/*Note j*/</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;            TotNumType[j] += tot_count_type[j][i];</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;            <a class="code" href="test__exchange_8c.html#a73eab74927dfbb4060edd1ee7f3af699">TotNumPart</a> += tot_count_type[j][i];</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        }</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="timestep_8c.html#a896d6e80e5dd9d14008709479a0f8a66">is_timebin_active</a>(i, times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>))</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;            tot_num_force += tot_count[i];</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    }</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160; </div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="keywordtype">char</span> extra[20] = {0};</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160; </div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="timestep_8c.html#a1da56439eb88b453b1ae0122f15d8dc1">is_PM_timestep</a>(times))</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        strcat(extra, <span class="stringliteral">&quot;PM-Step&quot;</span>);</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160; </div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> = <a class="code" href="timebinmgr_8c.html#a716e51b694540af2851fb51c081bcf5d">get_dloga_for_bin</a>(times-&gt;<a class="code" href="structDriftKickTimes.html#ad3b4fe6ff2b0e0be706882c59323621e">mintimebin</a>, times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>);</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> z = 1.0 / (Time) - 1;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;Begin Step %d, Time: %g (%x), Redshift: %g, Nf = %014ld, Systemstep: %g, Dloga: %g, status: %s\n&quot;</span>,</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                NumCurrentTiStep, Time, times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>, z, tot_num_force,</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> * Time, <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a>,</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                extra);</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160; </div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;TotNumPart: %013ld SPH %013ld BH %010ld STAR %013ld \n&quot;</span>,</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;                <a class="code" href="test__exchange_8c.html#a73eab74927dfbb4060edd1ee7f3af699">TotNumPart</a>, TotNumType[0], TotNumType[5], TotNumType[4]);</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0,     <span class="stringliteral">&quot;Occupied: % 12ld % 12ld % 12ld % 12ld % 12ld % 12ld dt\n&quot;</span>, 0L, 1L, 2L, 3L, 4L, 5L);</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160; </div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <span class="keywordflow">for</span>(i = <a class="code" href="timebinmgr_8h.html#a4668a3a5f210b5742a179c8d258a703d">TIMEBINS</a>;  i &gt;= 0; i--) {</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        <span class="keywordflow">if</span>(tot_count[i] == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot; %c bin=%2d % 12ld % 12ld % 12ld % 12ld % 12ld % 12ld %6g\n&quot;</span>,</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                <a class="code" href="timestep_8c.html#a896d6e80e5dd9d14008709479a0f8a66">is_timebin_active</a>(i, times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>) ? <span class="charliteral">&#39;X&#39;</span> : <span class="charliteral">&#39; &#39;</span>,</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                i,</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                tot_count_type[0][i],</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                tot_count_type[1][i],</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;                tot_count_type[2][i],</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                tot_count_type[3][i],</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                tot_count_type[4][i],</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                tot_count_type[5][i],</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                <a class="code" href="timebinmgr_8c.html#a716e51b694540af2851fb51c081bcf5d">get_dloga_for_bin</a>(i, times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>));</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160; </div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="timestep_8c.html#a896d6e80e5dd9d14008709479a0f8a66">is_timebin_active</a>(i, times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>))</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        {</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;            tot += tot_count[i];</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            <span class="keywordtype">int</span> <a class="code" href="zeldovich_8c.html#a953067f6751c09a3d2e7554c74fcbf6d">ptype</a>;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            <span class="keywordflow">for</span>(<a class="code" href="zeldovich_8c.html#a953067f6751c09a3d2e7554c74fcbf6d">ptype</a> = 0; <a class="code" href="zeldovich_8c.html#a953067f6751c09a3d2e7554c74fcbf6d">ptype</a> &lt; 6; <a class="code" href="zeldovich_8c.html#a953067f6751c09a3d2e7554c74fcbf6d">ptype</a> ++) {</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                tot_type[<a class="code" href="zeldovich_8c.html#a953067f6751c09a3d2e7554c74fcbf6d">ptype</a>] += tot_count_type[<a class="code" href="zeldovich_8c.html#a953067f6751c09a3d2e7554c74fcbf6d">ptype</a>][i];</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;            }</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        }</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    }</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0,     <span class="stringliteral">&quot;               -----------------------------------\n&quot;</span>);</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0,     <span class="stringliteral">&quot;Total:    % 12ld % 12ld % 12ld % 12ld % 12ld % 12ld  Sum:% 14ld\n&quot;</span>,</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        tot_type[0], tot_type[1], tot_type[2], tot_type[3], tot_type[4], tot_type[5], tot);</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160; </div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;}</div>
<div class="ttc" id="atest__exchange_8c_html_a73eab74927dfbb4060edd1ee7f3af699"><div class="ttname"><a href="test__exchange_8c.html#a73eab74927dfbb4060edd1ee7f3af699">TotNumPart</a></div><div class="ttdeci">int TotNumPart</div><div class="ttdef"><b>Definition:</b> <a href="test__exchange_8c_source.html#l00024">test_exchange.c:24</a></div></div>
<div class="ttc" id="azeldovich_8c_html_a953067f6751c09a3d2e7554c74fcbf6d"><div class="ttname"><a href="zeldovich_8c.html#a953067f6751c09a3d2e7554c74fcbf6d">ptype</a></div><div class="ttdeci">static enum TransferType ptype</div><div class="ttdef"><b>Definition:</b> <a href="zeldovich_8c_source.html#l00113">zeldovich.c:146</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="lightcone_8c_source.html#l00021">dloga</a>, <a class="el" href="timebinmgr_8c_source.html#l00279">get_dloga_for_bin()</a>, <a class="el" href="timestep_8c_source.html#l00160">is_PM_timestep()</a>, <a class="el" href="timestep_8c_source.html#l00149">is_timebin_active()</a>, <a class="el" href="endrun_8c_source.html#l00175">message()</a>, <a class="el" href="timestep_8h_source.html#l00020">DriftKickTimes::mintimebin</a>, <a class="el" href="zeldovich_8c_source.html#l00146">ptype</a>, <a class="el" href="system_8c_source.html#l00192">sumup_large_ints()</a>, <a class="el" href="timestep_8h_source.html#l00027">DriftKickTimes::Ti_Current</a>, <a class="el" href="timebinmgr_8h_source.html#l00013">TIMEBINS</a>, and <a class="el" href="test__exchange_8c_source.html#l00024">TotNumPart</a>.</p>

<p class="reference">Referenced by <a class="el" href="timestep_8c_source.html#l00721">rebuild_activelist()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_af09ee9d6b74189aeb58a368e2e810936_cgraph.svg" width="844" height="240"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_af09ee9d6b74189aeb58a368e2e810936_icgraph.svg" width="770" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a8102740bf0615adc840060e1101d6d3e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8102740bf0615adc840060e1101d6d3e">&#9670;&nbsp;</a></span>rebuild_activelist()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rebuild_activelist </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structActiveParticles.html">ActiveParticles</a> *&#160;</td>
          <td class="paramname"><em>act</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structDriftKickTimes.html">DriftKickTimes</a> *const&#160;</td>
          <td class="paramname"><em>times</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>NumCurrentTiStep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>Time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00721">721</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;{</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160; </div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="keywordtype">int</span> NumThreads = omp_get_max_threads();</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <span class="comment">/*Since we use a static schedule, only need NumPart/NumThreads elements per thread.*/</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="keywordtype">size_t</span> narr = <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a> / NumThreads + NumThreads;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160; </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="comment">/*We know all particles are active on a PM timestep*/</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="timestep_8c.html#a1da56439eb88b453b1ae0122f15d8dc1">is_PM_timestep</a>(times)) {</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a> = NULL;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        act-&gt;<a class="code" href="structActiveParticles.html#a847ab898fdabc62a4723c7c3a66038d4">NumActiveParticle</a> = <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a>;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    }</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        <span class="comment">/*Need space for more particles than we have, because of star formation*/</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a> = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;ActiveParticle&quot;</span>, narr * NumThreads * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        act-&gt;<a class="code" href="structActiveParticles.html#a847ab898fdabc62a4723c7c3a66038d4">NumActiveParticle</a> = 0;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    }</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160; </div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keywordtype">int</span> * TimeBinCountType = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;TimeBinCountType&quot;</span>, 6*(<a class="code" href="timebinmgr_8h.html#a4668a3a5f210b5742a179c8d258a703d">TIMEBINS</a>+1)*NumThreads * <span class="keyword">sizeof</span>(int));</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    memset(TimeBinCountType, 0, 6 * (<a class="code" href="timebinmgr_8h.html#a4668a3a5f210b5742a179c8d258a703d">TIMEBINS</a>+1) * NumThreads * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160; </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <span class="comment">/*We want a lockless algorithm which preserves the ordering of the particle list.*/</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="keywordtype">size_t</span> *NActiveThread = <a class="code" href="mymalloc_8h.html#a52bc2c6ec78b17bb6d42957cbf642f15">ta_malloc</a>(<span class="stringliteral">&quot;NActiveThread&quot;</span>, <span class="keywordtype">size_t</span>, NumThreads);</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keywordtype">int</span> **ActivePartSets = <a class="code" href="mymalloc_8h.html#a52bc2c6ec78b17bb6d42957cbf642f15">ta_malloc</a>(<span class="stringliteral">&quot;ActivePartSets&quot;</span>, <span class="keywordtype">int</span> *, NumThreads);</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <a class="code" href="system_8c.html#a0082531d4facaa6caabf05fb9fd547d4">gadget_setup_thread_arrays</a>(act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a>, ActivePartSets, NActiveThread, narr, NumThreads);</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160; </div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="comment">/* We enforce schedule static to imply monotonic, ensure that each thread executes on contiguous particles</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="comment">     * and ensure no thread gets more than narr particles.*/</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="keywordtype">size_t</span> schedsz = <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a> / NumThreads + 1;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="preprocessor">    #pragma omp parallel for schedule(static, schedsz)</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a>; i++)</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    {</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> bin = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].TimeBin;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> tid = omp_get_thread_num();</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].IsGarbage || <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Swallowed)</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <span class="comment">/* when we are in PM, all particles must have been synced. */</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Ti_drift != times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>) {</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(5, <span class="stringliteral">&quot;Particle %d type %d has drift time %x not ti_current %x!&quot;</span>,i, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Type, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Ti_drift, times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>);</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        }</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        <span class="keywordflow">if</span>(act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a> &amp;&amp; <a class="code" href="timestep_8c.html#a896d6e80e5dd9d14008709479a0f8a66">is_timebin_active</a>(bin, times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>))</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        {</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;            <span class="comment">/* Store this particle in the ActiveSet for this thread*/</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            ActivePartSets[tid][NActiveThread[tid]] = i;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            NActiveThread[tid]++;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        }</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        TimeBinCountType[(<a class="code" href="timebinmgr_8h.html#a4668a3a5f210b5742a179c8d258a703d">TIMEBINS</a> + 1) * (6* tid + <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Type) + bin] ++;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    }</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="keywordflow">if</span>(act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a>) {</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        <span class="comment">/*Now we want a merge step for the ActiveParticle list.*/</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        act-&gt;<a class="code" href="structActiveParticles.html#a847ab898fdabc62a4723c7c3a66038d4">NumActiveParticle</a> = <a class="code" href="system_8c.html#a98a657dc63957ee4d2d237c6411f32f7">gadget_compact_thread_arrays</a>(act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a>, ActivePartSets, NActiveThread, NumThreads);</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    }</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <a class="code" href="mymalloc_8h.html#a84e2115e90e9c22e11d9663c019fc8bc">ta_free</a>(ActivePartSets);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <a class="code" href="mymalloc_8h.html#a84e2115e90e9c22e11d9663c019fc8bc">ta_free</a>(NActiveThread);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160; </div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="comment">/*Print statistics for this time bin*/</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <a class="code" href="timestep_8c.html#af09ee9d6b74189aeb58a368e2e810936">print_timebin_statistics</a>(times, NumCurrentTiStep, TimeBinCountType, Time);</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(TimeBinCountType);</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160; </div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="comment">/* Shrink the ActiveParticle array. We still need extra space for star formation,</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="comment">     * but we do not need space for the known-inactive particles*/</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="keywordflow">if</span>(act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a>) {</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a> = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a81d253773ecedbda7d865554e707489f">myrealloc</a>(act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*(act-&gt;<a class="code" href="structActiveParticles.html#a847ab898fdabc62a4723c7c3a66038d4">NumActiveParticle</a> + <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a5e24abb34f2c8998d8b35c217477d580">MaxPart</a> - <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a>));</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        act-&gt;<a class="code" href="structActiveParticles.html#a28d54535d84f6fd1a6c2040d6d9eb80b">MaxActiveParticle</a> = act-&gt;<a class="code" href="structActiveParticles.html#a847ab898fdabc62a4723c7c3a66038d4">NumActiveParticle</a> + <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a5e24abb34f2c8998d8b35c217477d580">MaxPart</a> - <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a>;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="comment">/* listen to the slots events such that we can set timebin of new particles */</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    }</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <a class="code" href="event_8c.html#a3f548c264e5e5b9fe2bb8b10c177482a">event_listen</a>(&amp;<a class="code" href="event_8c.html#aafc3f0c1fffb6f0a19f5f3ecd24474c7">EventSlotsFork</a>, <a class="code" href="timestep_8c.html#a7f89b5c29a35ca695a22d09f18d2807a">timestep_eh_slots_fork</a>, act);</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Timeline/Active&quot;</span>);</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160; </div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;}</div>
<div class="ttc" id="aevent_8c_html_a3f548c264e5e5b9fe2bb8b10c177482a"><div class="ttname"><a href="event_8c.html#a3f548c264e5e5b9fe2bb8b10c177482a">event_listen</a></div><div class="ttdeci">int event_listen(EventSpec *eh, eventfunc func, void *userdata)</div><div class="ttdef"><b>Definition:</b> <a href="event_8c_source.html#l00006">event.c:6</a></div></div>
<div class="ttc" id="amymalloc_8h_html_a3eb707b32b6ac69f2df085e4bc098cc4"><div class="ttname"><a href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a></div><div class="ttdeci">#define mymalloc(name, size)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00015">mymalloc.h:15</a></div></div>
<div class="ttc" id="amymalloc_8h_html_a52bc2c6ec78b17bb6d42957cbf642f15"><div class="ttname"><a href="mymalloc_8h.html#a52bc2c6ec78b17bb6d42957cbf642f15">ta_malloc</a></div><div class="ttdeci">#define ta_malloc(name, type, nele)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00025">mymalloc.h:25</a></div></div>
<div class="ttc" id="amymalloc_8h_html_a81d253773ecedbda7d865554e707489f"><div class="ttname"><a href="mymalloc_8h.html#a81d253773ecedbda7d865554e707489f">myrealloc</a></div><div class="ttdeci">#define myrealloc(ptr, size)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00018">mymalloc.h:18</a></div></div>
<div class="ttc" id="amymalloc_8h_html_a84e2115e90e9c22e11d9663c019fc8bc"><div class="ttname"><a href="mymalloc_8h.html#a84e2115e90e9c22e11d9663c019fc8bc">ta_free</a></div><div class="ttdeci">#define ta_free(p)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00028">mymalloc.h:28</a></div></div>
<div class="ttc" id="astructActiveParticles_html_a28d54535d84f6fd1a6c2040d6d9eb80b"><div class="ttname"><a href="structActiveParticles.html#a28d54535d84f6fd1a6c2040d6d9eb80b">ActiveParticles::MaxActiveParticle</a></div><div class="ttdeci">int64_t MaxActiveParticle</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8h_source.html#l00011">timestep.h:11</a></div></div>
<div class="ttc" id="astructpart__manager__type_html_a5e24abb34f2c8998d8b35c217477d580"><div class="ttname"><a href="structpart__manager__type.html#a5e24abb34f2c8998d8b35c217477d580">part_manager_type::MaxPart</a></div><div class="ttdeci">int64_t MaxPart</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00078">partmanager.h:78</a></div></div>
<div class="ttc" id="asystem_8c_html_a0082531d4facaa6caabf05fb9fd547d4"><div class="ttname"><a href="system_8c.html#a0082531d4facaa6caabf05fb9fd547d4">gadget_setup_thread_arrays</a></div><div class="ttdeci">void gadget_setup_thread_arrays(int *dest, int *srcs[], size_t sizes[], size_t total_size, int narrays)</div><div class="ttdef"><b>Definition:</b> <a href="system_8c_source.html#l00600">system.c:600</a></div></div>
<div class="ttc" id="asystem_8c_html_a98a657dc63957ee4d2d237c6411f32f7"><div class="ttname"><a href="system_8c.html#a98a657dc63957ee4d2d237c6411f32f7">gadget_compact_thread_arrays</a></div><div class="ttdeci">size_t gadget_compact_thread_arrays(int *dest, int *srcs[], size_t sizes[], int narrays)</div><div class="ttdef"><b>Definition:</b> <a href="system_8c_source.html#l00587">system.c:587</a></div></div>
<div class="ttc" id="atimestep_8c_html_af09ee9d6b74189aeb58a368e2e810936"><div class="ttname"><a href="timestep_8c.html#af09ee9d6b74189aeb58a368e2e810936">print_timebin_statistics</a></div><div class="ttdeci">static void print_timebin_statistics(const DriftKickTimes *const times, const int NumCurrentTiStep, int *TimeBinCountType, const double Time)</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00807">timestep.c:807</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="timestep_8h_source.html#l00013">ActiveParticles::ActiveParticle</a>, <a class="el" href="endrun_8c_source.html#l00147">endrun()</a>, <a class="el" href="event_8c_source.html#l00006">event_listen()</a>, <a class="el" href="event_8c_source.html#l00054">EventSlotsFork</a>, <a class="el" href="system_8c_source.html#l00587">gadget_compact_thread_arrays()</a>, <a class="el" href="system_8c_source.html#l00600">gadget_setup_thread_arrays()</a>, <a class="el" href="timestep_8c_source.html#l00160">is_PM_timestep()</a>, <a class="el" href="timestep_8c_source.html#l00149">is_timebin_active()</a>, <a class="el" href="timestep_8h_source.html#l00011">ActiveParticles::MaxActiveParticle</a>, <a class="el" href="partmanager_8h_source.html#l00078">part_manager_type::MaxPart</a>, <a class="el" href="mymalloc_8h_source.html#l00019">myfree</a>, <a class="el" href="mymalloc_8h_source.html#l00015">mymalloc</a>, <a class="el" href="mymalloc_8h_source.html#l00018">myrealloc</a>, <a class="el" href="timestep_8h_source.html#l00012">ActiveParticles::NumActiveParticle</a>, <a class="el" href="partmanager_8h_source.html#l00076">part_manager_type::NumPart</a>, <a class="el" href="partmanager_8h_source.html#l00088">P</a>, <a class="el" href="partmanager_8c_source.html#l00011">PartManager</a>, <a class="el" href="timestep_8c_source.html#l00807">print_timebin_statistics()</a>, <a class="el" href="mymalloc_8h_source.html#l00028">ta_free</a>, <a class="el" href="mymalloc_8h_source.html#l00025">ta_malloc</a>, <a class="el" href="timestep_8h_source.html#l00027">DriftKickTimes::Ti_Current</a>, <a class="el" href="timebinmgr_8h_source.html#l00013">TIMEBINS</a>, <a class="el" href="timestep_8c_source.html#l00077">timestep_eh_slots_fork()</a>, and <a class="el" href="walltime_8h_source.html#l00008">walltime_measure</a>.</p>

<p class="reference">Referenced by <a class="el" href="run_8c_source.html#l00284">run()</a>, and <a class="el" href="runtests_8c_source.html#l00071">run_gravity_test()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a8102740bf0615adc840060e1101d6d3e_cgraph.svg" width="1084" height="448"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a8102740bf0615adc840060e1101d6d3e_icgraph.svg" width="547" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a27b2f11d07d3c2d3c0d2f095c270a3cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a27b2f11d07d3c2d3c0d2f095c270a3cf">&#9670;&nbsp;</a></span>set_timestep_params()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_timestep_params </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structParameterSet.html">ParameterSet</a> *&#160;</td>
          <td class="paramname"><em>ps</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00051">51</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;{</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    MPI_Comm_rank(MPI_COMM_WORLD, &amp;<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0) {</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        <a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#a8a5ae74e923d6105e3b256704c1cdc3d">ErrTolIntAccuracy</a> = <a class="code" href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a>(ps, <span class="stringliteral">&quot;ErrTolIntAccuracy&quot;</span>);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#a443eea8dbfadc8c5caa0734ec1ff68ec">MaxGasVel</a> = <a class="code" href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a>(ps, <span class="stringliteral">&quot;MaxGasVel&quot;</span>);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#a03e0c2042baceb109e580450df0e2075">MaxSizeTimestep</a> = <a class="code" href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a>(ps, <span class="stringliteral">&quot;MaxSizeTimestep&quot;</span>);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#a638b86b8ff28a851bb56a9ed17ec039c">MinSizeTimestep</a> = <a class="code" href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a>(ps, <span class="stringliteral">&quot;MinSizeTimestep&quot;</span>);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#a97d08be54a1ba3a50904f948c75705e9">ForceEqualTimesteps</a> = <a class="code" href="paramset_8c.html#a6228c17649c46aef53e74cd7ccb93fb0">param_get_int</a>(ps, <span class="stringliteral">&quot;ForceEqualTimesteps&quot;</span>);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#a77809e5f4e2fc3387e743eaa9fc329dc">MaxRMSDisplacementFac</a> = <a class="code" href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a>(ps, <span class="stringliteral">&quot;MaxRMSDisplacementFac&quot;</span>);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.<a class="code" href="structtimestep__params.html#aef33cb2560126749c17dbf6c6b40ed77">CourantFac</a> = <a class="code" href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a>(ps, <span class="stringliteral">&quot;CourantFac&quot;</span>);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    MPI_Bcast(&amp;<a class="code" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structtimestep__params.html">timestep_params</a>), MPI_BYTE, 0, MPI_COMM_WORLD);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;}</div>
<div class="ttc" id="aparamset_8c_html_a1ae36a31d95a8e2a9d2812bb9ecc9d49"><div class="ttname"><a href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a></div><div class="ttdeci">double param_get_double(ParameterSet *ps, const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="paramset_8c_source.html#l00336">paramset.c:336</a></div></div>
<div class="ttc" id="aparamset_8c_html_a6228c17649c46aef53e74cd7ccb93fb0"><div class="ttname"><a href="paramset_8c.html#a6228c17649c46aef53e74cd7ccb93fb0">param_get_int</a></div><div class="ttdeci">int param_get_int(ParameterSet *ps, const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="paramset_8c_source.html#l00368">paramset.c:368</a></div></div>
<div class="ttc" id="astructtimestep__params_html"><div class="ttname"><a href="structtimestep__params.html">timestep_params</a></div><div class="ttdef"><b>Definition:</b> <a href="timestep_8c_source.html#l00026">timestep.c:27</a></div></div>
<div class="ttc" id="atest__exchange_8c_html_a52c8c7d2abff436111942e02c5bb466a"><div class="ttname"><a href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a></div><div class="ttdeci">int ThisTask</div><div class="ttdef"><b>Definition:</b> <a href="test__exchange_8c_source.html#l00023">test_exchange.c:23</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="timestep_8c_source.html#l00046">timestep_params::CourantFac</a>, <a class="el" href="timestep_8c_source.html#l00030">timestep_params::ErrTolIntAccuracy</a>, <a class="el" href="timestep_8c_source.html#l00033">timestep_params::ForceEqualTimesteps</a>, <a class="el" href="timestep_8c_source.html#l00045">timestep_params::MaxGasVel</a>, <a class="el" href="timestep_8c_source.html#l00038">timestep_params::MaxRMSDisplacementFac</a>, <a class="el" href="timestep_8c_source.html#l00036">timestep_params::MaxSizeTimestep</a>, <a class="el" href="timestep_8c_source.html#l00035">timestep_params::MinSizeTimestep</a>, <a class="el" href="paramset_8c_source.html#l00336">param_get_double()</a>, <a class="el" href="paramset_8c_source.html#l00368">param_get_int()</a>, <a class="el" href="test__exchange_8c_source.html#l00023">ThisTask</a>, and <a class="el" href="timestep_8c.html#a9a9520c05fd90139cd00f4581dbea57a">TimestepParams</a>.</p>

<p class="reference">Referenced by <a class="el" href="gadget_2params_8c_source.html#l00359">read_parameter_file()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a27b2f11d07d3c2d3c0d2f095c270a3cf_cgraph.svg" width="831" height="130"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a27b2f11d07d3c2d3c0d2f095c270a3cf_icgraph.svg" width="478" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a7f89b5c29a35ca695a22d09f18d2807a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f89b5c29a35ca695a22d09f18d2807a">&#9670;&nbsp;</a></span>timestep_eh_slots_fork()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int timestep_eh_slots_fork </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structEIBase.html">EIBase</a> *&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>userdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00077">77</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;{</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">/*Update the active particle list:</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">     * if the parent is active the child should also be active.</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">     * Stars must always be active on formation, but</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">     * BHs need not be: a halo can be seeded when the particle in question is inactive.*/</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <a class="code" href="structEISlotsFork.html">EISlotsFork</a> * ev = (<a class="code" href="structEISlotsFork.html">EISlotsFork</a> *) event;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordtype">int</span> parent = ev-&gt;<a class="code" href="structEISlotsFork.html#adfb224c6cc23cde340474c5d08b5b449">parent</a>;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordtype">int</span> child = ev-&gt;<a class="code" href="structEISlotsFork.html#acceff2e5aa9a8341512e4067f65c46de">child</a>;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <a class="code" href="structActiveParticles.html">ActiveParticles</a> * act = (<a class="code" href="structActiveParticles.html">ActiveParticles</a> *) userdata;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="timestep_8c.html#a896d6e80e5dd9d14008709479a0f8a66">is_timebin_active</a>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[parent].TimeBin, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[parent].Ti_drift)) {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        int64_t childactive = <a class="code" href="system_8h.html#aa4435d7957d01010b3934f5f107eb0d5">atomic_fetch_and_add_64</a>(&amp;act-&gt;<a class="code" href="structActiveParticles.html#a847ab898fdabc62a4723c7c3a66038d4">NumActiveParticle</a>, 1);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="keywordflow">if</span>(act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a>) {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            <span class="comment">/* This should never happen because we allocate as much space for active particles as we have space</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">             * for particles, but just in case*/</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            <span class="keywordflow">if</span>(childactive &gt;= act-&gt;<a class="code" href="structActiveParticles.html#a28d54535d84f6fd1a6c2040d6d9eb80b">MaxActiveParticle</a>)</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(5, <span class="stringliteral">&quot;Tried to add %ld active particles, more than %ld allowed\n&quot;</span>, childactive, act-&gt;<a class="code" href="structActiveParticles.html#a28d54535d84f6fd1a6c2040d6d9eb80b">MaxActiveParticle</a>);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a>[childactive] = child;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        }</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    }</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;}</div>
<div class="ttc" id="astructActiveParticles_html"><div class="ttname"><a href="structActiveParticles.html">ActiveParticles</a></div><div class="ttdef"><b>Definition:</b> <a href="timestep_8h_source.html#l00009">timestep.h:10</a></div></div>
<div class="ttc" id="astructEISlotsFork_html"><div class="ttname"><a href="structEISlotsFork.html">EISlotsFork</a></div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00148">slotsmanager.h:148</a></div></div>
<div class="ttc" id="astructEISlotsFork_html_acceff2e5aa9a8341512e4067f65c46de"><div class="ttname"><a href="structEISlotsFork.html#acceff2e5aa9a8341512e4067f65c46de">EISlotsFork::child</a></div><div class="ttdeci">int64_t child</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00151">slotsmanager.h:151</a></div></div>
<div class="ttc" id="astructEISlotsFork_html_adfb224c6cc23cde340474c5d08b5b449"><div class="ttname"><a href="structEISlotsFork.html#adfb224c6cc23cde340474c5d08b5b449">EISlotsFork::parent</a></div><div class="ttdeci">int parent</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00150">slotsmanager.h:150</a></div></div>
<div class="ttc" id="asystem_8h_html_aa4435d7957d01010b3934f5f107eb0d5"><div class="ttname"><a href="system_8h.html#aa4435d7957d01010b3934f5f107eb0d5">atomic_fetch_and_add_64</a></div><div class="ttdeci">static int64_t atomic_fetch_and_add_64(int64_t *ptr, int64_t value)</div><div class="ttdef"><b>Definition:</b> <a href="system_8h_source.html#l00068">system.h:68</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="timestep_8h_source.html#l00013">ActiveParticles::ActiveParticle</a>, <a class="el" href="system_8h_source.html#l00068">atomic_fetch_and_add_64()</a>, <a class="el" href="slotsmanager_8h_source.html#l00151">EISlotsFork::child</a>, <a class="el" href="endrun_8c_source.html#l00147">endrun()</a>, <a class="el" href="timestep_8c_source.html#l00149">is_timebin_active()</a>, <a class="el" href="timestep_8h_source.html#l00011">ActiveParticles::MaxActiveParticle</a>, <a class="el" href="timestep_8h_source.html#l00012">ActiveParticles::NumActiveParticle</a>, <a class="el" href="partmanager_8h_source.html#l00088">P</a>, and <a class="el" href="slotsmanager_8h_source.html#l00150">EISlotsFork::parent</a>.</p>

<p class="reference">Referenced by <a class="el" href="timestep_8c_source.html#l00795">free_activelist()</a>, and <a class="el" href="timestep_8c_source.html#l00721">rebuild_activelist()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a7f89b5c29a35ca695a22d09f18d2807a_cgraph.svg" width="723" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_a7f89b5c29a35ca695a22d09f18d2807a_icgraph.svg" width="770" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ace9e5cdcc776609e46189b2268155ca7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace9e5cdcc776609e46189b2268155ca7">&#9670;&nbsp;</a></span>update_lastactive_drift()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void update_lastactive_drift </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structDriftKickTimes.html">DriftKickTimes</a> *&#160;</td>
          <td class="paramname"><em>times</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="timestep_8c_source.html#l00309">309</a> of file <a class="el" href="timestep_8c_source.html">timestep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;{</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordtype">int</span> bin;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="preprocessor">    #pragma omp parallel for</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">for</span>(bin = 0; bin &lt;= <a class="code" href="timebinmgr_8h.html#a4668a3a5f210b5742a179c8d258a703d">TIMEBINS</a>; bin++)</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="comment">/* Update active timestep even if no particles in it*/</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="timestep_8c.html#a896d6e80e5dd9d14008709479a0f8a66">is_timebin_active</a>(bin, times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>))</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            times-&gt;<a class="code" href="structDriftKickTimes.html#a3082835582bba0baf28c10ba766e3939">Ti_lastactivedrift</a>[bin] = times-&gt;<a class="code" href="structDriftKickTimes.html#a8cbfa406f883f7f7e6ef53cfa4608f7d">Ti_Current</a>;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    }</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="timestep_8c_source.html#l00149">is_timebin_active()</a>, <a class="el" href="timestep_8h_source.html#l00027">DriftKickTimes::Ti_Current</a>, <a class="el" href="timestep_8h_source.html#l00025">DriftKickTimes::Ti_lastactivedrift</a>, and <a class="el" href="timebinmgr_8h_source.html#l00013">TIMEBINS</a>.</p>

<p class="reference">Referenced by <a class="el" href="run_8c_source.html#l00284">run()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_ace9e5cdcc776609e46189b2268155ca7_cgraph.svg" width="550" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="timestep_8c_ace9e5cdcc776609e46189b2268155ca7_icgraph.svg" width="375" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a9a9520c05fd90139cd00f4581dbea57a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a9520c05fd90139cd00f4581dbea57a">&#9670;&nbsp;</a></span>TimestepParams</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structtimestep__params.html">timestep_params</a> TimestepParams</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="timestep_8c_source.html#l00396">do_the_short_range_kick()</a>, <a class="el" href="timestep_8c_source.html#l00176">find_timesteps()</a>, <a class="el" href="timestep_8c_source.html#l00584">get_long_range_timestep_dloga()</a>, <a class="el" href="timestep_8c_source.html#l00450">get_timestep_dloga()</a>, <a class="el" href="timestep_8c_source.html#l00537">get_timestep_ti()</a>, and <a class="el" href="timestep_8c_source.html#l00051">set_timestep_params()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
