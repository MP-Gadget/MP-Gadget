<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MP-Gadget: MP-Gadget</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MP-Gadget
   &#160;<span id="projectnumber">5.0.1.dev1-76bc7d4726-dirty</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">MP-Gadget </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README_tmp"></a> Massively Parallel Cosmological SPH Simulation Software - MP-Gadget.</p>
<p><a href="https://mp-gadget.github.io/MP-Gadget/classes.html">Source code browser</a> (may be slightly out-sync from current master branch)</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Description</h1>
<p>This version of Gadget is derived from main P-Gadget / Gadget-2. It is the source code used to run the BlueTides simulation (<a href="http://bluetides-project.org">http://bluetides-project.org</a>).</p>
<p>The infrastructure is heavily reworked. As a summary:</p>
<ul>
<li>A better PM solver for long range force with <a class="el" href="structPencil.html">Pencil</a> FFT.</li>
<li>A better Tree solver with faster threading and less redundant code.</li>
<li>A better Domain decomposition that scales to half a million cores.</li>
<li>A easier to use IO module with a Python binding.</li>
<li>A more intuitive parameter file parser with schema and docstrings.</li>
<li>A cleaner code base with less conditional compilation flags.</li>
</ul>
<p>Physics models:</p>
<ul>
<li>Pressure Entropy SPH and Density Entropy SPH</li>
<li>Radiation background in the expansion</li>
<li>Massive neutrinos</li>
<li>Dark energy</li>
<li>ICs have species dependent density and velocity transfer functions</li>
<li>Generic halo tracer particle seeding</li>
<li>Various wind feedback and blackhole feedback models</li>
<li>Various star formation criteria</li>
<li>Primordial and metal cooling using updated recombination rates from the Sherwood simulation.</li>
<li>Helium reionization</li>
<li>Fluctuating UV background</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Installation</h1>
<p>First time users:</p>
<div class="fragment"><div class="line">git clone https://github.com/MP-Gadget/MP-Gadget.git</div>
<div class="line">cd MP-Gadget</div>
<div class="line">make -j</div>
</div><!-- fragment --><p>We will need gsl. On HPC systems with the modules command, usually it can be loaded with</p>
<div class="fragment"><div class="line">module load gsl</div>
<div class="line"> </div>
<div class="line">env | grep GSL  # check if GSL path is reasonable</div>
</div><!-- fragment --><p>On a common PC/Linux system, refer to your package vendor how to install gsl and gsl-devel.</p>
<p>If you wish to perform compile-time customisation (to, eg, change optimizations or use different compilers), you need an Options.mk file. The initial defaults are stored in Options.mk.example.</p>
<p>For other systems you should use the customised Options.mk file in the platform-options directory. For example, for Stampede 2 you should do:</p>
<div class="fragment"><div class="line">cp platform-options/Options.mk.stampede2 Options.mk</div>
</div><!-- fragment --><p>For generic intel compiler based clusters, start with platform-options/Options.mk.icc</p>
<p>Compile-time options may be set in Options.mk. The remaining compile time options are generally only useful for development or debugging. All science options are set using a parameter file at runtime.</p>
<ul>
<li>DEBUG which enables various internal code consistency checks for debugging.</li>
<li>VALGRIND which if set disables the internal memory allocator and allocates memory from the system. This is required for debugging memory allocation errors with valgrind of the address sanitizer.</li>
<li>NO_ISEND_IRECV_IN_DOMAIN disables the use of asynchronous send and receive in our custom MPI_Alltoallv implementation, for buggy MPI libraries.</li>
<li>NO_OPENMP_SPINLOCK uses the OpenMP default locking routines. These are often much slower than the default pthread spinlocks. However, they are necessary for Mac, which does not provide pthreads.</li>
</ul>
<p>If compilation fails with errors related to the GSL, you may also need to set the GSL_INC or GSL_LIB variables in Options.mk to the filesystem path containing the GSL headers and libraries.</p>
<p>To run a N-Body sim, use IC files with no gas particles.</p>
<p>Now we are ready to build</p>
<div class="fragment"><div class="line">make -j</div>
</div><!-- fragment --><p>In the end, we will have 2 binaries:</p>
<div class="fragment"><div class="line">ls gadget/MP-Gadget genic/MP-GenIC</div>
</div><!-- fragment --><ol type="1">
<li>MP-Gadget is the main simulation program.</li>
<li>MP-GenIC is the initial condition generator.</li>
</ol>
<h1><a class="anchor" id="autotoc_md3"></a>
Config Files</h1>
<p>Most options are configured at runtime with options in the config files. The meaning of these options are documented in the params.c files in the gadget/ and genic/ subdirectories.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Usage</h1>
<p>Find examples in examples/.</p>
<ul>
<li>dm-only : Dark Matter only</li>
<li>lya : Lyman Alpha only</li>
<li>hydro : hydro</li>
<li>small : hydro with low resolution</li>
</ul>
<p>Control number of threads with [OMP_NUM_THREADS]{.title-ref}. A good value is 10-20 threads.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
User Guide</h1>
<p>A longer user guide in LaTeX can be found here: <a href="https://www.overleaf.com/read/kzksrgnzhtnh">https://www.overleaf.com/read/kzksrgnzhtnh</a></p>
<h1><a class="anchor" id="autotoc_md6"></a>
IO Format</h1>
<p>The snapshot is in bigfile format. For data analysis in Python, use</p>
<div class="fragment"><div class="line">pip install bigfile</div>
</div><!-- fragment --><p>Refer to <a href="https://github.com/rainwoodman/bigfile">https://github.com/rainwoodman/bigfile</a> for usage.</p>
<p>Otherwise directly open the blocks with Fortran or C, noting the data-type information and attributes in header and attrs files (in plain text)</p>
<h1><a class="anchor" id="autotoc_md7"></a>
GLIBC 2.22</h1>
<p>Cray updated their GLIBC to 2.22+ recently. A good move but it happens to be a buggy version of GLIBC: <a href="https://sourceware.org/bugzilla/show_bug.cgi?id=19590">https://sourceware.org/bugzilla/show_bug.cgi?id=19590</a> causing non-existing symbols like [_ZGVcN4v___log_finite]{.title-ref}. Adding [-lmvec -lmvec_nonshared]{.title-ref} to GSL_LIBS works around the issue.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Bigfile</h1>
<p>Bigfile is incorporated using git-subtree, in the depends/bigfile prefix. The command to update it (squash is currently mandatory) is:</p>
<div class="fragment"><div class="line">git subtree pull --prefix depends/bigfile &quot;https://github.com/rainwoodman/bigfile.git&quot; master --squash</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md9"></a>
Contributors</h1>
<p>Gadget-2 was authored by Volker Springel. The original P-GADGET3 was maintained by Volker Springel</p>
<p>MP-Gadget is maintained by Yu Feng and Simeon Bird.</p>
<p>Contributors to MP-Gadget include:</p>
<p>Nicholas Battaglia, James Davies, Nishikanta Khandai, Yueying Ni, Karime Maamari, Chris Pederson and Lauren Anderson.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Code review</h1>
<p>Pull requests should ideally be reviewed. Here are some links on how to conduct review:</p>
<p><a href="https://smartbear.com/learn/code-review/best-practices-for-peer-code-review/">https://smartbear.com/learn/code-review/best-practices-for-peer-code-review/</a> <a href="http://web.mit.edu/6.005/www/fa15/classes/04-code-review/">http://web.mit.edu/6.005/www/fa15/classes/04-code-review/</a></p>
<h1><a class="anchor" id="autotoc_md11"></a>
Citation</h1>
<p>We never get around to write a proper code paper on MP-Gadget.</p>
<p>For usage of the code, here is a DOI for this repository that you can cite</p>
<p><a href="https://zenodo.org/badge/latestdoi/24486904"><img src="https://zenodo.org/badge/24486904.svg" alt="image" style="pointer-events: none;" class="inline"/></a></p>
<p>It helps us to keep track of uses.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
Licence Issue</h1>
<p>Most files are licensed under GPLv2+.</p>
<p>Please refer to the source files for details.</p>
<h1><a class="anchor" id="autotoc_md13"></a>
Status</h1>
<p>master branch status:</p>
<p><a href="https://github.com/MP-Gadget/MP-Gadget/actions?query=workflow%3Amain"><img src="https://github.com/MP-Gadget/MP-Gadget/workflows/main/badge.svg" alt="image" style="pointer-events: none;" class="inline"/></a> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
