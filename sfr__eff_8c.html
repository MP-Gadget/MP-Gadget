<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MP-Gadget: libgadget/sfr_eff.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MP-Gadget
   &#160;<span id="projectnumber">5.0.1.dev1-76bc7d4726-dirty</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_8db5bc7a24c620673ff2e44953ca6f6c.html">libgadget</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">sfr_eff.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;mpi.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;<a class="el" href="string_8h_source.html">string.h</a>&gt;</code><br />
<code>#include &lt;math.h&gt;</code><br />
<code>#include &lt;omp.h&gt;</code><br />
<code>#include &quot;<a class="el" href="physconst_8h_source.html">physconst.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sfr__eff_8h_source.html">sfr_eff.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="cooling_8h_source.html">cooling.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="slotsmanager_8h_source.html">slotsmanager.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="walltime_8h_source.html">walltime.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="winds_8h_source.html">winds.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hydra_8h_source.html">hydra.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="forcetree_8h_source.html">forcetree.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="domain_8h_source.html">domain.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for sfr_eff.c:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c__incl.svg" width="2770" height="784"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<p><a href="sfr__eff_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structSFRParams.html">SFRParams</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsfr__eeqos__data.html">sfr_eeqos_data</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a50b5665399825c31849545fe351e51ab"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#a50b5665399825c31849545fe351e51ab">get_generations</a> (void)</td></tr>
<tr class="separator:a50b5665399825c31849545fe351e51ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4951e59bdceebd7b56b972942bc3a10d"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structsfr__eeqos__data.html">sfr_eeqos_data</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#a4951e59bdceebd7b56b972942bc3a10d">get_sfr_eeqos</a> (struct <a class="el" href="structparticle__data.html">particle_data</a> *part, struct <a class="el" href="structsph__particle__data.html">sph_particle_data</a> *sph, double dtime, struct <a class="el" href="structUVBG.html">UVBG</a> *local_uvbg, const double redshift, const double a3inv)</td></tr>
<tr class="separator:a4951e59bdceebd7b56b972942bc3a10d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbc106c51df0aa2c0b5727eadbf2dd3c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#adbc106c51df0aa2c0b5727eadbf2dd3c">cooling_direct</a> (int i, const double redshift, const double a3inv, const double hubble, const struct <a class="el" href="structUVBG.html">UVBG</a> *const GlobalUVBG)</td></tr>
<tr class="separator:adbc106c51df0aa2c0b5727eadbf2dd3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64f07331e54d0eb86fd4f6466d58e0f2"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#a64f07331e54d0eb86fd4f6466d58e0f2">cooling_relaxed</a> (int i, double dtime, struct <a class="el" href="structUVBG.html">UVBG</a> *local_uvbg, const double redshift, const double a3inv, struct <a class="el" href="structsfr__eeqos__data.html">sfr_eeqos_data</a> sfr_data, const struct <a class="el" href="structUVBG.html">UVBG</a> *const GlobalUVBG)</td></tr>
<tr class="separator:a64f07331e54d0eb86fd4f6466d58e0f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a537fdd1e25fad1d7245263ef47412790"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#a537fdd1e25fad1d7245263ef47412790">make_particle_star</a> (int child, int parent, int placement, double Time)</td></tr>
<tr class="separator:a537fdd1e25fad1d7245263ef47412790"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a276becdf281cd9d2a0f2f3e1642b2559"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#a276becdf281cd9d2a0f2f3e1642b2559">starformation</a> (int i, double *localsfr, <a class="el" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> *sm_out, <a class="el" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> *GradRho, const double redshift, const double a3inv, const double hubble, const double GravInternal, const struct <a class="el" href="structUVBG.html">UVBG</a> *const GlobalUVBG)</td></tr>
<tr class="separator:a276becdf281cd9d2a0f2f3e1642b2559"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4c376934146cd783970d5b2582a893f"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#ae4c376934146cd783970d5b2582a893f">quicklyastarformation</a> (int i, const double a3inv)</td></tr>
<tr class="separator:ae4c376934146cd783970d5b2582a893f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70b33984dc619b1cdb5acaf23b4aaf1f"><td class="memItemLeft" align="right" valign="top">static double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#a70b33984dc619b1cdb5acaf23b4aaf1f">get_sfr_factor_due_to_selfgravity</a> (int i, const double atime, const double a3inv, const double hubble, const double GravInternal)</td></tr>
<tr class="separator:a70b33984dc619b1cdb5acaf23b4aaf1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affe50edf965ec43e0c4bb2591d5f1d91"><td class="memItemLeft" align="right" valign="top">static double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#affe50edf965ec43e0c4bb2591d5f1d91">get_sfr_factor_due_to_h2</a> (int i, <a class="el" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> *GradRho, const double atime)</td></tr>
<tr class="separator:affe50edf965ec43e0c4bb2591d5f1d91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5cfa7b95c20ca76682274d0dc17e3c66"><td class="memItemLeft" align="right" valign="top">static double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#a5cfa7b95c20ca76682274d0dc17e3c66">get_starformation_rate_full</a> (int i, <a class="el" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> *GradRho, struct <a class="el" href="structsfr__eeqos__data.html">sfr_eeqos_data</a> sfr_data, const double atime, const double a3inv, const double hubble, const double GravInternal)</td></tr>
<tr class="separator:a5cfa7b95c20ca76682274d0dc17e3c66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a054be999a15e37a4d4d9b8dde836f287"><td class="memItemLeft" align="right" valign="top">static double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#a054be999a15e37a4d4d9b8dde836f287">get_egyeff</a> (double redshift, double dens, struct <a class="el" href="structUVBG.html">UVBG</a> *uvbg)</td></tr>
<tr class="separator:a054be999a15e37a4d4d9b8dde836f287"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5c8b2f6a1323536d08519b623f60992"><td class="memItemLeft" align="right" valign="top">static double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#ad5c8b2f6a1323536d08519b623f60992">find_star_mass</a> (int i, const double avg_baryon_mass)</td></tr>
<tr class="separator:ad5c8b2f6a1323536d08519b623f60992"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad138d98cd8eded73c2b44955c8709b42"><td class="memItemLeft" align="right" valign="top">static int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#ad138d98cd8eded73c2b44955c8709b42">sfr_reserve_slots</a> (<a class="el" href="structActiveParticles.html">ActiveParticles</a> *act, int *NewStars, int NumNewStar, <a class="el" href="structForceTree.html">ForceTree</a> *<a class="el" href="test__cooling__rates_8c.html#a3f5eb0be0db76594291d88d7cbdab712">tt</a>)</td></tr>
<tr class="separator:ad138d98cd8eded73c2b44955c8709b42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9a0036f2b590b6343d359f638d0218f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#af9a0036f2b590b6343d359f638d0218f">set_sfr_params</a> (<a class="el" href="structParameterSet.html">ParameterSet</a> *ps)</td></tr>
<tr class="separator:af9a0036f2b590b6343d359f638d0218f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc5b151d356619b98a8ded72cc9426c7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#abc5b151d356619b98a8ded72cc9426c7">cooling_and_starformation</a> (<a class="el" href="structActiveParticles.html">ActiveParticles</a> *act, double Time, double <a class="el" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a>, <a class="el" href="structForceTree.html">ForceTree</a> *tree, const <a class="el" href="structCosmology.html">Cosmology</a> *<a class="el" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, <a class="el" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> *GradRho, FILE *FdSfr)</td></tr>
<tr class="separator:abc5b151d356619b98a8ded72cc9426c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4080dc1b2496c08090d1101544b48cc2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#a4080dc1b2496c08090d1101544b48cc2">sfreff_on_eeqos</a> (const struct <a class="el" href="structsph__particle__data.html">sph_particle_data</a> *sph, const double a3inv)</td></tr>
<tr class="separator:a4080dc1b2496c08090d1101544b48cc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e4a6b5d6976b26f1ababfba475c1f4c"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#a4e4a6b5d6976b26f1ababfba475c1f4c">get_neutral_fraction_sfreff</a> (double redshift, double hubble, struct <a class="el" href="structparticle__data.html">particle_data</a> *partdata, struct <a class="el" href="structsph__particle__data.html">sph_particle_data</a> *sphdata)</td></tr>
<tr class="separator:a4e4a6b5d6976b26f1ababfba475c1f4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18c2f2fb564de2ff8a5372d8bcbe0968"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#a18c2f2fb564de2ff8a5372d8bcbe0968">get_helium_neutral_fraction_sfreff</a> (int ion, double redshift, double hubble, struct <a class="el" href="structparticle__data.html">particle_data</a> *partdata, struct <a class="el" href="structsph__particle__data.html">sph_particle_data</a> *sphdata)</td></tr>
<tr class="separator:a18c2f2fb564de2ff8a5372d8bcbe0968"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4503d203fa143d76d004c0719415562"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#aa4503d203fa143d76d004c0719415562">get_MinEgySpec</a> (void)</td></tr>
<tr class="separator:aa4503d203fa143d76d004c0719415562"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17ba6f2251e04bc57005d00cc09640c8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#a17ba6f2251e04bc57005d00cc09640c8">init_cooling_and_star_formation</a> (int CoolingOn, int StarformationOn, <a class="el" href="structCosmology.html">Cosmology</a> *<a class="el" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, const double avg_baryon_mass, const double BoxSize, const struct <a class="el" href="structUnitSystem.html">UnitSystem</a> units)</td></tr>
<tr class="separator:a17ba6f2251e04bc57005d00cc09640c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aefebad1cdf9c3fe278031e2b78d69859"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#aefebad1cdf9c3fe278031e2b78d69859">sfr_need_to_compute_sph_grad_rho</a> (void)</td></tr>
<tr class="separator:aefebad1cdf9c3fe278031e2b78d69859"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acfbbbdbb84c5b6812489f849106492de"><td class="memItemLeft" align="right" valign="top">static double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#acfbbbdbb84c5b6812489f849106492de">ev_NH_from_GradRho</a> (<a class="el" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> gradrho_mag, double hsml, double rho, double include_h)</td></tr>
<tr class="separator:acfbbbdbb84c5b6812489f849106492de"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a1a33e045abac80ac9459e11061775e70"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structSFRParams.html">SFRParams</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a></td></tr>
<tr class="separator:a1a33e045abac80ac9459e11061775e70"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="abc5b151d356619b98a8ded72cc9426c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc5b151d356619b98a8ded72cc9426c7">&#9670;&nbsp;</a></span>cooling_and_starformation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cooling_and_starformation </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structActiveParticles.html">ActiveParticles</a> *&#160;</td>
          <td class="paramname"><em>act</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>dloga</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structForceTree.html">ForceTree</a> *&#160;</td>
          <td class="paramname"><em>tree</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structCosmology.html">Cosmology</a> *&#160;</td>
          <td class="paramname"><em>CP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> *&#160;</td>
          <td class="paramname"><em>GradRho</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>FdSfr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00167">167</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;{</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> nthreads = omp_get_max_threads();</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="comment">/*This is a queue for the new stars and their parents, so we can reallocate the slots after the main cooling loop.*/</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordtype">int</span> * NewStars = NULL;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordtype">int</span> * NewParents = NULL;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    int64_t NumNewStar = 0, NumMaybeWind = 0;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordtype">int</span> * MaybeWind = NULL;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> * StellarMass = NULL;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160; </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordtype">size_t</span> *nqthrsfr = <a class="code" href="mymalloc_8h.html#a52bc2c6ec78b17bb6d42957cbf642f15">ta_malloc</a>(<span class="stringliteral">&quot;nqthrsfr&quot;</span>, <span class="keywordtype">size_t</span>, nthreads);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordtype">int</span> **thrqueuesfr = <a class="code" href="mymalloc_8h.html#a52bc2c6ec78b17bb6d42957cbf642f15">ta_malloc</a>(<span class="stringliteral">&quot;thrqueuesfr&quot;</span>, <span class="keywordtype">int</span> *, nthreads);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordtype">int</span> **thrqueueparent = <a class="code" href="mymalloc_8h.html#a52bc2c6ec78b17bb6d42957cbf642f15">ta_malloc</a>(<span class="stringliteral">&quot;thrqueueparent&quot;</span>, <span class="keywordtype">int</span> *, nthreads);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordtype">size_t</span> *nqthrwind = NULL;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordtype">int</span> **thrqueuewind = NULL;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">/*Need to capture this so that when NumActiveParticle increases during the loop</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">     * we don&#39;t add extra loop iterations on particles with invalid slots.*/</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> nactive = act-&gt;<a class="code" href="structActiveParticles.html#a847ab898fdabc62a4723c7c3a66038d4">NumActiveParticle</a>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> a3inv = 1./(Time * Time * Time);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> hubble = <a class="code" href="cosmology_8c.html#ab425f16e6fe06110e2fb4944065b81bb">hubble_function</a>(<a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, Time);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160; </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a2694f130b78888ed2a49aa30181b0bcf">StarformationOn</a>) {</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        NewStars = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;NewStars&quot;</span>, nactive * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * nthreads);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <a class="code" href="system_8c.html#a0082531d4facaa6caabf05fb9fd547d4">gadget_setup_thread_arrays</a>(NewStars, thrqueuesfr, nqthrsfr, nactive, nthreads);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        NewParents = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#ac576b6f19b635b512399d6afb8c20d99">mymalloc2</a>(<span class="stringliteral">&quot;NewParents&quot;</span>, nactive * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * nthreads);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <a class="code" href="system_8c.html#a0082531d4facaa6caabf05fb9fd547d4">gadget_setup_thread_arrays</a>(NewParents, thrqueueparent, nqthrsfr, nactive, nthreads);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    }</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#acc35d766de8266c3fb4686b33820a2df">WindOn</a> &amp;&amp; <a class="code" href="winds_8c.html#a7a6b62046c0e4f5fe9e0a7bb0be65ddc">winds_are_subgrid</a>()) {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        nqthrwind = <a class="code" href="mymalloc_8h.html#a52bc2c6ec78b17bb6d42957cbf642f15">ta_malloc</a>(<span class="stringliteral">&quot;nqthrwind&quot;</span>, <span class="keywordtype">size_t</span>, nthreads);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        thrqueuewind = <a class="code" href="mymalloc_8h.html#a52bc2c6ec78b17bb6d42957cbf642f15">ta_malloc</a>(<span class="stringliteral">&quot;thrqueuewind&quot;</span>, <span class="keywordtype">int</span> *, nthreads);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        StellarMass = (<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;StellarMass&quot;</span>, <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[0].<a class="code" href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">size</a> * <span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a>));</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        MaybeWind = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;MaybeWind&quot;</span>, nactive * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * nthreads);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <a class="code" href="system_8c.html#a0082531d4facaa6caabf05fb9fd547d4">gadget_setup_thread_arrays</a>(MaybeWind, thrqueuewind, nqthrwind, nactive, nthreads);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    }</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160; </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="comment">/* Get the global UVBG for this redshift. */</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> redshift = 1./Time - 1;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keyword">struct </span><a class="code" href="structUVBG.html">UVBG</a> GlobalUVBG = <a class="code" href="cooling_8h.html#ac9c80af3cbf2235e9f8d39e176515cfe">get_global_UVBG</a>(redshift);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordtype">double</span> sum_sm = 0, sum_mass_stars = 0, localsfr = 0;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160; </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">/* First decide which stars are cooling and which starforming. If star forming we add them to a list.</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">     * Note the dynamic scheduling: individual particles may have very different loop iteration lengths.</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">     * Cooling is much slower than sfr. I tried splitting it into a separate loop instead, but this was faster.*/</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="preprocessor">    #pragma omp parallel reduction(+:localsfr) reduction(+: sum_sm) reduction(+:sum_mass_stars)</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> tid = omp_get_thread_num();</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="preprocessor">        #pragma omp for schedule(static)</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="keywordflow">for</span>(i=0; i &lt; nactive; i++)</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <span class="comment">/*Use raw particle number if active_set is null, otherwise use active_set*/</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> p_i = act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a> ? act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a>[i] : i;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            <span class="comment">/* Skip non-gas or garbage particles */</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Type != 0 || <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].IsGarbage || <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Mass &lt;= 0)</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160; </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="keywordtype">int</span> shall_we_star_form = 0;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a2694f130b78888ed2a49aa30181b0bcf">StarformationOn</a>) {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                <span class="comment">/*Reduce delaytime for wind particles.*/</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                <a class="code" href="winds_8c.html#a274ae45443daff42b91d384c64105010">winds_evolve</a>(p_i, a3inv, hubble);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                <span class="comment">/* check whether we are star forming gas.*/</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#acc0def39860c56e0a46c003d10bcb1b8">QuickLymanAlphaProbability</a> &gt; 0)</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                    shall_we_star_form = <a class="code" href="sfr__eff_8c.html#ae4c376934146cd783970d5b2582a893f">quicklyastarformation</a>(p_i, a3inv);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                    shall_we_star_form = <a class="code" href="sfr__eff_8c.html#a4080dc1b2496c08090d1101544b48cc2">sfreff_on_eeqos</a>(&amp;<a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(p_i), a3inv);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            <span class="keywordflow">if</span>(shall_we_star_form) {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                <span class="keywordtype">int</span> newstar = -1;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> sm = 0;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#acc0def39860c56e0a46c003d10bcb1b8">QuickLymanAlphaProbability</a> &gt; 0) {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                    <span class="comment">/*New star is always the same particle as the parent for quicklya*/</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                    newstar = p_i;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                    sum_sm += <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Mass;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                    sm = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Mass;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                    newstar = <a class="code" href="sfr__eff_8c.html#a276becdf281cd9d2a0f2f3e1642b2559">starformation</a>(p_i, &amp;localsfr, &amp;sm, GradRho, redshift, a3inv, hubble, <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#a0970aac048f04a9ccd8778aaf07a0bbc">GravInternal</a>, &amp;GlobalUVBG);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                    sum_sm += <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Mass * (1 - exp(-sm/<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Mass));</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                }</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                <span class="comment">/*Add this particle to the stellar conversion queue if necessary.*/</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                <span class="keywordflow">if</span>(newstar &gt;= 0) {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                    thrqueuesfr[tid][nqthrsfr[tid]] = newstar;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                    thrqueueparent[tid][nqthrsfr[tid]] = p_i;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                    nqthrsfr[tid]++;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                <span class="comment">/* Add this particle to the queue for consideration to spawn a wind.</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">                 * Only for subgrid winds. */</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                <span class="keywordflow">if</span>(nqthrwind &amp;&amp; newstar &lt; 0) {</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                    thrqueuewind[tid][nqthrwind[tid]] = p_i;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                    StellarMass[<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].PI] = sm;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                    nqthrwind[tid]++;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                }</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                <a class="code" href="sfr__eff_8c.html#adbc106c51df0aa2c0b5727eadbf2dd3c">cooling_direct</a>(p_i, redshift, a3inv, hubble, &amp;GlobalUVBG);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <a class="code" href="mymalloc_8h.html#afaf046f010cd01115a573a59e1e73e01">report_memory_usage</a>(<span class="stringliteral">&quot;SFR&quot;</span>);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Cooling/Cooling&quot;</span>);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160; </div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="comment">/* Do subgrid winds*/</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#acc35d766de8266c3fb4686b33820a2df">WindOn</a> &amp;&amp; <a class="code" href="winds_8c.html#a7a6b62046c0e4f5fe9e0a7bb0be65ddc">winds_are_subgrid</a>()) {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        NumMaybeWind = <a class="code" href="system_8c.html#a98a657dc63957ee4d2d237c6411f32f7">gadget_compact_thread_arrays</a>(MaybeWind, thrqueuewind, nqthrwind, nthreads);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <a class="code" href="winds_8c.html#a2cb5d8c3051470cd229593554b0fd1e8">winds_subgrid</a>(MaybeWind, NumMaybeWind, Time, hubble, tree, StellarMass);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(MaybeWind);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(StellarMass);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <a class="code" href="mymalloc_8h.html#a84e2115e90e9c22e11d9663c019fc8bc">ta_free</a>(thrqueuewind);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <a class="code" href="mymalloc_8h.html#a84e2115e90e9c22e11d9663c019fc8bc">ta_free</a>(nqthrwind);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="comment">/*Merge step for the queue.*/</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">if</span>(NewStars) {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        NumNewStar = <a class="code" href="system_8c.html#a98a657dc63957ee4d2d237c6411f32f7">gadget_compact_thread_arrays</a>(NewStars, thrqueuesfr, nqthrsfr, nthreads);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        int64_t NumNewParent = <a class="code" href="system_8c.html#a98a657dc63957ee4d2d237c6411f32f7">gadget_compact_thread_arrays</a>(NewParents, thrqueueparent, nqthrsfr, nthreads);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="keywordflow">if</span>(NumNewStar != NumNewParent)</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(3,<span class="stringliteral">&quot;%lu new stars, but %lu new parents!\n&quot;</span>,NumNewStar, NumNewParent);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="comment">/*Shrink star memory as we keep it for the wind model*/</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        NewStars = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a81d253773ecedbda7d865554e707489f">myrealloc</a>(NewStars, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * NumNewStar);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160; </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <a class="code" href="mymalloc_8h.html#a84e2115e90e9c22e11d9663c019fc8bc">ta_free</a>(thrqueueparent);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <a class="code" href="mymalloc_8h.html#a84e2115e90e9c22e11d9663c019fc8bc">ta_free</a>(thrqueuesfr);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <a class="code" href="mymalloc_8h.html#a84e2115e90e9c22e11d9663c019fc8bc">ta_free</a>(nqthrsfr);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a2694f130b78888ed2a49aa30181b0bcf">StarformationOn</a>)</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160; </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="comment">/*Get some empty slots for the stars*/</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordtype">int</span> firststarslot = <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[4].<a class="code" href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">size</a>;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="comment">/* We ran out of slots! We must be forming a lot of stars.</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">     * There are things in the way of extending the slot list, so we have to move them.</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">     * The code in sfr_reserve_slots is not elegant, but I cannot think of a better way.*/</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a2694f130b78888ed2a49aa30181b0bcf">StarformationOn</a> &amp;&amp; (<a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[4].<a class="code" href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">size</a> + NumNewStar &gt;= <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[4].<a class="code" href="structslot__info.html#a7b67ebbddce987acdd80262a51f2e8c6">maxsize</a>)) {</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="keywordflow">if</span>(NewParents)</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            NewParents = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a81d253773ecedbda7d865554e707489f">myrealloc</a>(NewParents, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * NumNewStar);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        NewStars = <a class="code" href="sfr__eff_8c.html#ad138d98cd8eded73c2b44955c8709b42">sfr_reserve_slots</a>(act, NewStars, NumNewStar, tree);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[4].<a class="code" href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">size</a> += NumNewStar;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160; </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordtype">int</span> stars_converted=0, stars_spawned=0;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160; </div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="comment">/*Now we turn the particles into stars*/</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="preprocessor">    #pragma omp parallel for schedule(static) reduction(+:stars_converted) reduction(+:stars_spawned) reduction(+:sum_mass_stars)</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">for</span>(i=0; i &lt; NumNewStar; i++)</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    {</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="keywordtype">int</span> child = NewStars[i];</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keywordtype">int</span> parent = NewParents[i];</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <a class="code" href="sfr__eff_8c.html#a537fdd1e25fad1d7245263ef47412790">make_particle_star</a>(child, parent, firststarslot+i, Time);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        sum_mass_stars += <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[child].Mass;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="keywordflow">if</span>(child == parent)</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            stars_converted++;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            stars_spawned++;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    }</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="comment">/*Done with the parents*/</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(NewParents);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160; </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    int64_t tot_spawned=0, tot_converted=0;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <a class="code" href="system_8c.html#a866c4b0425665030c89933c11752b1fe">sumup_large_ints</a>(1, &amp;stars_spawned, &amp;tot_spawned);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <a class="code" href="system_8c.html#a866c4b0425665030c89933c11752b1fe">sumup_large_ints</a>(1, &amp;stars_converted, &amp;tot_converted);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordtype">double</span> total_sum_mass_stars, total_sm, totsfrrate;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    MPI_Reduce(&amp;localsfr, &amp;totsfrrate, 1, MPI_DOUBLE, MPI_SUM, 0, MPI_COMM_WORLD);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    MPI_Reduce(&amp;sum_sm, &amp;total_sm, 1, MPI_DOUBLE, MPI_SUM, 0, MPI_COMM_WORLD);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    MPI_Reduce(&amp;sum_mass_stars, &amp;total_sum_mass_stars, 1, MPI_DOUBLE, MPI_SUM, 0, MPI_COMM_WORLD);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordflow">if</span>(FdSfr)</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <span class="keywordtype">double</span> rate = 0;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160; </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> &gt; 0)</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            rate = total_sm / (<a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> / hubble);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160; </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="comment">/* convert to solar masses per yr */</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160; </div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="keywordtype">double</span> rate_in_msunperyear = rate * <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a4f73d6b7178f89196effe799512cfa1e">UnitSfr_in_solar_per_year</a>;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160; </div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="comment">/* Format:</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">         * Time = current scale factor,</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">         * total_sm = expected change in stellar mass this timestep,</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">         * totsfrrate = current star formation rate in active particles in Msun/year,</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">         * rate_in_msunperyear = expected stellar mass formation rate in Msun/year from total_sm,</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">         * total_sum_mass_stars = actual mass of stars formed this timestep (discretized total_sm) */</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        fprintf(FdSfr, <span class="stringliteral">&quot;%g %g %g %g %g\n&quot;</span>, Time, total_sm, totsfrrate, rate_in_msunperyear,</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                total_sum_mass_stars);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        fflush(FdSfr);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    }</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160; </div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <a class="code" href="system_8h.html#a2ca58d338cd52c808ec1a86073940c49">MPIU_Barrier</a>(MPI_COMM_WORLD);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">if</span>(tot_spawned || tot_converted)</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;SFR: spawned %ld stars, converted %ld gas particles into stars\n&quot;</span>, tot_spawned, tot_converted);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160; </div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Cooling/StarFormation&quot;</span>);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160; </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="comment">/* Now apply the wind model using the list of new stars.*/</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#acc35d766de8266c3fb4686b33820a2df">WindOn</a> &amp;&amp; !<a class="code" href="winds_8c.html#a7a6b62046c0e4f5fe9e0a7bb0be65ddc">winds_are_subgrid</a>())</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        <a class="code" href="winds_8c.html#addbf19ca865e66f66ff2402b7dde8de6">winds_and_feedback</a>(NewStars, NumNewStar, Time, hubble, tree);</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160; </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(NewStars);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;}</div>
<div class="ttc" id="acooling_8h_html_ac9c80af3cbf2235e9f8d39e176515cfe"><div class="ttname"><a href="cooling_8h.html#ac9c80af3cbf2235e9f8d39e176515cfe">get_global_UVBG</a></div><div class="ttdeci">struct UVBG get_global_UVBG(double redshift)</div><div class="ttdef"><b>Definition:</b> <a href="cooling__rates_8c_source.html#l00244">cooling_rates.c:263</a></div></div>
<div class="ttc" id="acosmology_8c_html_ab425f16e6fe06110e2fb4944065b81bb"><div class="ttname"><a href="cosmology_8c.html#ab425f16e6fe06110e2fb4944065b81bb">hubble_function</a></div><div class="ttdeci">double hubble_function(const Cosmology *CP, double a)</div><div class="ttdef"><b>Definition:</b> <a href="cosmology_8c_source.html#l00058">cosmology.c:58</a></div></div>
<div class="ttc" id="aendrun_8c_html_a6567cd867c5549fb6586e19ccd819764"><div class="ttname"><a href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a></div><div class="ttdeci">void message(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00175">endrun.c:175</a></div></div>
<div class="ttc" id="aendrun_8c_html_ad963d7efdb9f10f7a2298c8ccd222ab0"><div class="ttname"><a href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a></div><div class="ttdeci">void endrun(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00147">endrun.c:147</a></div></div>
<div class="ttc" id="alightcone_8c_html_a8f3ab427b30a3327076ffcc7c683562c"><div class="ttname"><a href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a></div><div class="ttdeci">static double dloga</div><div class="ttdef"><b>Definition:</b> <a href="lightcone_8c_source.html#l00021">lightcone.c:21</a></div></div>
<div class="ttc" id="amymalloc_8h_html_a3eb707b32b6ac69f2df085e4bc098cc4"><div class="ttname"><a href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a></div><div class="ttdeci">#define mymalloc(name, size)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00015">mymalloc.h:15</a></div></div>
<div class="ttc" id="amymalloc_8h_html_a52bc2c6ec78b17bb6d42957cbf642f15"><div class="ttname"><a href="mymalloc_8h.html#a52bc2c6ec78b17bb6d42957cbf642f15">ta_malloc</a></div><div class="ttdeci">#define ta_malloc(name, type, nele)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00025">mymalloc.h:25</a></div></div>
<div class="ttc" id="amymalloc_8h_html_a81d253773ecedbda7d865554e707489f"><div class="ttname"><a href="mymalloc_8h.html#a81d253773ecedbda7d865554e707489f">myrealloc</a></div><div class="ttdeci">#define myrealloc(ptr, size)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00018">mymalloc.h:18</a></div></div>
<div class="ttc" id="amymalloc_8h_html_a84e2115e90e9c22e11d9663c019fc8bc"><div class="ttname"><a href="mymalloc_8h.html#a84e2115e90e9c22e11d9663c019fc8bc">ta_free</a></div><div class="ttdeci">#define ta_free(p)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00028">mymalloc.h:28</a></div></div>
<div class="ttc" id="amymalloc_8h_html_ac576b6f19b635b512399d6afb8c20d99"><div class="ttname"><a href="mymalloc_8h.html#ac576b6f19b635b512399d6afb8c20d99">mymalloc2</a></div><div class="ttdeci">#define mymalloc2(name, size)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00016">mymalloc.h:16</a></div></div>
<div class="ttc" id="amymalloc_8h_html_af469c2f7e504a771f5d8a91ac9623240"><div class="ttname"><a href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a></div><div class="ttdeci">#define myfree(x)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00019">mymalloc.h:19</a></div></div>
<div class="ttc" id="amymalloc_8h_html_afaf046f010cd01115a573a59e1e73e01"><div class="ttname"><a href="mymalloc_8h.html#afaf046f010cd01115a573a59e1e73e01">report_memory_usage</a></div><div class="ttdeci">#define report_memory_usage(x)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00030">mymalloc.h:30</a></div></div>
<div class="ttc" id="apartmanager_8h_html_a2748566f4c443ee77aa831e63dbb5ebe"><div class="ttname"><a href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a></div><div class="ttdeci">#define P</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00088">partmanager.h:88</a></div></div>
<div class="ttc" id="apower_8c_html_aaca257a58f3e957a7db5fc91431eadf5"><div class="ttname"><a href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a></div><div class="ttdeci">static Cosmology * CP</div><div class="ttdef"><b>Definition:</b> <a href="power_8c_source.html#l00027">power.c:27</a></div></div>
<div class="ttc" id="asfr__eff_8c_html_a1a33e045abac80ac9459e11061775e70"><div class="ttname"><a href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a></div><div class="ttdeci">static struct SFRParams sfr_params</div></div>
<div class="ttc" id="asfr__eff_8c_html_a276becdf281cd9d2a0f2f3e1642b2559"><div class="ttname"><a href="sfr__eff_8c.html#a276becdf281cd9d2a0f2f3e1642b2559">starformation</a></div><div class="ttdeci">static int starformation(int i, double *localsfr, MyFloat *sm_out, MyFloat *GradRho, const double redshift, const double a3inv, const double hubble, const double GravInternal, const struct UVBG *const GlobalUVBG)</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00666">sfr_eff.c:666</a></div></div>
<div class="ttc" id="asfr__eff_8c_html_a4080dc1b2496c08090d1101544b48cc2"><div class="ttname"><a href="sfr__eff_8c.html#a4080dc1b2496c08090d1101544b48cc2">sfreff_on_eeqos</a></div><div class="ttdeci">int sfreff_on_eeqos(const struct sph_particle_data *sph, const double a3inv)</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00486">sfr_eff.c:486</a></div></div>
<div class="ttc" id="asfr__eff_8c_html_a537fdd1e25fad1d7245263ef47412790"><div class="ttname"><a href="sfr__eff_8c.html#a537fdd1e25fad1d7245263ef47412790">make_particle_star</a></div><div class="ttdeci">static int make_particle_star(int child, int parent, int placement, double Time)</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00578">sfr_eff.c:578</a></div></div>
<div class="ttc" id="asfr__eff_8c_html_ad138d98cd8eded73c2b44955c8709b42"><div class="ttname"><a href="sfr__eff_8c.html#ad138d98cd8eded73c2b44955c8709b42">sfr_reserve_slots</a></div><div class="ttdeci">static int * sfr_reserve_slots(ActiveParticles *act, int *NewStars, int NumNewStar, ForceTree *tt)</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00380">sfr_eff.c:380</a></div></div>
<div class="ttc" id="asfr__eff_8c_html_adbc106c51df0aa2c0b5727eadbf2dd3c"><div class="ttname"><a href="sfr__eff_8c.html#adbc106c51df0aa2c0b5727eadbf2dd3c">cooling_direct</a></div><div class="ttdeci">static void cooling_direct(int i, const double redshift, const double a3inv, const double hubble, const struct UVBG *const GlobalUVBG)</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00444">sfr_eff.c:444</a></div></div>
<div class="ttc" id="asfr__eff_8c_html_ae4c376934146cd783970d5b2582a893f"><div class="ttname"><a href="sfr__eff_8c.html#ae4c376934146cd783970d5b2582a893f">quicklyastarformation</a></div><div class="ttdeci">static int quicklyastarformation(int i, const double a3inv)</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00641">sfr_eff.c:641</a></div></div>
<div class="ttc" id="aslotsmanager_8c_html_aa317621b6c60bc95c5f3e33c648e8392"><div class="ttname"><a href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a></div><div class="ttdeci">struct slots_manager_type SlotsManager[1]</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8c_source.html#l00001">slotsmanager.c:7</a></div></div>
<div class="ttc" id="aslotsmanager_8h_html_a681d502f5cbf25161ff026312cd1498c"><div class="ttname"><a href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a></div><div class="ttdeci">#define SPHP(i)</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00124">slotsmanager.h:124</a></div></div>
<div class="ttc" id="astructActiveParticles_html_a1b0b230f3890d70bae976516719b7d07"><div class="ttname"><a href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticles::ActiveParticle</a></div><div class="ttdeci">int * ActiveParticle</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8h_source.html#l00013">timestep.h:13</a></div></div>
<div class="ttc" id="astructActiveParticles_html_a847ab898fdabc62a4723c7c3a66038d4"><div class="ttname"><a href="structActiveParticles.html#a847ab898fdabc62a4723c7c3a66038d4">ActiveParticles::NumActiveParticle</a></div><div class="ttdeci">int64_t NumActiveParticle</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8h_source.html#l00012">timestep.h:12</a></div></div>
<div class="ttc" id="astructCosmology_html_a0970aac048f04a9ccd8778aaf07a0bbc"><div class="ttname"><a href="structCosmology.html#a0970aac048f04a9ccd8778aaf07a0bbc">Cosmology::GravInternal</a></div><div class="ttdeci">double GravInternal</div><div class="ttdef"><b>Definition:</b> <a href="cosmology_8h_source.html#l00032">cosmology.h:32</a></div></div>
<div class="ttc" id="astructSFRParams_html_a2694f130b78888ed2a49aa30181b0bcf"><div class="ttname"><a href="structSFRParams.html#a2694f130b78888ed2a49aa30181b0bcf">SFRParams::StarformationOn</a></div><div class="ttdeci">int StarformationOn</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00039">sfr_eff.c:39</a></div></div>
<div class="ttc" id="astructSFRParams_html_a4f73d6b7178f89196effe799512cfa1e"><div class="ttname"><a href="structSFRParams.html#a4f73d6b7178f89196effe799512cfa1e">SFRParams::UnitSfr_in_solar_per_year</a></div><div class="ttdeci">double UnitSfr_in_solar_per_year</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00072">sfr_eff.c:72</a></div></div>
<div class="ttc" id="astructSFRParams_html_acc0def39860c56e0a46c003d10bcb1b8"><div class="ttname"><a href="structSFRParams.html#acc0def39860c56e0a46c003d10bcb1b8">SFRParams::QuickLymanAlphaProbability</a></div><div class="ttdeci">double QuickLymanAlphaProbability</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00062">sfr_eff.c:62</a></div></div>
<div class="ttc" id="astructSFRParams_html_acc35d766de8266c3fb4686b33820a2df"><div class="ttname"><a href="structSFRParams.html#acc35d766de8266c3fb4686b33820a2df">SFRParams::WindOn</a></div><div class="ttdeci">int WindOn</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00041">sfr_eff.c:41</a></div></div>
<div class="ttc" id="astructUVBG_html"><div class="ttname"><a href="structUVBG.html">UVBG</a></div><div class="ttdef"><b>Definition:</b> <a href="cooling_8h_source.html#l00008">cooling.h:8</a></div></div>
<div class="ttc" id="astructslot__info_html_a7b67ebbddce987acdd80262a51f2e8c6"><div class="ttname"><a href="structslot__info.html#a7b67ebbddce987acdd80262a51f2e8c6">slot_info::maxsize</a></div><div class="ttdeci">int64_t maxsize</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00011">slotsmanager.h:11</a></div></div>
<div class="ttc" id="astructslot__info_html_aa651c4c7d01687a0b313076c0266465f"><div class="ttname"><a href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">slot_info::size</a></div><div class="ttdeci">int64_t size</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00012">slotsmanager.h:12</a></div></div>
<div class="ttc" id="astructslots__manager__type_html_a2b662d46902bf6fffca8b3fa2534a4e4"><div class="ttname"><a href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">slots_manager_type::info</a></div><div class="ttdeci">struct slot_info info[6]</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00108">slotsmanager.h:112</a></div></div>
<div class="ttc" id="asystem_8c_html_a0082531d4facaa6caabf05fb9fd547d4"><div class="ttname"><a href="system_8c.html#a0082531d4facaa6caabf05fb9fd547d4">gadget_setup_thread_arrays</a></div><div class="ttdeci">void gadget_setup_thread_arrays(int *dest, int *srcs[], size_t sizes[], size_t total_size, int narrays)</div><div class="ttdef"><b>Definition:</b> <a href="system_8c_source.html#l00600">system.c:600</a></div></div>
<div class="ttc" id="asystem_8c_html_a866c4b0425665030c89933c11752b1fe"><div class="ttname"><a href="system_8c.html#a866c4b0425665030c89933c11752b1fe">sumup_large_ints</a></div><div class="ttdeci">void sumup_large_ints(int n, int *src, int64_t *res)</div><div class="ttdef"><b>Definition:</b> <a href="system_8c_source.html#l00192">system.c:192</a></div></div>
<div class="ttc" id="asystem_8c_html_a98a657dc63957ee4d2d237c6411f32f7"><div class="ttname"><a href="system_8c.html#a98a657dc63957ee4d2d237c6411f32f7">gadget_compact_thread_arrays</a></div><div class="ttdeci">size_t gadget_compact_thread_arrays(int *dest, int *srcs[], size_t sizes[], int narrays)</div><div class="ttdef"><b>Definition:</b> <a href="system_8c_source.html#l00587">system.c:587</a></div></div>
<div class="ttc" id="asystem_8h_html_a2ca58d338cd52c808ec1a86073940c49"><div class="ttname"><a href="system_8h.html#a2ca58d338cd52c808ec1a86073940c49">MPIU_Barrier</a></div><div class="ttdeci">#define MPIU_Barrier(comm)</div><div class="ttdef"><b>Definition:</b> <a href="system_8h_source.html#l00103">system.h:103</a></div></div>
<div class="ttc" id="atypes_8h_html_af1ada7381a1118c6d51bdbb0b5e72811"><div class="ttname"><a href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a></div><div class="ttdeci">LOW_PRECISION MyFloat</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00019">types.h:19</a></div></div>
<div class="ttc" id="awalltime_8h_html_a2d23071e44d020b4a0b3f2876667d370"><div class="ttname"><a href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a></div><div class="ttdeci">#define walltime_measure(name)</div><div class="ttdef"><b>Definition:</b> <a href="walltime_8h_source.html#l00008">walltime.h:8</a></div></div>
<div class="ttc" id="awinds_8c_html_a274ae45443daff42b91d384c64105010"><div class="ttname"><a href="winds_8c.html#a274ae45443daff42b91d384c64105010">winds_evolve</a></div><div class="ttdeci">void winds_evolve(int i, double a3inv, double hubble)</div><div class="ttdef"><b>Definition:</b> <a href="winds_8c_source.html#l00403">winds.c:403</a></div></div>
<div class="ttc" id="awinds_8c_html_a2cb5d8c3051470cd229593554b0fd1e8"><div class="ttname"><a href="winds_8c.html#a2cb5d8c3051470cd229593554b0fd1e8">winds_subgrid</a></div><div class="ttdeci">void winds_subgrid(int *MaybeWind, int NumMaybeWind, const double Time, const double hubble, ForceTree *tree, MyFloat *StellarMasses)</div><div class="ttdef"><b>Definition:</b> <a href="winds_8c_source.html#l00306">winds.c:306</a></div></div>
<div class="ttc" id="awinds_8c_html_a7a6b62046c0e4f5fe9e0a7bb0be65ddc"><div class="ttname"><a href="winds_8c.html#a7a6b62046c0e4f5fe9e0a7bb0be65ddc">winds_are_subgrid</a></div><div class="ttdeci">int winds_are_subgrid(void)</div><div class="ttdef"><b>Definition:</b> <a href="winds_8c_source.html#l00115">winds.c:115</a></div></div>
<div class="ttc" id="awinds_8c_html_addbf19ca865e66f66ff2402b7dde8de6"><div class="ttname"><a href="winds_8c.html#addbf19ca865e66f66ff2402b7dde8de6">winds_and_feedback</a></div><div class="ttdeci">void winds_and_feedback(int *NewStars, int NumNewStars, const double Time, const double hubble, ForceTree *tree)</div><div class="ttdef"><b>Definition:</b> <a href="winds_8c_source.html#l00333">winds.c:333</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="timestep_8h_source.html#l00013">ActiveParticles::ActiveParticle</a>, <a class="el" href="sfr__eff_8c_source.html#l00444">cooling_direct()</a>, <a class="el" href="power_8c_source.html#l00027">CP</a>, <a class="el" href="lightcone_8c_source.html#l00021">dloga</a>, <a class="el" href="endrun_8c_source.html#l00147">endrun()</a>, <a class="el" href="system_8c_source.html#l00587">gadget_compact_thread_arrays()</a>, <a class="el" href="system_8c_source.html#l00600">gadget_setup_thread_arrays()</a>, <a class="el" href="cooling__rates_8c_source.html#l00263">get_global_UVBG()</a>, <a class="el" href="cosmology_8h_source.html#l00032">Cosmology::GravInternal</a>, <a class="el" href="cosmology_8c_source.html#l00058">hubble_function()</a>, <a class="el" href="slotsmanager_8h_source.html#l00112">slots_manager_type::info</a>, <a class="el" href="sfr__eff_8c_source.html#l00578">make_particle_star()</a>, <a class="el" href="slotsmanager_8h_source.html#l00011">slot_info::maxsize</a>, <a class="el" href="endrun_8c_source.html#l00175">message()</a>, <a class="el" href="system_8h_source.html#l00103">MPIU_Barrier</a>, <a class="el" href="mymalloc_8h_source.html#l00019">myfree</a>, <a class="el" href="mymalloc_8h_source.html#l00015">mymalloc</a>, <a class="el" href="mymalloc_8h_source.html#l00016">mymalloc2</a>, <a class="el" href="mymalloc_8h_source.html#l00018">myrealloc</a>, <a class="el" href="timestep_8h_source.html#l00012">ActiveParticles::NumActiveParticle</a>, <a class="el" href="partmanager_8h_source.html#l00088">P</a>, <a class="el" href="sfr__eff_8c_source.html#l00641">quicklyastarformation()</a>, <a class="el" href="sfr__eff_8c_source.html#l00062">SFRParams::QuickLymanAlphaProbability</a>, <a class="el" href="mymalloc_8h_source.html#l00030">report_memory_usage</a>, <a class="el" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>, <a class="el" href="sfr__eff_8c_source.html#l00380">sfr_reserve_slots()</a>, <a class="el" href="sfr__eff_8c_source.html#l00486">sfreff_on_eeqos()</a>, <a class="el" href="slotsmanager_8h_source.html#l00012">slot_info::size</a>, <a class="el" href="slotsmanager_8c_source.html#l00007">SlotsManager</a>, <a class="el" href="slotsmanager_8h_source.html#l00124">SPHP</a>, <a class="el" href="sfr__eff_8c_source.html#l00666">starformation()</a>, <a class="el" href="sfr__eff_8c_source.html#l00039">SFRParams::StarformationOn</a>, <a class="el" href="system_8c_source.html#l00192">sumup_large_ints()</a>, <a class="el" href="mymalloc_8h_source.html#l00028">ta_free</a>, <a class="el" href="mymalloc_8h_source.html#l00025">ta_malloc</a>, <a class="el" href="sfr__eff_8c_source.html#l00072">SFRParams::UnitSfr_in_solar_per_year</a>, <a class="el" href="walltime_8h_source.html#l00008">walltime_measure</a>, <a class="el" href="sfr__eff_8c_source.html#l00041">SFRParams::WindOn</a>, <a class="el" href="winds_8c_source.html#l00333">winds_and_feedback()</a>, <a class="el" href="winds_8c_source.html#l00115">winds_are_subgrid()</a>, <a class="el" href="winds_8c_source.html#l00403">winds_evolve()</a>, and <a class="el" href="winds_8c_source.html#l00306">winds_subgrid()</a>.</p>

<p class="reference">Referenced by <a class="el" href="run_8c_source.html#l00284">run()</a>, and <a class="el" href="run_8c_source.html#l00652">runfof()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_abc5b151d356619b98a8ded72cc9426c7_cgraph.svg" width="1323" height="1567"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_abc5b151d356619b98a8ded72cc9426c7_icgraph.svg" width="419" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="adbc106c51df0aa2c0b5727eadbf2dd3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbc106c51df0aa2c0b5727eadbf2dd3c">&#9670;&nbsp;</a></span>cooling_direct()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void cooling_direct </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>redshift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>a3inv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>hubble</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structUVBG.html">UVBG</a> *const&#160;</td>
          <td class="paramname"><em>GlobalUVBG</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00444">444</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;{</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="comment">/*  the actual time-step */</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> = <a class="code" href="timebinmgr_8c.html#a716e51b694540af2851fb51c081bcf5d">get_dloga_for_bin</a>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].TimeBin, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Ti_drift);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordtype">double</span> dtime = <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> / hubble;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160; </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordtype">double</span> ne = <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Ne; <span class="comment">/* electron abundance (gives ionization state and mean molecular weight) */</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160; </div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> enttou = pow(<a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Density * a3inv, <a class="code" href="physconst_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a>) / <a class="code" href="physconst_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a>;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="comment">/* Current internal energy including adiabatic change*/</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordtype">double</span> uold = <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Entropy * enttou;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keyword">struct </span><a class="code" href="structUVBG.html">UVBG</a> uvbg = <a class="code" href="cooling_8h.html#ab06d4baa8de3f3e0db4203a9deef30cf">get_local_UVBG</a>(redshift, GlobalUVBG, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Pos, <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a5462d473b8cd90abf7f7f7a56d822649">CurrentParticleOffset</a>);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordtype">double</span> lasttime = exp(<a class="code" href="test__timefac_8c.html#a5b77523ed91eb413cb28b12d8c2ceb46">loga_from_ti</a>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Ti_drift - <a class="code" href="timebinmgr_8h.html#af676ea14ddc4ab85d634f5a18015038d">dti_from_timebin</a>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].TimeBin)));</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordtype">double</span> lastred = 1/lasttime - 1;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keywordtype">double</span> unew;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="comment">/* The particle reionized this timestep, bump the temperature to the HI reionization temperature.</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">     * We only do this for non-star-forming gas.*/</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#ace00e5c4d358ba8b268519fe3af45773">HIReionTemp</a> &gt; 0 &amp;&amp; uvbg.<a class="code" href="structUVBG.html#affde575b32f8fb924df290e5c80a31a7">zreion</a> &gt; redshift &amp;&amp; uvbg.<a class="code" href="structUVBG.html#affde575b32f8fb924df290e5c80a31a7">zreion</a> &lt; lastred) {</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="comment">/* We assume it is fully ionized*/</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> meanweight = 4 / (8 - 5 * (1 - <a class="code" href="physconst_8h.html#a67abaa49a5aa2892eba705d380652279">HYDROGEN_MASSFRAC</a>));</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        unew = <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a5173127552b049a6104298f5cf2317c2">temp_to_u</a> / meanweight * <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#ace00e5c4d358ba8b268519fe3af45773">HIReionTemp</a>;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    }</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <span class="comment">/* mean molecular weight assuming ZERO ionization NEUTRAL GAS*/</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> meanweight = 4.0 / (1 + 3 * <a class="code" href="physconst_8h.html#a67abaa49a5aa2892eba705d380652279">HYDROGEN_MASSFRAC</a>);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> MinEgySpec = <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a5173127552b049a6104298f5cf2317c2">temp_to_u</a>/meanweight * <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a52747a7ff6078a36a8ecf3fa0e89b11f">MinGasTemp</a>;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        unew = <a class="code" href="cooling_8c.html#ad3b2ce3b26247df36f1de8c97ccccf05">DoCooling</a>(redshift, uold, <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Density * a3inv, dtime, &amp;uvbg, &amp;ne, <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Metallicity, MinEgySpec, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].HeIIIionized);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    }</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Ne = ne;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="comment">/* Update the entropy. This is done after synchronizing kicks and drifts, as per run.c.*/</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Entropy = unew / enttou;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="comment">/* Cooling gas is not forming stars*/</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Sfr = 0;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;}</div>
<div class="ttc" id="acooling_8c_html_ad3b2ce3b26247df36f1de8c97ccccf05"><div class="ttname"><a href="cooling_8c.html#ad3b2ce3b26247df36f1de8c97ccccf05">DoCooling</a></div><div class="ttdeci">double DoCooling(double redshift, double u_old, double rho, double dt, struct UVBG *uvbg, double *ne_guess, double Z, double MinEgySpec, int isHeIIIionized)</div><div class="ttdef"><b>Definition:</b> <a href="cooling_8c_source.html#l00071">cooling.c:71</a></div></div>
<div class="ttc" id="acooling_8h_html_ab06d4baa8de3f3e0db4203a9deef30cf"><div class="ttname"><a href="cooling_8h.html#ab06d4baa8de3f3e0db4203a9deef30cf">get_local_UVBG</a></div><div class="ttdeci">struct UVBG get_local_UVBG(double redshift, const struct UVBG *const GlobalUVBG, const double *const Pos, const double *const PosOffset)</div><div class="ttdef"><b>Definition:</b> <a href="cooling__uvfluc_8c_source.html#l00091">cooling_uvfluc.c:149</a></div></div>
<div class="ttc" id="apartmanager_8c_html_a6cef44682776e476d8f9f1b9e1f9fe16"><div class="ttname"><a href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a></div><div class="ttdeci">struct part_manager_type PartManager[1]</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8c_source.html#l00001">partmanager.c:11</a></div></div>
<div class="ttc" id="aphysconst_8h_html_a67abaa49a5aa2892eba705d380652279"><div class="ttname"><a href="physconst_8h.html#a67abaa49a5aa2892eba705d380652279">HYDROGEN_MASSFRAC</a></div><div class="ttdeci">#define HYDROGEN_MASSFRAC</div><div class="ttdef"><b>Definition:</b> <a href="physconst_8h_source.html#l00037">physconst.h:37</a></div></div>
<div class="ttc" id="aphysconst_8h_html_a75216f9bf4030240b1fc0e1855e032d2"><div class="ttname"><a href="physconst_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a></div><div class="ttdeci">#define GAMMA_MINUS1</div><div class="ttdef"><b>Definition:</b> <a href="physconst_8h_source.html#l00035">physconst.h:35</a></div></div>
<div class="ttc" id="astructSFRParams_html_a5173127552b049a6104298f5cf2317c2"><div class="ttname"><a href="structSFRParams.html#a5173127552b049a6104298f5cf2317c2">SFRParams::temp_to_u</a></div><div class="ttdeci">double temp_to_u</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00070">sfr_eff.c:70</a></div></div>
<div class="ttc" id="astructSFRParams_html_a52747a7ff6078a36a8ecf3fa0e89b11f"><div class="ttname"><a href="structSFRParams.html#a52747a7ff6078a36a8ecf3fa0e89b11f">SFRParams::MinGasTemp</a></div><div class="ttdeci">double MinGasTemp</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00057">sfr_eff.c:57</a></div></div>
<div class="ttc" id="astructSFRParams_html_ace00e5c4d358ba8b268519fe3af45773"><div class="ttname"><a href="structSFRParams.html#ace00e5c4d358ba8b268519fe3af45773">SFRParams::HIReionTemp</a></div><div class="ttdeci">double HIReionTemp</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00078">sfr_eff.c:78</a></div></div>
<div class="ttc" id="astructUVBG_html_affde575b32f8fb924df290e5c80a31a7"><div class="ttname"><a href="structUVBG.html#affde575b32f8fb924df290e5c80a31a7">UVBG::zreion</a></div><div class="ttdeci">double zreion</div><div class="ttdef"><b>Definition:</b> <a href="cooling_8h_source.html#l00016">cooling.h:16</a></div></div>
<div class="ttc" id="astructpart__manager__type_html_a5462d473b8cd90abf7f7f7a56d822649"><div class="ttname"><a href="structpart__manager__type.html#a5462d473b8cd90abf7f7f7a56d822649">part_manager_type::CurrentParticleOffset</a></div><div class="ttdeci">double CurrentParticleOffset[3]</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00082">partmanager.h:82</a></div></div>
<div class="ttc" id="atest__timefac_8c_html_a5b77523ed91eb413cb28b12d8c2ceb46"><div class="ttname"><a href="test__timefac_8c.html#a5b77523ed91eb413cb28b12d8c2ceb46">loga_from_ti</a></div><div class="ttdeci">double loga_from_ti(int ti)</div><div class="ttdef"><b>Definition:</b> <a href="test__timefac_8c_source.html#l00051">test_timefac.c:51</a></div></div>
<div class="ttc" id="atimebinmgr_8c_html_a716e51b694540af2851fb51c081bcf5d"><div class="ttname"><a href="timebinmgr_8c.html#a716e51b694540af2851fb51c081bcf5d">get_dloga_for_bin</a></div><div class="ttdeci">double get_dloga_for_bin(int timebin, const inttime_t Ti_Current)</div><div class="ttdef"><b>Definition:</b> <a href="timebinmgr_8c_source.html#l00279">timebinmgr.c:279</a></div></div>
<div class="ttc" id="atimebinmgr_8h_html_af676ea14ddc4ab85d634f5a18015038d"><div class="ttname"><a href="timebinmgr_8h.html#af676ea14ddc4ab85d634f5a18015038d">dti_from_timebin</a></div><div class="ttdeci">static inttime_t dti_from_timebin(int bin)</div><div class="ttdef"><b>Definition:</b> <a href="timebinmgr_8h_source.html#l00044">timebinmgr.h:44</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="partmanager_8h_source.html#l00082">part_manager_type::CurrentParticleOffset</a>, <a class="el" href="lightcone_8c_source.html#l00021">dloga</a>, <a class="el" href="cooling_8c_source.html#l00071">DoCooling()</a>, <a class="el" href="timebinmgr_8h_source.html#l00044">dti_from_timebin()</a>, <a class="el" href="physconst_8h_source.html#l00035">GAMMA_MINUS1</a>, <a class="el" href="timebinmgr_8c_source.html#l00279">get_dloga_for_bin()</a>, <a class="el" href="cooling__uvfluc_8c_source.html#l00149">get_local_UVBG()</a>, <a class="el" href="sfr__eff_8c_source.html#l00078">SFRParams::HIReionTemp</a>, <a class="el" href="physconst_8h_source.html#l00037">HYDROGEN_MASSFRAC</a>, <a class="el" href="test__timefac_8c_source.html#l00051">loga_from_ti()</a>, <a class="el" href="sfr__eff_8c_source.html#l00057">SFRParams::MinGasTemp</a>, <a class="el" href="partmanager_8h_source.html#l00088">P</a>, <a class="el" href="partmanager_8c_source.html#l00011">PartManager</a>, <a class="el" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>, <a class="el" href="slotsmanager_8h_source.html#l00124">SPHP</a>, <a class="el" href="sfr__eff_8c_source.html#l00070">SFRParams::temp_to_u</a>, and <a class="el" href="cooling_8h_source.html#l00016">UVBG::zreion</a>.</p>

<p class="reference">Referenced by <a class="el" href="sfr__eff_8c_source.html#l00167">cooling_and_starformation()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_adbc106c51df0aa2c0b5727eadbf2dd3c_cgraph.svg" width="1770" height="1332"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_adbc106c51df0aa2c0b5727eadbf2dd3c_icgraph.svg" width="580" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a64f07331e54d0eb86fd4f6466d58e0f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a64f07331e54d0eb86fd4f6466d58e0f2">&#9670;&nbsp;</a></span>cooling_relaxed()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void cooling_relaxed </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>dtime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structUVBG.html">UVBG</a> *&#160;</td>
          <td class="paramname"><em>local_uvbg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>redshift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>a3inv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structsfr__eeqos__data.html">sfr_eeqos_data</a>&#160;</td>
          <td class="paramname"><em>sfr_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structUVBG.html">UVBG</a> *const&#160;</td>
          <td class="paramname"><em>GlobalUVBG</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00606">606</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;{</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> egyeff = <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a7ee644d6ec675488c665b4e84c8b2cd2">EgySpecCold</a> * sfr_data.<a class="code" href="structsfr__eeqos__data.html#a167c8900f3dd897a8c448d09fa54f53e">cloudfrac</a> + (1 - sfr_data.<a class="code" href="structsfr__eeqos__data.html#a167c8900f3dd897a8c448d09fa54f53e">cloudfrac</a>) * sfr_data.<a class="code" href="structsfr__eeqos__data.html#a55da71adb5b8d5a586336fef41a2da79">egyhot</a>;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> Density = <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Density;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> densityfac = pow(Density * a3inv, <a class="code" href="physconst_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a>) / <a class="code" href="physconst_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a>;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordtype">double</span> egycurrent = <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Entropy * densityfac;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="keywordtype">double</span> trelax = sfr_data.<a class="code" href="structsfr__eeqos__data.html#a335b12ecbc2c8baabb24f2e9c3425fd4">trelax</a>;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aaf1aff4c4a17fd79170143e207c521f2">BHFeedbackUseTcool</a> == 1 &amp;&amp; <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].BHHeated)</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    {</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keywordflow">if</span>(egycurrent &gt; egyeff)</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        {</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            <span class="keywordtype">double</span> ne = <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Ne;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            <span class="comment">/* In practice tcool &lt;&lt; trelax*/</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;            <span class="keywordtype">double</span> tcool = <a class="code" href="cooling_8c.html#a2cb008d71b53fcb66c3596042453bdb8">GetCoolingTime</a>(redshift, egycurrent, <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Density * a3inv, local_uvbg, &amp;ne, <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Metallicity);</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160; </div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            <span class="comment">/* The point of the star-forming equation of state is to pressurize the gas. However,</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">             * when the gas has been heated above the equation of state it is pressurized and does not cool successfully.</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment">             * This code uses the cooling time rather than the relaxation time.</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment">             * This reduces the effect of black hole feedback marginally (a 5% reduction in star formation)</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">             * and dates from the earliest versions of this code available.</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment">             * The main impact is on the high end of the black hole mass function: turning this off</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">             * removes most massive black holes. */</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            <span class="keywordflow">if</span>(tcool &lt; trelax &amp;&amp; tcool &gt; 0)</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                trelax = tcool;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        }</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].BHHeated = 0;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    }</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Entropy =  (egyeff + (egycurrent - egyeff) * exp(-dtime / trelax)) /densityfac;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;}</div>
<div class="ttc" id="acooling_8c_html_a2cb008d71b53fcb66c3596042453bdb8"><div class="ttname"><a href="cooling_8c.html#a2cb008d71b53fcb66c3596042453bdb8">GetCoolingTime</a></div><div class="ttdeci">double GetCoolingTime(double redshift, double u_old, double rho, struct UVBG *uvbg, double *ne_guess, double Z)</div><div class="ttdef"><b>Definition:</b> <a href="cooling_8c_source.html#l00157">cooling.c:157</a></div></div>
<div class="ttc" id="astructSFRParams_html_a7ee644d6ec675488c665b4e84c8b2cd2"><div class="ttname"><a href="structSFRParams.html#a7ee644d6ec675488c665b4e84c8b2cd2">SFRParams::EgySpecCold</a></div><div class="ttdeci">double EgySpecCold</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00049">sfr_eff.c:49</a></div></div>
<div class="ttc" id="astructSFRParams_html_aaf1aff4c4a17fd79170143e207c521f2"><div class="ttname"><a href="structSFRParams.html#aaf1aff4c4a17fd79170143e207c521f2">SFRParams::BHFeedbackUseTcool</a></div><div class="ttdeci">int BHFeedbackUseTcool</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00055">sfr_eff.c:55</a></div></div>
<div class="ttc" id="astructsfr__eeqos__data_html_a167c8900f3dd897a8c448d09fa54f53e"><div class="ttname"><a href="structsfr__eeqos__data.html#a167c8900f3dd897a8c448d09fa54f53e">sfr_eeqos_data::cloudfrac</a></div><div class="ttdeci">double cloudfrac</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00104">sfr_eff.c:104</a></div></div>
<div class="ttc" id="astructsfr__eeqos__data_html_a335b12ecbc2c8baabb24f2e9c3425fd4"><div class="ttname"><a href="structsfr__eeqos__data.html#a335b12ecbc2c8baabb24f2e9c3425fd4">sfr_eeqos_data::trelax</a></div><div class="ttdeci">double trelax</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00096">sfr_eff.c:96</a></div></div>
<div class="ttc" id="astructsfr__eeqos__data_html_a55da71adb5b8d5a586336fef41a2da79"><div class="ttname"><a href="structsfr__eeqos__data.html#a55da71adb5b8d5a586336fef41a2da79">sfr_eeqos_data::egyhot</a></div><div class="ttdeci">double egyhot</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00100">sfr_eff.c:100</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="sfr__eff_8c_source.html#l00055">SFRParams::BHFeedbackUseTcool</a>, <a class="el" href="sfr__eff_8c_source.html#l00104">sfr_eeqos_data::cloudfrac</a>, <a class="el" href="slotsmanager_8h_source.html#l00090">sph_particle_data::Density</a>, <a class="el" href="sfr__eff_8c_source.html#l00100">sfr_eeqos_data::egyhot</a>, <a class="el" href="sfr__eff_8c_source.html#l00049">SFRParams::EgySpecCold</a>, <a class="el" href="physconst_8h_source.html#l00035">GAMMA_MINUS1</a>, <a class="el" href="cooling_8c_source.html#l00157">GetCoolingTime()</a>, <a class="el" href="slotsmanager_8h_source.html#l00107">sph_particle_data::Metallicity</a>, <a class="el" href="partmanager_8h_source.html#l00088">P</a>, <a class="el" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>, <a class="el" href="slotsmanager_8h_source.html#l00124">SPHP</a>, and <a class="el" href="sfr__eff_8c_source.html#l00096">sfr_eeqos_data::trelax</a>.</p>

<p class="reference">Referenced by <a class="el" href="sfr__eff_8c_source.html#l00722">get_sfr_eeqos()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_a64f07331e54d0eb86fd4f6466d58e0f2_cgraph.svg" width="1394" height="1139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_a64f07331e54d0eb86fd4f6466d58e0f2_icgraph.svg" width="1075" height="256"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="acfbbbdbb84c5b6812489f849106492de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acfbbbdbb84c5b6812489f849106492de">&#9670;&nbsp;</a></span>ev_NH_from_GradRho()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static double ev_NH_from_GradRho </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a>&#160;</td>
          <td class="paramname"><em>gradrho_mag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>hsml</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>rho</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>include_h</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00959">959</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;{</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="comment">/* column density from GradRho, copied from gadget-p; what is it</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="comment">     * calculating? */</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordflow">if</span>(rho&lt;=0)</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <span class="keywordtype">double</span> ev_NH = 0;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <span class="keywordflow">if</span>(gradrho_mag &gt; 0)</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        ev_NH = rho*rho/gradrho_mag;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="keywordflow">if</span>(include_h &gt; 0)</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        ev_NH += rho*hsml;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="keywordflow">return</span> ev_NH; <span class="comment">// *(Z/Zsolar) add metallicity dependence</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="sfr__eff_8c_source.html#l00973">get_sfr_factor_due_to_h2()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_acfbbbdbb84c5b6812489f849106492de_icgraph.svg" width="1556" height="256"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ad5c8b2f6a1323536d08519b623f60992"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5c8b2f6a1323536d08519b623f60992">&#9670;&nbsp;</a></span>find_star_mass()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static double find_star_mass </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>avg_baryon_mass</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00921">921</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;{</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <span class="comment">/*Quick Lyman Alpha always turns all of a particle into stars*/</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#acc0def39860c56e0a46c003d10bcb1b8">QuickLymanAlphaProbability</a> &gt; 0)</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Mass;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160; </div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="keywordtype">double</span> mass_of_star =  avg_baryon_mass / <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aa22c2694f1c282c616eb15f9b6b3a182">Generations</a>;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="keywordflow">if</span>(mass_of_star &gt; <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Mass) {</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        <span class="comment">/* if some mass has been stolen by BH, e.g */</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        mass_of_star = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Mass;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    }</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="comment">/* Conditions to turn the gas into a star. .</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="comment">     * The mass check makes sure we never get a gas particle which is lighter</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="comment">     * than the smallest star particle.</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="comment">     * The Generations check (which can happen because of mass return)</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="comment">     * ensures we never instantaneously enrich stars above solar. */</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Mass &lt; 2 * mass_of_star  || <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Generation &gt; <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aa22c2694f1c282c616eb15f9b6b3a182">Generations</a>) {</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        mass_of_star = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Mass;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    }</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="keywordflow">return</span> mass_of_star;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;}</div>
<div class="ttc" id="astructSFRParams_html_aa22c2694f1c282c616eb15f9b6b3a182"><div class="ttname"><a href="structSFRParams.html#aa22c2694f1c282c616eb15f9b6b3a182">SFRParams::Generations</a></div><div class="ttdeci">int Generations</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00065">sfr_eff.c:65</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="sfr__eff_8c_source.html#l00065">SFRParams::Generations</a>, <a class="el" href="partmanager_8h_source.html#l00088">P</a>, <a class="el" href="sfr__eff_8c_source.html#l00062">SFRParams::QuickLymanAlphaProbability</a>, and <a class="el" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.</p>

<p class="reference">Referenced by <a class="el" href="sfr__eff_8c_source.html#l00722">get_sfr_eeqos()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_ad5c8b2f6a1323536d08519b623f60992_icgraph.svg" width="1071" height="256"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a054be999a15e37a4d4d9b8dde836f287"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a054be999a15e37a4d4d9b8dde836f287">&#9670;&nbsp;</a></span>get_egyeff()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static double get_egyeff </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>redshift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>dens</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structUVBG.html">UVBG</a> *&#160;</td>
          <td class="paramname"><em>uvbg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00782">782</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;{</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="keywordtype">double</span> tsfr = sqrt(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a287cf4dfed60a4b9aecef1c74815519d">PhysDensThresh</a> / (dens)) * <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a02fdfce08943fa87ae7a618d4ed61f42">MaxSfrTimescale</a>;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="keywordtype">double</span> factorEVP = pow(dens / <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a287cf4dfed60a4b9aecef1c74815519d">PhysDensThresh</a>, -0.8) * <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a9bc0ca836eb6db5b6545ef8a3c6555e5">FactorEVP</a>;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="keywordtype">double</span> egyhot = <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aa8019313a01afd6d8e9054867d6a42b4">EgySpecSN</a> / (1 + factorEVP) + <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a7ee644d6ec675488c665b4e84c8b2cd2">EgySpecCold</a>;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160; </div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordtype">double</span> ne = 0.5;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="keywordtype">double</span> tcool = <a class="code" href="cooling_8c.html#a2cb008d71b53fcb66c3596042453bdb8">GetCoolingTime</a>(redshift, egyhot, dens, uvbg, &amp;ne, 0.0);</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160; </div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordtype">double</span> y = tsfr / tcool * egyhot / (<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#ab2746a80290d4849001b730e8b8a5956">FactorSN</a> * <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aa8019313a01afd6d8e9054867d6a42b4">EgySpecSN</a> - (1 - <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#ab2746a80290d4849001b730e8b8a5956">FactorSN</a>) * <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a7ee644d6ec675488c665b4e84c8b2cd2">EgySpecCold</a>);</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="keywordtype">double</span> x = 1 + 1 / (2 * y) - sqrt(1 / y + 1 / (4 * y * y));</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="keywordflow">return</span> egyhot * (1 - x) + <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a7ee644d6ec675488c665b4e84c8b2cd2">EgySpecCold</a> * x;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;}</div>
<div class="ttc" id="astructSFRParams_html_a02fdfce08943fa87ae7a618d4ed61f42"><div class="ttname"><a href="structSFRParams.html#a02fdfce08943fa87ae7a618d4ed61f42">SFRParams::MaxSfrTimescale</a></div><div class="ttdeci">double MaxSfrTimescale</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00054">sfr_eff.c:54</a></div></div>
<div class="ttc" id="astructSFRParams_html_a287cf4dfed60a4b9aecef1c74815519d"><div class="ttname"><a href="structSFRParams.html#a287cf4dfed60a4b9aecef1c74815519d">SFRParams::PhysDensThresh</a></div><div class="ttdeci">double PhysDensThresh</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00046">sfr_eff.c:46</a></div></div>
<div class="ttc" id="astructSFRParams_html_a9bc0ca836eb6db5b6545ef8a3c6555e5"><div class="ttname"><a href="structSFRParams.html#a9bc0ca836eb6db5b6545ef8a3c6555e5">SFRParams::FactorEVP</a></div><div class="ttdeci">double FactorEVP</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00050">sfr_eff.c:50</a></div></div>
<div class="ttc" id="astructSFRParams_html_aa8019313a01afd6d8e9054867d6a42b4"><div class="ttname"><a href="structSFRParams.html#aa8019313a01afd6d8e9054867d6a42b4">SFRParams::EgySpecSN</a></div><div class="ttdeci">double EgySpecSN</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00047">sfr_eff.c:47</a></div></div>
<div class="ttc" id="astructSFRParams_html_ab2746a80290d4849001b730e8b8a5956"><div class="ttname"><a href="structSFRParams.html#ab2746a80290d4849001b730e8b8a5956">SFRParams::FactorSN</a></div><div class="ttdeci">double FactorSN</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00048">sfr_eff.c:48</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="sfr__eff_8c_source.html#l00100">sfr_eeqos_data::egyhot</a>, <a class="el" href="sfr__eff_8c_source.html#l00049">SFRParams::EgySpecCold</a>, <a class="el" href="sfr__eff_8c_source.html#l00047">SFRParams::EgySpecSN</a>, <a class="el" href="sfr__eff_8c_source.html#l00050">SFRParams::FactorEVP</a>, <a class="el" href="sfr__eff_8c_source.html#l00048">SFRParams::FactorSN</a>, <a class="el" href="cooling_8c_source.html#l00157">GetCoolingTime()</a>, <a class="el" href="sfr__eff_8c_source.html#l00054">SFRParams::MaxSfrTimescale</a>, <a class="el" href="sfr__eff_8c_source.html#l00106">sfr_eeqos_data::ne</a>, <a class="el" href="sfr__eff_8c_source.html#l00046">SFRParams::PhysDensThresh</a>, <a class="el" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>, and <a class="el" href="sfr__eff_8c_source.html#l00098">sfr_eeqos_data::tsfr</a>.</p>

<p class="reference">Referenced by <a class="el" href="sfr__eff_8c_source.html#l00805">init_cooling_and_star_formation()</a>, and <a class="el" href="sfr__eff_8c_source.html#l00486">sfreff_on_eeqos()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_a054be999a15e37a4d4d9b8dde836f287_cgraph.svg" width="1360" height="1139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_a054be999a15e37a4d4d9b8dde836f287_icgraph.svg" width="1627" height="404"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a50b5665399825c31849545fe351e51ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50b5665399825c31849545fe351e51ab">&#9670;&nbsp;</a></span>get_generations()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int get_generations </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00087">87</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;{</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aa22c2694f1c282c616eb15f9b6b3a182">Generations</a>;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="sfr__eff_8c_source.html#l00065">SFRParams::Generations</a>, and <a class="el" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.</p>

<p class="reference">Referenced by <a class="el" href="init_8c_source.html#l00086">init()</a>, and <a class="el" href="petaio_8c_source.html#l00426">petaio_read_header_internal()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_a50b5665399825c31849545fe351e51ab_icgraph.svg" width="554" height="104"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a18c2f2fb564de2ff8a5372d8bcbe0968"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a18c2f2fb564de2ff8a5372d8bcbe0968">&#9670;&nbsp;</a></span>get_helium_neutral_fraction_sfreff()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double get_helium_neutral_fraction_sfreff </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>redshift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>hubble</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structparticle__data.html">particle_data</a> *&#160;</td>
          <td class="paramname"><em>partdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structsph__particle__data.html">sph_particle_data</a> *&#160;</td>
          <td class="paramname"><em>sphdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00548">548</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;{</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> a3inv = pow(1+redshift,3);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordtype">double</span> helium;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keyword">struct </span><a class="code" href="structUVBG.html">UVBG</a> GlobalUVBG = <a class="code" href="cooling_8h.html#ac9c80af3cbf2235e9f8d39e176515cfe">get_global_UVBG</a>(redshift);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keyword">struct </span><a class="code" href="structUVBG.html">UVBG</a> uvbg = <a class="code" href="cooling_8h.html#ab06d4baa8de3f3e0db4203a9deef30cf">get_local_UVBG</a>(redshift, &amp;GlobalUVBG, partdata-&gt;<a class="code" href="structparticle__data.html#a8a2930279027f0fff6ef709c41e718ec">Pos</a>, <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a5462d473b8cd90abf7f7f7a56d822649">CurrentParticleOffset</a>);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordtype">double</span> physdens = sphdata-&gt;<a class="code" href="structsph__particle__data.html#a40e26648ca8d900ec500a36a5d876ed7">Density</a> * a3inv;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160; </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#acc0def39860c56e0a46c003d10bcb1b8">QuickLymanAlphaProbability</a> &gt; 0 || !<a class="code" href="sfr__eff_8c.html#a4080dc1b2496c08090d1101544b48cc2">sfreff_on_eeqos</a>(sphdata, a3inv)) {</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="comment">/*This gets the neutral fraction for standard gas*/</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        <span class="keywordtype">double</span> eomdensity = sphdata-&gt;<a class="code" href="structsph__particle__data.html#a40e26648ca8d900ec500a36a5d876ed7">Density</a>;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="keywordtype">double</span> InternalEnergy = sphdata-&gt;<a class="code" href="structsph__particle__data.html#a1519e54bbe3cf301cd3fc1224178e4f9">Entropy</a> / <a class="code" href="physconst_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a> * pow(eomdensity * a3inv, <a class="code" href="physconst_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a>);</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        helium = <a class="code" href="cooling_8c.html#ae342c4a687fc7f1ff741a45d010e0e4d">GetHeliumIonFraction</a>(ion, InternalEnergy, physdens, &amp;uvbg, sphdata-&gt;<a class="code" href="structsph__particle__data.html#aa4cd5a16a69812e250259617dc9dea58">Ne</a>);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    }</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        <span class="comment">/* This gets the neutral fraction for gas on the star-forming equation of state.</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment">         * This needs special handling because the cold clouds have a different neutral</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">         * fraction than the hot gas*/</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> = <a class="code" href="timebinmgr_8c.html#a716e51b694540af2851fb51c081bcf5d">get_dloga_for_bin</a>(partdata-&gt;<a class="code" href="structparticle__data.html#a05fd8464aa98ca965a3e57109a326dd6">TimeBin</a>, partdata-&gt;<a class="code" href="structparticle__data.html#aeafd0c9a116318728e4eab4a5a4332ed">Ti_drift</a>);</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <span class="keywordtype">double</span> dtime = <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> / hubble;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <span class="keyword">struct </span><a class="code" href="structsfr__eeqos__data.html">sfr_eeqos_data</a> sfr_data = <a class="code" href="sfr__eff_8c.html#a4951e59bdceebd7b56b972942bc3a10d">get_sfr_eeqos</a>(partdata, sphdata, dtime, &amp;uvbg, redshift, a3inv);</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <span class="keywordtype">double</span> nh0cold = <a class="code" href="cooling_8c.html#ae342c4a687fc7f1ff741a45d010e0e4d">GetHeliumIonFraction</a>(ion, <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a7ee644d6ec675488c665b4e84c8b2cd2">EgySpecCold</a>, physdens, &amp;uvbg, sfr_data.<a class="code" href="structsfr__eeqos__data.html#a1b1001831e195f3bc21921f0744062d1">ne</a>);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <span class="keywordtype">double</span> nh0hot = <a class="code" href="cooling_8c.html#ae342c4a687fc7f1ff741a45d010e0e4d">GetHeliumIonFraction</a>(ion, sfr_data.<a class="code" href="structsfr__eeqos__data.html#a55da71adb5b8d5a586336fef41a2da79">egyhot</a>, physdens, &amp;uvbg, sfr_data.<a class="code" href="structsfr__eeqos__data.html#a1b1001831e195f3bc21921f0744062d1">ne</a>);</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        helium =  nh0cold * sfr_data.<a class="code" href="structsfr__eeqos__data.html#a167c8900f3dd897a8c448d09fa54f53e">cloudfrac</a> + (1-sfr_data.<a class="code" href="structsfr__eeqos__data.html#a167c8900f3dd897a8c448d09fa54f53e">cloudfrac</a>) * nh0hot;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    }</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keywordflow">return</span> helium;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;}</div>
<div class="ttc" id="acooling_8c_html_ae342c4a687fc7f1ff741a45d010e0e4d"><div class="ttname"><a href="cooling_8c.html#ae342c4a687fc7f1ff741a45d010e0e4d">GetHeliumIonFraction</a></div><div class="ttdeci">double GetHeliumIonFraction(int ion, double u_old, double rho, const struct UVBG *uvbg, double ne_init)</div><div class="ttdef"><b>Definition:</b> <a href="cooling_8c_source.html#l00192">cooling.c:192</a></div></div>
<div class="ttc" id="asfr__eff_8c_html_a4951e59bdceebd7b56b972942bc3a10d"><div class="ttname"><a href="sfr__eff_8c.html#a4951e59bdceebd7b56b972942bc3a10d">get_sfr_eeqos</a></div><div class="ttdeci">static struct sfr_eeqos_data get_sfr_eeqos(struct particle_data *part, struct sph_particle_data *sph, double dtime, struct UVBG *local_uvbg, const double redshift, const double a3inv)</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00666">sfr_eff.c:722</a></div></div>
<div class="ttc" id="astructparticle__data_html_a05fd8464aa98ca965a3e57109a326dd6"><div class="ttname"><a href="structparticle__data.html#a05fd8464aa98ca965a3e57109a326dd6">particle_data::TimeBin</a></div><div class="ttdeci">unsigned char TimeBin</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00026">partmanager.h:26</a></div></div>
<div class="ttc" id="astructparticle__data_html_a8a2930279027f0fff6ef709c41e718ec"><div class="ttname"><a href="structparticle__data.html#a8a2930279027f0fff6ef709c41e718ec">particle_data::Pos</a></div><div class="ttdeci">double Pos[3]</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00012">partmanager.h:12</a></div></div>
<div class="ttc" id="astructparticle__data_html_aeafd0c9a116318728e4eab4a5a4332ed"><div class="ttname"><a href="structparticle__data.html#aeafd0c9a116318728e4eab4a5a4332ed">particle_data::Ti_drift</a></div><div class="ttdeci">inttime_t Ti_drift</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00036">partmanager.h:36</a></div></div>
<div class="ttc" id="astructsfr__eeqos__data_html"><div class="ttname"><a href="structsfr__eeqos__data.html">sfr_eeqos_data</a></div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00093">sfr_eff.c:94</a></div></div>
<div class="ttc" id="astructsfr__eeqos__data_html_a1b1001831e195f3bc21921f0744062d1"><div class="ttname"><a href="structsfr__eeqos__data.html#a1b1001831e195f3bc21921f0744062d1">sfr_eeqos_data::ne</a></div><div class="ttdeci">double ne</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00106">sfr_eff.c:106</a></div></div>
<div class="ttc" id="astructsph__particle__data_html_a1519e54bbe3cf301cd3fc1224178e4f9"><div class="ttname"><a href="structsph__particle__data.html#a1519e54bbe3cf301cd3fc1224178e4f9">sph_particle_data::Entropy</a></div><div class="ttdeci">MyFloat Entropy</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00087">slotsmanager.h:87</a></div></div>
<div class="ttc" id="astructsph__particle__data_html_a40e26648ca8d900ec500a36a5d876ed7"><div class="ttname"><a href="structsph__particle__data.html#a40e26648ca8d900ec500a36a5d876ed7">sph_particle_data::Density</a></div><div class="ttdeci">MyFloat Density</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00090">slotsmanager.h:90</a></div></div>
<div class="ttc" id="astructsph__particle__data_html_aa4cd5a16a69812e250259617dc9dea58"><div class="ttname"><a href="structsph__particle__data.html#aa4cd5a16a69812e250259617dc9dea58">sph_particle_data::Ne</a></div><div class="ttdeci">MyFloat Ne</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00100">slotsmanager.h:100</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="sfr__eff_8c_source.html#l00104">sfr_eeqos_data::cloudfrac</a>, <a class="el" href="partmanager_8h_source.html#l00082">part_manager_type::CurrentParticleOffset</a>, <a class="el" href="slotsmanager_8h_source.html#l00090">sph_particle_data::Density</a>, <a class="el" href="lightcone_8c_source.html#l00021">dloga</a>, <a class="el" href="sfr__eff_8c_source.html#l00100">sfr_eeqos_data::egyhot</a>, <a class="el" href="sfr__eff_8c_source.html#l00049">SFRParams::EgySpecCold</a>, <a class="el" href="slotsmanager_8h_source.html#l00087">sph_particle_data::Entropy</a>, <a class="el" href="physconst_8h_source.html#l00035">GAMMA_MINUS1</a>, <a class="el" href="timebinmgr_8c_source.html#l00279">get_dloga_for_bin()</a>, <a class="el" href="cooling__rates_8c_source.html#l00263">get_global_UVBG()</a>, <a class="el" href="cooling__uvfluc_8c_source.html#l00149">get_local_UVBG()</a>, <a class="el" href="sfr__eff_8c_source.html#l00722">get_sfr_eeqos()</a>, <a class="el" href="cooling_8c_source.html#l00192">GetHeliumIonFraction()</a>, <a class="el" href="sfr__eff_8c_source.html#l00106">sfr_eeqos_data::ne</a>, <a class="el" href="slotsmanager_8h_source.html#l00100">sph_particle_data::Ne</a>, <a class="el" href="partmanager_8c_source.html#l00011">PartManager</a>, <a class="el" href="partmanager_8h_source.html#l00012">particle_data::Pos</a>, <a class="el" href="sfr__eff_8c_source.html#l00062">SFRParams::QuickLymanAlphaProbability</a>, <a class="el" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>, <a class="el" href="sfr__eff_8c_source.html#l00486">sfreff_on_eeqos()</a>, <a class="el" href="partmanager_8h_source.html#l00036">particle_data::Ti_drift</a>, and <a class="el" href="partmanager_8h_source.html#l00026">particle_data::TimeBin</a>.</p>

<p class="reference">Referenced by <a class="el" href="petaio_8c_source.html#l00831">GTHeliumIFraction()</a>, <a class="el" href="petaio_8c_source.html#l00839">GTHeliumIIFraction()</a>, and <a class="el" href="petaio_8c_source.html#l00847">GTHeliumIIIFraction()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_a18c2f2fb564de2ff8a5372d8bcbe0968_cgraph.svg" width="2764" height="1168"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_a18c2f2fb564de2ff8a5372d8bcbe0968_icgraph.svg" width="358" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aa4503d203fa143d76d004c0719415562"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4503d203fa143d76d004c0719415562">&#9670;&nbsp;</a></span>get_MinEgySpec()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double get_MinEgySpec </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00797">797</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;{</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="comment">/* mean molecular weight assuming ZERO ionization NEUTRAL GAS*/</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> meanweight = 4.0 / (1 + 3 * <a class="code" href="physconst_8h.html#a67abaa49a5aa2892eba705d380652279">HYDROGEN_MASSFRAC</a>);</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    <span class="comment">/*Enforces a minimum internal energy in cooling. */</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a5173127552b049a6104298f5cf2317c2">temp_to_u</a> / meanweight * <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a52747a7ff6078a36a8ecf3fa0e89b11f">MinGasTemp</a>;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="physconst_8h_source.html#l00037">HYDROGEN_MASSFRAC</a>, <a class="el" href="sfr__eff_8c_source.html#l00057">SFRParams::MinGasTemp</a>, <a class="el" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>, and <a class="el" href="sfr__eff_8c_source.html#l00070">SFRParams::temp_to_u</a>.</p>

<p class="reference">Referenced by <a class="el" href="run_8c_source.html#l00194">begrun()</a>, <a class="el" href="run_8c_source.html#l00284">run()</a>, and <a class="el" href="run_8c_source.html#l00652">runfof()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_aa4503d203fa143d76d004c0719415562_icgraph.svg" width="358" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a4e4a6b5d6976b26f1ababfba475c1f4c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e4a6b5d6976b26f1ababfba475c1f4c">&#9670;&nbsp;</a></span>get_neutral_fraction_sfreff()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double get_neutral_fraction_sfreff </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>redshift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>hubble</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structparticle__data.html">particle_data</a> *&#160;</td>
          <td class="paramname"><em>partdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structsph__particle__data.html">sph_particle_data</a> *&#160;</td>
          <td class="paramname"><em>sphdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00520">520</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;{</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keywordtype">double</span> nh0;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> a3inv = pow(1+redshift,3);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keyword">struct </span><a class="code" href="structUVBG.html">UVBG</a> GlobalUVBG = <a class="code" href="cooling_8h.html#ac9c80af3cbf2235e9f8d39e176515cfe">get_global_UVBG</a>(redshift);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keyword">struct </span><a class="code" href="structUVBG.html">UVBG</a> uvbg = <a class="code" href="cooling_8h.html#ab06d4baa8de3f3e0db4203a9deef30cf">get_local_UVBG</a>(redshift, &amp;GlobalUVBG, partdata-&gt;<a class="code" href="structparticle__data.html#a8a2930279027f0fff6ef709c41e718ec">Pos</a>, <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a5462d473b8cd90abf7f7f7a56d822649">CurrentParticleOffset</a>);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keywordtype">double</span> physdens = sphdata-&gt;<a class="code" href="structsph__particle__data.html#a40e26648ca8d900ec500a36a5d876ed7">Density</a> * a3inv;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160; </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#acc0def39860c56e0a46c003d10bcb1b8">QuickLymanAlphaProbability</a> &gt; 0 || !<a class="code" href="sfr__eff_8c.html#a4080dc1b2496c08090d1101544b48cc2">sfreff_on_eeqos</a>(sphdata, a3inv)) {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <span class="comment">/*This gets the neutral fraction for standard gas*/</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        <span class="keywordtype">double</span> eomdensity = sphdata-&gt;<a class="code" href="structsph__particle__data.html#a40e26648ca8d900ec500a36a5d876ed7">Density</a>;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <span class="keywordtype">double</span> InternalEnergy = sphdata-&gt;<a class="code" href="structsph__particle__data.html#a1519e54bbe3cf301cd3fc1224178e4f9">Entropy</a> / <a class="code" href="physconst_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a> * pow(eomdensity * a3inv, <a class="code" href="physconst_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a>);</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        nh0 = <a class="code" href="cooling_8c.html#afc517262b7b2a6b80ba9302b10d4721c">GetNeutralFraction</a>(InternalEnergy, physdens, &amp;uvbg, sphdata-&gt;<a class="code" href="structsph__particle__data.html#aa4cd5a16a69812e250259617dc9dea58">Ne</a>);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    }</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <span class="comment">/* This gets the neutral fraction for gas on the star-forming equation of state.</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">         * This needs special handling because the cold clouds have a different neutral</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">         * fraction than the hot gas*/</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> = <a class="code" href="timebinmgr_8c.html#a716e51b694540af2851fb51c081bcf5d">get_dloga_for_bin</a>(partdata-&gt;<a class="code" href="structparticle__data.html#a05fd8464aa98ca965a3e57109a326dd6">TimeBin</a>, partdata-&gt;<a class="code" href="structparticle__data.html#aeafd0c9a116318728e4eab4a5a4332ed">Ti_drift</a>);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <span class="keywordtype">double</span> dtime = <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> / hubble;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        <span class="keyword">struct </span><a class="code" href="structsfr__eeqos__data.html">sfr_eeqos_data</a> sfr_data = <a class="code" href="sfr__eff_8c.html#a4951e59bdceebd7b56b972942bc3a10d">get_sfr_eeqos</a>(partdata, sphdata, dtime, &amp;uvbg, redshift, a3inv);</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <span class="keywordtype">double</span> nh0cold = <a class="code" href="cooling_8c.html#afc517262b7b2a6b80ba9302b10d4721c">GetNeutralFraction</a>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a7ee644d6ec675488c665b4e84c8b2cd2">EgySpecCold</a>, physdens, &amp;uvbg, sfr_data.<a class="code" href="structsfr__eeqos__data.html#a1b1001831e195f3bc21921f0744062d1">ne</a>);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <span class="keywordtype">double</span> nh0hot = <a class="code" href="cooling_8c.html#afc517262b7b2a6b80ba9302b10d4721c">GetNeutralFraction</a>(sfr_data.<a class="code" href="structsfr__eeqos__data.html#a55da71adb5b8d5a586336fef41a2da79">egyhot</a>, physdens, &amp;uvbg, sfr_data.<a class="code" href="structsfr__eeqos__data.html#a1b1001831e195f3bc21921f0744062d1">ne</a>);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        nh0 =  nh0cold * sfr_data.<a class="code" href="structsfr__eeqos__data.html#a167c8900f3dd897a8c448d09fa54f53e">cloudfrac</a> + (1-sfr_data.<a class="code" href="structsfr__eeqos__data.html#a167c8900f3dd897a8c448d09fa54f53e">cloudfrac</a>) * nh0hot;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    }</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordflow">return</span> nh0;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;}</div>
<div class="ttc" id="acooling_8c_html_afc517262b7b2a6b80ba9302b10d4721c"><div class="ttname"><a href="cooling_8c.html#afc517262b7b2a6b80ba9302b10d4721c">GetNeutralFraction</a></div><div class="ttdeci">double GetNeutralFraction(double u_old, double rho, const struct UVBG *uvbg, double ne_init)</div><div class="ttdef"><b>Definition:</b> <a href="cooling_8c_source.html#l00181">cooling.c:181</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="sfr__eff_8c_source.html#l00104">sfr_eeqos_data::cloudfrac</a>, <a class="el" href="partmanager_8h_source.html#l00082">part_manager_type::CurrentParticleOffset</a>, <a class="el" href="slotsmanager_8h_source.html#l00090">sph_particle_data::Density</a>, <a class="el" href="lightcone_8c_source.html#l00021">dloga</a>, <a class="el" href="sfr__eff_8c_source.html#l00100">sfr_eeqos_data::egyhot</a>, <a class="el" href="sfr__eff_8c_source.html#l00049">SFRParams::EgySpecCold</a>, <a class="el" href="slotsmanager_8h_source.html#l00087">sph_particle_data::Entropy</a>, <a class="el" href="physconst_8h_source.html#l00035">GAMMA_MINUS1</a>, <a class="el" href="timebinmgr_8c_source.html#l00279">get_dloga_for_bin()</a>, <a class="el" href="cooling__rates_8c_source.html#l00263">get_global_UVBG()</a>, <a class="el" href="cooling__uvfluc_8c_source.html#l00149">get_local_UVBG()</a>, <a class="el" href="sfr__eff_8c_source.html#l00722">get_sfr_eeqos()</a>, <a class="el" href="cooling_8c_source.html#l00181">GetNeutralFraction()</a>, <a class="el" href="sfr__eff_8c_source.html#l00106">sfr_eeqos_data::ne</a>, <a class="el" href="slotsmanager_8h_source.html#l00100">sph_particle_data::Ne</a>, <a class="el" href="partmanager_8c_source.html#l00011">PartManager</a>, <a class="el" href="partmanager_8h_source.html#l00012">particle_data::Pos</a>, <a class="el" href="sfr__eff_8c_source.html#l00062">SFRParams::QuickLymanAlphaProbability</a>, <a class="el" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>, <a class="el" href="sfr__eff_8c_source.html#l00486">sfreff_on_eeqos()</a>, <a class="el" href="partmanager_8h_source.html#l00036">particle_data::Ti_drift</a>, and <a class="el" href="partmanager_8h_source.html#l00026">particle_data::TimeBin</a>.</p>

<p class="reference">Referenced by <a class="el" href="blackhole_8c_source.html#l01063">blackhole_accretion_ngbiter()</a>, and <a class="el" href="petaio_8c_source.html#l00822">GTNeutralHydrogenFraction()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_a4e4a6b5d6976b26f1ababfba475c1f4c_cgraph.svg" width="2740" height="1168"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_a4e4a6b5d6976b26f1ababfba475c1f4c_icgraph.svg" width="742" height="104"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a4951e59bdceebd7b56b972942bc3a10d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4951e59bdceebd7b56b972942bc3a10d">&#9670;&nbsp;</a></span>get_sfr_eeqos()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structsfr__eeqos__data.html">sfr_eeqos_data</a> get_sfr_eeqos </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structparticle__data.html">particle_data</a> *&#160;</td>
          <td class="paramname"><em>part</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structsph__particle__data.html">sph_particle_data</a> *&#160;</td>
          <td class="paramname"><em>sph</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>dtime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structUVBG.html">UVBG</a> *&#160;</td>
          <td class="paramname"><em>local_uvbg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>redshift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>a3inv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00666">666</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;{</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="keyword">struct </span><a class="code" href="structsfr__eeqos__data.html">sfr_eeqos_data</a> data;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="comment">/* Initialise data to something, just in case.*/</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    data.<a class="code" href="structsfr__eeqos__data.html#a335b12ecbc2c8baabb24f2e9c3425fd4">trelax</a> = <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a02fdfce08943fa87ae7a618d4ed61f42">MaxSfrTimescale</a>;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    data.tsfr = <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a02fdfce08943fa87ae7a618d4ed61f42">MaxSfrTimescale</a>;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    data.egyhot = <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a7ee644d6ec675488c665b4e84c8b2cd2">EgySpecCold</a>;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    data.cloudfrac = 0;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    data.ne = 0;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160; </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="comment">/* This shall never happen, but just in case*/</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="sfr__eff_8c.html#a4080dc1b2496c08090d1101544b48cc2">sfreff_on_eeqos</a>(sph, a3inv))</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        <span class="keywordflow">return</span> data;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160; </div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    data.ne = sph-&gt;<a class="code" href="structsph__particle__data.html#aa4cd5a16a69812e250259617dc9dea58">Ne</a>;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    data.tsfr = sqrt(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a287cf4dfed60a4b9aecef1c74815519d">PhysDensThresh</a> / (sph-&gt;<a class="code" href="structsph__particle__data.html#a40e26648ca8d900ec500a36a5d876ed7">Density</a> * a3inv)) * <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a02fdfce08943fa87ae7a618d4ed61f42">MaxSfrTimescale</a>;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="comment">     * gadget-p doesn&#39;t have this cap.</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="comment">     * without the cap sm can be bigger than cloudmass.</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <span class="keywordflow">if</span>(data.tsfr &lt; dtime &amp;&amp; dtime &gt; 0)</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        data.tsfr = dtime;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160; </div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keywordtype">double</span> factorEVP = pow(sph-&gt;<a class="code" href="structsph__particle__data.html#a40e26648ca8d900ec500a36a5d876ed7">Density</a> * a3inv / <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a287cf4dfed60a4b9aecef1c74815519d">PhysDensThresh</a>, -0.8) * <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a9bc0ca836eb6db5b6545ef8a3c6555e5">FactorEVP</a>;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160; </div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    data.egyhot = <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aa8019313a01afd6d8e9054867d6a42b4">EgySpecSN</a> / (1 + factorEVP) + <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a7ee644d6ec675488c665b4e84c8b2cd2">EgySpecCold</a>;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    data.egycold = <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a7ee644d6ec675488c665b4e84c8b2cd2">EgySpecCold</a>;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160; </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="keywordtype">double</span> tcool = <a class="code" href="cooling_8c.html#a2cb008d71b53fcb66c3596042453bdb8">GetCoolingTime</a>(redshift, data.egyhot, sph-&gt;<a class="code" href="structsph__particle__data.html#a40e26648ca8d900ec500a36a5d876ed7">Density</a> * a3inv, local_uvbg, &amp;data.ne, sph-&gt;<a class="code" href="structsph__particle__data.html#ab564223ae792423129ffd27a8508b051">Metallicity</a>);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="keywordtype">double</span> y = data.tsfr / tcool * data.egyhot / (<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#ab2746a80290d4849001b730e8b8a5956">FactorSN</a> * <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aa8019313a01afd6d8e9054867d6a42b4">EgySpecSN</a> - (1 - <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#ab2746a80290d4849001b730e8b8a5956">FactorSN</a>) * <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a7ee644d6ec675488c665b4e84c8b2cd2">EgySpecCold</a>);</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160; </div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    data.cloudfrac = 1 + 1 / (2 * y) - sqrt(1 / y + 1 / (4 * y * y));</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160; </div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    data.trelax = data.tsfr * (1 - data.cloudfrac) / data.cloudfrac / (<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#ab2746a80290d4849001b730e8b8a5956">FactorSN</a> * (1 + factorEVP));</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="keywordflow">return</span> data;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;}</div>
<div class="ttc" id="astructsph__particle__data_html_ab564223ae792423129ffd27a8508b051"><div class="ttname"><a href="structsph__particle__data.html#ab564223ae792423129ffd27a8508b051">sph_particle_data::Metallicity</a></div><div class="ttdeci">MyFloat Metallicity</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00107">slotsmanager.h:107</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="sfr__eff_8c_source.html#l00067">SFRParams::avg_baryon_mass</a>, <a class="el" href="sfr__eff_8c_source.html#l00606">cooling_relaxed()</a>, <a class="el" href="partmanager_8h_source.html#l00082">part_manager_type::CurrentParticleOffset</a>, <a class="el" href="lightcone_8c_source.html#l00021">dloga</a>, <a class="el" href="sfr__eff_8c_source.html#l00921">find_star_mass()</a>, <a class="el" href="sfr__eff_8c_source.html#l00065">SFRParams::Generations</a>, <a class="el" href="timebinmgr_8c_source.html#l00279">get_dloga_for_bin()</a>, <a class="el" href="cooling__uvfluc_8c_source.html#l00149">get_local_UVBG()</a>, <a class="el" href="system_8c_source.html#l00060">get_random_number()</a>, <a class="el" href="sfr__eff_8c_source.html#l00759">get_starformation_rate_full()</a>, <a class="el" href="sfr__eff_8h_source.html#l00011">METAL_YIELD</a>, <a class="el" href="sfr__eff_8c_source.html#l00106">sfr_eeqos_data::ne</a>, <a class="el" href="partmanager_8h_source.html#l00088">P</a>, <a class="el" href="partmanager_8c_source.html#l00011">PartManager</a>, <a class="el" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>, <a class="el" href="slotsmanager_8c_source.html#l00103">slots_split_particle()</a>, <a class="el" href="slotsmanager_8h_source.html#l00124">SPHP</a>, and <a class="el" href="sfr__eff_8c_source.html#l00072">SFRParams::UnitSfr_in_solar_per_year</a>.</p>

<p class="reference">Referenced by <a class="el" href="sfr__eff_8c_source.html#l00548">get_helium_neutral_fraction_sfreff()</a>, and <a class="el" href="sfr__eff_8c_source.html#l00520">get_neutral_fraction_sfreff()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_a4951e59bdceebd7b56b972942bc3a10d_cgraph.svg" width="1687" height="1000"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_a4951e59bdceebd7b56b972942bc3a10d_icgraph.svg" width="903" height="256"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="affe50edf965ec43e0c4bb2591d5f1d91"></a>
<h2 class="memtitle"><span class="permalink"><a href="#affe50edf965ec43e0c4bb2591d5f1d91">&#9670;&nbsp;</a></span>get_sfr_factor_due_to_h2()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static double get_sfr_factor_due_to_h2 </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> *&#160;</td>
          <td class="paramname"><em>GradRho</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>atime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00973">973</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                                                                                     {</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="comment">/*  Krumholz &amp; Gnedin fitting function for f_H2 as a function of local</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="comment">     *  properties, from gadget-p; we return the enhancement on SFR in this</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="comment">     *  function */</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="keywordtype">double</span> tau_fmol;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> a2 = atime * atime;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="keywordtype">double</span> zoverzsun = <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Metallicity/<a class="code" href="sfr__eff_8h.html#a898d422fc3ce4d0e27b19dd4b489e70a">METAL_YIELD</a>;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="keywordtype">double</span> gradrho_mag = sqrt(GradRho[3*<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].PI]*GradRho[3*<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].PI]+GradRho[3*<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].PI+1]*GradRho[3*<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].PI+1]+GradRho[3*<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].PI+2]*GradRho[3*<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].PI+2]);</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="comment">//message(4, &quot;GradRho %g rho %g hsml %g i %d\n&quot;, gradrho_mag, SPHP(i).Density, P[i].Hsml, i);</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    tau_fmol = <a class="code" href="sfr__eff_8c.html#acfbbbdbb84c5b6812489f849106492de">ev_NH_from_GradRho</a>(gradrho_mag,<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Hsml,<a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Density,1) /a2;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    tau_fmol *= (0.1 + zoverzsun);</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="keywordflow">if</span>(tau_fmol&gt;0) {</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        tau_fmol *= 434.78*<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a9af92cded51df7bb763f8638186fbcb4">tau_fmol_unit</a>;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        <span class="keywordtype">double</span> y = 0.756*(1+3.1*pow(zoverzsun,0.365));</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        y = log(1+0.6*y+0.01*y*y)/(0.6*tau_fmol);</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;        y = 1-0.75*y/(1+0.25*y);</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        <span class="keywordflow">if</span>(y&lt;0) y=0;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        <span class="keywordflow">if</span>(y&gt;1) y=1;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        <span class="keywordflow">return</span> y;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160; </div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    } <span class="comment">// if(tau_fmol&gt;0)</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="keywordflow">return</span> 1.0;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;}</div>
<div class="ttc" id="asfr__eff_8c_html_acfbbbdbb84c5b6812489f849106492de"><div class="ttname"><a href="sfr__eff_8c.html#acfbbbdbb84c5b6812489f849106492de">ev_NH_from_GradRho</a></div><div class="ttdeci">static double ev_NH_from_GradRho(MyFloat gradrho_mag, double hsml, double rho, double include_h)</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00959">sfr_eff.c:959</a></div></div>
<div class="ttc" id="asfr__eff_8h_html_a898d422fc3ce4d0e27b19dd4b489e70a"><div class="ttname"><a href="sfr__eff_8h.html#a898d422fc3ce4d0e27b19dd4b489e70a">METAL_YIELD</a></div><div class="ttdeci">#define METAL_YIELD</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8h_source.html#l00011">sfr_eff.h:11</a></div></div>
<div class="ttc" id="astructSFRParams_html_a9af92cded51df7bb763f8638186fbcb4"><div class="ttname"><a href="structSFRParams.html#a9af92cded51df7bb763f8638186fbcb4">SFRParams::tau_fmol_unit</a></div><div class="ttdeci">double tau_fmol_unit</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00060">sfr_eff.c:60</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="sfr__eff_8c_source.html#l00959">ev_NH_from_GradRho()</a>, <a class="el" href="sfr__eff_8h_source.html#l00011">METAL_YIELD</a>, <a class="el" href="partmanager_8h_source.html#l00088">P</a>, <a class="el" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>, <a class="el" href="slotsmanager_8h_source.html#l00124">SPHP</a>, and <a class="el" href="sfr__eff_8c_source.html#l00060">SFRParams::tau_fmol_unit</a>.</p>

<p class="reference">Referenced by <a class="el" href="sfr__eff_8c_source.html#l00759">get_starformation_rate_full()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_affe50edf965ec43e0c4bb2591d5f1d91_cgraph.svg" width="368" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_affe50edf965ec43e0c4bb2591d5f1d91_icgraph.svg" width="1342" height="256"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a70b33984dc619b1cdb5acaf23b4aaf1f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70b33984dc619b1cdb5acaf23b4aaf1f">&#9670;&nbsp;</a></span>get_sfr_factor_due_to_selfgravity()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static double get_sfr_factor_due_to_selfgravity </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>atime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>a3inv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>hubble</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>GravInternal</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00997">997</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;                                                                                                                                               {</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> a2 = atime * atime;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="keywordtype">double</span> divv = <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).DivVel / a2;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160; </div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    divv += 3.0*hubble * a2; <span class="comment">// hubble-flow correction</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160; </div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="types_8h.html#aae268cff368c829e32ef0a52ee731bd6">HAS</a>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#abd689c6b41461ad6e52ec4197f58a2a2">StarformationCriterion</a>, <a class="code" href="sfr__eff_8h.html#ab842fea564dc8ca2101c3bb43fab2ba1a4414f137381c58bd61737779fe858225">SFR_CRITERION_CONVERGENT_FLOW</a>)) {</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        <span class="keywordflow">if</span>( divv&gt;=0 ) <span class="keywordflow">return</span> 0; <span class="comment">// restrict to convergent flows (optional) //</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    }</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160; </div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <span class="keywordtype">double</span> dv2abs = (divv*divv</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            + (<a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).CurlVel/a2)</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;            * (<a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).CurlVel/a2)</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;           ); <span class="comment">// all in physical units</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="keywordtype">double</span> alpha_vir = 0.2387 * dv2abs/(GravInternal * <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Density * a3inv);</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160; </div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    <span class="keywordtype">double</span> y = 1.0;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160; </div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="keywordflow">if</span>((alpha_vir &lt; 1.0)</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    || (<a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Density * a3inv &gt; 100. * <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a287cf4dfed60a4b9aecef1c74815519d">PhysDensThresh</a>)</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    )  {</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        y = 66.7;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        y = 0.1;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    }</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <span class="comment">// PFH: note the latter flag is an arbitrary choice currently set</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    <span class="comment">// -by hand- to prevent runaway densities from this prescription! //</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160; </div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="types_8h.html#aae268cff368c829e32ef0a52ee731bd6">HAS</a>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#abd689c6b41461ad6e52ec4197f58a2a2">StarformationCriterion</a>, <a class="code" href="sfr__eff_8h.html#ab842fea564dc8ca2101c3bb43fab2ba1a4754feeefc9970370fa3238938c25c7e">SFR_CRITERION_CONTINUOUS_CUTOFF</a>)) {</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        <span class="comment">// continuous cutoff w alpha_vir instead of sharp (optional) //</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        y *= 1.0/(1.0 + alpha_vir);</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    }</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <span class="keywordflow">return</span> y;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;}</div>
<div class="ttc" id="asfr__eff_8h_html_ab842fea564dc8ca2101c3bb43fab2ba1a4414f137381c58bd61737779fe858225"><div class="ttname"><a href="sfr__eff_8h.html#ab842fea564dc8ca2101c3bb43fab2ba1a4414f137381c58bd61737779fe858225">SFR_CRITERION_CONVERGENT_FLOW</a></div><div class="ttdeci">@ SFR_CRITERION_CONVERGENT_FLOW</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8h_source.html#l00021">sfr_eff.h:21</a></div></div>
<div class="ttc" id="asfr__eff_8h_html_ab842fea564dc8ca2101c3bb43fab2ba1a4754feeefc9970370fa3238938c25c7e"><div class="ttname"><a href="sfr__eff_8h.html#ab842fea564dc8ca2101c3bb43fab2ba1a4754feeefc9970370fa3238938c25c7e">SFR_CRITERION_CONTINUOUS_CUTOFF</a></div><div class="ttdeci">@ SFR_CRITERION_CONTINUOUS_CUTOFF</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8h_source.html#l00022">sfr_eff.h:22</a></div></div>
<div class="ttc" id="astructSFRParams_html_abd689c6b41461ad6e52ec4197f58a2a2"><div class="ttname"><a href="structSFRParams.html#abd689c6b41461ad6e52ec4197f58a2a2">SFRParams::StarformationCriterion</a></div><div class="ttdeci">enum StarformationCriterion StarformationCriterion</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00039">sfr_eff.c:40</a></div></div>
<div class="ttc" id="atypes_8h_html_aae268cff368c829e32ef0a52ee731bd6"><div class="ttname"><a href="types_8h.html#aae268cff368c829e32ef0a52ee731bd6">HAS</a></div><div class="ttdeci">#define HAS(val, flag)</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00022">types.h:22</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="types_8h_source.html#l00022">HAS</a>, <a class="el" href="sfr__eff_8c_source.html#l00046">SFRParams::PhysDensThresh</a>, <a class="el" href="sfr__eff_8h_source.html#l00022">SFR_CRITERION_CONTINUOUS_CUTOFF</a>, <a class="el" href="sfr__eff_8h_source.html#l00021">SFR_CRITERION_CONVERGENT_FLOW</a>, <a class="el" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>, <a class="el" href="slotsmanager_8h_source.html#l00124">SPHP</a>, and <a class="el" href="sfr__eff_8c_source.html#l00040">SFRParams::StarformationCriterion</a>.</p>

<p class="reference">Referenced by <a class="el" href="sfr__eff_8c_source.html#l00759">get_starformation_rate_full()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_a70b33984dc619b1cdb5acaf23b4aaf1f_icgraph.svg" width="1342" height="256"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a5cfa7b95c20ca76682274d0dc17e3c66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5cfa7b95c20ca76682274d0dc17e3c66">&#9670;&nbsp;</a></span>get_starformation_rate_full()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static double get_starformation_rate_full </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> *&#160;</td>
          <td class="paramname"><em>GradRho</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structsfr__eeqos__data.html">sfr_eeqos_data</a>&#160;</td>
          <td class="paramname"><em>sfr_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>atime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>a3inv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>hubble</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>GravInternal</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00759">759</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;{</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="sfr__eff_8c.html#a4080dc1b2496c08090d1101544b48cc2">sfreff_on_eeqos</a>(&amp;<a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i), a3inv)) {</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    }</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160; </div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="keywordtype">double</span> cloudmass = sfr_data.<a class="code" href="structsfr__eeqos__data.html#a167c8900f3dd897a8c448d09fa54f53e">cloudfrac</a> * <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Mass;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160; </div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordtype">double</span> rateOfSF = (1 - <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#ab2746a80290d4849001b730e8b8a5956">FactorSN</a>) * cloudmass / sfr_data.<a class="code" href="structsfr__eeqos__data.html#a6c1ea23e04b1b4a56b51b142e6ccfb81">tsfr</a>;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160; </div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    if (<a class="code" href="types_8h.html#aae268cff368c829e32ef0a52ee731bd6">HAS</a>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#abd689c6b41461ad6e52ec4197f58a2a2">StarformationCriterion</a>, <a class="code" href="sfr__eff_8h.html#ab842fea564dc8ca2101c3bb43fab2ba1a3c3314c2c3e12bd32982499ef7c98904">SFR_CRITERION_MOLECULAR_H2</a>)) {</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        <span class="keywordflow">if</span>(!GradRho)</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;            <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(1, <span class="stringliteral">&quot;GradRho not allocated but has SFR_CRITERION_MOLECULAR_H2. Should never happen!\n&quot;</span>);</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        rateOfSF *= <a class="code" href="sfr__eff_8c.html#affe50edf965ec43e0c4bb2591d5f1d91">get_sfr_factor_due_to_h2</a>(i, GradRho, atime);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    }</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="types_8h.html#aae268cff368c829e32ef0a52ee731bd6">HAS</a>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#abd689c6b41461ad6e52ec4197f58a2a2">StarformationCriterion</a>, <a class="code" href="sfr__eff_8h.html#ab842fea564dc8ca2101c3bb43fab2ba1ab9d87d5c819540d1b2734ec31750c181">SFR_CRITERION_SELFGRAVITY</a>)) {</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        rateOfSF *= <a class="code" href="sfr__eff_8c.html#a70b33984dc619b1cdb5acaf23b4aaf1f">get_sfr_factor_due_to_selfgravity</a>(i, atime, a3inv, hubble, GravInternal);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    }</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keywordflow">return</span> rateOfSF;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;}</div>
<div class="ttc" id="asfr__eff_8c_html_a70b33984dc619b1cdb5acaf23b4aaf1f"><div class="ttname"><a href="sfr__eff_8c.html#a70b33984dc619b1cdb5acaf23b4aaf1f">get_sfr_factor_due_to_selfgravity</a></div><div class="ttdeci">static double get_sfr_factor_due_to_selfgravity(int i, const double atime, const double a3inv, const double hubble, const double GravInternal)</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00997">sfr_eff.c:997</a></div></div>
<div class="ttc" id="asfr__eff_8c_html_affe50edf965ec43e0c4bb2591d5f1d91"><div class="ttname"><a href="sfr__eff_8c.html#affe50edf965ec43e0c4bb2591d5f1d91">get_sfr_factor_due_to_h2</a></div><div class="ttdeci">static double get_sfr_factor_due_to_h2(int i, MyFloat *GradRho, const double atime)</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00973">sfr_eff.c:973</a></div></div>
<div class="ttc" id="asfr__eff_8h_html_ab842fea564dc8ca2101c3bb43fab2ba1a3c3314c2c3e12bd32982499ef7c98904"><div class="ttname"><a href="sfr__eff_8h.html#ab842fea564dc8ca2101c3bb43fab2ba1a3c3314c2c3e12bd32982499ef7c98904">SFR_CRITERION_MOLECULAR_H2</a></div><div class="ttdeci">@ SFR_CRITERION_MOLECULAR_H2</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8h_source.html#l00018">sfr_eff.h:18</a></div></div>
<div class="ttc" id="asfr__eff_8h_html_ab842fea564dc8ca2101c3bb43fab2ba1ab9d87d5c819540d1b2734ec31750c181"><div class="ttname"><a href="sfr__eff_8h.html#ab842fea564dc8ca2101c3bb43fab2ba1ab9d87d5c819540d1b2734ec31750c181">SFR_CRITERION_SELFGRAVITY</a></div><div class="ttdeci">@ SFR_CRITERION_SELFGRAVITY</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8h_source.html#l00019">sfr_eff.h:19</a></div></div>
<div class="ttc" id="astructsfr__eeqos__data_html_a6c1ea23e04b1b4a56b51b142e6ccfb81"><div class="ttname"><a href="structsfr__eeqos__data.html#a6c1ea23e04b1b4a56b51b142e6ccfb81">sfr_eeqos_data::tsfr</a></div><div class="ttdeci">double tsfr</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00098">sfr_eff.c:98</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="sfr__eff_8c_source.html#l00104">sfr_eeqos_data::cloudfrac</a>, <a class="el" href="endrun_8c_source.html#l00147">endrun()</a>, <a class="el" href="sfr__eff_8c_source.html#l00048">SFRParams::FactorSN</a>, <a class="el" href="sfr__eff_8c_source.html#l00973">get_sfr_factor_due_to_h2()</a>, <a class="el" href="sfr__eff_8c_source.html#l00997">get_sfr_factor_due_to_selfgravity()</a>, <a class="el" href="types_8h_source.html#l00022">HAS</a>, <a class="el" href="partmanager_8h_source.html#l00088">P</a>, <a class="el" href="sfr__eff_8h_source.html#l00018">SFR_CRITERION_MOLECULAR_H2</a>, <a class="el" href="sfr__eff_8h_source.html#l00019">SFR_CRITERION_SELFGRAVITY</a>, <a class="el" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>, <a class="el" href="sfr__eff_8c_source.html#l00486">sfreff_on_eeqos()</a>, <a class="el" href="slotsmanager_8h_source.html#l00124">SPHP</a>, <a class="el" href="sfr__eff_8c_source.html#l00040">SFRParams::StarformationCriterion</a>, and <a class="el" href="sfr__eff_8c_source.html#l00098">sfr_eeqos_data::tsfr</a>.</p>

<p class="reference">Referenced by <a class="el" href="sfr__eff_8c_source.html#l00722">get_sfr_eeqos()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_a5cfa7b95c20ca76682274d0dc17e3c66_cgraph.svg" width="2271" height="1012"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_a5cfa7b95c20ca76682274d0dc17e3c66_icgraph.svg" width="1151" height="256"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a17ba6f2251e04bc57005d00cc09640c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17ba6f2251e04bc57005d00cc09640c8">&#9670;&nbsp;</a></span>init_cooling_and_star_formation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init_cooling_and_star_formation </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>CoolingOn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>StarformationOn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structCosmology.html">Cosmology</a> *&#160;</td>
          <td class="paramname"><em>CP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>avg_baryon_mass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>BoxSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structUnitSystem.html">UnitSystem</a>&#160;</td>
          <td class="paramname"><em>units</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00805">805</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;{</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keyword">struct </span><a class="code" href="structcooling__units.html">cooling_units</a> <a class="code" href="cooling_8c.html#ab61ac947b35fafcb19fc2717d7925d9e">coolunits</a>;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <a class="code" href="cooling_8c.html#ab61ac947b35fafcb19fc2717d7925d9e">coolunits</a>.<a class="code" href="structcooling__units.html#a391226210f3bbf5cf1f8711dea5fbcff">CoolingOn</a> = <a class="code" href="structcooling__units.html#a391226210f3bbf5cf1f8711dea5fbcff">CoolingOn</a>;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <a class="code" href="cooling_8c.html#ab61ac947b35fafcb19fc2717d7925d9e">coolunits</a>.<a class="code" href="structcooling__units.html#a4e7fcb9d92af681c076ec9c5d40c0d5e">density_in_phys_cgs</a> = units.<a class="code" href="structUnitSystem.html#ae3a46a3844ef8aa07ac2091c55bae340">UnitDensity_in_cgs</a> * <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#a4b79dcaa1e1c38d07258c3f539e2cb20">HubbleParam</a> * <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#a4b79dcaa1e1c38d07258c3f539e2cb20">HubbleParam</a>;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <a class="code" href="cooling_8c.html#ab61ac947b35fafcb19fc2717d7925d9e">coolunits</a>.<a class="code" href="structcooling__units.html#ac89fefc3f9166c37239805d7b2e3faca">uu_in_cgs</a> = units.<a class="code" href="structUnitSystem.html#a3ebe1ddf4cba3793bcf24181184ff418">UnitInternalEnergy_in_cgs</a>;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <a class="code" href="cooling_8c.html#ab61ac947b35fafcb19fc2717d7925d9e">coolunits</a>.<a class="code" href="structcooling__units.html#abbbde322027c927b99b97848acf86f3a">tt_in_s</a> = units.<a class="code" href="structUnitSystem.html#aa1bfcc4e49209e38d8e77996d294db6d">UnitTime_in_s</a> / <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#a4b79dcaa1e1c38d07258c3f539e2cb20">HubbleParam</a>;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="comment">/* Get mean cosmic baryon density for photoheating rate from long mean free path photons */</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <a class="code" href="cooling_8c.html#ab61ac947b35fafcb19fc2717d7925d9e">coolunits</a>.<a class="code" href="structcooling__units.html#a31974c33d0606bad52d795b6c8210010">rho_crit_baryon</a> = 3 * pow(<a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#a4b79dcaa1e1c38d07258c3f539e2cb20">HubbleParam</a> * <a class="code" href="physconst_8h.html#a5de72d8762faf787d06d4dd47daeddeb">HUBBLE</a>,2) * <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#ac818659114fd72f09039b088e43e8624">OmegaBaryon</a> / (8 * M_PI * <a class="code" href="physconst_8h.html#a6801baa546c6112d19eb095111d24720">GRAVITY</a>);</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160; </div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a5173127552b049a6104298f5cf2317c2">temp_to_u</a> = (1.0 / <a class="code" href="physconst_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a>) * (<a class="code" href="physconst_8h.html#aa1487dae81baa2e0a5643e7b571633a0">BOLTZMANN</a> / <a class="code" href="physconst_8h.html#a7e6cfbe5535ec2470a672abeba3fcd4d">PROTONMASS</a>) / units.<a class="code" href="structUnitSystem.html#a3ebe1ddf4cba3793bcf24181184ff418">UnitInternalEnergy_in_cgs</a>;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160; </div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a4f73d6b7178f89196effe799512cfa1e">UnitSfr_in_solar_per_year</a> = (units.<a class="code" href="structUnitSystem.html#a24a8ba09b3be1b3ca429d6bc123d40ab">UnitMass_in_g</a> / <a class="code" href="physconst_8h.html#a6321c9a4f727494edf637f2c5559af44">SOLAR_MASS</a>) / (units.<a class="code" href="structUnitSystem.html#aa1bfcc4e49209e38d8e77996d294db6d">UnitTime_in_s</a> / <a class="code" href="physconst_8h.html#a8cd8e04105fec7cd442d078c303e46b9">SEC_PER_YEAR</a>);</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160; </div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <a class="code" href="cooling_8c.html#a17345bafab1e456c8ec9eda0d8c2a3f6">init_cooling</a>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#abc8e43fe5dc6f83a149358663b7799de">TreeCoolFile</a>, <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a692a90bd49e8067e6ad169b4573a82fd">MetalCoolFile</a>, <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a97addb13e58685dbc9e6894fdcf0f92c">ReionHistFile</a>, <a class="code" href="cooling_8c.html#ab61ac947b35fafcb19fc2717d7925d9e">coolunits</a>, <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>);</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160; </div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="structcooling__units.html#a391226210f3bbf5cf1f8711dea5fbcff">CoolingOn</a>)</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160; </div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="comment">/*Initialize the uv fluctuation table*/</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <a class="code" href="cooling_8h.html#a92fbf2911ebf6d8f63203b09bb2079a2">init_uvf_table</a>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a503155d11569c2ebf2d40428583eabf8">UVFluctuationFile</a>, <span class="keyword">sizeof</span>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a503155d11569c2ebf2d40428583eabf8">UVFluctuationFile</a>), BoxSize, units.<a class="code" href="structUnitSystem.html#ac9bf5677cfdf7a47b50d40a7e975941b">UnitLength_in_cm</a>);</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160; </div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a2694f130b78888ed2a49aa30181b0bcf">StarformationOn</a> = StarformationOn;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160; </div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="keywordflow">if</span>(!StarformationOn)</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160; </div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#acebdc3bbe3b18772a854b12ddb3b53b4">avg_baryon_mass</a> = avg_baryon_mass;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160; </div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a9af92cded51df7bb763f8638186fbcb4">tau_fmol_unit</a> = units.<a class="code" href="structUnitSystem.html#ae3a46a3844ef8aa07ac2091c55bae340">UnitDensity_in_cgs</a>*<a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#a4b79dcaa1e1c38d07258c3f539e2cb20">HubbleParam</a>*units.<a class="code" href="structUnitSystem.html#ac9bf5677cfdf7a47b50d40a7e975941b">UnitLength_in_cm</a>;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a98cc56490d039123bd27e01b3717c005">OverDensThresh</a> =</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a4d864f42486060a96daed3365d10db46">CritOverDensity</a> * <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#ac818659114fd72f09039b088e43e8624">OmegaBaryon</a> * 3 * <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#af1c6029696c00e5405054f00e849e972">Hubble</a> * <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#af1c6029696c00e5405054f00e849e972">Hubble</a> / (8 * M_PI * <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#a0970aac048f04a9ccd8778aaf07a0bbc">GravInternal</a>);</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160; </div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a287cf4dfed60a4b9aecef1c74815519d">PhysDensThresh</a> = <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#ad6f6acd4daaa5517cd90fcde2a574575">CritPhysDensity</a> * <a class="code" href="physconst_8h.html#a7e6cfbe5535ec2470a672abeba3fcd4d">PROTONMASS</a> / <a class="code" href="physconst_8h.html#a67abaa49a5aa2892eba705d380652279">HYDROGEN_MASSFRAC</a> / units.<a class="code" href="structUnitSystem.html#ae3a46a3844ef8aa07ac2091c55bae340">UnitDensity_in_cgs</a>;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160; </div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="comment">/* mean molecular weight assuming ZERO ionization NEUTRAL GAS*/</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <span class="keywordtype">double</span> meanweight = 4.0 / (1 + 3 * <a class="code" href="physconst_8h.html#a67abaa49a5aa2892eba705d380652279">HYDROGEN_MASSFRAC</a>);</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a7ee644d6ec675488c665b4e84c8b2cd2">EgySpecCold</a> = (<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a5173127552b049a6104298f5cf2317c2">temp_to_u</a>/meanweight) * <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aa69d29b5787a2a504a02557d94a37a7b">TempClouds</a>;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160; </div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <span class="comment">/* mean molecular weight assuming FULL ionization */</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    meanweight = 4 / (8 - 5 * (1 - <a class="code" href="physconst_8h.html#a67abaa49a5aa2892eba705d380652279">HYDROGEN_MASSFRAC</a>));</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aa8019313a01afd6d8e9054867d6a42b4">EgySpecSN</a> = <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a5173127552b049a6104298f5cf2317c2">temp_to_u</a>/meanweight * <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a04bc261e26369e111e499967de60d0c3">TempSupernova</a>;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160; </div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a287cf4dfed60a4b9aecef1c74815519d">PhysDensThresh</a> == 0)</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    {</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <span class="keywordtype">double</span> egyhot = <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aa8019313a01afd6d8e9054867d6a42b4">EgySpecSN</a> / <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a9bc0ca836eb6db5b6545ef8a3c6555e5">FactorEVP</a>;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160; </div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        meanweight = 4 / (8 - 5 * (1 - <a class="code" href="physconst_8h.html#a67abaa49a5aa2892eba705d380652279">HYDROGEN_MASSFRAC</a>)); <span class="comment">/* note: assuming FULL ionization */</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160; </div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        <span class="keywordtype">double</span> u4 = <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a5173127552b049a6104298f5cf2317c2">temp_to_u</a>/meanweight * 1.0e4;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160; </div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        <span class="keywordtype">double</span> dens = 1.0e6 * 3 * <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#af1c6029696c00e5405054f00e849e972">Hubble</a> * <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#af1c6029696c00e5405054f00e849e972">Hubble</a> / (8 * M_PI * <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#a0970aac048f04a9ccd8778aaf07a0bbc">GravInternal</a>);</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160; </div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        <span class="keywordtype">double</span> ne = 1.0;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160; </div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        <span class="keyword">struct </span><a class="code" href="structUVBG.html">UVBG</a> uvbg = {0};</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <span class="comment">/*XXX: We set the threshold without metal cooling</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="comment">         * and with zero ionization at z=0.</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="comment">         * It probably make sense to set the parameters with</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="comment">         * a metalicity dependence.</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="comment">         * */</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> tcool = <a class="code" href="cooling_8c.html#a2cb008d71b53fcb66c3596042453bdb8">GetCoolingTime</a>(0, egyhot, dens, &amp;uvbg, &amp;ne, 0.0);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160; </div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> coolrate = egyhot / tcool / dens;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160; </div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> x = (egyhot - u4) / (egyhot - <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a7ee644d6ec675488c665b4e84c8b2cd2">EgySpecCold</a>);</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160; </div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a287cf4dfed60a4b9aecef1c74815519d">PhysDensThresh</a> =</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            x / pow(1 - x,</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                    2) * (<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#ab2746a80290d4849001b730e8b8a5956">FactorSN</a> * <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aa8019313a01afd6d8e9054867d6a42b4">EgySpecSN</a> - (1 -</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                            <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#ab2746a80290d4849001b730e8b8a5956">FactorSN</a>) * <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a7ee644d6ec675488c665b4e84c8b2cd2">EgySpecCold</a>) /</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                        (<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a02fdfce08943fa87ae7a618d4ed61f42">MaxSfrTimescale</a> * coolrate);</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160; </div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;A0= %g  \n&quot;</span>, <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a9bc0ca836eb6db5b6545ef8a3c6555e5">FactorEVP</a>);</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;Computed: PhysDensThresh= %g  (int units)         %g h^2 cm^-3\n&quot;</span>, <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a287cf4dfed60a4b9aecef1c74815519d">PhysDensThresh</a>,</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a287cf4dfed60a4b9aecef1c74815519d">PhysDensThresh</a> / (<a class="code" href="physconst_8h.html#a7e6cfbe5535ec2470a672abeba3fcd4d">PROTONMASS</a> / <a class="code" href="physconst_8h.html#a67abaa49a5aa2892eba705d380652279">HYDROGEN_MASSFRAC</a> / units.<a class="code" href="structUnitSystem.html#ae3a46a3844ef8aa07ac2091c55bae340">UnitDensity_in_cgs</a>));</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;EXPECTED FRACTION OF COLD GAS AT THRESHOLD = %g\n&quot;</span>, x);</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;tcool=%g dens=%g egyhot=%g\n&quot;</span>, tcool, dens, egyhot);</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160; </div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        dens = <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a287cf4dfed60a4b9aecef1c74815519d">PhysDensThresh</a> * 10;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160; </div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        <span class="keywordtype">double</span> neff;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <span class="keywordflow">do</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        {</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;            <span class="keywordtype">double</span> egyeff = <a class="code" href="sfr__eff_8c.html#a054be999a15e37a4d4d9b8dde836f287">get_egyeff</a>(0, dens, &amp;uvbg);</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160; </div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;            <span class="keywordtype">double</span> peff = <a class="code" href="physconst_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a> * dens * egyeff;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160; </div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> fac = 1 / (log(dens * 1.025) - log(dens));</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;            neff = -log(peff) * fac;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160; </div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;            dens *= 1.025;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;            egyeff = <a class="code" href="sfr__eff_8c.html#a054be999a15e37a4d4d9b8dde836f287">get_egyeff</a>(0, dens, &amp;uvbg);</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            peff = <a class="code" href="physconst_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a> * dens * egyeff;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160; </div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            neff += log(peff) * fac;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        }</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        <span class="keywordflow">while</span>(neff &gt; 4.0 / 3);</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160; </div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;Run-away sets in for dens=%g\n&quot;</span>, dens);</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;Dynamic range for quiescent star formation= %g\n&quot;</span>, dens / <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a287cf4dfed60a4b9aecef1c74815519d">PhysDensThresh</a>);</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160; </div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="densitykernel_8c.html#ae1ef058cb2030082c121b8226a7dab57">sigma</a> = 10.0 / <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#af1c6029696c00e5405054f00e849e972">Hubble</a> * 1.0e-10 / pow(1.0e-3, 2);</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160; </div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;Isotherm sheet central density: %g   z0=%g\n&quot;</span>,</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                M_PI * <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#a0970aac048f04a9ccd8778aaf07a0bbc">GravInternal</a> * <a class="code" href="densitykernel_8c.html#ae1ef058cb2030082c121b8226a7dab57">sigma</a> * <a class="code" href="densitykernel_8c.html#ae1ef058cb2030082c121b8226a7dab57">sigma</a> / (2 * <a class="code" href="physconst_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a>) / u4,</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                <a class="code" href="physconst_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a> * u4 / (2 * M_PI * <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#a0970aac048f04a9ccd8778aaf07a0bbc">GravInternal</a> * <a class="code" href="densitykernel_8c.html#ae1ef058cb2030082c121b8226a7dab57">sigma</a>));</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    }</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160; </div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#acc35d766de8266c3fb4686b33820a2df">WindOn</a>) {</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        <a class="code" href="winds_8c.html#af3d7ddd5775b76d4edc8efd44afd25ae">init_winds</a>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#ab2746a80290d4849001b730e8b8a5956">FactorSN</a>, <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aa8019313a01afd6d8e9054867d6a42b4">EgySpecSN</a>, <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a287cf4dfed60a4b9aecef1c74815519d">PhysDensThresh</a>, units.<a class="code" href="structUnitSystem.html#aa1bfcc4e49209e38d8e77996d294db6d">UnitTime_in_s</a>);</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    }</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160; </div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;}</div>
<div class="ttc" id="acooling_8c_html_a17345bafab1e456c8ec9eda0d8c2a3f6"><div class="ttname"><a href="cooling_8c.html#a17345bafab1e456c8ec9eda0d8c2a3f6">init_cooling</a></div><div class="ttdeci">void init_cooling(const char *TreeCoolFile, const char *MetalCoolFile, char *reion_hist_file, struct cooling_units cu, Cosmology *CP)</div><div class="ttdef"><b>Definition:</b> <a href="cooling_8c_source.html#l00036">cooling.c:36</a></div></div>
<div class="ttc" id="acooling_8c_html_ab61ac947b35fafcb19fc2717d7925d9e"><div class="ttname"><a href="cooling_8c.html#ab61ac947b35fafcb19fc2717d7925d9e">coolunits</a></div><div class="ttdeci">static struct cooling_units coolunits</div><div class="ttdef"><b>Definition:</b> <a href="cooling_8c_source.html#l00001">cooling.c:33</a></div></div>
<div class="ttc" id="acooling_8h_html_a92fbf2911ebf6d8f63203b09bb2079a2"><div class="ttname"><a href="cooling_8h.html#a92fbf2911ebf6d8f63203b09bb2079a2">init_uvf_table</a></div><div class="ttdeci">void init_uvf_table(const char *UVFluctuationFile, const int UVFlucLen, const double BoxSize, const double UnitLength_in_cm)</div><div class="ttdef"><b>Definition:</b> <a href="cooling__uvfluc_8c_source.html#l00091">cooling_uvfluc.c:91</a></div></div>
<div class="ttc" id="adensitykernel_8c_html_ae1ef058cb2030082c121b8226a7dab57"><div class="ttname"><a href="densitykernel_8c.html#ae1ef058cb2030082c121b8226a7dab57">sigma</a></div><div class="ttdeci">double sigma[3]</div><div class="ttdef"><b>Definition:</b> <a href="densitykernel_8c_source.html#l00097">densitykernel.c:97</a></div></div>
<div class="ttc" id="aphysconst_8h_html_a5de72d8762faf787d06d4dd47daeddeb"><div class="ttname"><a href="physconst_8h.html#a5de72d8762faf787d06d4dd47daeddeb">HUBBLE</a></div><div class="ttdeci">#define HUBBLE</div><div class="ttdef"><b>Definition:</b> <a href="physconst_8h_source.html#l00025">physconst.h:25</a></div></div>
<div class="ttc" id="aphysconst_8h_html_a6321c9a4f727494edf637f2c5559af44"><div class="ttname"><a href="physconst_8h.html#a6321c9a4f727494edf637f2c5559af44">SOLAR_MASS</a></div><div class="ttdeci">#define SOLAR_MASS</div><div class="ttdef"><b>Definition:</b> <a href="physconst_8h_source.html#l00006">physconst.h:6</a></div></div>
<div class="ttc" id="aphysconst_8h_html_a6801baa546c6112d19eb095111d24720"><div class="ttname"><a href="physconst_8h.html#a6801baa546c6112d19eb095111d24720">GRAVITY</a></div><div class="ttdeci">#define GRAVITY</div><div class="ttdef"><b>Definition:</b> <a href="physconst_8h_source.html#l00005">physconst.h:5</a></div></div>
<div class="ttc" id="aphysconst_8h_html_a7e6cfbe5535ec2470a672abeba3fcd4d"><div class="ttname"><a href="physconst_8h.html#a7e6cfbe5535ec2470a672abeba3fcd4d">PROTONMASS</a></div><div class="ttdeci">#define PROTONMASS</div><div class="ttdef"><b>Definition:</b> <a href="physconst_8h_source.html#l00021">physconst.h:21</a></div></div>
<div class="ttc" id="aphysconst_8h_html_a8cd8e04105fec7cd442d078c303e46b9"><div class="ttname"><a href="physconst_8h.html#a8cd8e04105fec7cd442d078c303e46b9">SEC_PER_YEAR</a></div><div class="ttdeci">#define SEC_PER_YEAR</div><div class="ttdef"><b>Definition:</b> <a href="physconst_8h_source.html#l00032">physconst.h:32</a></div></div>
<div class="ttc" id="aphysconst_8h_html_aa1487dae81baa2e0a5643e7b571633a0"><div class="ttname"><a href="physconst_8h.html#aa1487dae81baa2e0a5643e7b571633a0">BOLTZMANN</a></div><div class="ttdeci">#define BOLTZMANN</div><div class="ttdef"><b>Definition:</b> <a href="physconst_8h_source.html#l00011">physconst.h:11</a></div></div>
<div class="ttc" id="asfr__eff_8c_html_a054be999a15e37a4d4d9b8dde836f287"><div class="ttname"><a href="sfr__eff_8c.html#a054be999a15e37a4d4d9b8dde836f287">get_egyeff</a></div><div class="ttdeci">static double get_egyeff(double redshift, double dens, struct UVBG *uvbg)</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00782">sfr_eff.c:782</a></div></div>
<div class="ttc" id="astructCosmology_html_a4b79dcaa1e1c38d07258c3f539e2cb20"><div class="ttname"><a href="structCosmology.html#a4b79dcaa1e1c38d07258c3f539e2cb20">Cosmology::HubbleParam</a></div><div class="ttdeci">double HubbleParam</div><div class="ttdef"><b>Definition:</b> <a href="cosmology_8h_source.html#l00020">cosmology.h:20</a></div></div>
<div class="ttc" id="astructCosmology_html_ac818659114fd72f09039b088e43e8624"><div class="ttname"><a href="structCosmology.html#ac818659114fd72f09039b088e43e8624">Cosmology::OmegaBaryon</a></div><div class="ttdeci">double OmegaBaryon</div><div class="ttdef"><b>Definition:</b> <a href="cosmology_8h_source.html#l00019">cosmology.h:19</a></div></div>
<div class="ttc" id="astructCosmology_html_af1c6029696c00e5405054f00e849e972"><div class="ttname"><a href="structCosmology.html#af1c6029696c00e5405054f00e849e972">Cosmology::Hubble</a></div><div class="ttdeci">double Hubble</div><div class="ttdef"><b>Definition:</b> <a href="cosmology_8h_source.html#l00021">cosmology.h:21</a></div></div>
<div class="ttc" id="astructSFRParams_html_a04bc261e26369e111e499967de60d0c3"><div class="ttname"><a href="structSFRParams.html#a04bc261e26369e111e499967de60d0c3">SFRParams::TempSupernova</a></div><div class="ttdeci">double TempSupernova</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00052">sfr_eff.c:52</a></div></div>
<div class="ttc" id="astructSFRParams_html_a4d864f42486060a96daed3365d10db46"><div class="ttname"><a href="structSFRParams.html#a4d864f42486060a96daed3365d10db46">SFRParams::CritOverDensity</a></div><div class="ttdeci">double CritOverDensity</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00043">sfr_eff.c:43</a></div></div>
<div class="ttc" id="astructSFRParams_html_a503155d11569c2ebf2d40428583eabf8"><div class="ttname"><a href="structSFRParams.html#a503155d11569c2ebf2d40428583eabf8">SFRParams::UVFluctuationFile</a></div><div class="ttdeci">char UVFluctuationFile[100]</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00082">sfr_eff.c:82</a></div></div>
<div class="ttc" id="astructSFRParams_html_a692a90bd49e8067e6ad169b4573a82fd"><div class="ttname"><a href="structSFRParams.html#a692a90bd49e8067e6ad169b4573a82fd">SFRParams::MetalCoolFile</a></div><div class="ttdeci">char MetalCoolFile[100]</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00081">sfr_eff.c:81</a></div></div>
<div class="ttc" id="astructSFRParams_html_a97addb13e58685dbc9e6894fdcf0f92c"><div class="ttname"><a href="structSFRParams.html#a97addb13e58685dbc9e6894fdcf0f92c">SFRParams::ReionHistFile</a></div><div class="ttdeci">char ReionHistFile[100]</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00084">sfr_eff.c:84</a></div></div>
<div class="ttc" id="astructSFRParams_html_a98cc56490d039123bd27e01b3717c005"><div class="ttname"><a href="structSFRParams.html#a98cc56490d039123bd27e01b3717c005">SFRParams::OverDensThresh</a></div><div class="ttdeci">double OverDensThresh</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00045">sfr_eff.c:45</a></div></div>
<div class="ttc" id="astructSFRParams_html_aa69d29b5787a2a504a02557d94a37a7b"><div class="ttname"><a href="structSFRParams.html#aa69d29b5787a2a504a02557d94a37a7b">SFRParams::TempClouds</a></div><div class="ttdeci">double TempClouds</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00053">sfr_eff.c:53</a></div></div>
<div class="ttc" id="astructSFRParams_html_abc8e43fe5dc6f83a149358663b7799de"><div class="ttname"><a href="structSFRParams.html#abc8e43fe5dc6f83a149358663b7799de">SFRParams::TreeCoolFile</a></div><div class="ttdeci">char TreeCoolFile[100]</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00080">sfr_eff.c:80</a></div></div>
<div class="ttc" id="astructSFRParams_html_acebdc3bbe3b18772a854b12ddb3b53b4"><div class="ttname"><a href="structSFRParams.html#acebdc3bbe3b18772a854b12ddb3b53b4">SFRParams::avg_baryon_mass</a></div><div class="ttdeci">double avg_baryon_mass</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00067">sfr_eff.c:67</a></div></div>
<div class="ttc" id="astructSFRParams_html_ad6f6acd4daaa5517cd90fcde2a574575"><div class="ttname"><a href="structSFRParams.html#ad6f6acd4daaa5517cd90fcde2a574575">SFRParams::CritPhysDensity</a></div><div class="ttdeci">double CritPhysDensity</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00044">sfr_eff.c:44</a></div></div>
<div class="ttc" id="astructUnitSystem_html_a24a8ba09b3be1b3ca429d6bc123d40ab"><div class="ttname"><a href="structUnitSystem.html#a24a8ba09b3be1b3ca429d6bc123d40ab">UnitSystem::UnitMass_in_g</a></div><div class="ttdeci">double UnitMass_in_g</div><div class="ttdef"><b>Definition:</b> <a href="unitsystem_8h_source.html#l00008">unitsystem.h:8</a></div></div>
<div class="ttc" id="astructUnitSystem_html_a3ebe1ddf4cba3793bcf24181184ff418"><div class="ttname"><a href="structUnitSystem.html#a3ebe1ddf4cba3793bcf24181184ff418">UnitSystem::UnitInternalEnergy_in_cgs</a></div><div class="ttdeci">double UnitInternalEnergy_in_cgs</div><div class="ttdef"><b>Definition:</b> <a href="unitsystem_8h_source.html#l00014">unitsystem.h:14</a></div></div>
<div class="ttc" id="astructUnitSystem_html_aa1bfcc4e49209e38d8e77996d294db6d"><div class="ttname"><a href="structUnitSystem.html#aa1bfcc4e49209e38d8e77996d294db6d">UnitSystem::UnitTime_in_s</a></div><div class="ttdeci">double UnitTime_in_s</div><div class="ttdef"><b>Definition:</b> <a href="unitsystem_8h_source.html#l00011">unitsystem.h:11</a></div></div>
<div class="ttc" id="astructUnitSystem_html_ac9bf5677cfdf7a47b50d40a7e975941b"><div class="ttname"><a href="structUnitSystem.html#ac9bf5677cfdf7a47b50d40a7e975941b">UnitSystem::UnitLength_in_cm</a></div><div class="ttdeci">double UnitLength_in_cm</div><div class="ttdef"><b>Definition:</b> <a href="unitsystem_8h_source.html#l00010">unitsystem.h:10</a></div></div>
<div class="ttc" id="astructUnitSystem_html_ae3a46a3844ef8aa07ac2091c55bae340"><div class="ttname"><a href="structUnitSystem.html#ae3a46a3844ef8aa07ac2091c55bae340">UnitSystem::UnitDensity_in_cgs</a></div><div class="ttdeci">double UnitDensity_in_cgs</div><div class="ttdef"><b>Definition:</b> <a href="unitsystem_8h_source.html#l00012">unitsystem.h:12</a></div></div>
<div class="ttc" id="astructcooling__units_html"><div class="ttname"><a href="structcooling__units.html">cooling_units</a></div><div class="ttdef"><b>Definition:</b> <a href="cooling_8h_source.html#l00020">cooling.h:21</a></div></div>
<div class="ttc" id="astructcooling__units_html_a31974c33d0606bad52d795b6c8210010"><div class="ttname"><a href="structcooling__units.html#a31974c33d0606bad52d795b6c8210010">cooling_units::rho_crit_baryon</a></div><div class="ttdeci">double rho_crit_baryon</div><div class="ttdef"><b>Definition:</b> <a href="cooling_8h_source.html#l00031">cooling.h:31</a></div></div>
<div class="ttc" id="astructcooling__units_html_a391226210f3bbf5cf1f8711dea5fbcff"><div class="ttname"><a href="structcooling__units.html#a391226210f3bbf5cf1f8711dea5fbcff">cooling_units::CoolingOn</a></div><div class="ttdeci">int CoolingOn</div><div class="ttdef"><b>Definition:</b> <a href="cooling_8h_source.html#l00023">cooling.h:23</a></div></div>
<div class="ttc" id="astructcooling__units_html_a4e7fcb9d92af681c076ec9c5d40c0d5e"><div class="ttname"><a href="structcooling__units.html#a4e7fcb9d92af681c076ec9c5d40c0d5e">cooling_units::density_in_phys_cgs</a></div><div class="ttdeci">double density_in_phys_cgs</div><div class="ttdef"><b>Definition:</b> <a href="cooling_8h_source.html#l00025">cooling.h:25</a></div></div>
<div class="ttc" id="astructcooling__units_html_abbbde322027c927b99b97848acf86f3a"><div class="ttname"><a href="structcooling__units.html#abbbde322027c927b99b97848acf86f3a">cooling_units::tt_in_s</a></div><div class="ttdeci">double tt_in_s</div><div class="ttdef"><b>Definition:</b> <a href="cooling_8h_source.html#l00029">cooling.h:29</a></div></div>
<div class="ttc" id="astructcooling__units_html_ac89fefc3f9166c37239805d7b2e3faca"><div class="ttname"><a href="structcooling__units.html#ac89fefc3f9166c37239805d7b2e3faca">cooling_units::uu_in_cgs</a></div><div class="ttdeci">double uu_in_cgs</div><div class="ttdef"><b>Definition:</b> <a href="cooling_8h_source.html#l00027">cooling.h:27</a></div></div>
<div class="ttc" id="awinds_8c_html_af3d7ddd5775b76d4edc8efd44afd25ae"><div class="ttname"><a href="winds_8c.html#af3d7ddd5775b76d4edc8efd44afd25ae">init_winds</a></div><div class="ttdeci">void init_winds(double FactorSN, double EgySpecSN, double PhysDensThresh, double UnitTime_in_s)</div><div class="ttdef"><b>Definition:</b> <a href="winds_8c_source.html#l00097">winds.c:97</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="sfr__eff_8c_source.html#l00067">SFRParams::avg_baryon_mass</a>, <a class="el" href="physconst_8h_source.html#l00011">BOLTZMANN</a>, <a class="el" href="cooling_8h_source.html#l00023">cooling_units::CoolingOn</a>, <a class="el" href="cooling_8c_source.html#l00033">coolunits</a>, <a class="el" href="power_8c_source.html#l00027">CP</a>, <a class="el" href="sfr__eff_8c_source.html#l00043">SFRParams::CritOverDensity</a>, <a class="el" href="sfr__eff_8c_source.html#l00044">SFRParams::CritPhysDensity</a>, <a class="el" href="cooling_8h_source.html#l00025">cooling_units::density_in_phys_cgs</a>, <a class="el" href="sfr__eff_8c_source.html#l00049">SFRParams::EgySpecCold</a>, <a class="el" href="sfr__eff_8c_source.html#l00047">SFRParams::EgySpecSN</a>, <a class="el" href="sfr__eff_8c_source.html#l00050">SFRParams::FactorEVP</a>, <a class="el" href="sfr__eff_8c_source.html#l00048">SFRParams::FactorSN</a>, <a class="el" href="physconst_8h_source.html#l00035">GAMMA_MINUS1</a>, <a class="el" href="sfr__eff_8c_source.html#l00782">get_egyeff()</a>, <a class="el" href="cooling_8c_source.html#l00157">GetCoolingTime()</a>, <a class="el" href="cosmology_8h_source.html#l00032">Cosmology::GravInternal</a>, <a class="el" href="physconst_8h_source.html#l00005">GRAVITY</a>, <a class="el" href="cosmology_8h_source.html#l00021">Cosmology::Hubble</a>, <a class="el" href="physconst_8h_source.html#l00025">HUBBLE</a>, <a class="el" href="cosmology_8h_source.html#l00020">Cosmology::HubbleParam</a>, <a class="el" href="physconst_8h_source.html#l00037">HYDROGEN_MASSFRAC</a>, <a class="el" href="cooling_8c_source.html#l00036">init_cooling()</a>, <a class="el" href="cooling__uvfluc_8c_source.html#l00091">init_uvf_table()</a>, <a class="el" href="winds_8c_source.html#l00097">init_winds()</a>, <a class="el" href="sfr__eff_8c_source.html#l00054">SFRParams::MaxSfrTimescale</a>, <a class="el" href="endrun_8c_source.html#l00175">message()</a>, <a class="el" href="sfr__eff_8c_source.html#l00081">SFRParams::MetalCoolFile</a>, <a class="el" href="cosmology_8h_source.html#l00019">Cosmology::OmegaBaryon</a>, <a class="el" href="sfr__eff_8c_source.html#l00045">SFRParams::OverDensThresh</a>, <a class="el" href="sfr__eff_8c_source.html#l00046">SFRParams::PhysDensThresh</a>, <a class="el" href="physconst_8h_source.html#l00021">PROTONMASS</a>, <a class="el" href="sfr__eff_8c_source.html#l00084">SFRParams::ReionHistFile</a>, <a class="el" href="cooling_8h_source.html#l00031">cooling_units::rho_crit_baryon</a>, <a class="el" href="physconst_8h_source.html#l00032">SEC_PER_YEAR</a>, <a class="el" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>, <a class="el" href="densitykernel_8c_source.html#l00097">sigma</a>, <a class="el" href="physconst_8h_source.html#l00006">SOLAR_MASS</a>, <a class="el" href="sfr__eff_8c_source.html#l00039">SFRParams::StarformationOn</a>, <a class="el" href="sfr__eff_8c_source.html#l00060">SFRParams::tau_fmol_unit</a>, <a class="el" href="sfr__eff_8c_source.html#l00070">SFRParams::temp_to_u</a>, <a class="el" href="sfr__eff_8c_source.html#l00053">SFRParams::TempClouds</a>, <a class="el" href="sfr__eff_8c_source.html#l00052">SFRParams::TempSupernova</a>, <a class="el" href="sfr__eff_8c_source.html#l00080">SFRParams::TreeCoolFile</a>, <a class="el" href="cooling_8h_source.html#l00029">cooling_units::tt_in_s</a>, <a class="el" href="unitsystem_8h_source.html#l00012">UnitSystem::UnitDensity_in_cgs</a>, <a class="el" href="unitsystem_8h_source.html#l00014">UnitSystem::UnitInternalEnergy_in_cgs</a>, <a class="el" href="unitsystem_8h_source.html#l00010">UnitSystem::UnitLength_in_cm</a>, <a class="el" href="unitsystem_8h_source.html#l00008">UnitSystem::UnitMass_in_g</a>, <a class="el" href="sfr__eff_8c_source.html#l00072">SFRParams::UnitSfr_in_solar_per_year</a>, <a class="el" href="unitsystem_8h_source.html#l00011">UnitSystem::UnitTime_in_s</a>, <a class="el" href="cooling_8h_source.html#l00027">cooling_units::uu_in_cgs</a>, <a class="el" href="sfr__eff_8c_source.html#l00082">SFRParams::UVFluctuationFile</a>, and <a class="el" href="sfr__eff_8c_source.html#l00041">SFRParams::WindOn</a>.</p>

<p class="reference">Referenced by <a class="el" href="run_8c_source.html#l00194">begrun()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_a17ba6f2251e04bc57005d00cc09640c8_cgraph.svg" width="1806" height="1659"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_a17ba6f2251e04bc57005d00cc09640c8_icgraph.svg" width="388" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a537fdd1e25fad1d7245263ef47412790"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a537fdd1e25fad1d7245263ef47412790">&#9670;&nbsp;</a></span>make_particle_star()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int make_particle_star </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>child</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>placement</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00578">578</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;{</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keywordtype">int</span> retflag = 2;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[parent].Type != 0)</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(7772, <span class="stringliteral">&quot;Only gas forms stars, what&#39;s wrong?\n&quot;</span>);</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160; </div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="comment">/*Store the SPH particle slot properties, as the PI may be over-written</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">     *in slots_convert*/</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keyword">struct </span><a class="code" href="structsph__particle__data.html">sph_particle_data</a> oldslot = <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(parent);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160; </div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="comment">/*Convert the child slot to the new type.*/</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    child = <a class="code" href="slotsmanager_8c.html#ae6ac1b2e8f1b1588c2bc2fe2d3ba5cdc">slots_convert</a>(child, 4, placement, <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>, <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>);</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160; </div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="comment">/*Set properties*/</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(child).FormationTime = Time;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(child).LastEnrichmentMyr = 0;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(child).TotalMassReturned = 0;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(child).BirthDensity = oldslot.<a class="code" href="structsph__particle__data.html#a40e26648ca8d900ec500a36a5d876ed7">Density</a>;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="comment">/*Copy metallicity*/</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(child).Metallicity = oldslot.<a class="code" href="structsph__particle__data.html#ab564223ae792423129ffd27a8508b051">Metallicity</a>;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordtype">int</span> j;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordflow">for</span>(j = 0; j &lt; <a class="code" href="slotsmanager_8h.html#ad07d3b873121463218a991d53512e49b">NMETALS</a>; j++)</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(child).Metals[j] = oldslot.<a class="code" href="structsph__particle__data.html#ae18cc26efecda6750163b1617f12b333">Metals</a>[j];</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="keywordflow">return</span> retflag;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;}</div>
<div class="ttc" id="aslotsmanager_8c_html_ae6ac1b2e8f1b1588c2bc2fe2d3ba5cdc"><div class="ttname"><a href="slotsmanager_8c.html#ae6ac1b2e8f1b1588c2bc2fe2d3ba5cdc">slots_convert</a></div><div class="ttdeci">int slots_convert(int parent, int ptype, int placement, struct part_manager_type *pman, struct slots_manager_type *sman)</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8c_source.html#l00060">slotsmanager.c:60</a></div></div>
<div class="ttc" id="aslotsmanager_8h_html_a9dd255c01b21dd0eff9b32811421bfc8"><div class="ttname"><a href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a></div><div class="ttdeci">#define STARP(i)</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00126">slotsmanager.h:126</a></div></div>
<div class="ttc" id="aslotsmanager_8h_html_ad07d3b873121463218a991d53512e49b"><div class="ttname"><a href="slotsmanager_8h.html#ad07d3b873121463218a991d53512e49b">NMETALS</a></div><div class="ttdeci">#define NMETALS</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00060">slotsmanager.h:60</a></div></div>
<div class="ttc" id="astructsph__particle__data_html"><div class="ttname"><a href="structsph__particle__data.html">sph_particle_data</a></div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00079">slotsmanager.h:80</a></div></div>
<div class="ttc" id="astructsph__particle__data_html_ae18cc26efecda6750163b1617f12b333"><div class="ttname"><a href="structsph__particle__data.html#ae18cc26efecda6750163b1617f12b333">sph_particle_data::Metals</a></div><div class="ttdeci">float Metals[NMETALS]</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00108">slotsmanager.h:108</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="slotsmanager_8h_source.html#l00090">sph_particle_data::Density</a>, <a class="el" href="endrun_8c_source.html#l00147">endrun()</a>, <a class="el" href="slotsmanager_8h_source.html#l00107">sph_particle_data::Metallicity</a>, <a class="el" href="slotsmanager_8h_source.html#l00108">sph_particle_data::Metals</a>, <a class="el" href="slotsmanager_8h_source.html#l00060">NMETALS</a>, <a class="el" href="partmanager_8h_source.html#l00088">P</a>, <a class="el" href="partmanager_8c_source.html#l00011">PartManager</a>, <a class="el" href="slotsmanager_8c_source.html#l00060">slots_convert()</a>, <a class="el" href="slotsmanager_8c_source.html#l00007">SlotsManager</a>, <a class="el" href="slotsmanager_8h_source.html#l00124">SPHP</a>, and <a class="el" href="slotsmanager_8h_source.html#l00126">STARP</a>.</p>

<p class="reference">Referenced by <a class="el" href="sfr__eff_8c_source.html#l00167">cooling_and_starformation()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_a537fdd1e25fad1d7245263ef47412790_cgraph.svg" width="844" height="164"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_a537fdd1e25fad1d7245263ef47412790_icgraph.svg" width="614" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ae4c376934146cd783970d5b2582a893f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae4c376934146cd783970d5b2582a893f">&#9670;&nbsp;</a></span>quicklyastarformation()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int quicklyastarformation </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>a3inv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00641">641</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;{</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Density &lt;= <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a98cc56490d039123bd27e01b3717c005">OverDensThresh</a>)</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160; </div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> enttou = pow(<a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Density * a3inv, <a class="code" href="physconst_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a>) / <a class="code" href="physconst_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a>;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordtype">double</span> unew = <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Entropy * enttou;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160; </div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> meanweight = (4 / (8 - 5 * (1 - <a class="code" href="physconst_8h.html#a67abaa49a5aa2892eba705d380652279">HYDROGEN_MASSFRAC</a>)));</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordtype">double</span> temp = unew * meanweight / <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a5173127552b049a6104298f5cf2317c2">temp_to_u</a>;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="keywordflow">if</span>(temp &gt;= <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a7a7cf75838e582ea09d5893865d40fde">QuickLymanAlphaTempThresh</a>)</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="system_8c.html#a14a8799b5e9e58e14107bad2fadc7e06">get_random_number</a>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].ID + 1) &lt; <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#acc0def39860c56e0a46c003d10bcb1b8">QuickLymanAlphaProbability</a>)</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;}</div>
<div class="ttc" id="astructSFRParams_html_a7a7cf75838e582ea09d5893865d40fde"><div class="ttname"><a href="structSFRParams.html#a7a7cf75838e582ea09d5893865d40fde">SFRParams::QuickLymanAlphaTempThresh</a></div><div class="ttdeci">double QuickLymanAlphaTempThresh</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00063">sfr_eff.c:63</a></div></div>
<div class="ttc" id="asystem_8c_html_a14a8799b5e9e58e14107bad2fadc7e06"><div class="ttname"><a href="system_8c.html#a14a8799b5e9e58e14107bad2fadc7e06">get_random_number</a></div><div class="ttdeci">double get_random_number(uint64_t id)</div><div class="ttdef"><b>Definition:</b> <a href="system_8c_source.html#l00060">system.c:60</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="slotsmanager_8h_source.html#l00090">sph_particle_data::Density</a>, <a class="el" href="physconst_8h_source.html#l00035">GAMMA_MINUS1</a>, <a class="el" href="system_8c_source.html#l00060">get_random_number()</a>, <a class="el" href="physconst_8h_source.html#l00037">HYDROGEN_MASSFRAC</a>, <a class="el" href="sfr__eff_8c_source.html#l00045">SFRParams::OverDensThresh</a>, <a class="el" href="partmanager_8h_source.html#l00088">P</a>, <a class="el" href="sfr__eff_8c_source.html#l00062">SFRParams::QuickLymanAlphaProbability</a>, <a class="el" href="sfr__eff_8c_source.html#l00063">SFRParams::QuickLymanAlphaTempThresh</a>, <a class="el" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>, <a class="el" href="slotsmanager_8h_source.html#l00124">SPHP</a>, and <a class="el" href="sfr__eff_8c_source.html#l00070">SFRParams::temp_to_u</a>.</p>

<p class="reference">Referenced by <a class="el" href="sfr__eff_8c_source.html#l00167">cooling_and_starformation()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_ae4c376934146cd783970d5b2582a893f_cgraph.svg" width="383" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_ae4c376934146cd783970d5b2582a893f_icgraph.svg" width="634" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="af9a0036f2b590b6343d359f638d0218f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9a0036f2b590b6343d359f638d0218f">&#9670;&nbsp;</a></span>set_sfr_params()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_sfr_params </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structParameterSet.html">ParameterSet</a> *&#160;</td>
          <td class="paramname"><em>ps</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00129">129</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;{</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    MPI_Comm_rank(MPI_COMM_WORLD, &amp;<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0) {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="comment">/*Star formation parameters*/</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#abd689c6b41461ad6e52ec4197f58a2a2">StarformationCriterion</a> = (<span class="keyword">enum</span> <a class="code" href="sfr__eff_8h.html#ab842fea564dc8ca2101c3bb43fab2ba1">StarformationCriterion</a>) <a class="code" href="paramset_8c.html#abcc62489086c3bb14a61b90765e8d706">param_get_enum</a>(ps, <span class="stringliteral">&quot;StarformationCriterion&quot;</span>);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a4d864f42486060a96daed3365d10db46">CritOverDensity</a> = <a class="code" href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a>(ps, <span class="stringliteral">&quot;CritOverDensity&quot;</span>);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#ad6f6acd4daaa5517cd90fcde2a574575">CritPhysDensity</a> = <a class="code" href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a>(ps, <span class="stringliteral">&quot;CritPhysDensity&quot;</span>);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#acc35d766de8266c3fb4686b33820a2df">WindOn</a> = <a class="code" href="paramset_8c.html#a6228c17649c46aef53e74cd7ccb93fb0">param_get_int</a>(ps, <span class="stringliteral">&quot;WindOn&quot;</span>);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#ab2746a80290d4849001b730e8b8a5956">FactorSN</a> = <a class="code" href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a>(ps, <span class="stringliteral">&quot;FactorSN&quot;</span>);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a9bc0ca836eb6db5b6545ef8a3c6555e5">FactorEVP</a> = <a class="code" href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a>(ps, <span class="stringliteral">&quot;FactorEVP&quot;</span>);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a04bc261e26369e111e499967de60d0c3">TempSupernova</a> = <a class="code" href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a>(ps, <span class="stringliteral">&quot;TempSupernova&quot;</span>);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aa69d29b5787a2a504a02557d94a37a7b">TempClouds</a> = <a class="code" href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a>(ps, <span class="stringliteral">&quot;TempClouds&quot;</span>);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a02fdfce08943fa87ae7a618d4ed61f42">MaxSfrTimescale</a> = <a class="code" href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a>(ps, <span class="stringliteral">&quot;MaxSfrTimescale&quot;</span>);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aa22c2694f1c282c616eb15f9b6b3a182">Generations</a> = <a class="code" href="paramset_8c.html#a6228c17649c46aef53e74cd7ccb93fb0">param_get_int</a>(ps, <span class="stringliteral">&quot;Generations&quot;</span>);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a52747a7ff6078a36a8ecf3fa0e89b11f">MinGasTemp</a> = <a class="code" href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a>(ps, <span class="stringliteral">&quot;MinGasTemp&quot;</span>);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aaf1aff4c4a17fd79170143e207c521f2">BHFeedbackUseTcool</a> = <a class="code" href="paramset_8c.html#a6228c17649c46aef53e74cd7ccb93fb0">param_get_int</a>(ps, <span class="stringliteral">&quot;BHFeedbackUseTcool&quot;</span>);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aaf1aff4c4a17fd79170143e207c521f2">BHFeedbackUseTcool</a> &gt; 2 || <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aaf1aff4c4a17fd79170143e207c521f2">BHFeedbackUseTcool</a> &lt; 0)</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(0, <span class="stringliteral">&quot;BHFeedbackUseTcool mode %d not supported\n&quot;</span>, <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aaf1aff4c4a17fd79170143e207c521f2">BHFeedbackUseTcool</a>);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="comment">/*Lyman-alpha forest parameters*/</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#acc0def39860c56e0a46c003d10bcb1b8">QuickLymanAlphaProbability</a> = <a class="code" href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a>(ps, <span class="stringliteral">&quot;QuickLymanAlphaProbability&quot;</span>);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a7a7cf75838e582ea09d5893865d40fde">QuickLymanAlphaTempThresh</a> = <a class="code" href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a>(ps, <span class="stringliteral">&quot;QuickLymanAlphaTempThresh&quot;</span>);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#ace00e5c4d358ba8b268519fe3af45773">HIReionTemp</a> = <a class="code" href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a>(ps, <span class="stringliteral">&quot;HIReionTemp&quot;</span>);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="comment">/* File names*/</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <a class="code" href="paramset_8c.html#a1f6042209e35f2497db00411eb03a495">param_get_string2</a>(ps, <span class="stringliteral">&quot;TreeCoolFile&quot;</span>, <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#abc8e43fe5dc6f83a149358663b7799de">TreeCoolFile</a>, <span class="keyword">sizeof</span>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#abc8e43fe5dc6f83a149358663b7799de">TreeCoolFile</a>));</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <a class="code" href="paramset_8c.html#a1f6042209e35f2497db00411eb03a495">param_get_string2</a>(ps, <span class="stringliteral">&quot;UVFluctuationfile&quot;</span>, <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a503155d11569c2ebf2d40428583eabf8">UVFluctuationFile</a>, <span class="keyword">sizeof</span>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a503155d11569c2ebf2d40428583eabf8">UVFluctuationFile</a>));</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <a class="code" href="paramset_8c.html#a1f6042209e35f2497db00411eb03a495">param_get_string2</a>(ps, <span class="stringliteral">&quot;MetalCoolFile&quot;</span>, <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a692a90bd49e8067e6ad169b4573a82fd">MetalCoolFile</a>, <span class="keyword">sizeof</span>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a692a90bd49e8067e6ad169b4573a82fd">MetalCoolFile</a>));</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <a class="code" href="paramset_8c.html#a1f6042209e35f2497db00411eb03a495">param_get_string2</a>(ps, <span class="stringliteral">&quot;ReionHistFile&quot;</span>, <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a97addb13e58685dbc9e6894fdcf0f92c">ReionHistFile</a>, <span class="keyword">sizeof</span>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a97addb13e58685dbc9e6894fdcf0f92c">ReionHistFile</a>));</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    MPI_Bcast(&amp;<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structSFRParams.html">SFRParams</a>), MPI_BYTE, 0, MPI_COMM_WORLD);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;}</div>
<div class="ttc" id="aparamset_8c_html_a1ae36a31d95a8e2a9d2812bb9ecc9d49"><div class="ttname"><a href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a></div><div class="ttdeci">double param_get_double(ParameterSet *ps, const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="paramset_8c_source.html#l00336">paramset.c:336</a></div></div>
<div class="ttc" id="aparamset_8c_html_a1f6042209e35f2497db00411eb03a495"><div class="ttname"><a href="paramset_8c.html#a1f6042209e35f2497db00411eb03a495">param_get_string2</a></div><div class="ttdeci">void param_get_string2(ParameterSet *ps, const char *name, char *dst, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="paramset_8c_source.html#l00355">paramset.c:355</a></div></div>
<div class="ttc" id="aparamset_8c_html_a6228c17649c46aef53e74cd7ccb93fb0"><div class="ttname"><a href="paramset_8c.html#a6228c17649c46aef53e74cd7ccb93fb0">param_get_int</a></div><div class="ttdeci">int param_get_int(ParameterSet *ps, const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="paramset_8c_source.html#l00368">paramset.c:368</a></div></div>
<div class="ttc" id="aparamset_8c_html_abcc62489086c3bb14a61b90765e8d706"><div class="ttname"><a href="paramset_8c.html#abcc62489086c3bb14a61b90765e8d706">param_get_enum</a></div><div class="ttdeci">int param_get_enum(ParameterSet *ps, const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="paramset_8c_source.html#l00378">paramset.c:378</a></div></div>
<div class="ttc" id="asfr__eff_8h_html_ab842fea564dc8ca2101c3bb43fab2ba1"><div class="ttname"><a href="sfr__eff_8h.html#ab842fea564dc8ca2101c3bb43fab2ba1">StarformationCriterion</a></div><div class="ttdeci">StarformationCriterion</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8h_source.html#l00016">sfr_eff.h:16</a></div></div>
<div class="ttc" id="astructSFRParams_html"><div class="ttname"><a href="structSFRParams.html">SFRParams</a></div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00036">sfr_eff.c:37</a></div></div>
<div class="ttc" id="atest__exchange_8c_html_a52c8c7d2abff436111942e02c5bb466a"><div class="ttname"><a href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a></div><div class="ttdeci">int ThisTask</div><div class="ttdef"><b>Definition:</b> <a href="test__exchange_8c_source.html#l00023">test_exchange.c:23</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="sfr__eff_8c_source.html#l00055">SFRParams::BHFeedbackUseTcool</a>, <a class="el" href="sfr__eff_8c_source.html#l00043">SFRParams::CritOverDensity</a>, <a class="el" href="sfr__eff_8c_source.html#l00044">SFRParams::CritPhysDensity</a>, <a class="el" href="endrun_8c_source.html#l00147">endrun()</a>, <a class="el" href="sfr__eff_8c_source.html#l00050">SFRParams::FactorEVP</a>, <a class="el" href="sfr__eff_8c_source.html#l00048">SFRParams::FactorSN</a>, <a class="el" href="sfr__eff_8c_source.html#l00065">SFRParams::Generations</a>, <a class="el" href="sfr__eff_8c_source.html#l00078">SFRParams::HIReionTemp</a>, <a class="el" href="sfr__eff_8c_source.html#l00054">SFRParams::MaxSfrTimescale</a>, <a class="el" href="sfr__eff_8c_source.html#l00081">SFRParams::MetalCoolFile</a>, <a class="el" href="sfr__eff_8c_source.html#l00057">SFRParams::MinGasTemp</a>, <a class="el" href="paramset_8c_source.html#l00336">param_get_double()</a>, <a class="el" href="paramset_8c_source.html#l00378">param_get_enum()</a>, <a class="el" href="paramset_8c_source.html#l00368">param_get_int()</a>, <a class="el" href="paramset_8c_source.html#l00355">param_get_string2()</a>, <a class="el" href="sfr__eff_8c_source.html#l00062">SFRParams::QuickLymanAlphaProbability</a>, <a class="el" href="sfr__eff_8c_source.html#l00063">SFRParams::QuickLymanAlphaTempThresh</a>, <a class="el" href="sfr__eff_8c_source.html#l00084">SFRParams::ReionHistFile</a>, <a class="el" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>, <a class="el" href="sfr__eff_8c_source.html#l00040">SFRParams::StarformationCriterion</a>, <a class="el" href="sfr__eff_8c_source.html#l00053">SFRParams::TempClouds</a>, <a class="el" href="sfr__eff_8c_source.html#l00052">SFRParams::TempSupernova</a>, <a class="el" href="test__exchange_8c_source.html#l00023">ThisTask</a>, <a class="el" href="sfr__eff_8c_source.html#l00080">SFRParams::TreeCoolFile</a>, <a class="el" href="sfr__eff_8c_source.html#l00082">SFRParams::UVFluctuationFile</a>, and <a class="el" href="sfr__eff_8c_source.html#l00041">SFRParams::WindOn</a>.</p>

<p class="reference">Referenced by <a class="el" href="gadget_2params_8c_source.html#l00359">read_parameter_file()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_af9a0036f2b590b6343d359f638d0218f_cgraph.svg" width="792" height="279"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_af9a0036f2b590b6343d359f638d0218f_icgraph.svg" width="438" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aefebad1cdf9c3fe278031e2b78d69859"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aefebad1cdf9c3fe278031e2b78d69859">&#9670;&nbsp;</a></span>sfr_need_to_compute_sph_grad_rho()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sfr_need_to_compute_sph_grad_rho </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00952">952</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;{</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="types_8h.html#aae268cff368c829e32ef0a52ee731bd6">HAS</a>(<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#abd689c6b41461ad6e52ec4197f58a2a2">StarformationCriterion</a>, <a class="code" href="sfr__eff_8h.html#ab842fea564dc8ca2101c3bb43fab2ba1a3c3314c2c3e12bd32982499ef7c98904">SFR_CRITERION_MOLECULAR_H2</a>)) {</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    }</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="types_8h_source.html#l00022">HAS</a>, <a class="el" href="sfr__eff_8h_source.html#l00018">SFR_CRITERION_MOLECULAR_H2</a>, <a class="el" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>, and <a class="el" href="sfr__eff_8c_source.html#l00040">SFRParams::StarformationCriterion</a>.</p>

<p class="reference">Referenced by <a class="el" href="run_8c_source.html#l00284">run()</a>, and <a class="el" href="run_8c_source.html#l00652">runfof()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_aefebad1cdf9c3fe278031e2b78d69859_icgraph.svg" width="386" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ad138d98cd8eded73c2b44955c8709b42"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad138d98cd8eded73c2b44955c8709b42">&#9670;&nbsp;</a></span>sfr_reserve_slots()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int * sfr_reserve_slots </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structActiveParticles.html">ActiveParticles</a> *&#160;</td>
          <td class="paramname"><em>act</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>NewStars</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>NumNewStar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structForceTree.html">ForceTree</a> *&#160;</td>
          <td class="paramname"><em>tt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00380">380</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;{</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="comment">/* SlotsManager is below Nodes and ActiveParticleList,</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">         * so we need to move them out of the way before we extend Nodes.</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">         * This is quite slow, but need not be collective and is faster than a tree rebuild.</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">         * Try not to do this too often.*/</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(1, <span class="stringliteral">&quot;Need %d star slots, more than %d available. Try increasing SlotsIncreaseFactor on restart.\n&quot;</span>, <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[4].<a class="code" href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">size</a>, <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[4].<a class="code" href="structslot__info.html#a7b67ebbddce987acdd80262a51f2e8c6">maxsize</a>);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <span class="comment">/*Move the NewStar array to upper memory*/</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="keywordtype">int</span> * new_star_tmp = NULL;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="keywordflow">if</span>(NewStars) {</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            new_star_tmp = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#ac576b6f19b635b512399d6afb8c20d99">mymalloc2</a>(<span class="stringliteral">&quot;newstartmp&quot;</span>, NumNewStar*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            memmove(new_star_tmp, NewStars, NumNewStar * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(NewStars);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        }</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="comment">/*Move the tree to upper memory*/</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> * nodes_base_tmp=NULL;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="keywordtype">int</span> *Father_tmp=NULL;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <span class="keywordtype">int</span> *ActiveParticle_tmp=NULL;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#a6676b2eba19512b1671a4c21fcb6e71d">force_tree_allocated</a>(tree)) {</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            nodes_base_tmp = (<span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> *) <a class="code" href="mymalloc_8h.html#ac576b6f19b635b512399d6afb8c20d99">mymalloc2</a>(<span class="stringliteral">&quot;nodesbasetmp&quot;</span>, tree-&gt;numnodes * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structNODE.html">NODE</a>));</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            memmove(nodes_base_tmp, tree-&gt;Nodes_base, tree-&gt;numnodes * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structNODE.html">NODE</a>));</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(tree-&gt;Nodes_base);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            Father_tmp = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#ac576b6f19b635b512399d6afb8c20d99">mymalloc2</a>(<span class="stringliteral">&quot;Father_tmp&quot;</span>, <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a5e24abb34f2c8998d8b35c217477d580">MaxPart</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            memmove(Father_tmp, tree-&gt;Father, <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a5e24abb34f2c8998d8b35c217477d580">MaxPart</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(tree-&gt;Father);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="keywordflow">if</span>(act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a>) {</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            ActiveParticle_tmp = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#ac576b6f19b635b512399d6afb8c20d99">mymalloc2</a>(<span class="stringliteral">&quot;ActiveParticle_tmp&quot;</span>, act-&gt;<a class="code" href="structActiveParticles.html#a847ab898fdabc62a4723c7c3a66038d4">NumActiveParticle</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            memmove(ActiveParticle_tmp, act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a>, act-&gt;<a class="code" href="structActiveParticles.html#a847ab898fdabc62a4723c7c3a66038d4">NumActiveParticle</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a>);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        }</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="comment">/*Now we can extend the slots! */</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        int64_t atleast[6];</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        int64_t i;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="keywordflow">for</span>(i = 0; i &lt; 6; i++)</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            atleast[i] = <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[i].<a class="code" href="structslot__info.html#a7b67ebbddce987acdd80262a51f2e8c6">maxsize</a>;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        atleast[4] += NumNewStar;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <a class="code" href="slotsmanager_8c.html#a0effa6d52d74a3ca0b91c1cae3b72b5e">slots_reserve</a>(1, atleast, <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <span class="comment">/*And now we need our memory back in the right place*/</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keywordflow">if</span>(ActiveParticle_tmp) {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a> = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;ActiveParticle&quot;</span>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*(act-&gt;<a class="code" href="structActiveParticles.html#a847ab898fdabc62a4723c7c3a66038d4">NumActiveParticle</a> + <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a5e24abb34f2c8998d8b35c217477d580">MaxPart</a> - <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a>));</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            memmove(act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a>, ActiveParticle_tmp, act-&gt;<a class="code" href="structActiveParticles.html#a847ab898fdabc62a4723c7c3a66038d4">NumActiveParticle</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(ActiveParticle_tmp);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        }</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#a6676b2eba19512b1671a4c21fcb6e71d">force_tree_allocated</a>(tree)) {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            tree-&gt;Father = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;Father&quot;</span>, <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a5e24abb34f2c8998d8b35c217477d580">MaxPart</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            memmove(tree-&gt;Father, Father_tmp, <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a5e24abb34f2c8998d8b35c217477d580">MaxPart</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(Father_tmp);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            tree-&gt;Nodes_base = (<span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;Nodes_base&quot;</span>, tree-&gt;numnodes * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structNODE.html">NODE</a>));</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            memmove(tree-&gt;Nodes_base, nodes_base_tmp, tree-&gt;numnodes * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structNODE.html">NODE</a>));</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(nodes_base_tmp);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            <span class="comment">/*Don&#39;t forget to update the Node pointer as well as Node_base!*/</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            tree-&gt;Nodes = tree-&gt;Nodes_base - tree-&gt;firstnode;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="keywordflow">if</span>(new_star_tmp) {</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            NewStars = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;NewStars&quot;</span>, NumNewStar*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            memmove(NewStars, new_star_tmp, NumNewStar * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(new_star_tmp);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        }</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="keywordflow">return</span> NewStars;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;}</div>
<div class="ttc" id="aforcetree_8c_html_a6676b2eba19512b1671a4c21fcb6e71d"><div class="ttname"><a href="forcetree_8c.html#a6676b2eba19512b1671a4c21fcb6e71d">force_tree_allocated</a></div><div class="ttdeci">int force_tree_allocated(const ForceTree *tree)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00134">forcetree.c:134</a></div></div>
<div class="ttc" id="aslotsmanager_8c_html_a0effa6d52d74a3ca0b91c1cae3b72b5e"><div class="ttname"><a href="slotsmanager_8c.html#a0effa6d52d74a3ca0b91c1cae3b72b5e">slots_reserve</a></div><div class="ttdeci">size_t slots_reserve(int where, int64_t atleast[6], struct slots_manager_type *sman)</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8c_source.html#l00475">slotsmanager.c:475</a></div></div>
<div class="ttc" id="astructNODE_html"><div class="ttname"><a href="structNODE.html">NODE</a></div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00038">forcetree.h:39</a></div></div>
<div class="ttc" id="astructpart__manager__type_html_a45e1f95715be50e4081af78f4ee99cb5"><div class="ttname"><a href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">part_manager_type::NumPart</a></div><div class="ttdeci">int64_t NumPart</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00076">partmanager.h:76</a></div></div>
<div class="ttc" id="astructpart__manager__type_html_a5e24abb34f2c8998d8b35c217477d580"><div class="ttname"><a href="structpart__manager__type.html#a5e24abb34f2c8998d8b35c217477d580">part_manager_type::MaxPart</a></div><div class="ttdeci">int64_t MaxPart</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00078">partmanager.h:78</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="timestep_8h_source.html#l00013">ActiveParticles::ActiveParticle</a>, <a class="el" href="forcetree_8h_source.html#l00103">ForceTree::Father</a>, <a class="el" href="forcetree_8h_source.html#l00084">ForceTree::firstnode</a>, <a class="el" href="forcetree_8c_source.html#l00134">force_tree_allocated()</a>, <a class="el" href="slotsmanager_8h_source.html#l00112">slots_manager_type::info</a>, <a class="el" href="partmanager_8h_source.html#l00078">part_manager_type::MaxPart</a>, <a class="el" href="slotsmanager_8h_source.html#l00011">slot_info::maxsize</a>, <a class="el" href="endrun_8c_source.html#l00175">message()</a>, <a class="el" href="mymalloc_8h_source.html#l00019">myfree</a>, <a class="el" href="mymalloc_8h_source.html#l00015">mymalloc</a>, <a class="el" href="mymalloc_8h_source.html#l00016">mymalloc2</a>, <a class="el" href="forcetree_8h_source.html#l00097">ForceTree::Nodes</a>, <a class="el" href="forcetree_8h_source.html#l00101">ForceTree::Nodes_base</a>, <a class="el" href="timestep_8h_source.html#l00012">ActiveParticles::NumActiveParticle</a>, <a class="el" href="forcetree_8h_source.html#l00088">ForceTree::numnodes</a>, <a class="el" href="partmanager_8h_source.html#l00076">part_manager_type::NumPart</a>, <a class="el" href="partmanager_8c_source.html#l00011">PartManager</a>, <a class="el" href="slotsmanager_8h_source.html#l00012">slot_info::size</a>, <a class="el" href="slotsmanager_8c_source.html#l00475">slots_reserve()</a>, and <a class="el" href="slotsmanager_8c_source.html#l00007">SlotsManager</a>.</p>

<p class="reference">Referenced by <a class="el" href="sfr__eff_8c_source.html#l00167">cooling_and_starformation()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_ad138d98cd8eded73c2b44955c8709b42_cgraph.svg" width="744" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_ad138d98cd8eded73c2b44955c8709b42_icgraph.svg" width="600" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a4080dc1b2496c08090d1101544b48cc2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4080dc1b2496c08090d1101544b48cc2">&#9670;&nbsp;</a></span>sfreff_on_eeqos()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sfreff_on_eeqos </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structsph__particle__data.html">sph_particle_data</a> *&#160;</td>
          <td class="paramname"><em>sph</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>a3inv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00486">486</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;{</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordtype">int</span> flag = 0;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="comment">/* no sfr: normal cooling*/</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a2694f130b78888ed2a49aa30181b0bcf">StarformationOn</a>) {</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    }</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160; </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordflow">if</span>(sph-&gt;<a class="code" href="structsph__particle__data.html#a40e26648ca8d900ec500a36a5d876ed7">Density</a> * a3inv &gt;= <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a287cf4dfed60a4b9aecef1c74815519d">PhysDensThresh</a>)</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        flag = 1;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160; </div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keywordflow">if</span>(sph-&gt;<a class="code" href="structsph__particle__data.html#a40e26648ca8d900ec500a36a5d876ed7">Density</a> &lt; <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a98cc56490d039123bd27e01b3717c005">OverDensThresh</a>)</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        flag = 0;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordflow">if</span>(sph-&gt;<a class="code" href="structsph__particle__data.html#a0df53257ae122aa0b8a8343d16e8ebbe">DelayTime</a> &gt; 0)</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        flag = 0;   <span class="comment">/* only normal cooling for particles in the wind */</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160; </div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="comment">/* The model from 0904.2572 makes gas not star forming if more than 0.5 dex above</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">     * the effective equation of state (at z=0). This in practice means black hole heated.*/</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keywordflow">if</span>(flag == 1 &amp;&amp; <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aaf1aff4c4a17fd79170143e207c521f2">BHFeedbackUseTcool</a> == 2) {</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <span class="comment">//Redshift is the argument</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="keywordtype">double</span> redshift = pow(a3inv, 1./3.)-1;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="keyword">struct </span><a class="code" href="structUVBG.html">UVBG</a> uvbg = <a class="code" href="cooling_8h.html#ac9c80af3cbf2235e9f8d39e176515cfe">get_global_UVBG</a>(redshift);</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="keywordtype">double</span> egyeff = <a class="code" href="sfr__eff_8c.html#a054be999a15e37a4d4d9b8dde836f287">get_egyeff</a>(redshift, sph-&gt;<a class="code" href="structsph__particle__data.html#a40e26648ca8d900ec500a36a5d876ed7">Density</a>, &amp;uvbg);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> enttou = pow(sph-&gt;<a class="code" href="structsph__particle__data.html#a40e26648ca8d900ec500a36a5d876ed7">Density</a> * a3inv, <a class="code" href="physconst_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a>) / <a class="code" href="physconst_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a>;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="keywordtype">double</span> unew = sph-&gt;<a class="code" href="structsph__particle__data.html#a1519e54bbe3cf301cd3fc1224178e4f9">Entropy</a> * enttou;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="comment">/* 0.5 dex = 10^0.5 = 3.2 */</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="keywordflow">if</span>(unew &gt;= egyeff * 3.2)</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            flag = 0;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordflow">return</span> flag;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;}</div>
<div class="ttc" id="astructsph__particle__data_html_a0df53257ae122aa0b8a8343d16e8ebbe"><div class="ttname"><a href="structsph__particle__data.html#a0df53257ae122aa0b8a8343d16e8ebbe">sph_particle_data::DelayTime</a></div><div class="ttdeci">MyFloat DelayTime</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00103">slotsmanager.h:103</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="sfr__eff_8c_source.html#l00055">SFRParams::BHFeedbackUseTcool</a>, <a class="el" href="slotsmanager_8h_source.html#l00103">sph_particle_data::DelayTime</a>, <a class="el" href="slotsmanager_8h_source.html#l00090">sph_particle_data::Density</a>, <a class="el" href="slotsmanager_8h_source.html#l00087">sph_particle_data::Entropy</a>, <a class="el" href="physconst_8h_source.html#l00035">GAMMA_MINUS1</a>, <a class="el" href="sfr__eff_8c_source.html#l00782">get_egyeff()</a>, <a class="el" href="cooling__rates_8c_source.html#l00263">get_global_UVBG()</a>, <a class="el" href="sfr__eff_8c_source.html#l00045">SFRParams::OverDensThresh</a>, <a class="el" href="sfr__eff_8c_source.html#l00046">SFRParams::PhysDensThresh</a>, <a class="el" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>, and <a class="el" href="sfr__eff_8c_source.html#l00039">SFRParams::StarformationOn</a>.</p>

<p class="reference">Referenced by <a class="el" href="blackhole_8c_source.html#l01278">blackhole_feedback_ngbiter()</a>, <a class="el" href="sfr__eff_8c_source.html#l00167">cooling_and_starformation()</a>, <a class="el" href="sfr__eff_8c_source.html#l00548">get_helium_neutral_fraction_sfreff()</a>, <a class="el" href="sfr__eff_8c_source.html#l00520">get_neutral_fraction_sfreff()</a>, and <a class="el" href="sfr__eff_8c_source.html#l00759">get_starformation_rate_full()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_a4080dc1b2496c08090d1101544b48cc2_cgraph.svg" width="1578" height="1152"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_a4080dc1b2496c08090d1101544b48cc2_icgraph.svg" width="1492" height="358"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a276becdf281cd9d2a0f2f3e1642b2559"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a276becdf281cd9d2a0f2f3e1642b2559">&#9670;&nbsp;</a></span>starformation()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int starformation </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>localsfr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> *&#160;</td>
          <td class="paramname"><em>sm_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> *&#160;</td>
          <td class="paramname"><em>GradRho</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>redshift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>a3inv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>hubble</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>GravInternal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structUVBG.html">UVBG</a> *const&#160;</td>
          <td class="paramname"><em>GlobalUVBG</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sfr__eff_8c_source.html#l00666">666</a> of file <a class="el" href="sfr__eff_8c_source.html">sfr_eff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;{</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="comment">/*  the proper time-step */</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> = <a class="code" href="timebinmgr_8c.html#a716e51b694540af2851fb51c081bcf5d">get_dloga_for_bin</a>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].TimeBin, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Ti_drift);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="keywordtype">double</span> dtime = <a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> / hubble;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordtype">int</span> newstar = -1;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160; </div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="keyword">struct </span><a class="code" href="structUVBG.html">UVBG</a> uvbg = <a class="code" href="cooling_8h.html#ab06d4baa8de3f3e0db4203a9deef30cf">get_local_UVBG</a>(redshift, GlobalUVBG, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Pos, <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a5462d473b8cd90abf7f7f7a56d822649">CurrentParticleOffset</a>);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160; </div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="keyword">struct </span><a class="code" href="structsfr__eeqos__data.html">sfr_eeqos_data</a> sfr_data = <a class="code" href="sfr__eff_8c.html#a4951e59bdceebd7b56b972942bc3a10d">get_sfr_eeqos</a>(&amp;<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i], &amp;<a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i), dtime, &amp;uvbg, redshift, a3inv);</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160; </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keywordtype">double</span> atime = 1/(1+redshift);</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordtype">double</span> smr = <a class="code" href="sfr__eff_8c.html#a5cfa7b95c20ca76682274d0dc17e3c66">get_starformation_rate_full</a>(i, GradRho, sfr_data, atime, a3inv, hubble, GravInternal);</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160; </div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordtype">double</span> sm = smr * dtime;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160; </div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    *sm_out = sm;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="keywordtype">double</span> p = sm / <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Mass;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160; </div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="comment">/* convert to Solar per Year.*/</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Sfr = smr * <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#a4f73d6b7178f89196effe799512cfa1e">UnitSfr_in_solar_per_year</a>;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Ne = sfr_data.<a class="code" href="structsfr__eeqos__data.html#a1b1001831e195f3bc21921f0744062d1">ne</a>;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    *localsfr += <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Sfr;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160; </div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> w = <a class="code" href="system_8c.html#a14a8799b5e9e58e14107bad2fadc7e06">get_random_number</a>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].ID);</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> frac = (1 - exp(-p));</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Metallicity += w * <a class="code" href="sfr__eff_8h.html#a898d422fc3ce4d0e27b19dd4b489e70a">METAL_YIELD</a> * frac / <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aa22c2694f1c282c616eb15f9b6b3a182">Generations</a>;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160; </div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="comment">/* upon start-up, we need to protect against dloga ==0 */</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="lightcone_8c.html#a8f3ab427b30a3327076ffcc7c683562c">dloga</a> &gt; 0 &amp;&amp; <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].TimeBin)</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        <a class="code" href="sfr__eff_8c.html#a64f07331e54d0eb86fd4f6466d58e0f2">cooling_relaxed</a>(i, dtime, &amp;uvbg, redshift, a3inv, sfr_data, GlobalUVBG);</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160; </div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keywordtype">double</span> mass_of_star = <a class="code" href="sfr__eff_8c.html#ad5c8b2f6a1323536d08519b623f60992">find_star_mass</a>(i, <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#acebdc3bbe3b18772a854b12ddb3b53b4">avg_baryon_mass</a>);</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="keywordtype">double</span> prob = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Mass / mass_of_star * (1 - exp(-p));</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160; </div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordtype">int</span> form_star = (<a class="code" href="system_8c.html#a14a8799b5e9e58e14107bad2fadc7e06">get_random_number</a>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].ID + 1) &lt; prob);</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keywordflow">if</span>(form_star) {</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        <span class="comment">/* ok, make a star */</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        newstar = i;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <span class="comment">/* If we get a fraction of the mass we need to create</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">         * a new particle for the star and remove mass from i.*/</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Mass &gt;= 1.1 * mass_of_star)</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            newstar = <a class="code" href="slotsmanager_8c.html#aeebe9837f30b25a51a23bf4f9c237144">slots_split_particle</a>(i, mass_of_star, <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    }</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160; </div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="comment">/* Add the rest of the metals if we didn&#39;t form a star.</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="comment">     * If we did form a star, add winds to the star-forming particle</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="comment">     * that formed it if it is still around*/</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="keywordflow">if</span>(!form_star || newstar != i) {</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(i).Metallicity += (1-w) * <a class="code" href="sfr__eff_8h.html#a898d422fc3ce4d0e27b19dd4b489e70a">METAL_YIELD</a> * frac / <a class="code" href="sfr__eff_8c.html#a1a33e045abac80ac9459e11061775e70">sfr_params</a>.<a class="code" href="structSFRParams.html#aa22c2694f1c282c616eb15f9b6b3a182">Generations</a>;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    }</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keywordflow">return</span> newstar;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;}</div>
<div class="ttc" id="asfr__eff_8c_html_a5cfa7b95c20ca76682274d0dc17e3c66"><div class="ttname"><a href="sfr__eff_8c.html#a5cfa7b95c20ca76682274d0dc17e3c66">get_starformation_rate_full</a></div><div class="ttdeci">static double get_starformation_rate_full(int i, MyFloat *GradRho, struct sfr_eeqos_data sfr_data, const double atime, const double a3inv, const double hubble, const double GravInternal)</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00759">sfr_eff.c:759</a></div></div>
<div class="ttc" id="asfr__eff_8c_html_a64f07331e54d0eb86fd4f6466d58e0f2"><div class="ttname"><a href="sfr__eff_8c.html#a64f07331e54d0eb86fd4f6466d58e0f2">cooling_relaxed</a></div><div class="ttdeci">static void cooling_relaxed(int i, double dtime, struct UVBG *local_uvbg, const double redshift, const double a3inv, struct sfr_eeqos_data sfr_data, const struct UVBG *const GlobalUVBG)</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00606">sfr_eff.c:606</a></div></div>
<div class="ttc" id="asfr__eff_8c_html_ad5c8b2f6a1323536d08519b623f60992"><div class="ttname"><a href="sfr__eff_8c.html#ad5c8b2f6a1323536d08519b623f60992">find_star_mass</a></div><div class="ttdeci">static double find_star_mass(int i, const double avg_baryon_mass)</div><div class="ttdef"><b>Definition:</b> <a href="sfr__eff_8c_source.html#l00921">sfr_eff.c:921</a></div></div>
<div class="ttc" id="aslotsmanager_8c_html_aeebe9837f30b25a51a23bf4f9c237144"><div class="ttname"><a href="slotsmanager_8c.html#aeebe9837f30b25a51a23bf4f9c237144">slots_split_particle</a></div><div class="ttdeci">int slots_split_particle(int parent, double childmass, struct part_manager_type *pman)</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8c_source.html#l00103">slotsmanager.c:103</a></div></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="sfr__eff_8c_source.html#l00167">cooling_and_starformation()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="sfr__eff_8c_a276becdf281cd9d2a0f2f3e1642b2559_icgraph.svg" width="578" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a1a33e045abac80ac9459e11061775e70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a33e045abac80ac9459e11061775e70">&#9670;&nbsp;</a></span>sfr_params</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structSFRParams.html">SFRParams</a> sfr_params</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="sfr__eff_8c_source.html#l00167">cooling_and_starformation()</a>, <a class="el" href="sfr__eff_8c_source.html#l00444">cooling_direct()</a>, <a class="el" href="sfr__eff_8c_source.html#l00606">cooling_relaxed()</a>, <a class="el" href="sfr__eff_8c_source.html#l00921">find_star_mass()</a>, <a class="el" href="sfr__eff_8c_source.html#l00782">get_egyeff()</a>, <a class="el" href="sfr__eff_8c_source.html#l00087">get_generations()</a>, <a class="el" href="sfr__eff_8c_source.html#l00548">get_helium_neutral_fraction_sfreff()</a>, <a class="el" href="sfr__eff_8c_source.html#l00797">get_MinEgySpec()</a>, <a class="el" href="sfr__eff_8c_source.html#l00520">get_neutral_fraction_sfreff()</a>, <a class="el" href="sfr__eff_8c_source.html#l00722">get_sfr_eeqos()</a>, <a class="el" href="sfr__eff_8c_source.html#l00973">get_sfr_factor_due_to_h2()</a>, <a class="el" href="sfr__eff_8c_source.html#l00997">get_sfr_factor_due_to_selfgravity()</a>, <a class="el" href="sfr__eff_8c_source.html#l00759">get_starformation_rate_full()</a>, <a class="el" href="sfr__eff_8c_source.html#l00805">init_cooling_and_star_formation()</a>, <a class="el" href="sfr__eff_8c_source.html#l00641">quicklyastarformation()</a>, <a class="el" href="sfr__eff_8c_source.html#l00129">set_sfr_params()</a>, <a class="el" href="sfr__eff_8c_source.html#l00952">sfr_need_to_compute_sph_grad_rho()</a>, and <a class="el" href="sfr__eff_8c_source.html#l00486">sfreff_on_eeqos()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
