<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MP-Gadget: libgadget/forcetree.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MP-Gadget
   &#160;<span id="projectnumber">5.0.1.dev1-76bc7d4726-dirty</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_8db5bc7a24c620673ff2e44953ca6f6c.html">libgadget</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">forcetree.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="types_8h_source.html">types.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="domain_8h_source.html">domain.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for forcetree.h:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8h__incl.svg" width="1866" height="560"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8h__dep__incl.svg" width="4875" height="395"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<p><a href="forcetree_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structNodeChild.html">NodeChild</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structNODE.html">NODE</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structForceTree.html">ForceTree</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:afcfeb1a32a47b8b7f8bce9222b542a9e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#afcfeb1a32a47b8b7f8bce9222b542a9e">NMAXCHILD</a>&#160;&#160;&#160;8</td></tr>
<tr class="separator:afcfeb1a32a47b8b7f8bce9222b542a9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac342a8bc2bb97849655e3ea50d3c5494"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#ac342a8bc2bb97849655e3ea50d3c5494">PARTICLE_NODE_TYPE</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:ac342a8bc2bb97849655e3ea50d3c5494"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ad606200a7ba07b8766c7d37b2454c7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#a3ad606200a7ba07b8766c7d37b2454c7">NODE_NODE_TYPE</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:a3ad606200a7ba07b8766c7d37b2454c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca0ae17134eee3f867d5d7579a97ba64"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#aca0ae17134eee3f867d5d7579a97ba64">PSEUDO_NODE_TYPE</a>&#160;&#160;&#160;2</td></tr>
<tr class="separator:aca0ae17134eee3f867d5d7579a97ba64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09c0db73b04ae32608387993001427ee"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#a09c0db73b04ae32608387993001427ee">ALLMASK</a>&#160;&#160;&#160;(1&lt;&lt;30)-1</td></tr>
<tr class="separator:a09c0db73b04ae32608387993001427ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7d9abc3063766d4c2825954b8354f70"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#ad7d9abc3063766d4c2825954b8354f70">GASMASK</a>&#160;&#160;&#160;(1)</td></tr>
<tr class="separator:ad7d9abc3063766d4c2825954b8354f70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e094756ac8122f169dee095986c84b0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#a3e094756ac8122f169dee095986c84b0">DMMASK</a>&#160;&#160;&#160;(2)</td></tr>
<tr class="separator:a3e094756ac8122f169dee095986c84b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0ad600f91ce6914ef7b31e6d35964a2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#ac0ad600f91ce6914ef7b31e6d35964a2">STARMASK</a>&#160;&#160;&#160;(1&lt;&lt;4)</td></tr>
<tr class="separator:ac0ad600f91ce6914ef7b31e6d35964a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaebd40007f6dff89e2fb4b3376192199"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#aaebd40007f6dff89e2fb4b3376192199">BHMASK</a>&#160;&#160;&#160;(1&lt;&lt;5)</td></tr>
<tr class="separator:aaebd40007f6dff89e2fb4b3376192199"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a230362fdb55cd9e9b616388717d0f781"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structForceTree.html">ForceTree</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#a230362fdb55cd9e9b616388717d0f781">ForceTree</a></td></tr>
<tr class="separator:a230362fdb55cd9e9b616388717d0f781"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa58562a96bb05cdba9466ecedafece27"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#aa58562a96bb05cdba9466ecedafece27">init_forcetree_params</a> (const int FastParticleType)</td></tr>
<tr class="separator:aa58562a96bb05cdba9466ecedafece27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54bd715ce16fc7cad4beae50e36690ef"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#a54bd715ce16fc7cad4beae50e36690ef">force_tree_allocated</a> (const <a class="el" href="structForceTree.html">ForceTree</a> *<a class="el" href="test__cooling__rates_8c.html#a3f5eb0be0db76594291d88d7cbdab712">tt</a>)</td></tr>
<tr class="separator:a54bd715ce16fc7cad4beae50e36690ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a1586acbca478c066f9b27cdac64ac4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#a4a1586acbca478c066f9b27cdac64ac4">force_update_hmax</a> (int *activeset, int size, <a class="el" href="structForceTree.html">ForceTree</a> *<a class="el" href="test__cooling__rates_8c.html#a3f5eb0be0db76594291d88d7cbdab712">tt</a>, <a class="el" href="structDomainDecomp.html">DomainDecomp</a> *ddecomp)</td></tr>
<tr class="separator:a4a1586acbca478c066f9b27cdac64ac4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5156dae3aae56140d6e9ae0ab58867cc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#a5156dae3aae56140d6e9ae0ab58867cc">force_tree_rebuild</a> (<a class="el" href="structForceTree.html">ForceTree</a> *tree, <a class="el" href="structDomainDecomp.html">DomainDecomp</a> *ddecomp, const int HybridNuGrav, const int DoMoments, const char *EmergencyOutputDir)</td></tr>
<tr class="separator:a5156dae3aae56140d6e9ae0ab58867cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa01061828cef34bc4c55ef9eaa7c03f5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#aa01061828cef34bc4c55ef9eaa7c03f5">force_tree_rebuild_mask</a> (<a class="el" href="structForceTree.html">ForceTree</a> *tree, <a class="el" href="structDomainDecomp.html">DomainDecomp</a> *ddecomp, int mask, const int HybridNuGrav, const char *EmergencyOutputDir)</td></tr>
<tr class="separator:aa01061828cef34bc4c55ef9eaa7c03f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9653023aff6e0f8f6aac05fd498348c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#af9653023aff6e0f8f6aac05fd498348c">force_tree_free</a> (<a class="el" href="structForceTree.html">ForceTree</a> *<a class="el" href="test__cooling__rates_8c.html#a3f5eb0be0db76594291d88d7cbdab712">tt</a>)</td></tr>
<tr class="separator:af9653023aff6e0f8f6aac05fd498348c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab303b92c6d6b4144999c5cebabd65ec0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#ab303b92c6d6b4144999c5cebabd65ec0">dump_particles</a> (void)</td></tr>
<tr class="separator:ab303b92c6d6b4144999c5cebabd65ec0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae01cb41cc000acecd9213d69c7d15c32"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#ae01cb41cc000acecd9213d69c7d15c32">node_is_pseudo_particle</a> (int no, const <a class="el" href="structForceTree.html">ForceTree</a> *tree)</td></tr>
<tr class="separator:ae01cb41cc000acecd9213d69c7d15c32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac689be6113781c695ef044ed53b94c6f"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#ac689be6113781c695ef044ed53b94c6f">node_is_particle</a> (int no, const <a class="el" href="structForceTree.html">ForceTree</a> *tree)</td></tr>
<tr class="separator:ac689be6113781c695ef044ed53b94c6f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a822d99b8bfbdf4c010e2b974b4334409"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#a822d99b8bfbdf4c010e2b974b4334409">node_is_node</a> (int no, const <a class="el" href="structForceTree.html">ForceTree</a> *tree)</td></tr>
<tr class="separator:a822d99b8bfbdf4c010e2b974b4334409"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1886c54dda026ca16e1d52a530a44b30"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#a1886c54dda026ca16e1d52a530a44b30">force_get_father</a> (int no, const <a class="el" href="structForceTree.html">ForceTree</a> *<a class="el" href="test__cooling__rates_8c.html#a3f5eb0be0db76594291d88d7cbdab712">tt</a>)</td></tr>
<tr class="separator:a1886c54dda026ca16e1d52a530a44b30"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54c1bcfde446f424ff0b7f89199dde0a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#a54c1bcfde446f424ff0b7f89199dde0a">force_tree_create_nodes</a> (const <a class="el" href="structForceTree.html">ForceTree</a> tb, const int npart, int mask, <a class="el" href="structDomainDecomp.html">DomainDecomp</a> *ddecomp, const int HybridNuGrav)</td></tr>
<tr class="separator:a54c1bcfde446f424ff0b7f89199dde0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68ccb093e6e43385d633074edd4aee40"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structForceTree.html">ForceTree</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#a68ccb093e6e43385d633074edd4aee40">force_treeallocate</a> (int64_t maxnodes, int64_t maxpart, <a class="el" href="structDomainDecomp.html">DomainDecomp</a> *ddecomp)</td></tr>
<tr class="separator:a68ccb093e6e43385d633074edd4aee40"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c06d93e6c1c1afab740e393528fa0f6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8h.html#a8c06d93e6c1c1afab740e393528fa0f6">force_update_node_parallel</a> (const <a class="el" href="structForceTree.html">ForceTree</a> *tree, const <a class="el" href="structDomainDecomp.html">DomainDecomp</a> *ddecomp)</td></tr>
<tr class="separator:a8c06d93e6c1c1afab740e393528fa0f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a09c0db73b04ae32608387993001427ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09c0db73b04ae32608387993001427ee">&#9670;&nbsp;</a></span>ALLMASK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ALLMASK&#160;&#160;&#160;(1&lt;&lt;30)-1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8h_source.html#l00020">20</a> of file <a class="el" href="forcetree_8h_source.html">forcetree.h</a>.</p>

</div>
</div>
<a id="aaebd40007f6dff89e2fb4b3376192199"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaebd40007f6dff89e2fb4b3376192199">&#9670;&nbsp;</a></span>BHMASK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BHMASK&#160;&#160;&#160;(1&lt;&lt;5)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8h_source.html#l00024">24</a> of file <a class="el" href="forcetree_8h_source.html">forcetree.h</a>.</p>

</div>
</div>
<a id="a3e094756ac8122f169dee095986c84b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e094756ac8122f169dee095986c84b0">&#9670;&nbsp;</a></span>DMMASK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DMMASK&#160;&#160;&#160;(2)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8h_source.html#l00022">22</a> of file <a class="el" href="forcetree_8h_source.html">forcetree.h</a>.</p>

</div>
</div>
<a id="ad7d9abc3063766d4c2825954b8354f70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7d9abc3063766d4c2825954b8354f70">&#9670;&nbsp;</a></span>GASMASK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define GASMASK&#160;&#160;&#160;(1)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8h_source.html#l00021">21</a> of file <a class="el" href="forcetree_8h_source.html">forcetree.h</a>.</p>

</div>
</div>
<a id="afcfeb1a32a47b8b7f8bce9222b542a9e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afcfeb1a32a47b8b7f8bce9222b542a9e">&#9670;&nbsp;</a></span>NMAXCHILD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NMAXCHILD&#160;&#160;&#160;8</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8h_source.html#l00012">12</a> of file <a class="el" href="forcetree_8h_source.html">forcetree.h</a>.</p>

</div>
</div>
<a id="a3ad606200a7ba07b8766c7d37b2454c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ad606200a7ba07b8766c7d37b2454c7">&#9670;&nbsp;</a></span>NODE_NODE_TYPE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NODE_NODE_TYPE&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8h_source.html#l00016">16</a> of file <a class="el" href="forcetree_8h_source.html">forcetree.h</a>.</p>

</div>
</div>
<a id="ac342a8bc2bb97849655e3ea50d3c5494"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac342a8bc2bb97849655e3ea50d3c5494">&#9670;&nbsp;</a></span>PARTICLE_NODE_TYPE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PARTICLE_NODE_TYPE&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8h_source.html#l00015">15</a> of file <a class="el" href="forcetree_8h_source.html">forcetree.h</a>.</p>

</div>
</div>
<a id="aca0ae17134eee3f867d5d7579a97ba64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca0ae17134eee3f867d5d7579a97ba64">&#9670;&nbsp;</a></span>PSEUDO_NODE_TYPE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PSEUDO_NODE_TYPE&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8h_source.html#l00017">17</a> of file <a class="el" href="forcetree_8h_source.html">forcetree.h</a>.</p>

</div>
</div>
<a id="ac0ad600f91ce6914ef7b31e6d35964a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0ad600f91ce6914ef7b31e6d35964a2">&#9670;&nbsp;</a></span>STARMASK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STARMASK&#160;&#160;&#160;(1&lt;&lt;4)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8h_source.html#l00023">23</a> of file <a class="el" href="forcetree_8h_source.html">forcetree.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a230362fdb55cd9e9b616388717d0f781"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a230362fdb55cd9e9b616388717d0f781">&#9670;&nbsp;</a></span>ForceTree</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structForceTree.html">ForceTree</a> <a class="el" href="structForceTree.html">ForceTree</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ab303b92c6d6b4144999c5cebabd65ec0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab303b92c6d6b4144999c5cebabd65ec0">&#9670;&nbsp;</a></span>dump_particles()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dump_particles </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a1886c54dda026ca16e1d52a530a44b30"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1886c54dda026ca16e1d52a530a44b30">&#9670;&nbsp;</a></span>force_get_father()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int force_get_father </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>no</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structForceTree.html">ForceTree</a> *&#160;</td>
          <td class="paramname"><em>tt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00905">905</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;{</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <span class="keywordflow">if</span>(no &gt;= tree-&gt;firstnode)</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <span class="keywordflow">return</span> tree-&gt;Nodes[no].father;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <span class="keywordflow">return</span> tree-&gt;Father[no];</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="forcetree_8h_source.html#l00041">NODE::father</a>, <a class="el" href="forcetree_8h_source.html#l00103">ForceTree::Father</a>, <a class="el" href="forcetree_8h_source.html#l00084">ForceTree::firstnode</a>, and <a class="el" href="forcetree_8h_source.html#l00097">ForceTree::Nodes</a>.</p>

<p class="reference">Referenced by <a class="el" href="gravpm_8c_source.html#l00117">_prepare()</a>, <a class="el" href="test__forcetree_8c_source.html#l00067">check_moments()</a>, <a class="el" href="test__forcetree_8c_source.html#l00153">check_tree()</a>, <a class="el" href="metal__return_8c_source.html#l00772">effhsml()</a>, <a class="el" href="forcetree_8c_source.html#l00110">force_tree_eh_slots_fork()</a>, <a class="el" href="treewalk_8c_source.html#l01052">ngb_treefind_threads()</a>, <a class="el" href="test__density_8c_source.html#l00034">set_init_hsml()</a>, and <a class="el" href="init_8c_source.html#l00439">setup_smoothinglengths()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8h_a1886c54dda026ca16e1d52a530a44b30_icgraph.svg" width="1772" height="1343"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a54bd715ce16fc7cad4beae50e36690ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54bd715ce16fc7cad4beae50e36690ef">&#9670;&nbsp;</a></span>force_tree_allocated()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int force_tree_allocated </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structForceTree.html">ForceTree</a> *&#160;</td>
          <td class="paramname"><em>tt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00134">134</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;{</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordflow">return</span> tree-&gt;tree_allocated_flag;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="forcetree_8h_source.html#l00078">ForceTree::tree_allocated_flag</a>.</p>

<p class="reference">Referenced by <a class="el" href="gravpm_8c_source.html#l00117">_prepare()</a>, <a class="el" href="forcetree_8c_source.html#l01409">force_tree_free()</a>, <a class="el" href="forcetree_8c_source.html#l00140">force_tree_rebuild()</a>, <a class="el" href="forcetree_8c_source.html#l00161">force_tree_rebuild_mask()</a>, <a class="el" href="sfr__eff_8c_source.html#l00380">sfr_reserve_slots()</a>, and <a class="el" href="treewalk_8c_source.html#l00619">treewalk_run()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8h_a54bd715ce16fc7cad4beae50e36690ef_icgraph.svg" width="1586" height="1503"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a54c1bcfde446f424ff0b7f89199dde0a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54c1bcfde446f424ff0b7f89199dde0a">&#9670;&nbsp;</a></span>force_tree_create_nodes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int force_tree_create_nodes </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structForceTree.html">ForceTree</a>&#160;</td>
          <td class="paramname"><em>tb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>npart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDomainDecomp.html">DomainDecomp</a> *&#160;</td>
          <td class="paramname"><em>ddecomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>HybridNuGrav</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Does initial creation of the nodes for the gravitational oct-tree. mask is a bitfield: Only types whose bit is set are added. </p>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00661">661</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;{</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="keywordtype">int</span> nnext = tb.<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>;       <span class="comment">/* index of first free node */</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160; </div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="comment">/* create an empty root node  */</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        <span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> *nfreep = &amp;tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[nnext]; <span class="comment">/* select first node */</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160; </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a> = <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#afd51316d545eaf7f3f083aea9616858d">BoxSize</a>*1.001;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordflow">for</span>(i = 0; i &lt; 3; i++)</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;            nfreep-&gt;<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[i] = <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#afd51316d545eaf7f3f083aea9616858d">BoxSize</a>/2.;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="forcetree_8h.html#afcfeb1a32a47b8b7f8bce9222b542a9e">NMAXCHILD</a>; i++)</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            nfreep-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[i] = -1;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#ac1593255d2d991cb18a3b4b0d5f4f7a6">Types</a> = 0;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a> = 0;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a> = -1;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a> = -1;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#aa3b4bfc6b6c8c99d88860a5262679487">TopLevel</a> = 1;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#ac63501e2f4f5076dfe3534268e89bc39">InternalTopLevel</a> = 0;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a1ff8c5e570722798d188c60455312fa2">DependsOnLocalMass</a> = 0;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> = <a class="code" href="forcetree_8h.html#ac342a8bc2bb97849655e3ea50d3c5494">PARTICLE_NODE_TYPE</a>;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a85ba1893599828fd008829ac46e5a234">unused</a> = 0;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        memset(&amp;(nfreep-&gt;<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>),0,3*<span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a>));</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a> = 0;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a> = 0;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        nnext++;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        <span class="comment">/* create a set of empty nodes corresponding to the top-level ddecomp</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="comment">         * grid. We need to generate these nodes first to make sure that we have a</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="comment">         * complete top-level tree which allows the easy insertion of the</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="comment">         * pseudo-particles in the right place */</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        <a class="code" href="forcetree_8c.html#a4a6ff36eefac3d77669f28982e4f02b0">force_create_node_for_topnode</a>(tb.<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>, 0, tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>, ddecomp, 1, 0, 0, 0, &amp;nnext, tb.<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a>);</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    }</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="comment">/* Set up thread-local copies of the topnodes to anchor the subtrees. */</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>, j, t;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    MPI_Comm_rank(MPI_COMM_WORLD, &amp;<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>);</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> StartLeaf = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">Tasks</a>[<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>].<a class="code" href="structtask__data.html#adb9ec65f9257aa87c1811f283061ef4b">StartLeaf</a>;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> EndLeaf = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">Tasks</a>[<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>].<a class="code" href="structtask__data.html#a3282c0a233e6ab985c0c9568f2589a6f">EndLeaf</a>;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> nthr = omp_get_max_threads();</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="keywordtype">int</span> * topnodes = <a class="code" href="mymalloc_8h.html#a52bc2c6ec78b17bb6d42957cbf642f15">ta_malloc</a>(<span class="stringliteral">&quot;topnodes&quot;</span>, <span class="keywordtype">int</span>, (EndLeaf - StartLeaf) * nthr);</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="comment">/* Topnodes for each thread. For tid 0, just use the real tree. Saves copying the tree back.*/</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keywordflow">for</span>(j = 0; j &lt; EndLeaf - StartLeaf; j++)</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        topnodes[j] = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#adcfdab38d4690533d89c93b927df477f">TopLeaves</a>[j + StartLeaf].<a class="code" href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">treenode</a>;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="comment">/* Other threads need a copy*/</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="keywordflow">for</span>(t = 1; t &lt; nthr; t++) {</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <span class="keywordflow">for</span>(j = 0; j &lt; EndLeaf - StartLeaf; j++) {</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            <span class="comment">/* Make a local copy*/</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            topnodes[j + t * (EndLeaf - StartLeaf)] = nnext;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            memmove(&amp;tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[nnext], &amp;tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[topnodes[j]], <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structNODE.html">NODE</a>));</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            nnext++;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        }</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    }</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160; </div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="comment">/*     double tstart = second(); */</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> first_free = nnext;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="comment">/* Increment nnext for the threads we are about to initialise.*/</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    nnext += <a class="code" href="forcetree_8c.html#ae9d22ac96be9a18932a00837b0a78f30">NODECACHE_SIZE</a> * nthr;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="comment">/* now we insert all particles */</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="preprocessor">    #pragma omp parallel</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    {</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="comment">/* Local topnodes*/</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <span class="keywordtype">int</span> tid = omp_get_thread_num();</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> * <span class="keyword">const</span> local_topnodes = topnodes + tid * (EndLeaf - StartLeaf);</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160; </div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <span class="comment">/* This implements a small thread-local free Node cache.</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="comment">         * The cache ensures that Nodes from the same (or close) particles</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment">         * are created close to each other on the Node list and thus</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment">         * helps cache locality. I tried each thread getting a separate</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="comment">         * part of the tree, and it wasted too much memory. */</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        <span class="keyword">struct </span><a class="code" href="structNodeCache.html">NodeCache</a> nc;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        nc.<a class="code" href="structNodeCache.html#a9486e11f8687f7f5797654f117a50c8c">nnext_thread</a> = first_free + tid * <a class="code" href="forcetree_8c.html#ae9d22ac96be9a18932a00837b0a78f30">NODECACHE_SIZE</a>;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        nc.nrem_thread = <a class="code" href="forcetree_8c.html#ae9d22ac96be9a18932a00837b0a78f30">NODECACHE_SIZE</a>;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160; </div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        <span class="comment">/* Stores the last-seen node on this thread.</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="comment">         * Since most particles are close to each other, this should save a number of tree walks.*/</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        <span class="keywordtype">int</span> this_acc = local_topnodes[0];</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        <span class="comment">// message(1, &quot;Topnodes %d real %d\n&quot;, local_topnodes[0], topnodes[0]);</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160; </div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <span class="comment">/* The default schedule is static with a chunk 1/4 the total.</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="comment">         * However, particles are sorted by type and then by peano order.</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment">         * Since we need to merge trees, it is advantageous to have all particles</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="comment">         * spatially close be processed by the same thread. This means that the threads should</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment">         * process particles at a constant offset from the start of the type.</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="comment">         * We do this with a static schedule. */</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        <span class="keywordtype">int</span> chnksz = <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a>/nthr;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[0].<a class="code" href="structslot__info.html#a29b1b6c4eae612eca7f1125a0c854436">enabled</a> &amp;&amp; <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[0].<a class="code" href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">size</a> &gt; 0)</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            chnksz = <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[0].<a class="code" href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">size</a>/nthr;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="keywordflow">if</span>(chnksz &lt; 1000)</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            chnksz = 1000;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="preprocessor">        #pragma omp for schedule(static, chnksz)</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="keywordflow">for</span>(i = 0; i &lt; npart; i++)</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        {</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            <span class="comment">/*Can&#39;t break from openmp for*/</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            <span class="keywordflow">if</span>(nc.nnext_thread &gt;= tb.<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a>)</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160; </div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            <span class="comment">/* Do not add types that do not have their mask bit set.*/</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            <span class="keywordflow">if</span>(!((1&lt;&lt;<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Type) &amp; mask)) {</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            }</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            <span class="comment">/* Do not add garbage/swallowed particles to the tree*/</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].IsGarbage || (<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Swallowed &amp;&amp; <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Type==5))</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Mass == 0)</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(12, <span class="stringliteral">&quot;Zero mass particle %d type %d id %ld pos %g %g %g\n&quot;</span>, i, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Type, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].ID, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Pos[0], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Pos[1], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Pos[2]);</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            <span class="comment">/*First find the Node for the TopLeaf */</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            <span class="keywordtype">int</span> cur;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#ab3ee27767a982ea77a18f5f4983e4344">inside_node</a>(&amp;tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[this_acc], i)) {</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                cur = this_acc;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                <span class="comment">/* Get the topnode to which a particle belongs. Each local tree</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="comment">                 * has a local set of treenodes copying the global topnodes, except tid 0</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="comment">                 * which has the real topnodes.*/</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> topleaf = <a class="code" href="domain_8h.html#aa7470209c061c08a6f7a32ad9c3610a5">domain_get_topleaf</a>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Key, ddecomp);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                <span class="comment">//int treenode = ddecomp-&gt;TopLeaves[topleaf].treenode;</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                cur = local_topnodes[topleaf - StartLeaf];</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            }</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160; </div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            this_acc = <a class="code" href="forcetree_8c.html#aa745b024ee4449af60e622e8c2bc32c1">add_particle_to_tree</a>(i, cur, tb, HybridNuGrav, &amp;nc, &amp;nnext);</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        }</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        <span class="comment">/* The implicit omp-barrier is important here!*/</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="comment">/*         double tend = second(); */</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="comment">/*         message(0, &quot;Initial insertion: %.3g ms. First node %d\n&quot;, (tend - tstart)*1000, local_topnodes[0]); */</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160; </div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="comment">/* Merge each topnode separately, using a for loop.</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="comment">         * This wastes threads if NTHREAD &gt; NTOPNODES, but it</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="comment">         * means only one merge is done per subtree and</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment">         * it requires no locking.*/</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="preprocessor">        #pragma omp for schedule(static, 1)</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <span class="keywordflow">for</span>(i = 0; i &lt; EndLeaf - StartLeaf; i++) {</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;            <span class="keywordtype">int</span> t;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            <span class="comment">/* These are the addresses of the real topnodes*/</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> target = topnodes[i];</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;            <span class="keywordflow">if</span>(nc.nnext_thread &gt;= tb.<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a>)</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;            <span class="keywordflow">for</span>(t = 1; t &lt; nthr; t++) {</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> righttop = topnodes[i + t * (EndLeaf - StartLeaf)];</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment">//                  message(1, &quot;tid = %d i = %d t = %d Merging %d to %d addresses are %lx - %lx end is %lx\n&quot;, omp_get_thread_num(), i, t, righttop, target, &amp;tb.Nodes[righttop], &amp;tb.Nodes[target], &amp;tb.Nodes[nnext]);</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#a43eea1e716d44d6b38a732d94df1b4ce">merge_partial_force_trees</a>(target, righttop, &amp;nc, &amp;nnext, tb, HybridNuGrav))</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            }</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        }</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    }</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160; </div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <a class="code" href="mymalloc_8h.html#a84e2115e90e9c22e11d9663c019fc8bc">ta_free</a>(topnodes);</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordflow">return</span> nnext - tb.<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;}</div>
<div class="ttc" id="adomain_8h_html_aa7470209c061c08a6f7a32ad9c3610a5"><div class="ttname"><a href="domain_8h.html#aa7470209c061c08a6f7a32ad9c3610a5">domain_get_topleaf</a></div><div class="ttdeci">static int domain_get_topleaf(const peano_t key, const DomainDecomp *ddecomp)</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00074">domain.h:74</a></div></div>
<div class="ttc" id="aendrun_8c_html_ad963d7efdb9f10f7a2298c8ccd222ab0"><div class="ttname"><a href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a></div><div class="ttdeci">void endrun(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00147">endrun.c:147</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a43eea1e716d44d6b38a732d94df1b4ce"><div class="ttname"><a href="forcetree_8c.html#a43eea1e716d44d6b38a732d94df1b4ce">merge_partial_force_trees</a></div><div class="ttdeci">int merge_partial_force_trees(int left, int right, struct NodeCache *nc, int *nnext, const struct ForceTree tb, int HybridNuGrav)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00533">forcetree.c:533</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a4a6ff36eefac3d77669f28982e4f02b0"><div class="ttname"><a href="forcetree_8c.html#a4a6ff36eefac3d77669f28982e4f02b0">force_create_node_for_topnode</a></div><div class="ttdeci">static void force_create_node_for_topnode(int no, int topnode, struct NODE *Nodes, const DomainDecomp *ddecomp, int bits, int x, int y, int z, int *nextfree, const int lastnode)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00818">forcetree.c:818</a></div></div>
<div class="ttc" id="aforcetree_8c_html_aa745b024ee4449af60e622e8c2bc32c1"><div class="ttname"><a href="forcetree_8c.html#aa745b024ee4449af60e622e8c2bc32c1">add_particle_to_tree</a></div><div class="ttdeci">int add_particle_to_tree(int i, int cur_start, const ForceTree tb, const int HybridNuGrav, struct NodeCache *nc, int *nnext)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00487">forcetree.c:487</a></div></div>
<div class="ttc" id="aforcetree_8c_html_ab3ee27767a982ea77a18f5f4983e4344"><div class="ttname"><a href="forcetree_8c.html#ab3ee27767a982ea77a18f5f4983e4344">inside_node</a></div><div class="ttdeci">static int inside_node(const struct NODE *node, const int p_i)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00291">forcetree.c:291</a></div></div>
<div class="ttc" id="aforcetree_8c_html_ae9d22ac96be9a18932a00837b0a78f30"><div class="ttname"><a href="forcetree_8c.html#ae9d22ac96be9a18932a00837b0a78f30">NODECACHE_SIZE</a></div><div class="ttdeci">#define NODECACHE_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00336">forcetree.c:336</a></div></div>
<div class="ttc" id="aforcetree_8h_html_ac342a8bc2bb97849655e3ea50d3c5494"><div class="ttname"><a href="forcetree_8h.html#ac342a8bc2bb97849655e3ea50d3c5494">PARTICLE_NODE_TYPE</a></div><div class="ttdeci">#define PARTICLE_NODE_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00015">forcetree.h:15</a></div></div>
<div class="ttc" id="aforcetree_8h_html_afcfeb1a32a47b8b7f8bce9222b542a9e"><div class="ttname"><a href="forcetree_8h.html#afcfeb1a32a47b8b7f8bce9222b542a9e">NMAXCHILD</a></div><div class="ttdeci">#define NMAXCHILD</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00012">forcetree.h:12</a></div></div>
<div class="ttc" id="amymalloc_8h_html_a52bc2c6ec78b17bb6d42957cbf642f15"><div class="ttname"><a href="mymalloc_8h.html#a52bc2c6ec78b17bb6d42957cbf642f15">ta_malloc</a></div><div class="ttdeci">#define ta_malloc(name, type, nele)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00025">mymalloc.h:25</a></div></div>
<div class="ttc" id="amymalloc_8h_html_a84e2115e90e9c22e11d9663c019fc8bc"><div class="ttname"><a href="mymalloc_8h.html#a84e2115e90e9c22e11d9663c019fc8bc">ta_free</a></div><div class="ttdeci">#define ta_free(p)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00028">mymalloc.h:28</a></div></div>
<div class="ttc" id="apartmanager_8c_html_a6cef44682776e476d8f9f1b9e1f9fe16"><div class="ttname"><a href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a></div><div class="ttdeci">struct part_manager_type PartManager[1]</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8c_source.html#l00001">partmanager.c:11</a></div></div>
<div class="ttc" id="apartmanager_8h_html_a2748566f4c443ee77aa831e63dbb5ebe"><div class="ttname"><a href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a></div><div class="ttdeci">#define P</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00088">partmanager.h:88</a></div></div>
<div class="ttc" id="aslotsmanager_8c_html_aa317621b6c60bc95c5f3e33c648e8392"><div class="ttname"><a href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a></div><div class="ttdeci">struct slots_manager_type SlotsManager[1]</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8c_source.html#l00001">slotsmanager.c:7</a></div></div>
<div class="ttc" id="astructDomainDecomp_html_a77ea7d828deab5bbd9714c0691c2e3ee"><div class="ttname"><a href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">DomainDecomp::Tasks</a></div><div class="ttdeci">struct task_data * Tasks</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00041">domain.h:41</a></div></div>
<div class="ttc" id="astructDomainDecomp_html_adcfdab38d4690533d89c93b927df477f"><div class="ttname"><a href="structDomainDecomp.html#adcfdab38d4690533d89c93b927df477f">DomainDecomp::TopLeaves</a></div><div class="ttdeci">struct topleaf_data * TopLeaves</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00037">domain.h:37</a></div></div>
<div class="ttc" id="astructForceTree_html_abc4bf1553d516b1b9b9c672b0a371bb1"><div class="ttname"><a href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">ForceTree::Nodes</a></div><div class="ttdeci">struct NODE * Nodes</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00097">forcetree.h:97</a></div></div>
<div class="ttc" id="astructForceTree_html_abf7b0590c6127d64c7596ea0363d6f7e"><div class="ttname"><a href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">ForceTree::firstnode</a></div><div class="ttdeci">int firstnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00084">forcetree.h:84</a></div></div>
<div class="ttc" id="astructForceTree_html_ae724473c76c778705c3f287c769b287f"><div class="ttname"><a href="structForceTree.html#ae724473c76c778705c3f287c769b287f">ForceTree::lastnode</a></div><div class="ttdeci">int lastnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00086">forcetree.h:86</a></div></div>
<div class="ttc" id="astructNODE_html"><div class="ttname"><a href="structNODE.html">NODE</a></div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00038">forcetree.h:39</a></div></div>
<div class="ttc" id="astructNODE_html_a0e5a3f58232208e4ad8570f801bf5713"><div class="ttname"><a href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">NODE::sibling</a></div><div class="ttdeci">int sibling</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00040">forcetree.h:40</a></div></div>
<div class="ttc" id="astructNODE_html_a14f3123f334264157f4b2e74828cc644"><div class="ttname"><a href="structNODE.html#a14f3123f334264157f4b2e74828cc644">NODE::mom</a></div><div class="ttdeci">struct NODE::@9 mom</div></div>
<div class="ttc" id="astructNODE_html_a1ff8c5e570722798d188c60455312fa2"><div class="ttname"><a href="structNODE.html#a1ff8c5e570722798d188c60455312fa2">NODE::DependsOnLocalMass</a></div><div class="ttdeci">unsigned int DependsOnLocalMass</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00048">forcetree.h:48</a></div></div>
<div class="ttc" id="astructNODE_html_a3460a1b4f9607fe15e6adc40a737d947"><div class="ttname"><a href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">NODE::center</a></div><div class="ttdeci">MyFloat center[3]</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00043">forcetree.h:43</a></div></div>
<div class="ttc" id="astructNODE_html_a57b0c9ea5dcf02231f24ecbae9b5d492"><div class="ttname"><a href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">NODE::ChildType</a></div><div class="ttdeci">unsigned int ChildType</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00049">forcetree.h:49</a></div></div>
<div class="ttc" id="astructNODE_html_a5f599abbea1f0fc03e09d98232c740a8"><div class="ttname"><a href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">NODE::mass</a></div><div class="ttdeci">MyFloat mass</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00056">forcetree.h:56</a></div></div>
<div class="ttc" id="astructNODE_html_a85ba1893599828fd008829ac46e5a234"><div class="ttname"><a href="structNODE.html#a85ba1893599828fd008829ac46e5a234">NODE::unused</a></div><div class="ttdeci">unsigned int unused</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00051">forcetree.h:51</a></div></div>
<div class="ttc" id="astructNODE_html_a99422a4018ea66f6dbc395d9a7babd70"><div class="ttname"><a href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">NODE::hmax</a></div><div class="ttdeci">MyFloat hmax</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00057">forcetree.h:57</a></div></div>
<div class="ttc" id="astructNODE_html_a9a1b7edbe811165e40220f63a38f2d16"><div class="ttname"><a href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">NODE::father</a></div><div class="ttdeci">int father</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00041">forcetree.h:41</a></div></div>
<div class="ttc" id="astructNODE_html_a9cb41ac11c7c89d9a2b9429163057fb9"><div class="ttname"><a href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">NODE::cofm</a></div><div class="ttdeci">MyFloat cofm[3]</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00055">forcetree.h:55</a></div></div>
<div class="ttc" id="astructNODE_html_aa3b4bfc6b6c8c99d88860a5262679487"><div class="ttname"><a href="structNODE.html#aa3b4bfc6b6c8c99d88860a5262679487">NODE::TopLevel</a></div><div class="ttdeci">unsigned int TopLevel</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00047">forcetree.h:47</a></div></div>
<div class="ttc" id="astructNODE_html_ac33651457a5203e28e3506ab7b1fc6b4"><div class="ttname"><a href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">NODE::s</a></div><div class="ttdeci">struct NodeChild s</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00043">forcetree.h:66</a></div></div>
<div class="ttc" id="astructNODE_html_ac63501e2f4f5076dfe3534268e89bc39"><div class="ttname"><a href="structNODE.html#ac63501e2f4f5076dfe3534268e89bc39">NODE::InternalTopLevel</a></div><div class="ttdeci">unsigned int InternalTopLevel</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00046">forcetree.h:46</a></div></div>
<div class="ttc" id="astructNODE_html_ae1b65804a87e4675c77339a0d03f2063"><div class="ttname"><a href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">NODE::f</a></div><div class="ttdeci">struct NODE::@8 f</div></div>
<div class="ttc" id="astructNODE_html_ae6d6383dc0bc3e1660bbe700b77a85ab"><div class="ttname"><a href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">NODE::len</a></div><div class="ttdeci">MyFloat len</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00042">forcetree.h:42</a></div></div>
<div class="ttc" id="astructNodeCache_html"><div class="ttname"><a href="structNodeCache.html">NodeCache</a></div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00339">forcetree.c:339</a></div></div>
<div class="ttc" id="astructNodeCache_html_a9486e11f8687f7f5797654f117a50c8c"><div class="ttname"><a href="structNodeCache.html#a9486e11f8687f7f5797654f117a50c8c">NodeCache::nnext_thread</a></div><div class="ttdeci">int nnext_thread</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00340">forcetree.c:340</a></div></div>
<div class="ttc" id="astructNodeChild_html_a43cab418056b25e2b5b28a1d6b4d045a"><div class="ttname"><a href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">NodeChild::noccupied</a></div><div class="ttdeci">int noccupied</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00035">forcetree.h:35</a></div></div>
<div class="ttc" id="astructNodeChild_html_a82c1937a3bd5a4b54d8679e7fe76788b"><div class="ttname"><a href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">NodeChild::suns</a></div><div class="ttdeci">int suns[NMAXCHILD]</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00032">forcetree.h:32</a></div></div>
<div class="ttc" id="astructNodeChild_html_ac1593255d2d991cb18a3b4b0d5f4f7a6"><div class="ttname"><a href="structNodeChild.html#ac1593255d2d991cb18a3b4b0d5f4f7a6">NodeChild::Types</a></div><div class="ttdeci">unsigned int Types</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00030">forcetree.h:30</a></div></div>
<div class="ttc" id="astructpart__manager__type_html_a45e1f95715be50e4081af78f4ee99cb5"><div class="ttname"><a href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">part_manager_type::NumPart</a></div><div class="ttdeci">int64_t NumPart</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00076">partmanager.h:76</a></div></div>
<div class="ttc" id="astructpart__manager__type_html_afd51316d545eaf7f3f083aea9616858d"><div class="ttname"><a href="structpart__manager__type.html#afd51316d545eaf7f3f083aea9616858d">part_manager_type::BoxSize</a></div><div class="ttdeci">double BoxSize</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00084">partmanager.h:84</a></div></div>
<div class="ttc" id="astructslot__info_html_a29b1b6c4eae612eca7f1125a0c854436"><div class="ttname"><a href="structslot__info.html#a29b1b6c4eae612eca7f1125a0c854436">slot_info::enabled</a></div><div class="ttdeci">int enabled</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00014">slotsmanager.h:14</a></div></div>
<div class="ttc" id="astructslot__info_html_aa651c4c7d01687a0b313076c0266465f"><div class="ttname"><a href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">slot_info::size</a></div><div class="ttdeci">int64_t size</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00012">slotsmanager.h:12</a></div></div>
<div class="ttc" id="astructslots__manager__type_html_a2b662d46902bf6fffca8b3fa2534a4e4"><div class="ttname"><a href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">slots_manager_type::info</a></div><div class="ttdeci">struct slot_info info[6]</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00108">slotsmanager.h:112</a></div></div>
<div class="ttc" id="astructtask__data_html_a3282c0a233e6ab985c0c9568f2589a6f"><div class="ttname"><a href="structtask__data.html#a3282c0a233e6ab985c0c9568f2589a6f">task_data::EndLeaf</a></div><div class="ttdeci">int EndLeaf</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00030">domain.h:30</a></div></div>
<div class="ttc" id="astructtask__data_html_adb9ec65f9257aa87c1811f283061ef4b"><div class="ttname"><a href="structtask__data.html#adb9ec65f9257aa87c1811f283061ef4b">task_data::StartLeaf</a></div><div class="ttdeci">int StartLeaf</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00029">domain.h:29</a></div></div>
<div class="ttc" id="astructtopleaf__data_html_ab948aab0a7ca32817caaaec832643645"><div class="ttname"><a href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">topleaf_data::treenode</a></div><div class="ttdeci">int treenode</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00024">domain.h:24</a></div></div>
<div class="ttc" id="atest__exchange_8c_html_a52c8c7d2abff436111942e02c5bb466a"><div class="ttname"><a href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a></div><div class="ttdeci">int ThisTask</div><div class="ttdef"><b>Definition:</b> <a href="test__exchange_8c_source.html#l00023">test_exchange.c:23</a></div></div>
<div class="ttc" id="atypes_8h_html_af1ada7381a1118c6d51bdbb0b5e72811"><div class="ttname"><a href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a></div><div class="ttdeci">LOW_PRECISION MyFloat</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00019">types.h:19</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="forcetree_8c_source.html#l00487">add_particle_to_tree()</a>, <a class="el" href="partmanager_8h_source.html#l00084">part_manager_type::BoxSize</a>, <a class="el" href="forcetree_8h_source.html#l00043">NODE::center</a>, <a class="el" href="forcetree_8h_source.html#l00049">NODE::ChildType</a>, <a class="el" href="forcetree_8h_source.html#l00055">NODE::cofm</a>, <a class="el" href="forcetree_8h_source.html#l00048">NODE::DependsOnLocalMass</a>, <a class="el" href="domain_8h_source.html#l00074">domain_get_topleaf()</a>, <a class="el" href="slotsmanager_8h_source.html#l00014">slot_info::enabled</a>, <a class="el" href="domain_8h_source.html#l00030">task_data::EndLeaf</a>, <a class="el" href="endrun_8c_source.html#l00147">endrun()</a>, <a class="el" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">NODE::f</a>, <a class="el" href="forcetree_8h_source.html#l00041">NODE::father</a>, <a class="el" href="forcetree_8h_source.html#l00084">ForceTree::firstnode</a>, <a class="el" href="forcetree_8c_source.html#l00818">force_create_node_for_topnode()</a>, <a class="el" href="forcetree_8h_source.html#l00057">NODE::hmax</a>, <a class="el" href="slotsmanager_8h_source.html#l00112">slots_manager_type::info</a>, <a class="el" href="forcetree_8c_source.html#l00291">inside_node()</a>, <a class="el" href="forcetree_8h_source.html#l00046">NODE::InternalTopLevel</a>, <a class="el" href="forcetree_8h_source.html#l00086">ForceTree::lastnode</a>, <a class="el" href="forcetree_8h_source.html#l00042">NODE::len</a>, <a class="el" href="forcetree_8h_source.html#l00056">NODE::mass</a>, <a class="el" href="forcetree_8c_source.html#l00533">merge_partial_force_trees()</a>, <a class="el" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">NODE::mom</a>, <a class="el" href="forcetree_8h_source.html#l00012">NMAXCHILD</a>, <a class="el" href="forcetree_8c_source.html#l00340">NodeCache::nnext_thread</a>, <a class="el" href="forcetree_8h_source.html#l00035">NodeChild::noccupied</a>, <a class="el" href="forcetree_8c_source.html#l00336">NODECACHE_SIZE</a>, <a class="el" href="forcetree_8h_source.html#l00097">ForceTree::Nodes</a>, <a class="el" href="forcetree_8c_source.html#l00341">NodeCache::nrem_thread</a>, <a class="el" href="partmanager_8h_source.html#l00076">part_manager_type::NumPart</a>, <a class="el" href="partmanager_8h_source.html#l00088">P</a>, <a class="el" href="forcetree_8h_source.html#l00015">PARTICLE_NODE_TYPE</a>, <a class="el" href="partmanager_8c_source.html#l00011">PartManager</a>, <a class="el" href="forcetree_8h_source.html#l00066">NODE::s</a>, <a class="el" href="forcetree_8h_source.html#l00040">NODE::sibling</a>, <a class="el" href="slotsmanager_8h_source.html#l00012">slot_info::size</a>, <a class="el" href="slotsmanager_8c_source.html#l00007">SlotsManager</a>, <a class="el" href="domain_8h_source.html#l00029">task_data::StartLeaf</a>, <a class="el" href="forcetree_8h_source.html#l00032">NodeChild::suns</a>, <a class="el" href="mymalloc_8h_source.html#l00028">ta_free</a>, <a class="el" href="mymalloc_8h_source.html#l00025">ta_malloc</a>, <a class="el" href="domain_8h_source.html#l00041">DomainDecomp::Tasks</a>, <a class="el" href="test__exchange_8c_source.html#l00023">ThisTask</a>, <a class="el" href="domain_8h_source.html#l00037">DomainDecomp::TopLeaves</a>, <a class="el" href="forcetree_8h_source.html#l00047">NODE::TopLevel</a>, <a class="el" href="domain_8h_source.html#l00024">topleaf_data::treenode</a>, <a class="el" href="forcetree_8h_source.html#l00030">NodeChild::Types</a>, and <a class="el" href="forcetree_8h_source.html#l00051">NODE::unused</a>.</p>

<p class="reference">Referenced by <a class="el" href="test__forcetree_8c_source.html#l00207">do_tree_test()</a>, and <a class="el" href="forcetree_8c_source.html#l00191">force_tree_build()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8h_a54c1bcfde446f424ff0b7f89199dde0a_cgraph.svg" width="1376" height="399"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8h_a54c1bcfde446f424ff0b7f89199dde0a_icgraph.svg" width="1534" height="823"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="af9653023aff6e0f8f6aac05fd498348c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9653023aff6e0f8f6aac05fd498348c">&#9670;&nbsp;</a></span>force_tree_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void force_tree_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structForceTree.html">ForceTree</a> *&#160;</td>
          <td class="paramname"><em>tree</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function frees the memory allocated for the tree, i.e. it frees the space allocated by the function <a class="el" href="forcetree_8c.html#a68ccb093e6e43385d633074edd4aee40">force_treeallocate()</a>. </p>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l01409">1409</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;{</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    <a class="code" href="event_8c.html#a4b5347d345f55b1b454c1eeb02916ca8">event_unlisten</a>(&amp;<a class="code" href="event_8c.html#aafc3f0c1fffb6f0a19f5f3ecd24474c7">EventSlotsFork</a>, <a class="code" href="forcetree_8c.html#a6c833489d009e4b5e850dc5997214775">force_tree_eh_slots_fork</a>, tree);</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160; </div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="forcetree_8c.html#a6676b2eba19512b1671a4c21fcb6e71d">force_tree_allocated</a>(tree))</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(tree-&gt;<a class="code" href="structForceTree.html#a9b388efae8d9d4be5e14030d65a17819">Nodes_base</a>);</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(tree-&gt;<a class="code" href="structForceTree.html#a9c794bfbfd1b1c68d201af6a8564fd13">Father</a>);</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    tree-&gt;<a class="code" href="structForceTree.html#a843ac282eda641c264da5de145287dbf">tree_allocated_flag</a> = 0;</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;}</div>
<div class="ttc" id="aevent_8c_html_a4b5347d345f55b1b454c1eeb02916ca8"><div class="ttname"><a href="event_8c.html#a4b5347d345f55b1b454c1eeb02916ca8">event_unlisten</a></div><div class="ttdeci">int event_unlisten(EventSpec *eh, eventfunc func, void *userdata)</div><div class="ttdef"><b>Definition:</b> <a href="event_8c_source.html#l00026">event.c:26</a></div></div>
<div class="ttc" id="aevent_8c_html_aafc3f0c1fffb6f0a19f5f3ecd24474c7"><div class="ttname"><a href="event_8c.html#aafc3f0c1fffb6f0a19f5f3ecd24474c7">EventSlotsFork</a></div><div class="ttdeci">EventSpec EventSlotsFork</div><div class="ttdef"><b>Definition:</b> <a href="event_8c_source.html#l00054">event.c:54</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a6676b2eba19512b1671a4c21fcb6e71d"><div class="ttname"><a href="forcetree_8c.html#a6676b2eba19512b1671a4c21fcb6e71d">force_tree_allocated</a></div><div class="ttdeci">int force_tree_allocated(const ForceTree *tree)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00134">forcetree.c:134</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a6c833489d009e4b5e850dc5997214775"><div class="ttname"><a href="forcetree_8c.html#a6c833489d009e4b5e850dc5997214775">force_tree_eh_slots_fork</a></div><div class="ttdeci">static int force_tree_eh_slots_fork(EIBase *event, void *userdata)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00110">forcetree.c:110</a></div></div>
<div class="ttc" id="amymalloc_8h_html_af469c2f7e504a771f5d8a91ac9623240"><div class="ttname"><a href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a></div><div class="ttdeci">#define myfree(x)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00019">mymalloc.h:19</a></div></div>
<div class="ttc" id="astructForceTree_html_a843ac282eda641c264da5de145287dbf"><div class="ttname"><a href="structForceTree.html#a843ac282eda641c264da5de145287dbf">ForceTree::tree_allocated_flag</a></div><div class="ttdeci">int tree_allocated_flag</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00078">forcetree.h:78</a></div></div>
<div class="ttc" id="astructForceTree_html_a9b388efae8d9d4be5e14030d65a17819"><div class="ttname"><a href="structForceTree.html#a9b388efae8d9d4be5e14030d65a17819">ForceTree::Nodes_base</a></div><div class="ttdeci">struct NODE * Nodes_base</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00101">forcetree.h:101</a></div></div>
<div class="ttc" id="astructForceTree_html_a9c794bfbfd1b1c68d201af6a8564fd13"><div class="ttname"><a href="structForceTree.html#a9c794bfbfd1b1c68d201af6a8564fd13">ForceTree::Father</a></div><div class="ttdeci">int * Father</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00103">forcetree.h:103</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="event_8c_source.html#l00026">event_unlisten()</a>, <a class="el" href="event_8c_source.html#l00054">EventSlotsFork</a>, <a class="el" href="forcetree_8h_source.html#l00103">ForceTree::Father</a>, <a class="el" href="forcetree_8c_source.html#l00134">force_tree_allocated()</a>, <a class="el" href="forcetree_8c_source.html#l00110">force_tree_eh_slots_fork()</a>, <a class="el" href="mymalloc_8h_source.html#l00019">myfree</a>, <a class="el" href="forcetree_8h_source.html#l00101">ForceTree::Nodes_base</a>, and <a class="el" href="forcetree_8h_source.html#l00078">ForceTree::tree_allocated_flag</a>.</p>

<p class="reference">Referenced by <a class="el" href="gravpm_8c_source.html#l00117">_prepare()</a>, <a class="el" href="test__density_8c_source.html#l00080">do_density_test()</a>, <a class="el" href="test__gravity_8c_source.html#l00162">do_force_test()</a>, <a class="el" href="fof_8c_source.html#l00151">fof_fof()</a>, <a class="el" href="forcetree_8c_source.html#l00191">force_tree_build()</a>, <a class="el" href="forcetree_8c_source.html#l00140">force_tree_rebuild()</a>, <a class="el" href="forcetree_8c_source.html#l00161">force_tree_rebuild_mask()</a>, <a class="el" href="metal__return_8c_source.html#l00517">metal_return()</a>, <a class="el" href="run_8c_source.html#l00284">run()</a>, <a class="el" href="runtests_8c_source.html#l00071">run_gravity_test()</a>, <a class="el" href="run_8c_source.html#l00652">runfof()</a>, <a class="el" href="run_8c_source.html#l00691">runpower()</a>, <a class="el" href="init_8c_source.html#l00439">setup_smoothinglengths()</a>, <a class="el" href="test__forcetree_8c_source.html#l00276">test_rebuild_close()</a>, <a class="el" href="test__forcetree_8c_source.html#l00246">test_rebuild_flat()</a>, <a class="el" href="test__forcetree_8c_source.html#l00326">test_rebuild_random()</a>, and <a class="el" href="cooling__qso__lightup_8c_source.html#l00520">turn_on_quasars()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8h_af9653023aff6e0f8f6aac05fd498348c_cgraph.svg" width="540" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8h_af9653023aff6e0f8f6aac05fd498348c_icgraph.svg" width="1312" height="1000"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a5156dae3aae56140d6e9ae0ab58867cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5156dae3aae56140d6e9ae0ab58867cc">&#9670;&nbsp;</a></span>force_tree_rebuild()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void force_tree_rebuild </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structForceTree.html">ForceTree</a> *&#160;</td>
          <td class="paramname"><em>tree</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDomainDecomp.html">DomainDecomp</a> *&#160;</td>
          <td class="paramname"><em>ddecomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>HybridNuGrav</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>DoMoments</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>EmergencyOutputDir</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00140">140</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;{</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <a class="code" href="system_8h.html#a2ca58d338cd52c808ec1a86073940c49">MPIU_Barrier</a>(MPI_COMM_WORLD);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;Tree construction.  (presently allocated=%g MB)\n&quot;</span>, <a class="code" href="mymalloc_8h.html#ae51745d10f51ca300ad484ab4ecf7908">mymalloc_usedbytes</a>() / (1024.0 * 1024.0));</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#a6676b2eba19512b1671a4c21fcb6e71d">force_tree_allocated</a>(tree)) {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <a class="code" href="forcetree_8c.html#aaa26dfea4b696133a8bc35c5e0c56037">force_tree_free</a>(tree);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    }</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Misc&quot;</span>);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    *tree = <a class="code" href="forcetree_8c.html#a0de0fec1cfeb5e2aad5f33a843de25e7">force_tree_build</a>(<a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a>, <a class="code" href="forcetree_8h.html#a09c0db73b04ae32608387993001427ee">ALLMASK</a>, ddecomp, HybridNuGrav, DoMoments, EmergencyOutputDir);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <a class="code" href="event_8c.html#a3f548c264e5e5b9fe2bb8b10c177482a">event_listen</a>(&amp;<a class="code" href="event_8c.html#aafc3f0c1fffb6f0a19f5f3ecd24474c7">EventSlotsFork</a>, <a class="code" href="forcetree_8c.html#a6c833489d009e4b5e850dc5997214775">force_tree_eh_slots_fork</a>, tree);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Tree/Build/Moments&quot;</span>);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;Tree constructed (moments: %d). First node %d, number of nodes %d, first pseudo %d. NTopLeaves %d\n&quot;</span>,</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            tree-&gt;<a class="code" href="structForceTree.html#a4689b816563dd80b28c6a7de4d56e236">moments_computed_flag</a>, tree-&gt;<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>, tree-&gt;<a class="code" href="structForceTree.html#acd985b6d526df4466ad5f6850402c89e">numnodes</a>, tree-&gt;<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a>, tree-&gt;<a class="code" href="structForceTree.html#a2e227f51f43e9b318d9f9e67299da0ba">NTopLeaves</a>);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <a class="code" href="system_8h.html#a2ca58d338cd52c808ec1a86073940c49">MPIU_Barrier</a>(MPI_COMM_WORLD);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;}</div>
<div class="ttc" id="aendrun_8c_html_a6567cd867c5549fb6586e19ccd819764"><div class="ttname"><a href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a></div><div class="ttdeci">void message(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00175">endrun.c:175</a></div></div>
<div class="ttc" id="aevent_8c_html_a3f548c264e5e5b9fe2bb8b10c177482a"><div class="ttname"><a href="event_8c.html#a3f548c264e5e5b9fe2bb8b10c177482a">event_listen</a></div><div class="ttdeci">int event_listen(EventSpec *eh, eventfunc func, void *userdata)</div><div class="ttdef"><b>Definition:</b> <a href="event_8c_source.html#l00006">event.c:6</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a0de0fec1cfeb5e2aad5f33a843de25e7"><div class="ttname"><a href="forcetree_8c.html#a0de0fec1cfeb5e2aad5f33a843de25e7">force_tree_build</a></div><div class="ttdeci">static ForceTree force_tree_build(int npart, int mask, DomainDecomp *ddecomp, const int HybridNuGrav, const int DoMoments, const char *EmergencyOutputDir)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00191">forcetree.c:191</a></div></div>
<div class="ttc" id="aforcetree_8c_html_aaa26dfea4b696133a8bc35c5e0c56037"><div class="ttname"><a href="forcetree_8c.html#aaa26dfea4b696133a8bc35c5e0c56037">force_tree_free</a></div><div class="ttdeci">void force_tree_free(ForceTree *tree)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l01409">forcetree.c:1409</a></div></div>
<div class="ttc" id="aforcetree_8h_html_a09c0db73b04ae32608387993001427ee"><div class="ttname"><a href="forcetree_8h.html#a09c0db73b04ae32608387993001427ee">ALLMASK</a></div><div class="ttdeci">#define ALLMASK</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00020">forcetree.h:20</a></div></div>
<div class="ttc" id="amymalloc_8h_html_ae51745d10f51ca300ad484ab4ecf7908"><div class="ttname"><a href="mymalloc_8h.html#ae51745d10f51ca300ad484ab4ecf7908">mymalloc_usedbytes</a></div><div class="ttdeci">#define mymalloc_usedbytes()</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00032">mymalloc.h:32</a></div></div>
<div class="ttc" id="astructForceTree_html_a2e227f51f43e9b318d9f9e67299da0ba"><div class="ttname"><a href="structForceTree.html#a2e227f51f43e9b318d9f9e67299da0ba">ForceTree::NTopLeaves</a></div><div class="ttdeci">int NTopLeaves</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00094">forcetree.h:94</a></div></div>
<div class="ttc" id="astructForceTree_html_a4689b816563dd80b28c6a7de4d56e236"><div class="ttname"><a href="structForceTree.html#a4689b816563dd80b28c6a7de4d56e236">ForceTree::moments_computed_flag</a></div><div class="ttdeci">int moments_computed_flag</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00082">forcetree.h:82</a></div></div>
<div class="ttc" id="astructForceTree_html_acd985b6d526df4466ad5f6850402c89e"><div class="ttname"><a href="structForceTree.html#acd985b6d526df4466ad5f6850402c89e">ForceTree::numnodes</a></div><div class="ttdeci">int numnodes</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00088">forcetree.h:88</a></div></div>
<div class="ttc" id="asystem_8h_html_a2ca58d338cd52c808ec1a86073940c49"><div class="ttname"><a href="system_8h.html#a2ca58d338cd52c808ec1a86073940c49">MPIU_Barrier</a></div><div class="ttdeci">#define MPIU_Barrier(comm)</div><div class="ttdef"><b>Definition:</b> <a href="system_8h_source.html#l00103">system.h:103</a></div></div>
<div class="ttc" id="awalltime_8h_html_a2d23071e44d020b4a0b3f2876667d370"><div class="ttname"><a href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a></div><div class="ttdeci">#define walltime_measure(name)</div><div class="ttdef"><b>Definition:</b> <a href="walltime_8h_source.html#l00008">walltime.h:8</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="forcetree_8h_source.html#l00020">ALLMASK</a>, <a class="el" href="event_8c_source.html#l00006">event_listen()</a>, <a class="el" href="event_8c_source.html#l00054">EventSlotsFork</a>, <a class="el" href="forcetree_8h_source.html#l00084">ForceTree::firstnode</a>, <a class="el" href="forcetree_8c_source.html#l00134">force_tree_allocated()</a>, <a class="el" href="forcetree_8c_source.html#l00191">force_tree_build()</a>, <a class="el" href="forcetree_8c_source.html#l00110">force_tree_eh_slots_fork()</a>, <a class="el" href="forcetree_8c_source.html#l01409">force_tree_free()</a>, <a class="el" href="forcetree_8h_source.html#l00086">ForceTree::lastnode</a>, <a class="el" href="endrun_8c_source.html#l00175">message()</a>, <a class="el" href="forcetree_8h_source.html#l00082">ForceTree::moments_computed_flag</a>, <a class="el" href="system_8h_source.html#l00103">MPIU_Barrier</a>, <a class="el" href="mymalloc_8h_source.html#l00032">mymalloc_usedbytes</a>, <a class="el" href="forcetree_8h_source.html#l00094">ForceTree::NTopLeaves</a>, <a class="el" href="forcetree_8h_source.html#l00088">ForceTree::numnodes</a>, <a class="el" href="partmanager_8h_source.html#l00076">part_manager_type::NumPart</a>, <a class="el" href="partmanager_8c_source.html#l00011">PartManager</a>, and <a class="el" href="walltime_8h_source.html#l00008">walltime_measure</a>.</p>

<p class="reference">Referenced by <a class="el" href="test__density_8c_source.html#l00080">do_density_test()</a>, <a class="el" href="test__gravity_8c_source.html#l00162">do_force_test()</a>, <a class="el" href="run_8c_source.html#l00284">run()</a>, <a class="el" href="runtests_8c_source.html#l00071">run_gravity_test()</a>, <a class="el" href="run_8c_source.html#l00652">runfof()</a>, <a class="el" href="run_8c_source.html#l00691">runpower()</a>, and <a class="el" href="init_8c_source.html#l00439">setup_smoothinglengths()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8h_a5156dae3aae56140d6e9ae0ab58867cc_cgraph.svg" width="1836" height="1734"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8h_a5156dae3aae56140d6e9ae0ab58867cc_icgraph.svg" width="882" height="544"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aa01061828cef34bc4c55ef9eaa7c03f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa01061828cef34bc4c55ef9eaa7c03f5">&#9670;&nbsp;</a></span>force_tree_rebuild_mask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void force_tree_rebuild_mask </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structForceTree.html">ForceTree</a> *&#160;</td>
          <td class="paramname"><em>tree</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDomainDecomp.html">DomainDecomp</a> *&#160;</td>
          <td class="paramname"><em>ddecomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>HybridNuGrav</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>EmergencyOutputDir</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00161">161</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;{</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="system_8h.html#a2ca58d338cd52c808ec1a86073940c49">MPIU_Barrier</a>(MPI_COMM_WORLD);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;Tree construction for types: %d.\n&quot;</span>, mask);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#a6676b2eba19512b1671a4c21fcb6e71d">force_tree_allocated</a>(tree)) {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <a class="code" href="forcetree_8c.html#aaa26dfea4b696133a8bc35c5e0c56037">force_tree_free</a>(tree);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    }</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Misc&quot;</span>);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160; </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">/* No moments*/</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    *tree = <a class="code" href="forcetree_8c.html#a0de0fec1cfeb5e2aad5f33a843de25e7">force_tree_build</a>(<a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a>, mask, ddecomp, HybridNuGrav, 0, EmergencyOutputDir);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/SPH/Build&quot;</span>);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;Tree constructed (type mask: %d). First node %d, number of nodes %d, first pseudo %d. NTopLeaves %d\n&quot;</span>,</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            mask, tree-&gt;<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>, tree-&gt;<a class="code" href="structForceTree.html#acd985b6d526df4466ad5f6850402c89e">numnodes</a>, tree-&gt;<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a>, tree-&gt;<a class="code" href="structForceTree.html#a2e227f51f43e9b318d9f9e67299da0ba">NTopLeaves</a>);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="system_8h.html#a2ca58d338cd52c808ec1a86073940c49">MPIU_Barrier</a>(MPI_COMM_WORLD);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="forcetree_8h_source.html#l00084">ForceTree::firstnode</a>, <a class="el" href="forcetree_8c_source.html#l00134">force_tree_allocated()</a>, <a class="el" href="forcetree_8c_source.html#l00191">force_tree_build()</a>, <a class="el" href="forcetree_8c_source.html#l01409">force_tree_free()</a>, <a class="el" href="forcetree_8h_source.html#l00086">ForceTree::lastnode</a>, <a class="el" href="endrun_8c_source.html#l00175">message()</a>, <a class="el" href="system_8h_source.html#l00103">MPIU_Barrier</a>, <a class="el" href="forcetree_8h_source.html#l00094">ForceTree::NTopLeaves</a>, <a class="el" href="forcetree_8h_source.html#l00088">ForceTree::numnodes</a>, <a class="el" href="partmanager_8h_source.html#l00076">part_manager_type::NumPart</a>, <a class="el" href="partmanager_8c_source.html#l00011">PartManager</a>, and <a class="el" href="walltime_8h_source.html#l00008">walltime_measure</a>.</p>

<p class="reference">Referenced by <a class="el" href="fof_8c_source.html#l00151">fof_fof()</a>, <a class="el" href="metal__return_8c_source.html#l00517">metal_return()</a>, and <a class="el" href="cooling__qso__lightup_8c_source.html#l00520">turn_on_quasars()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8h_aa01061828cef34bc4c55ef9eaa7c03f5_cgraph.svg" width="1879" height="1618"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8h_aa01061828cef34bc4c55ef9eaa7c03f5_icgraph.svg" width="799" height="190"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a68ccb093e6e43385d633074edd4aee40"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68ccb093e6e43385d633074edd4aee40">&#9670;&nbsp;</a></span>force_treeallocate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structForceTree.html">ForceTree</a> force_treeallocate </td>
          <td>(</td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>maxnodes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>maxpart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDomainDecomp.html">DomainDecomp</a> *&#160;</td>
          <td class="paramname"><em>ddecomp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function allocates the memory used for storage of the tree and of auxiliary arrays needed for tree-walk and link-lists. Usually, maxnodes approximately equal to 0.7*maxpart is sufficient to store the tree for up to maxpart particles. </p>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l01381">1381</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;{</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    <a class="code" href="structForceTree.html">ForceTree</a> tb;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160; </div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    tb.<a class="code" href="structForceTree.html#a9c794bfbfd1b1c68d201af6a8564fd13">Father</a> = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;Father&quot;</span>, maxpart * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    tb.<a class="code" href="structForceTree.html#a17359d4c68615adc605baa984a584e78">nfather</a> = maxpart;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    memset(tb.<a class="code" href="structForceTree.html#a9c794bfbfd1b1c68d201af6a8564fd13">Father</a>, -1, maxpart * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    tb.<a class="code" href="structForceTree.html#a9b388efae8d9d4be5e14030d65a17819">Nodes_base</a> = (<span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;Nodes_base&quot;</span>, (maxnodes + 1) * <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a>));</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    memset(tb.<a class="code" href="structForceTree.html#a9b388efae8d9d4be5e14030d65a17819">Nodes_base</a>, -1, (maxnodes + 1) * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structNODE.html">NODE</a>));</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    tb.<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a> = maxpart;</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    tb.<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a> = maxpart + maxnodes;</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    <span class="keywordflow">if</span>(maxpart + maxnodes &gt;= 1L&lt;&lt;30)</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;        <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(5, <span class="stringliteral">&quot;Size of tree overflowed for maxpart = %ld, maxnodes = %ld!\n&quot;</span>, maxpart, maxnodes);</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    tb.<a class="code" href="structForceTree.html#acd985b6d526df4466ad5f6850402c89e">numnodes</a> = 0;</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a> = tb.<a class="code" href="structForceTree.html#a9b388efae8d9d4be5e14030d65a17819">Nodes_base</a> - maxpart;</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    tb.<a class="code" href="structForceTree.html#a843ac282eda641c264da5de145287dbf">tree_allocated_flag</a> = 1;</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    tb.<a class="code" href="structForceTree.html#a2e227f51f43e9b318d9f9e67299da0ba">NTopLeaves</a> = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#ae063710516bbb9f1fa1350b5b3c02a93">NTopLeaves</a>;</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    tb.<a class="code" href="structForceTree.html#ab986dcdbb47389ec6863651e899acc15">TopLeaves</a> = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#adcfdab38d4690533d89c93b927df477f">TopLeaves</a>;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <span class="keywordflow">return</span> tb;</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;}</div>
<div class="ttc" id="amymalloc_8h_html_a3eb707b32b6ac69f2df085e4bc098cc4"><div class="ttname"><a href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a></div><div class="ttdeci">#define mymalloc(name, size)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00015">mymalloc.h:15</a></div></div>
<div class="ttc" id="astructDomainDecomp_html_ae063710516bbb9f1fa1350b5b3c02a93"><div class="ttname"><a href="structDomainDecomp.html#ae063710516bbb9f1fa1350b5b3c02a93">DomainDecomp::NTopLeaves</a></div><div class="ttdeci">int NTopLeaves</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00040">domain.h:40</a></div></div>
<div class="ttc" id="astructForceTree_html"><div class="ttname"><a href="structForceTree.html">ForceTree</a></div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00076">forcetree.h:76</a></div></div>
<div class="ttc" id="astructForceTree_html_a17359d4c68615adc605baa984a584e78"><div class="ttname"><a href="structForceTree.html#a17359d4c68615adc605baa984a584e78">ForceTree::nfather</a></div><div class="ttdeci">int nfather</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00104">forcetree.h:104</a></div></div>
<div class="ttc" id="astructForceTree_html_ab986dcdbb47389ec6863651e899acc15"><div class="ttname"><a href="structForceTree.html#ab986dcdbb47389ec6863651e899acc15">ForceTree::TopLeaves</a></div><div class="ttdeci">struct topleaf_data * TopLeaves</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00092">forcetree.h:92</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="endrun_8c_source.html#l00147">endrun()</a>, <a class="el" href="forcetree_8h_source.html#l00103">ForceTree::Father</a>, <a class="el" href="forcetree_8h_source.html#l00084">ForceTree::firstnode</a>, <a class="el" href="forcetree_8h_source.html#l00086">ForceTree::lastnode</a>, <a class="el" href="mymalloc_8h_source.html#l00015">mymalloc</a>, <a class="el" href="forcetree_8h_source.html#l00104">ForceTree::nfather</a>, <a class="el" href="forcetree_8h_source.html#l00097">ForceTree::Nodes</a>, <a class="el" href="forcetree_8h_source.html#l00101">ForceTree::Nodes_base</a>, <a class="el" href="domain_8h_source.html#l00040">DomainDecomp::NTopLeaves</a>, <a class="el" href="forcetree_8h_source.html#l00094">ForceTree::NTopLeaves</a>, <a class="el" href="forcetree_8h_source.html#l00088">ForceTree::numnodes</a>, <a class="el" href="domain_8h_source.html#l00037">DomainDecomp::TopLeaves</a>, <a class="el" href="forcetree_8h_source.html#l00092">ForceTree::TopLeaves</a>, and <a class="el" href="forcetree_8h_source.html#l00078">ForceTree::tree_allocated_flag</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00191">force_tree_build()</a>, <a class="el" href="test__forcetree_8c_source.html#l00276">test_rebuild_close()</a>, <a class="el" href="test__forcetree_8c_source.html#l00246">test_rebuild_flat()</a>, and <a class="el" href="test__forcetree_8c_source.html#l00326">test_rebuild_random()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8h_a68ccb093e6e43385d633074edd4aee40_cgraph.svg" width="555" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8h_a68ccb093e6e43385d633074edd4aee40_icgraph.svg" width="1504" height="696"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a4a1586acbca478c066f9b27cdac64ac4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a1586acbca478c066f9b27cdac64ac4">&#9670;&nbsp;</a></span>force_update_hmax()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void force_update_hmax </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>activeset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structForceTree.html">ForceTree</a> *&#160;</td>
          <td class="paramname"><em>tree</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDomainDecomp.html">DomainDecomp</a> *&#160;</td>
          <td class="paramname"><em>ddecomp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function updates the hmax-values in tree nodes that hold SPH particles. Since the Hsml-values are potentially changed for active particles in the SPH-density computation, <a class="el" href="forcetree_8c.html#a965954b38afd36a3ce1047406d23cc22">force_update_hmax()</a> should be carried out just before the hydrodynamical SPH forces are computed, i.e. after <a class="el" href="density_8c.html#ac49d34dfc3f4e37cac0953d5bc1417a4">density()</a>.</p>
<p>The purpose of the hmax node is for a symmetric treewalk (currently only the hydro). Particles where P[i].Pos + Hsml pokes beyond the exterior of the tree node may mean that a tree node should be included when it would normally be culled. Therefore we don't really want hmax, we want the maximum amount P[i].Pos + Hsml pokes beyond the tree node. </p>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l01271">1271</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;{</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="test__exchange_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>, <a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>, recvTask;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <span class="keywordtype">int</span> i, ta;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    <span class="keywordtype">int</span> *recvcounts, *recvoffset;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160; </div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Misc&quot;</span>);</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160; </div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <span class="comment">/* If hmax has not yet been computed, do all particles*/</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    <span class="keywordflow">if</span>(!tree-&gt;<a class="code" href="structForceTree.html#ab0144192c151b0695bb436cf874f464a">hmax_computed_flag</a>) {</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;        activeset = NULL;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        size = <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a>;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    }</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    MPI_Comm_size(MPI_COMM_WORLD, &amp;<a class="code" href="test__exchange_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>);</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    MPI_Comm_rank(MPI_COMM_WORLD, &amp;<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>);</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160; </div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="preprocessor">    #pragma omp parallel for</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; size; i++)</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    {</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> p_i = activeset ? activeset[i] : i;</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160; </div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Type != 0 || <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].IsGarbage)</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160; </div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        <span class="keywordtype">int</span> no = tree-&gt;<a class="code" href="structForceTree.html#a9c794bfbfd1b1c68d201af6a8564fd13">Father</a>[p_i];</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160; </div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        <span class="keywordflow">while</span>(no &gt;= 0)</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        {</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;            <span class="comment">/* How much does this particle peek beyond this node?</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="comment">             * Note len does not change so we can read it without a lock or atomic. */</span></div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;            <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> readhmax, newhmax = 0;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;            <span class="keywordtype">int</span> j, done = 0;</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++) {</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;                <span class="comment">/* Compute each direction independently and take the maximum.</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="comment">                 * This is the largest possible distance away from node center within a cube bounding hsml.</span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="comment">                 * Note that because Pos - Center &lt; len, the maximum value this can have is Hsml.*/</span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;                newhmax = <a class="code" href="test__interp_8c.html#ac06514a27a2843d8325c1e46ad595b39">DMAX</a>(newhmax, fabs(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Pos[j] - tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[j]) + <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Hsml - tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a>);</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;            }</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;            <span class="comment">/* Most particles will lie fully inside a node. No need then for the atomic! */</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;            <span class="keywordflow">if</span>(newhmax &lt;= 0)</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160; </div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="preprocessor">            #pragma omp atomic read</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;            readhmax = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a>;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;            <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;                <span class="keywordflow">if</span>(newhmax &lt;= readhmax) {</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;                    done = 1;</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;                }</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;                <span class="comment">/* Swap in the new hmax only if the old one hasn&#39;t changed. */</span></div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;            } <span class="keywordflow">while</span>(!__atomic_compare_exchange(&amp;(tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a>), &amp;readhmax, &amp;newhmax, 0, __ATOMIC_RELAXED, __ATOMIC_RELAXED));</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160; </div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;            <span class="keywordflow">if</span>(done)</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;            no = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a>;</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;        }</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    }</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160; </div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    <span class="keywordtype">double</span> * TopLeafhmax = (<span class="keywordtype">double</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;TopLeafMoments&quot;</span>, ddecomp-&gt;<a class="code" href="structDomainDecomp.html#ae063710516bbb9f1fa1350b5b3c02a93">NTopLeaves</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    memset(&amp;TopLeafhmax[0], 0, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * ddecomp-&gt;<a class="code" href="structDomainDecomp.html#ae063710516bbb9f1fa1350b5b3c02a93">NTopLeaves</a>);</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160; </div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    <span class="keywordflow">for</span>(i = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">Tasks</a>[<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>].<a class="code" href="structtask__data.html#adb9ec65f9257aa87c1811f283061ef4b">StartLeaf</a>; i &lt; ddecomp-&gt;Tasks[<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>].EndLeaf; i ++) {</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        <span class="keywordtype">int</span> no = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#adcfdab38d4690533d89c93b927df477f">TopLeaves</a>[i].<a class="code" href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">treenode</a>;</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;        TopLeafhmax[i] = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a>;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    }</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160; </div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    <span class="comment">/* share the hmax-data of the dirty nodes accross CPUs */</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    recvcounts = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;recvcounts&quot;</span>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * <a class="code" href="test__exchange_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>);</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    recvoffset = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;recvoffset&quot;</span>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * <a class="code" href="test__exchange_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>);</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160; </div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <span class="keywordflow">for</span>(recvTask = 0; recvTask &lt; <a class="code" href="test__exchange_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; recvTask++)</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    {</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;        recvoffset[recvTask] = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">Tasks</a>[recvTask].<a class="code" href="structtask__data.html#adb9ec65f9257aa87c1811f283061ef4b">StartLeaf</a>;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;        recvcounts[recvTask] = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">Tasks</a>[recvTask].<a class="code" href="structtask__data.html#a3282c0a233e6ab985c0c9568f2589a6f">EndLeaf</a> - ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">Tasks</a>[recvTask].<a class="code" href="structtask__data.html#adb9ec65f9257aa87c1811f283061ef4b">StartLeaf</a>;</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    }</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160; </div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    MPI_Allgatherv(MPI_IN_PLACE, 0, MPI_DATATYPE_NULL,</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;            &amp;TopLeafhmax[0], recvcounts, recvoffset,</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;            MPI_DOUBLE, MPI_COMM_WORLD);</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160; </div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(recvoffset);</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(recvcounts);</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160; </div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <span class="keywordflow">for</span>(ta = 0; ta &lt; <a class="code" href="test__exchange_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; ta++) {</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;        <span class="keywordflow">if</span>(ta == <a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>)</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;            <span class="keywordflow">continue</span>; <span class="comment">/* bypass ThisTask since it is already up to date */</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;        <span class="keywordflow">for</span>(i = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">Tasks</a>[ta].<a class="code" href="structtask__data.html#adb9ec65f9257aa87c1811f283061ef4b">StartLeaf</a>; i &lt; ddecomp-&gt;Tasks[ta].EndLeaf; i ++) {</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;            <span class="keywordtype">int</span> no = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#adcfdab38d4690533d89c93b927df477f">TopLeaves</a>[i].<a class="code" href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">treenode</a>;</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;            tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a> = TopLeafhmax[i];</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160; </div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;            <span class="keywordflow">while</span>(no &gt;= 0)</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;            {</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;                <span class="keywordflow">if</span>(TopLeafhmax[i] &lt;= tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a>)</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;                tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a> = TopLeafhmax[i];</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                no = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a>;</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;            }</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;         }</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    }</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(TopLeafhmax);</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160; </div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    tree-&gt;<a class="code" href="structForceTree.html#ab0144192c151b0695bb436cf874f464a">hmax_computed_flag</a> = 1;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Tree/HmaxUpdate&quot;</span>);</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;}</div>
<div class="ttc" id="astructForceTree_html_ab0144192c151b0695bb436cf874f464a"><div class="ttname"><a href="structForceTree.html#ab0144192c151b0695bb436cf874f464a">ForceTree::hmax_computed_flag</a></div><div class="ttdeci">int hmax_computed_flag</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00080">forcetree.h:80</a></div></div>
<div class="ttc" id="atest__exchange_8c_html_a675acdcd149f5993271a1fdc11673b65"><div class="ttname"><a href="test__exchange_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a></div><div class="ttdeci">int NTask</div><div class="ttdef"><b>Definition:</b> <a href="test__exchange_8c_source.html#l00023">test_exchange.c:23</a></div></div>
<div class="ttc" id="atest__interp_8c_html_ac06514a27a2843d8325c1e46ad595b39"><div class="ttname"><a href="test__interp_8c.html#ac06514a27a2843d8325c1e46ad595b39">DMAX</a></div><div class="ttdeci">#define DMAX(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="test__interp_8c_source.html#l00011">test_interp.c:11</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="forcetree_8h_source.html#l00043">NODE::center</a>, <a class="el" href="test__interp_8c_source.html#l00011">DMAX</a>, <a class="el" href="domain_8h_source.html#l00030">task_data::EndLeaf</a>, <a class="el" href="forcetree_8h_source.html#l00041">NODE::father</a>, <a class="el" href="forcetree_8h_source.html#l00103">ForceTree::Father</a>, <a class="el" href="forcetree_8h_source.html#l00057">NODE::hmax</a>, <a class="el" href="forcetree_8h_source.html#l00080">ForceTree::hmax_computed_flag</a>, <a class="el" href="forcetree_8h_source.html#l00042">NODE::len</a>, <a class="el" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">NODE::mom</a>, <a class="el" href="mymalloc_8h_source.html#l00019">myfree</a>, <a class="el" href="mymalloc_8h_source.html#l00015">mymalloc</a>, <a class="el" href="forcetree_8h_source.html#l00097">ForceTree::Nodes</a>, <a class="el" href="test__exchange_8c_source.html#l00023">NTask</a>, <a class="el" href="domain_8h_source.html#l00040">DomainDecomp::NTopLeaves</a>, <a class="el" href="partmanager_8h_source.html#l00076">part_manager_type::NumPart</a>, <a class="el" href="partmanager_8h_source.html#l00088">P</a>, <a class="el" href="partmanager_8c_source.html#l00011">PartManager</a>, <a class="el" href="domain_8h_source.html#l00029">task_data::StartLeaf</a>, <a class="el" href="domain_8h_source.html#l00041">DomainDecomp::Tasks</a>, <a class="el" href="test__exchange_8c_source.html#l00023">ThisTask</a>, <a class="el" href="domain_8h_source.html#l00037">DomainDecomp::TopLeaves</a>, <a class="el" href="domain_8h_source.html#l00024">topleaf_data::treenode</a>, and <a class="el" href="walltime_8h_source.html#l00008">walltime_measure</a>.</p>

<p class="reference">Referenced by <a class="el" href="run_8c_source.html#l00284">run()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8h_a4a1586acbca478c066f9b27cdac64ac4_icgraph.svg" width="355" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a8c06d93e6c1c1afab740e393528fa0f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c06d93e6c1c1afab740e393528fa0f6">&#9670;&nbsp;</a></span>force_update_node_parallel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void force_update_node_parallel </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structForceTree.html">ForceTree</a> *&#160;</td>
          <td class="paramname"><em>tree</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structDomainDecomp.html">DomainDecomp</a> *&#160;</td>
          <td class="paramname"><em>ddecomp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This routine determines the multipole moments for a given internal node and all its subnodes in parallel, assigning the recursive algorithm to different threads using openmp's task api. The result is stored in tb.Nodes in the sequence of this tree-walk.</p>
<ul>
<li>A new task is spawned from each down from each local topleaf. Local topleaves are used so that we do not waste time trying moment calculation with pseudoparticles.</li>
<li>Each internal node found at that level is added to a list, together with its sibling.</li>
<li>Each node in this list then has the recursive moment calculation called on it. Note: If the tree is very unbalanced and one branch much deeper than the others, this will not be efficient.</li>
<li>Once each tree's recursive moment is generated in parallel, the tail value from each recursion is stored, and the node marked as done.</li>
<li>A final recursive moment calculation is run in serial for the top 3 levels of the tree. When it encounters one of the pre-computed nodes, it searches the list of pre-computed tail values to set the next node as if it had recursed and continues. </li>
</ul>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l01081">1081</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;{</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    MPI_Comm_rank(MPI_COMM_WORLD, &amp;<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>);</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160; </div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="preprocessor">#pragma omp parallel</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="preprocessor">#pragma omp single nowait</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    {</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <span class="keywordflow">for</span>(i = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">Tasks</a>[<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>].<a class="code" href="structtask__data.html#adb9ec65f9257aa87c1811f283061ef4b">StartLeaf</a>; i &lt; ddecomp-&gt;Tasks[<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>].EndLeaf; i ++) {</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> no = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#adcfdab38d4690533d89c93b927df477f">TopLeaves</a>[i].<a class="code" href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">treenode</a>;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;            <span class="comment">/* Nodes containing other nodes: the overwhelmingly likely case.*/</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            <span class="keywordflow">if</span>(tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> == <a class="code" href="forcetree_8h.html#a3ad606200a7ba07b8766c7d37b2454c7">NODE_NODE_TYPE</a>) {</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="preprocessor">                #pragma omp task default(none) shared(tree) firstprivate(no)</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;                <a class="code" href="forcetree_8c.html#accd80e6d7d45105a1af51e093c771aae">force_update_node_recursive</a>(no, tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a>, 1, tree);</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;            }</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> == <a class="code" href="forcetree_8h.html#ac342a8bc2bb97849655e3ea50d3c5494">PARTICLE_NODE_TYPE</a>)</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                <a class="code" href="forcetree_8c.html#ac8445ebf6810e2fed2bcfea994a668bf">force_update_particle_node</a>(no, tree);</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> == <a class="code" href="forcetree_8h.html#aca0ae17134eee3f867d5d7579a97ba64">PSEUDO_NODE_TYPE</a>)</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(5, <span class="stringliteral">&quot;Error, found pseudo node %d but domain entry %d says on task %d\n&quot;</span>, no, i, <a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>);</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        }</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    }</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;}</div>
<div class="ttc" id="aforcetree_8c_html_ac8445ebf6810e2fed2bcfea994a668bf"><div class="ttname"><a href="forcetree_8c.html#ac8445ebf6810e2fed2bcfea994a668bf">force_update_particle_node</a></div><div class="ttdeci">static void force_update_particle_node(int no, const ForceTree *tree)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00950">forcetree.c:950</a></div></div>
<div class="ttc" id="aforcetree_8c_html_accd80e6d7d45105a1af51e093c771aae"><div class="ttname"><a href="forcetree_8c.html#accd80e6d7d45105a1af51e093c771aae">force_update_node_recursive</a></div><div class="ttdeci">static int force_update_node_recursive(int no, int sib, int level, const ForceTree *tree)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00982">forcetree.c:982</a></div></div>
<div class="ttc" id="aforcetree_8h_html_a3ad606200a7ba07b8766c7d37b2454c7"><div class="ttname"><a href="forcetree_8h.html#a3ad606200a7ba07b8766c7d37b2454c7">NODE_NODE_TYPE</a></div><div class="ttdeci">#define NODE_NODE_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00016">forcetree.h:16</a></div></div>
<div class="ttc" id="aforcetree_8h_html_aca0ae17134eee3f867d5d7579a97ba64"><div class="ttname"><a href="forcetree_8h.html#aca0ae17134eee3f867d5d7579a97ba64">PSEUDO_NODE_TYPE</a></div><div class="ttdeci">#define PSEUDO_NODE_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00017">forcetree.h:17</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="forcetree_8h_source.html#l00049">NODE::ChildType</a>, <a class="el" href="endrun_8c_source.html#l00147">endrun()</a>, <a class="el" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">NODE::f</a>, <a class="el" href="forcetree_8c_source.html#l00982">force_update_node_recursive()</a>, <a class="el" href="forcetree_8c_source.html#l00950">force_update_particle_node()</a>, <a class="el" href="forcetree_8h_source.html#l00016">NODE_NODE_TYPE</a>, <a class="el" href="forcetree_8h_source.html#l00097">ForceTree::Nodes</a>, <a class="el" href="forcetree_8h_source.html#l00015">PARTICLE_NODE_TYPE</a>, <a class="el" href="forcetree_8h_source.html#l00017">PSEUDO_NODE_TYPE</a>, <a class="el" href="forcetree_8h_source.html#l00040">NODE::sibling</a>, <a class="el" href="domain_8h_source.html#l00029">task_data::StartLeaf</a>, <a class="el" href="domain_8h_source.html#l00041">DomainDecomp::Tasks</a>, <a class="el" href="test__exchange_8c_source.html#l00023">ThisTask</a>, <a class="el" href="domain_8h_source.html#l00037">DomainDecomp::TopLeaves</a>, and <a class="el" href="domain_8h_source.html#l00024">topleaf_data::treenode</a>.</p>

<p class="reference">Referenced by <a class="el" href="test__forcetree_8c_source.html#l00207">do_tree_test()</a>, and <a class="el" href="forcetree_8c_source.html#l00191">force_tree_build()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8h_a8c06d93e6c1c1afab740e393528fa0f6_cgraph.svg" width="1130" height="164"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8h_a8c06d93e6c1c1afab740e393528fa0f6_icgraph.svg" width="1554" height="823"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aa58562a96bb05cdba9466ecedafece27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa58562a96bb05cdba9466ecedafece27">&#9670;&nbsp;</a></span>init_forcetree_params()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init_forcetree_params </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>FastParticleType</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00043">43</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;{</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment">/* This was increased due to the extra nodes created by subtrees*/</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <a class="code" href="forcetree_8c.html#afdf47b35e2cd40f171992ebf07dcbbb6">ForceTreeParams</a>.<a class="code" href="structforcetree__params.html#aa3adbfedf9fd5baac777f0d0b0d2b4bc">TreeAllocFactor</a> = 0.9;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="forcetree_8c.html#afdf47b35e2cd40f171992ebf07dcbbb6">ForceTreeParams</a>.<a class="code" href="structforcetree__params.html#aa41e5b06e8fc33bb6434cbec5fde7649">FastParticleType</a> = FastParticleType;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;}</div>
<div class="ttc" id="aforcetree_8c_html_afdf47b35e2cd40f171992ebf07dcbbb6"><div class="ttname"><a href="forcetree_8c.html#afdf47b35e2cd40f171992ebf07dcbbb6">ForceTreeParams</a></div><div class="ttdeci">static struct forcetree_params ForceTreeParams</div></div>
<div class="ttc" id="astructforcetree__params_html_aa3adbfedf9fd5baac777f0d0b0d2b4bc"><div class="ttname"><a href="structforcetree__params.html#aa3adbfedf9fd5baac777f0d0b0d2b4bc">forcetree_params::TreeAllocFactor</a></div><div class="ttdeci">double TreeAllocFactor</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00037">forcetree.c:37</a></div></div>
<div class="ttc" id="astructforcetree__params_html_aa41e5b06e8fc33bb6434cbec5fde7649"><div class="ttname"><a href="structforcetree__params.html#aa41e5b06e8fc33bb6434cbec5fde7649">forcetree_params::FastParticleType</a></div><div class="ttdeci">int FastParticleType</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00039">forcetree.c:39</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="forcetree_8c_source.html#l00039">forcetree_params::FastParticleType</a>, <a class="el" href="forcetree_8c.html#afdf47b35e2cd40f171992ebf07dcbbb6">ForceTreeParams</a>, and <a class="el" href="forcetree_8c_source.html#l00037">forcetree_params::TreeAllocFactor</a>.</p>

<p class="reference">Referenced by <a class="el" href="run_8c_source.html#l00194">begrun()</a>, <a class="el" href="test__density_8c_source.html#l00314">setup_density()</a>, <a class="el" href="test__forcetree_8c_source.html#l00371">setup_tree()</a>, and <a class="el" href="test__fof_8c_source.html#l00071">test_fof()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8h_aa58562a96bb05cdba9466ecedafece27_icgraph.svg" width="440" height="190"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a822d99b8bfbdf4c010e2b974b4334409"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a822d99b8bfbdf4c010e2b974b4334409">&#9670;&nbsp;</a></span>node_is_node()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int node_is_node </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>no</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structForceTree.html">ForceTree</a> *&#160;</td>
          <td class="paramname"><em>tree</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8h_source.html#l00145">145</a> of file <a class="el" href="forcetree_8h_source.html">forcetree.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;{</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">return</span> (no &gt;= tree-&gt;<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>) &amp;&amp; (no &lt; tree-&gt;<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a> + tree-&gt;<a class="code" href="structForceTree.html#acd985b6d526df4466ad5f6850402c89e">numnodes</a>);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="forcetree_8h_source.html#l00084">ForceTree::firstnode</a>, and <a class="el" href="forcetree_8h_source.html#l00088">ForceTree::numnodes</a>.</p>

</div>
</div>
<a id="ac689be6113781c695ef044ed53b94c6f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac689be6113781c695ef044ed53b94c6f">&#9670;&nbsp;</a></span>node_is_particle()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int node_is_particle </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>no</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structForceTree.html">ForceTree</a> *&#160;</td>
          <td class="paramname"><em>tree</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8h_source.html#l00139">139</a> of file <a class="el" href="forcetree_8h_source.html">forcetree.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;{</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordflow">return</span> no &gt;= 0 &amp;&amp; no &lt; tree-&gt;<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="forcetree_8h_source.html#l00084">ForceTree::firstnode</a>.</p>

<p class="reference">Referenced by <a class="el" href="treewalk_8c_source.html#l01052">ngb_treefind_threads()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8h_ac689be6113781c695ef044ed53b94c6f_icgraph.svg" width="1354" height="335"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ae01cb41cc000acecd9213d69c7d15c32"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae01cb41cc000acecd9213d69c7d15c32">&#9670;&nbsp;</a></span>node_is_pseudo_particle()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int node_is_pseudo_particle </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>no</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structForceTree.html">ForceTree</a> *&#160;</td>
          <td class="paramname"><em>tree</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8h_source.html#l00133">133</a> of file <a class="el" href="forcetree_8h_source.html">forcetree.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;{</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordflow">return</span> no &gt;= tree-&gt;<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a>;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="forcetree_8h_source.html#l00086">ForceTree::lastnode</a>.</p>

<p class="reference">Referenced by <a class="el" href="treewalk_8c_source.html#l01052">ngb_treefind_threads()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8h_ae01cb41cc000acecd9213d69c7d15c32_icgraph.svg" width="1408" height="335"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
