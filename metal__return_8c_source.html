<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MP-Gadget: libgadget/metal_return.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MP-Gadget
   &#160;<span id="projectnumber">5.0.1.dev1-76bc7d4726-dirty</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_8db5bc7a24c620673ff2e44953ca6f6c.html">libgadget</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">metal_return.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="metal__return_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;mpi.h&gt;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="string_8h.html">string.h</a>&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;gsl/gsl_math.h&gt;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;gsl/gsl_integration.h&gt;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;gsl/gsl_interp2d.h&gt;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;gsl/gsl_roots.h&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;gsl/gsl_errno.h&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;omp.h&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; </div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="physconst_8h.html">physconst.h</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="walltime_8h.html">walltime.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="slotsmanager_8h.html">slotsmanager.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="treewalk_8h.html">treewalk.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="metal__return_8h.html">metal_return.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="densitykernel_8h.html">densitykernel.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="density_8h.html">density.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="cosmology_8h.html">cosmology.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="winds_8h.html">winds.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="spinlocks_8h.html">utils/spinlocks.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="metal__tables_8h.html">metal_tables.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#if NMETALS != NSPECIES</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">    #pragma error &quot; Inconsistency in metal number between slots and metals&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="structmetal__return__params.html">   47</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structmetal__return__params.html">metal_return_params</a></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;{</div>
<div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="structmetal__return__params.html#aab6341aebf537227479a3df11c2a1339">   49</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structmetal__return__params.html#aab6341aebf537227479a3df11c2a1339">Sn1aN0</a>;</div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="structmetal__return__params.html#a58452735fac8130955037b96e1c5c0ea">   50</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structmetal__return__params.html#a58452735fac8130955037b96e1c5c0ea">SPHWeighting</a>;</div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="structmetal__return__params.html#a98d41f7181e04a04139a160eaf7a0236">   51</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structmetal__return__params.html#a98d41f7181e04a04139a160eaf7a0236">MaxNgbDeviation</a>;</div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a687f879a7550bbdfdc820d65b606cb36">   52</a></span>&#160;} <a class="code" href="metal__return_8c.html#a687f879a7550bbdfdc820d65b606cb36">MetalParams</a>;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160; </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">/* For tests*/</span></div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a136faab0fe657ba92032f25f004098d9">   55</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="metal__return_8c.html#a136faab0fe657ba92032f25f004098d9">set_metal_params</a>(<span class="keywordtype">double</span> Sn1aN0)</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;{</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <a class="code" href="metal__return_8c.html#a687f879a7550bbdfdc820d65b606cb36">MetalParams</a>.<a class="code" href="structmetal__return__params.html#aab6341aebf537227479a3df11c2a1339">Sn1aN0</a> = Sn1aN0;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;}</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">/*Set the parameters of the hydro module*/</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a867fc3e21ae7aa831a63f2f3f5f20f57">   62</a></span>&#160;<a class="code" href="metal__return_8c.html#a867fc3e21ae7aa831a63f2f3f5f20f57">set_metal_return_params</a>(<a class="code" href="structParameterSet.html">ParameterSet</a> * ps)</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;{</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    MPI_Comm_rank(MPI_COMM_WORLD, &amp;<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0) {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <a class="code" href="metal__return_8c.html#a687f879a7550bbdfdc820d65b606cb36">MetalParams</a>.<a class="code" href="structmetal__return__params.html#aab6341aebf537227479a3df11c2a1339">Sn1aN0</a> = <a class="code" href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a>(ps, <span class="stringliteral">&quot;MetalsSn1aN0&quot;</span>);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <a class="code" href="metal__return_8c.html#a687f879a7550bbdfdc820d65b606cb36">MetalParams</a>.<a class="code" href="structmetal__return__params.html#a58452735fac8130955037b96e1c5c0ea">SPHWeighting</a> = <a class="code" href="paramset_8c.html#a6228c17649c46aef53e74cd7ccb93fb0">param_get_int</a>(ps, <span class="stringliteral">&quot;MetalsSPHWeighting&quot;</span>);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <a class="code" href="metal__return_8c.html#a687f879a7550bbdfdc820d65b606cb36">MetalParams</a>.<a class="code" href="structmetal__return__params.html#a98d41f7181e04a04139a160eaf7a0236">MaxNgbDeviation</a> = <a class="code" href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a>(ps, <span class="stringliteral">&quot;MetalsMaxNgbDeviation&quot;</span>);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    }</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    MPI_Bcast(&amp;<a class="code" href="metal__return_8c.html#a687f879a7550bbdfdc820d65b606cb36">MetalParams</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structmetal__return__params.html">metal_return_params</a>), MPI_BYTE, 0, MPI_COMM_WORLD);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;}</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">/* Build the interpolators for each yield table. We use bilinear interpolation</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment"> * so there is no extra memory allocation and we never free the tables*/</span></div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a45c1e30e08ea1d55780815948138bdc6">   76</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="metal__return_8c.html#a45c1e30e08ea1d55780815948138bdc6">setup_metal_table_interp</a>(<span class="keyword">struct</span> <a class="code" href="structinterps.html">interps</a> * <a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>)</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;{</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>-&gt;lifetime_interp = gsl_interp2d_alloc(gsl_interp2d_bilinear, <a class="code" href="metal__tables_8h.html#a009e5c702a99940896f57ca01379b6a1">LIFE_NMET</a>, <a class="code" href="metal__tables_8h.html#a6fd2c15826eef68647513456e6e50a3d">LIFE_NMASS</a>);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    gsl_interp2d_init(<a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>-&gt;lifetime_interp, <a class="code" href="metal__tables_8h.html#aac3cc9648b91cf1489acba747f7c722d">lifetime_metallicity</a>, <a class="code" href="metal__tables_8h.html#ae29b0d26e01b69825f3d4bb0357170cd">lifetime_masses</a>, <a class="code" href="metal__tables_8h.html#ac626022f7ea397ad8b6309ab43229766">lifetime</a>, <a class="code" href="metal__tables_8h.html#a009e5c702a99940896f57ca01379b6a1">LIFE_NMET</a>, <a class="code" href="metal__tables_8h.html#a6fd2c15826eef68647513456e6e50a3d">LIFE_NMASS</a>);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>-&gt;agb_mass_interp = gsl_interp2d_alloc(gsl_interp2d_bilinear, <a class="code" href="metal__tables_8h.html#a4f784d3142b1103442b95109d99f1dd8">AGB_NMET</a>, <a class="code" href="metal__tables_8h.html#a8f40898a35fecff6597e3f5b363426de">AGB_NMASS</a>);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    gsl_interp2d_init(<a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>-&gt;agb_mass_interp, <a class="code" href="metal__tables_8h.html#affe9e55a7937d887e455b230d6debc72">agb_metallicities</a>, <a class="code" href="metal__tables_8h.html#a75fab227eb2c54a8c6a0dc8646b20586">agb_masses</a>, <a class="code" href="metal__tables_8h.html#a9805eef500ca9d27dbf530685e27ba61">agb_total_mass</a>, <a class="code" href="metal__tables_8h.html#a4f784d3142b1103442b95109d99f1dd8">AGB_NMET</a>, <a class="code" href="metal__tables_8h.html#a8f40898a35fecff6597e3f5b363426de">AGB_NMASS</a>);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>-&gt;agb_metallicity_interp = gsl_interp2d_alloc(gsl_interp2d_bilinear, <a class="code" href="metal__tables_8h.html#a4f784d3142b1103442b95109d99f1dd8">AGB_NMET</a>, <a class="code" href="metal__tables_8h.html#a8f40898a35fecff6597e3f5b363426de">AGB_NMASS</a>);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    gsl_interp2d_init(<a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>-&gt;agb_metallicity_interp, <a class="code" href="metal__tables_8h.html#affe9e55a7937d887e455b230d6debc72">agb_metallicities</a>, <a class="code" href="metal__tables_8h.html#a75fab227eb2c54a8c6a0dc8646b20586">agb_masses</a>, <a class="code" href="metal__tables_8h.html#aa38d6243b64cada879d9ecf59a02e527">agb_total_metals</a>, <a class="code" href="metal__tables_8h.html#a4f784d3142b1103442b95109d99f1dd8">AGB_NMET</a>, <a class="code" href="metal__tables_8h.html#a8f40898a35fecff6597e3f5b363426de">AGB_NMASS</a>);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordflow">for</span>(i=0; i&lt;<a class="code" href="slotsmanager_8h.html#ad07d3b873121463218a991d53512e49b">NMETALS</a>; i++) {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>-&gt;agb_metals_interp[i] = gsl_interp2d_alloc(gsl_interp2d_bilinear, <a class="code" href="metal__tables_8h.html#a4f784d3142b1103442b95109d99f1dd8">AGB_NMET</a>, <a class="code" href="metal__tables_8h.html#a8f40898a35fecff6597e3f5b363426de">AGB_NMASS</a>);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        gsl_interp2d_init(<a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>-&gt;agb_metals_interp[i], <a class="code" href="metal__tables_8h.html#affe9e55a7937d887e455b230d6debc72">agb_metallicities</a>, <a class="code" href="metal__tables_8h.html#a75fab227eb2c54a8c6a0dc8646b20586">agb_masses</a>, <a class="code" href="metal__tables_8h.html#ada35087703fd56a884bc7c79c2b26495">agb_yield</a>[i], <a class="code" href="metal__tables_8h.html#a4f784d3142b1103442b95109d99f1dd8">AGB_NMET</a>, <a class="code" href="metal__tables_8h.html#a8f40898a35fecff6597e3f5b363426de">AGB_NMASS</a>);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    }</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>-&gt;snii_mass_interp = gsl_interp2d_alloc(gsl_interp2d_bilinear, <a class="code" href="metal__tables_8h.html#ab4b5721a1b3263ad6360bf5b874f7102">SNII_NMET</a>, <a class="code" href="metal__tables_8h.html#a72c6dc54510c0490ccc48ca6d1b6d5a3">SNII_NMASS</a>);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    gsl_interp2d_init(<a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>-&gt;snii_mass_interp, <a class="code" href="metal__tables_8h.html#a61be6fb4a1f463c29c9c1f436ac02ae6">snii_metallicities</a>, <a class="code" href="metal__tables_8h.html#ae1387e9c35b052580b69af49c33068dd">snii_masses</a>, <a class="code" href="metal__tables_8h.html#a94a003b7846207e7810e1e55b0244e42">snii_total_mass</a>, <a class="code" href="metal__tables_8h.html#ab4b5721a1b3263ad6360bf5b874f7102">SNII_NMET</a>, <a class="code" href="metal__tables_8h.html#a72c6dc54510c0490ccc48ca6d1b6d5a3">SNII_NMASS</a>);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>-&gt;snii_metallicity_interp = gsl_interp2d_alloc(gsl_interp2d_bilinear, <a class="code" href="metal__tables_8h.html#ab4b5721a1b3263ad6360bf5b874f7102">SNII_NMET</a>, <a class="code" href="metal__tables_8h.html#a72c6dc54510c0490ccc48ca6d1b6d5a3">SNII_NMASS</a>);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    gsl_interp2d_init(<a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>-&gt;snii_metallicity_interp, <a class="code" href="metal__tables_8h.html#a61be6fb4a1f463c29c9c1f436ac02ae6">snii_metallicities</a>, <a class="code" href="metal__tables_8h.html#ae1387e9c35b052580b69af49c33068dd">snii_masses</a>, <a class="code" href="metal__tables_8h.html#afa712d91edf737c0da969b49f4b9837f">snii_total_metals</a>, <a class="code" href="metal__tables_8h.html#ab4b5721a1b3263ad6360bf5b874f7102">SNII_NMET</a>, <a class="code" href="metal__tables_8h.html#a72c6dc54510c0490ccc48ca6d1b6d5a3">SNII_NMASS</a>);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keywordflow">for</span>(i=0; i&lt;<a class="code" href="slotsmanager_8h.html#ad07d3b873121463218a991d53512e49b">NMETALS</a>; i++) {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>-&gt;snii_metals_interp[i] = gsl_interp2d_alloc(gsl_interp2d_bilinear, <a class="code" href="metal__tables_8h.html#ab4b5721a1b3263ad6360bf5b874f7102">SNII_NMET</a>, <a class="code" href="metal__tables_8h.html#a72c6dc54510c0490ccc48ca6d1b6d5a3">SNII_NMASS</a>);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        gsl_interp2d_init(<a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>-&gt;snii_metals_interp[i], <a class="code" href="metal__tables_8h.html#a61be6fb4a1f463c29c9c1f436ac02ae6">snii_metallicities</a>, <a class="code" href="metal__tables_8h.html#ae1387e9c35b052580b69af49c33068dd">snii_masses</a>, <a class="code" href="metal__tables_8h.html#a17de36caa644e3741822c6196dbbcd9d">snii_yield</a>[i], <a class="code" href="metal__tables_8h.html#ab4b5721a1b3263ad6360bf5b874f7102">SNII_NMET</a>, <a class="code" href="metal__tables_8h.html#a72c6dc54510c0490ccc48ca6d1b6d5a3">SNII_NMASS</a>);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    }</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;}</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno"><a class="line" href="metal__return_8c.html#aad6b2bf60ee9eae8cc059ba4c50aedce">   99</a></span>&#160;<span class="preprocessor">#define METALS_GET_PRIV(tw) ((struct MetalReturnPriv*) ((tw)-&gt;priv))</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160; </div>
<div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="structTreeWalkQueryMetals.html">  101</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="structTreeWalkQueryMetals.html#aac20c5f1b2c23b44ee3f02a65d305a83">  102</a></span>&#160;    <a class="code" href="structTreeWalkQueryBase.html">TreeWalkQueryBase</a> <a class="code" href="structTreeWalkQueryMetals.html#aac20c5f1b2c23b44ee3f02a65d305a83">base</a>;</div>
<div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="structTreeWalkQueryMetals.html#a699dbc8bcfebe93b75880a81975efcf9">  103</a></span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> <a class="code" href="structTreeWalkQueryMetals.html#a699dbc8bcfebe93b75880a81975efcf9">Metallicity</a>;</div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="structTreeWalkQueryMetals.html#aee2bc2e2c1f19d81d0111b351934de22">  104</a></span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> <a class="code" href="structTreeWalkQueryMetals.html#aee2bc2e2c1f19d81d0111b351934de22">Mass</a>;</div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="structTreeWalkQueryMetals.html#aa91b40c5bbb212dac30473b5992f5304">  105</a></span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> <a class="code" href="structTreeWalkQueryMetals.html#aa91b40c5bbb212dac30473b5992f5304">Hsml</a>;</div>
<div class="line"><a name="l00106"></a><span class="lineno"><a class="line" href="structTreeWalkQueryMetals.html#a3291b51ca793d21c8e66c15794c3f4cf">  106</a></span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> <a class="code" href="structTreeWalkQueryMetals.html#a3291b51ca793d21c8e66c15794c3f4cf">StarVolumeSPH</a>;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="comment">/* This is the metal/mass generated this timestep.*/</span></div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="structTreeWalkQueryMetals.html#ae2f34af218c3ab39c9825bbae4314640">  108</a></span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> MetalSpeciesGenerated[<a class="code" href="slotsmanager_8h.html#ad07d3b873121463218a991d53512e49b">NMETALS</a>];</div>
<div class="line"><a name="l00109"></a><span class="lineno"><a class="line" href="structTreeWalkQueryMetals.html#a69fe57f92a03ddb696eb1c764f1112f7">  109</a></span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> <a class="code" href="structTreeWalkQueryMetals.html#a69fe57f92a03ddb696eb1c764f1112f7">MassGenerated</a>;</div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="structTreeWalkQueryMetals.html#ac1c17d61b3d06092002ee77b60e8083e">  110</a></span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> <a class="code" href="structTreeWalkQueryMetals.html#ac1c17d61b3d06092002ee77b60e8083e">MetalGenerated</a>;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;} <a class="code" href="structTreeWalkQueryMetals.html">TreeWalkQueryMetals</a>;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="structTreeWalkResultMetals.html">  113</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="structTreeWalkResultMetals.html#aa3893094b5af28cc33b475fb83ed7d38">  114</a></span>&#160;    <a class="code" href="structTreeWalkResultBase.html">TreeWalkResultBase</a> <a class="code" href="structTreeWalkResultMetals.html#aa3893094b5af28cc33b475fb83ed7d38">base</a>;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="comment">/* This is the total mass returned to</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">     * the surrounding gas particles, for mass conservation.*/</span></div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="structTreeWalkResultMetals.html#a48ce1e01704b4b1f21cf597332a1e1bf">  117</a></span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> <a class="code" href="structTreeWalkResultMetals.html#a48ce1e01704b4b1f21cf597332a1e1bf">MassReturn</a>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;} <a class="code" href="structTreeWalkResultMetals.html">TreeWalkResultMetals</a>;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="structTreeWalkNgbIterMetals.html">  120</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="structTreeWalkNgbIterMetals.html#a52b74d18ca74fbb1261f810e54446908">  121</a></span>&#160;    <a class="code" href="structTreeWalkNgbIterBase.html">TreeWalkNgbIterBase</a> <a class="code" href="structTreeWalkNgbIterMetals.html#a52b74d18ca74fbb1261f810e54446908">base</a>;</div>
<div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="structTreeWalkNgbIterMetals.html#ac06f9ef0841f91d7f368e12f55f1a8e4">  122</a></span>&#160;    <a class="code" href="structDensityKernel.html">DensityKernel</a> <a class="code" href="structTreeWalkNgbIterMetals.html#ac06f9ef0841f91d7f368e12f55f1a8e4">kernel</a>;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;} <a class="code" href="structTreeWalkNgbIterMetals.html">TreeWalkNgbIterMetals</a>;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<a class="code" href="metal__return_8c.html#aae2dc62d04b08fb98b6b5e0549d595f9">metal_return_haswork</a>(<span class="keywordtype">int</span> n, <a class="code" href="structTreeWalk.html">TreeWalk</a> * tw);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<a class="code" href="metal__return_8c.html#aed77dd49844be97101b610fcca622033">metal_return_ngbiter</a>(</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <a class="code" href="structTreeWalkQueryMetals.html">TreeWalkQueryMetals</a> * I,</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <a class="code" href="structTreeWalkResultMetals.html">TreeWalkResultMetals</a> * O,</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="structTreeWalkNgbIterMetals.html">TreeWalkNgbIterMetals</a> * iter,</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <a class="code" href="structLocalTreeWalk.html">LocalTreeWalk</a> * lv</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;   );</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<a class="code" href="metal__return_8c.html#ac75463a2439d1e5657e6b759b79cf717">metal_return_copy</a>(<span class="keywordtype">int</span> place, <a class="code" href="structTreeWalkQueryMetals.html">TreeWalkQueryMetals</a> * input, <a class="code" href="structTreeWalk.html">TreeWalk</a> * tw);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<a class="code" href="metal__return_8c.html#a64bf0f58fb25b3c2ded7dbeb73088b3c">metal_return_postprocess</a>(<span class="keywordtype">int</span> place, <a class="code" href="structTreeWalk.html">TreeWalk</a> * tw);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">/* The Chabrier IMF used for computing SnII and AGB yields.</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment"> * See 1305.2913 eq 3*/</span></div>
<div class="line"><a name="l00144"></a><span class="lineno"><a class="line" href="metal__return_8c.html#ad39fbdf9929fece660e9555909b2de10">  144</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code" href="metal__return_8c.html#ad39fbdf9929fece660e9555909b2de10">chabrier_imf</a>(<span class="keywordtype">double</span> mass)</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;{</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">if</span>(mass &lt;= 1) {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordflow">return</span> 0.852464 / mass * exp(- pow(log(mass / 0.079)/ 0.69, 2)/2);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="keywordflow">return</span> 0.237912 * pow(mass, -2.3);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;}</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a24d45c4ab9d585e3eee454565470fc44">  154</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="metal__return_8c.html#a24d45c4ab9d585e3eee454565470fc44">atime_integ</a>(<span class="keywordtype">double</span> atime, <span class="keywordtype">void</span> * params)</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;{</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="structCosmology.html">Cosmology</a> * <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a> = (<a class="code" href="structCosmology.html">Cosmology</a> *) params;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordflow">return</span> 1/(<a class="code" href="cosmology_8c.html#ab425f16e6fe06110e2fb4944065b81bb">hubble_function</a>(<a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, atime) * atime);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;}</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">/* Compute the difference in internal time units between two scale factors.*/</span></div>
<div class="line"><a name="l00161"></a><span class="lineno"><a class="line" href="metal__return_8c.html#ae51821f5a1163d9e641d2f59eea9a0de">  161</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code" href="metal__return_8c.html#ae51821f5a1163d9e641d2f59eea9a0de">atime_to_myr</a>(<a class="code" href="structCosmology.html">Cosmology</a> *<a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, <span class="keywordtype">double</span> atime1, <span class="keywordtype">double</span> atime2, gsl_integration_workspace * gsl_work)</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;{</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">/* t = dt/da da = 1/(Ha) da*/</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="comment">/* Approximate hubble function as constant here: we only care</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">     * about metal return over a single timestep*/</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    gsl_function ff = {<a class="code" href="metal__return_8c.html#a24d45c4ab9d585e3eee454565470fc44">atime_integ</a>, <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>};</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordtype">double</span> tmyr, abserr;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    gsl_integration_qag(&amp;ff, atime1, atime2, 1e-4, 0, <a class="code" href="metal__tables_8h.html#a80e75542e47c3d4bb53f7c18ecfbf446">GSL_WORKSPACE</a>, GSL_INTEG_GAUSS61, gsl_work, &amp;tmyr, &amp;abserr);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">return</span> tmyr * <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#ab98e5d1db0ac5adc89510264da3ab443">UnitTime_in_s</a> / <a class="code" href="physconst_8h.html#af2bfce8e844bbb3b120263471c6c329e">SEC_PER_MEGAYEAR</a>;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;}</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">/* Functions for the root finder*/</span></div>
<div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="structmassbin__find__params.html">  173</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structmassbin__find__params.html">massbin_find_params</a></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;{</div>
<div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="structmassbin__find__params.html#accf1b9447dc260087635a3fc03d7b3f9">  175</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structmassbin__find__params.html#accf1b9447dc260087635a3fc03d7b3f9">dtfind</a>;</div>
<div class="line"><a name="l00176"></a><span class="lineno"><a class="line" href="structmassbin__find__params.html#a3c735a960604b54b091f8eab1262abbe">  176</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structmassbin__find__params.html#a3c735a960604b54b091f8eab1262abbe">stellarmetal</a>;</div>
<div class="line"><a name="l00177"></a><span class="lineno"><a class="line" href="structmassbin__find__params.html#a990fdfe9437ba5302bf0dce9f1a27e7d">  177</a></span>&#160;    gsl_interp2d * <a class="code" href="structmassbin__find__params.html#a990fdfe9437ba5302bf0dce9f1a27e7d">lifetime_tables</a>;</div>
<div class="line"><a name="l00178"></a><span class="lineno"><a class="line" href="structmassbin__find__params.html#a476105a6b9c3b8bfe42884c31cb95158">  178</a></span>&#160;    gsl_interp_accel * <a class="code" href="structmassbin__find__params.html#a476105a6b9c3b8bfe42884c31cb95158">metalacc</a>;</div>
<div class="line"><a name="l00179"></a><span class="lineno"><a class="line" href="structmassbin__find__params.html#a2f353f39cf295dc80c1381664765e516">  179</a></span>&#160;    gsl_interp_accel * <a class="code" href="structmassbin__find__params.html#a2f353f39cf295dc80c1381664765e516">massacc</a>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;};</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160; </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">/* This is the inverse of the lifetime function from the tables.</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment"> * Need to find the stars with a given lifetime*/</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="keywordtype">double</span></div>
<div class="line"><a name="l00185"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a63f7c8d874ef7fd16f7fed060127acef">  185</a></span>&#160;<a class="code" href="metal__return_8c.html#a63f7c8d874ef7fd16f7fed060127acef">massendlife</a> (<span class="keywordtype">double</span> mass, <span class="keywordtype">void</span> *params)</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;{</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keyword">struct </span><a class="code" href="structmassbin__find__params.html">massbin_find_params</a> *p = (<span class="keyword">struct </span><a class="code" href="structmassbin__find__params.html">massbin_find_params</a> *) params;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keywordtype">double</span> tlife = gsl_interp2d_eval(p-&gt;<a class="code" href="structmassbin__find__params.html#a990fdfe9437ba5302bf0dce9f1a27e7d">lifetime_tables</a>, <a class="code" href="metal__tables_8h.html#aac3cc9648b91cf1489acba747f7c722d">lifetime_metallicity</a>, <a class="code" href="metal__tables_8h.html#ae29b0d26e01b69825f3d4bb0357170cd">lifetime_masses</a>, <a class="code" href="metal__tables_8h.html#ac626022f7ea397ad8b6309ab43229766">lifetime</a>, p-&gt;<a class="code" href="structmassbin__find__params.html#a3c735a960604b54b091f8eab1262abbe">stellarmetal</a>, mass, p-&gt;<a class="code" href="structmassbin__find__params.html#a476105a6b9c3b8bfe42884c31cb95158">metalacc</a>, p-&gt;<a class="code" href="structmassbin__find__params.html#a2f353f39cf295dc80c1381664765e516">massacc</a>);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keywordtype">double</span> tlifemyr = tlife/1e6;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keywordflow">return</span> tlifemyr - p-&gt;<a class="code" href="structmassbin__find__params.html#accf1b9447dc260087635a3fc03d7b3f9">dtfind</a>;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;}</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">/* Solve the lifetime function to find the lowest and highest mass bin that dies this timestep*/</span></div>
<div class="line"><a name="l00194"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a4aea3dd136365503eba1b3189dc8a453">  194</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="metal__return_8c.html#a4aea3dd136365503eba1b3189dc8a453">do_rootfinding</a>(<span class="keyword">struct</span> <a class="code" href="structmassbin__find__params.html">massbin_find_params</a> *p, <span class="keywordtype">double</span> mass_low, <span class="keywordtype">double</span> mass_high)</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;{</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordtype">int</span> iter = 0;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    gsl_function F;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160; </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    F.function = &amp;<a class="code" href="metal__return_8c.html#a63f7c8d874ef7fd16f7fed060127acef">massendlife</a>;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    F.params = p;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keyword">const</span> gsl_root_fsolver_type *T = gsl_root_fsolver_falsepos;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    gsl_root_fsolver * s = gsl_root_fsolver_alloc (T);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    gsl_root_fsolver_set (s, &amp;F, mass_low, mass_high);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">/* Iterate until we have an idea of the mass bins dying this timestep.</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">     * No check is done for success, but it should always be close enough.*/</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">for</span>(iter = 0; iter &lt; <a class="code" href="cooling_8c.html#a9e60f3e57fde2b9b1c7fe2eab7334add">MAXITER</a>; iter++)</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      gsl_root_fsolver_iterate (s);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      mass_low = gsl_root_fsolver_x_lower (s);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      mass_high = gsl_root_fsolver_x_upper (s);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      <span class="keywordtype">int</span> status = gsl_root_test_interval (mass_low, mass_high,</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                                       0, 0.005);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="comment">//message(4, &quot;lo %g hi %g root %g val %g\n&quot;, mass_low, mass_high, gsl_root_fsolver_root(s), massendlife(gsl_root_fsolver_root(s), p));</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <span class="keywordflow">if</span> (status == GSL_SUCCESS)</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  }</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordtype">double</span> root = gsl_root_fsolver_root(s);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  gsl_root_fsolver_free (s);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keywordflow">return</span> root;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;}</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">/* Find the mass bins which die in this timestep using the lifetime table.</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment"> * dtstart, dtend - time at start and end of timestep in Myr.</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment"> * stellarmetal - metallicity of the star.</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment"> * lifetime_tables - 2D interpolation table of the lifetime.</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment"> * masshigh, masslow - pointers in which to store the high and low lifetime limits</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00230"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a137b224aee42a66c68cde0385dfb58d0">  230</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="metal__return_8c.html#a137b224aee42a66c68cde0385dfb58d0">find_mass_bin_limits</a>(<span class="keywordtype">double</span> * masslow, <span class="keywordtype">double</span> * masshigh, <span class="keyword">const</span> <span class="keywordtype">double</span> dtstart, <span class="keyword">const</span> <span class="keywordtype">double</span> dtend, <span class="keywordtype">double</span> <a class="code" href="structmassbin__find__params.html#a3c735a960604b54b091f8eab1262abbe">stellarmetal</a>, gsl_interp2d * <a class="code" href="structmassbin__find__params.html#a990fdfe9437ba5302bf0dce9f1a27e7d">lifetime_tables</a>)</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;{</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">/* Clamp metallicities to the table values.*/</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structmassbin__find__params.html#a3c735a960604b54b091f8eab1262abbe">stellarmetal</a> &lt; <a class="code" href="metal__tables_8h.html#aac3cc9648b91cf1489acba747f7c722d">lifetime_metallicity</a>[0])</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <a class="code" href="structmassbin__find__params.html#a3c735a960604b54b091f8eab1262abbe">stellarmetal</a> = <a class="code" href="metal__tables_8h.html#aac3cc9648b91cf1489acba747f7c722d">lifetime_metallicity</a>[0];</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structmassbin__find__params.html#a3c735a960604b54b091f8eab1262abbe">stellarmetal</a> &gt; <a class="code" href="metal__tables_8h.html#aac3cc9648b91cf1489acba747f7c722d">lifetime_metallicity</a>[<a class="code" href="metal__tables_8h.html#a009e5c702a99940896f57ca01379b6a1">LIFE_NMET</a>-1])</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <a class="code" href="structmassbin__find__params.html#a3c735a960604b54b091f8eab1262abbe">stellarmetal</a> = <a class="code" href="metal__tables_8h.html#aac3cc9648b91cf1489acba747f7c722d">lifetime_metallicity</a>[<a class="code" href="metal__tables_8h.html#a009e5c702a99940896f57ca01379b6a1">LIFE_NMET</a>-1];</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="comment">/* Find the root with GSL routines. */</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keyword">struct </span><a class="code" href="structmassbin__find__params.html">massbin_find_params</a> p = {0};</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    p.<a class="code" href="structmassbin__find__params.html#a476105a6b9c3b8bfe42884c31cb95158">metalacc</a> = gsl_interp_accel_alloc();</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    p.<a class="code" href="structmassbin__find__params.html#a2f353f39cf295dc80c1381664765e516">massacc</a> = gsl_interp_accel_alloc();</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    p.<a class="code" href="structmassbin__find__params.html#a990fdfe9437ba5302bf0dce9f1a27e7d">lifetime_tables</a> = <a class="code" href="structmassbin__find__params.html#a990fdfe9437ba5302bf0dce9f1a27e7d">lifetime_tables</a>;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    p.<a class="code" href="structmassbin__find__params.html#a3c735a960604b54b091f8eab1262abbe">stellarmetal</a> = <a class="code" href="structmassbin__find__params.html#a3c735a960604b54b091f8eab1262abbe">stellarmetal</a>;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="comment">/* First find stars that died before the end of this timebin*/</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    p.<a class="code" href="structmassbin__find__params.html#accf1b9447dc260087635a3fc03d7b3f9">dtfind</a> = dtend;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="comment">/* If no stars have died yet*/</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="metal__return_8c.html#a63f7c8d874ef7fd16f7fed060127acef">massendlife</a> (<a class="code" href="metal__tables_8h.html#ac62ec9985d76dc0b4dc569839bc926ef">MAXMASS</a>, &amp;p) &gt;= 0)</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    {</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        *masslow = <a class="code" href="metal__tables_8h.html#ac62ec9985d76dc0b4dc569839bc926ef">MAXMASS</a>;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        *masshigh = <a class="code" href="metal__tables_8h.html#ac62ec9985d76dc0b4dc569839bc926ef">MAXMASS</a>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    }</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="comment">/* All stars die before the end of this timestep*/</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="metal__return_8c.html#a63f7c8d874ef7fd16f7fed060127acef">massendlife</a> (<a class="code" href="metal__tables_8h.html#a75fab227eb2c54a8c6a0dc8646b20586">agb_masses</a>[0], &amp;p) &lt;= 0)</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        *masslow = <a class="code" href="metal__tables_8h.html#ae29b0d26e01b69825f3d4bb0357170cd">lifetime_masses</a>[0];</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        *masslow = <a class="code" href="metal__return_8c.html#a4aea3dd136365503eba1b3189dc8a453">do_rootfinding</a>(&amp;p, <a class="code" href="metal__tables_8h.html#a75fab227eb2c54a8c6a0dc8646b20586">agb_masses</a>[0], <a class="code" href="metal__tables_8h.html#ac62ec9985d76dc0b4dc569839bc926ef">MAXMASS</a>);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="comment">/* Now find stars that died before the start of this timebin*/</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    p.<a class="code" href="structmassbin__find__params.html#accf1b9447dc260087635a3fc03d7b3f9">dtfind</a> = dtstart;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="comment">/* Now we know that life(masslow) = dtend, so life(masslow) &gt; dtstart, so life(masslow) - dtstart &gt; 0</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">     * This is when no stars have died at the beginning of this timestep.*/</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="metal__return_8c.html#a63f7c8d874ef7fd16f7fed060127acef">massendlife</a> (<a class="code" href="metal__tables_8h.html#ac62ec9985d76dc0b4dc569839bc926ef">MAXMASS</a>, &amp;p) &gt;= 0)</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        *masshigh = <a class="code" href="metal__tables_8h.html#ac62ec9985d76dc0b4dc569839bc926ef">MAXMASS</a>;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="comment">/* This can sometimes happen due to root finding inaccuracy.</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">     * Just do this star next timestep.*/</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="metal__return_8c.html#a63f7c8d874ef7fd16f7fed060127acef">massendlife</a> (*masslow, &amp;p) &lt;= 0)</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        *masshigh = *masslow;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        *masshigh = <a class="code" href="metal__return_8c.html#a4aea3dd136365503eba1b3189dc8a453">do_rootfinding</a>(&amp;p, *masslow, <a class="code" href="metal__tables_8h.html#ac62ec9985d76dc0b4dc569839bc926ef">MAXMASS</a>);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    gsl_interp_accel_free(p.<a class="code" href="structmassbin__find__params.html#a476105a6b9c3b8bfe42884c31cb95158">metalacc</a>);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    gsl_interp_accel_free(p.<a class="code" href="structmassbin__find__params.html#a2f353f39cf295dc80c1381664765e516">massacc</a>);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;}</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">/* Parameters of the interpolator</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment"> * to hand to the imf integral.</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment"> * Use different interpolation structures</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment"> * for mass return, metal return and yield.*/</span></div>
<div class="line"><a name="l00279"></a><span class="lineno"><a class="line" href="structimf__integ__params.html">  279</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structimf__integ__params.html">imf_integ_params</a></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;{</div>
<div class="line"><a name="l00281"></a><span class="lineno"><a class="line" href="structimf__integ__params.html#a6c90d1dcd404c55457d367d3ed7e46a4">  281</a></span>&#160;    gsl_interp2d * <a class="code" href="structimf__integ__params.html#a6c90d1dcd404c55457d367d3ed7e46a4">interp</a>;</div>
<div class="line"><a name="l00282"></a><span class="lineno"><a class="line" href="structimf__integ__params.html#acf3d030be4acb640012feded96d40a98">  282</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> * <a class="code" href="structimf__integ__params.html#acf3d030be4acb640012feded96d40a98">masses</a>;</div>
<div class="line"><a name="l00283"></a><span class="lineno"><a class="line" href="structimf__integ__params.html#a2d69b6d46483a514c2052fc71b2269ee">  283</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> * <a class="code" href="structimf__integ__params.html#a2d69b6d46483a514c2052fc71b2269ee">metallicities</a>;</div>
<div class="line"><a name="l00284"></a><span class="lineno"><a class="line" href="structimf__integ__params.html#a567ac849e47171ae06a1ee0673827c0b">  284</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> * <a class="code" href="structimf__integ__params.html#a567ac849e47171ae06a1ee0673827c0b">weights</a>;</div>
<div class="line"><a name="l00285"></a><span class="lineno"><a class="line" href="structimf__integ__params.html#a5ef3b84941e9bc50d589e35e707928c0">  285</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structimf__integ__params.html#a5ef3b84941e9bc50d589e35e707928c0">metallicity</a>;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;};</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">/* Integrand for a function which computes a Chabrier IMF weighted quantity.*/</span></div>
<div class="line"><a name="l00289"></a><span class="lineno"><a class="line" href="metal__return_8c.html#ab7106eacb849b554febe06ca0b7e920f">  289</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="metal__return_8c.html#ab7106eacb849b554febe06ca0b7e920f">chabrier_imf_integ</a> (<span class="keywordtype">double</span> mass, <span class="keywordtype">void</span> * params)</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;{</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keyword">struct </span><a class="code" href="structimf__integ__params.html">imf_integ_params</a> * para = (<span class="keyword">struct </span><a class="code" href="structimf__integ__params.html">imf_integ_params</a> * ) params;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="comment">/* This is needed so that the yield for SNII with masses between 8 and 13 Msun</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">     * are the same as the smallest mass in the table, 13 Msun,</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">     * but they still contribute their number density to the IMF.*/</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordtype">double</span> intpmass = mass;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">if</span>(mass &lt; para-&gt;<a class="code" href="structimf__integ__params.html#acf3d030be4acb640012feded96d40a98">masses</a>[0])</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        intpmass = para-&gt;<a class="code" href="structimf__integ__params.html#acf3d030be4acb640012feded96d40a98">masses</a>[0];</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">if</span>(mass &gt; para-&gt;<a class="code" href="structimf__integ__params.html#acf3d030be4acb640012feded96d40a98">masses</a>[para-&gt;<a class="code" href="structimf__integ__params.html#a6c90d1dcd404c55457d367d3ed7e46a4">interp</a>-&gt;ysize-1])</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        intpmass = para-&gt;<a class="code" href="structimf__integ__params.html#acf3d030be4acb640012feded96d40a98">masses</a>[para-&gt;<a class="code" href="structimf__integ__params.html#a6c90d1dcd404c55457d367d3ed7e46a4">interp</a>-&gt;ysize-1];</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordtype">double</span> weight = gsl_interp2d_eval(para-&gt;<a class="code" href="structimf__integ__params.html#a6c90d1dcd404c55457d367d3ed7e46a4">interp</a>, para-&gt;<a class="code" href="structimf__integ__params.html#a2d69b6d46483a514c2052fc71b2269ee">metallicities</a>, para-&gt;<a class="code" href="structimf__integ__params.html#acf3d030be4acb640012feded96d40a98">masses</a>, para-&gt;<a class="code" href="structimf__integ__params.html#a567ac849e47171ae06a1ee0673827c0b">weights</a>, para-&gt;<a class="code" href="structimf__integ__params.html#a5ef3b84941e9bc50d589e35e707928c0">metallicity</a>, intpmass, NULL, NULL);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="comment">/* This rescales the return by the original mass of the star, if it was outside the table.</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">     * It means that, for example, an 8 Msun star does not return more than 8 Msun. */</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    weight *= (mass/intpmass);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordflow">return</span> weight * <a class="code" href="metal__return_8c.html#ad39fbdf9929fece660e9555909b2de10">chabrier_imf</a>(mass);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;}</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160; </div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">/* Helper for the IMF normalisation*/</span></div>
<div class="line"><a name="l00308"></a><span class="lineno"><a class="line" href="metal__return_8c.html#aef53713bf77e1f8df00fcf003198cbd1">  308</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="metal__return_8c.html#aef53713bf77e1f8df00fcf003198cbd1">chabrier_mass</a>(<span class="keywordtype">double</span> mass, <span class="keywordtype">void</span> * params)</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;{</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordflow">return</span> mass * <a class="code" href="metal__return_8c.html#ad39fbdf9929fece660e9555909b2de10">chabrier_imf</a>(mass);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;}</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">/* Compute factor to normalise the total mass in the IMF to unity.*/</span></div>
<div class="line"><a name="l00314"></a><span class="lineno"><a class="line" href="metal__return_8c.html#ad2254b657bd9575bdc88bd5dd246ddd8">  314</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="metal__return_8c.html#ad2254b657bd9575bdc88bd5dd246ddd8">compute_imf_norm</a>(gsl_integration_workspace * gsl_work)</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;{</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordtype">double</span> norm, abserr;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    gsl_function ff = {<a class="code" href="metal__return_8c.html#aef53713bf77e1f8df00fcf003198cbd1">chabrier_mass</a>, NULL};</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    gsl_integration_qag(&amp;ff, <a class="code" href="metal__tables_8h.html#aa21065ef7a16b9c8ff2f75824bed67d4">MINMASS</a>, <a class="code" href="metal__tables_8h.html#ac62ec9985d76dc0b4dc569839bc926ef">MAXMASS</a>, 1e-4, 1e-3, <a class="code" href="metal__tables_8h.html#a80e75542e47c3d4bb53f7c18ecfbf446">GSL_WORKSPACE</a>, GSL_INTEG_GAUSS61, gsl_work, &amp;norm, &amp;abserr);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">return</span> norm;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;}</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160; </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">/* Compute number of Sn1a: has units of N0 = 1.3e-3, which is SN1A/(unit initial mass in M_sun).</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment"> * Zero for age &lt; 40 Myr. */</span></div>
<div class="line"><a name="l00324"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a76a8adf795460ecc25eb530e3c6e35cb">  324</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="metal__return_8c.html#a76a8adf795460ecc25eb530e3c6e35cb">sn1a_number</a>(<span class="keywordtype">double</span> dtmyrstart, <span class="keywordtype">double</span> dtmyrend, <span class="keywordtype">double</span> hub)</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;{</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">/* Number of Sn1a events follows a delay time distribution (1305.2913, eq. 10) */</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> sn1aindex = 1.12;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> tau8msun = 40;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">if</span>(dtmyrend &lt; tau8msun)</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">/* Lower integration limit modelling formation time of WDs*/</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordflow">if</span>(dtmyrstart &lt; tau8msun)</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        dtmyrstart  = tau8msun;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="comment">/* Total number of Sn1a events from this star: integral evaluated from t=tau8msun to t=hubble time.*/</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> totalSN1a = 1- pow(1/(hub*<a class="code" href="physconst_8h.html#a5de72d8762faf787d06d4dd47daeddeb">HUBBLE</a> * <a class="code" href="physconst_8h.html#af2bfce8e844bbb3b120263471c6c329e">SEC_PER_MEGAYEAR</a>)/tau8msun, 1-sn1aindex);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="comment">/* This is the integral of the DTD, normalised to the N0 rate which is in SN/M_sun.*/</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordtype">double</span> Nsn1a = <a class="code" href="metal__return_8c.html#a687f879a7550bbdfdc820d65b606cb36">MetalParams</a>.<a class="code" href="structmetal__return__params.html#aab6341aebf537227479a3df11c2a1339">Sn1aN0</a> /totalSN1a * (pow(dtmyrstart / tau8msun, 1-sn1aindex) - pow(dtmyrend / tau8msun, 1-sn1aindex));</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">return</span> Nsn1a;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;}</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">/* Compute yield of AGB stars: this is normalised to the yield which has units of Msun / (unit Msun in the initial SSP and so is really dimensionless.)*/</span></div>
<div class="line"><a name="l00342"></a><span class="lineno"><a class="line" href="metal__return_8c.html#ad1b2ebe4fbb8bd696bfaf675438fe550">  342</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="metal__return_8c.html#ad1b2ebe4fbb8bd696bfaf675438fe550">compute_agb_yield</a>(gsl_interp2d * agb_interp, <span class="keyword">const</span> <span class="keywordtype">double</span> * agb_weights, <span class="keywordtype">double</span> stellarmetal, <span class="keywordtype">double</span> masslow, <span class="keywordtype">double</span> masshigh, gsl_integration_workspace * gsl_work )</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;{</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keyword">struct </span><a class="code" href="structimf__integ__params.html">imf_integ_params</a> para;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    gsl_function ff = {<a class="code" href="metal__return_8c.html#ab7106eacb849b554febe06ca0b7e920f">chabrier_imf_integ</a>, &amp;para};</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordtype">double</span> agbyield = 0, abserr;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="comment">/* Only return AGB metals for the range of AGB stars*/</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordflow">if</span> (masshigh &gt; <a class="code" href="metal__tables_8h.html#a76c1c4ce8f3e324d728e5f9e2a17925f">SNAGBSWITCH</a>)</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        masshigh = <a class="code" href="metal__tables_8h.html#a76c1c4ce8f3e324d728e5f9e2a17925f">SNAGBSWITCH</a>;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordflow">if</span> (masslow &lt; <a class="code" href="metal__tables_8h.html#a75fab227eb2c54a8c6a0dc8646b20586">agb_masses</a>[0])</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        masslow = <a class="code" href="metal__tables_8h.html#a75fab227eb2c54a8c6a0dc8646b20586">agb_masses</a>[0];</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">if</span> (stellarmetal &gt; <a class="code" href="metal__tables_8h.html#affe9e55a7937d887e455b230d6debc72">agb_metallicities</a>[<a class="code" href="metal__tables_8h.html#a4f784d3142b1103442b95109d99f1dd8">AGB_NMET</a>-1])</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        stellarmetal = <a class="code" href="metal__tables_8h.html#affe9e55a7937d887e455b230d6debc72">agb_metallicities</a>[<a class="code" href="metal__tables_8h.html#a4f784d3142b1103442b95109d99f1dd8">AGB_NMET</a>-1];</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">if</span> (stellarmetal &lt; <a class="code" href="metal__tables_8h.html#affe9e55a7937d887e455b230d6debc72">agb_metallicities</a>[0])</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        stellarmetal = <a class="code" href="metal__tables_8h.html#affe9e55a7937d887e455b230d6debc72">agb_metallicities</a>[0];</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="comment">/* This happens if no bins in range had dying stars this timestep*/</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keywordflow">if</span>(masslow &gt;= masshigh)</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    para.<a class="code" href="structimf__integ__params.html#a6c90d1dcd404c55457d367d3ed7e46a4">interp</a> = agb_interp;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    para.<a class="code" href="structimf__integ__params.html#acf3d030be4acb640012feded96d40a98">masses</a> = <a class="code" href="metal__tables_8h.html#a75fab227eb2c54a8c6a0dc8646b20586">agb_masses</a>;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    para.<a class="code" href="structimf__integ__params.html#a2d69b6d46483a514c2052fc71b2269ee">metallicities</a> = <a class="code" href="metal__tables_8h.html#affe9e55a7937d887e455b230d6debc72">agb_metallicities</a>;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    para.<a class="code" href="structimf__integ__params.html#a5ef3b84941e9bc50d589e35e707928c0">metallicity</a> = stellarmetal;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    para.<a class="code" href="structimf__integ__params.html#a567ac849e47171ae06a1ee0673827c0b">weights</a> = agb_weights;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    gsl_integration_qag(&amp;ff, masslow, masshigh, 1e-7, 1e-3, <a class="code" href="metal__tables_8h.html#a80e75542e47c3d4bb53f7c18ecfbf446">GSL_WORKSPACE</a>, GSL_INTEG_GAUSS61, gsl_work, &amp;agbyield, &amp;abserr);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">return</span> agbyield;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;}</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00368"></a><span class="lineno"><a class="line" href="metal__return_8c.html#aa295d967ecdb8d2eb11cb8cf02386b41">  368</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="metal__return_8c.html#aa295d967ecdb8d2eb11cb8cf02386b41">compute_snii_yield</a>(gsl_interp2d * snii_interp, <span class="keyword">const</span> <span class="keywordtype">double</span> * snii_weights, <span class="keywordtype">double</span> stellarmetal, <span class="keywordtype">double</span> masslow, <span class="keywordtype">double</span> masshigh, gsl_integration_workspace * gsl_work )</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;{</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keyword">struct </span><a class="code" href="structimf__integ__params.html">imf_integ_params</a> para;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    gsl_function ff = {<a class="code" href="metal__return_8c.html#ab7106eacb849b554febe06ca0b7e920f">chabrier_imf_integ</a>, &amp;para};</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keywordtype">double</span> yield = 0, abserr;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="comment">/* Only return metals for the range of SNII stars.*/</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordflow">if</span> (masshigh &gt; <a class="code" href="metal__tables_8h.html#ae1387e9c35b052580b69af49c33068dd">snii_masses</a>[<a class="code" href="metal__tables_8h.html#a72c6dc54510c0490ccc48ca6d1b6d5a3">SNII_NMASS</a>-1])</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        masshigh = <a class="code" href="metal__tables_8h.html#ae1387e9c35b052580b69af49c33068dd">snii_masses</a>[<a class="code" href="metal__tables_8h.html#a72c6dc54510c0490ccc48ca6d1b6d5a3">SNII_NMASS</a>-1];</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">if</span> (masslow &lt; <a class="code" href="metal__tables_8h.html#a76c1c4ce8f3e324d728e5f9e2a17925f">SNAGBSWITCH</a>)</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        masslow = <a class="code" href="metal__tables_8h.html#a76c1c4ce8f3e324d728e5f9e2a17925f">SNAGBSWITCH</a>;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">if</span> (stellarmetal &gt; <a class="code" href="metal__tables_8h.html#a61be6fb4a1f463c29c9c1f436ac02ae6">snii_metallicities</a>[<a class="code" href="metal__tables_8h.html#ab4b5721a1b3263ad6360bf5b874f7102">SNII_NMET</a>-1])</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        stellarmetal = <a class="code" href="metal__tables_8h.html#a61be6fb4a1f463c29c9c1f436ac02ae6">snii_metallicities</a>[<a class="code" href="metal__tables_8h.html#ab4b5721a1b3263ad6360bf5b874f7102">SNII_NMET</a>-1];</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordflow">if</span> (stellarmetal &lt; <a class="code" href="metal__tables_8h.html#a61be6fb4a1f463c29c9c1f436ac02ae6">snii_metallicities</a>[0])</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        stellarmetal = <a class="code" href="metal__tables_8h.html#a61be6fb4a1f463c29c9c1f436ac02ae6">snii_metallicities</a>[0];</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    para.<a class="code" href="structimf__integ__params.html#a6c90d1dcd404c55457d367d3ed7e46a4">interp</a> = snii_interp;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    para.<a class="code" href="structimf__integ__params.html#acf3d030be4acb640012feded96d40a98">masses</a> = <a class="code" href="metal__tables_8h.html#ae1387e9c35b052580b69af49c33068dd">snii_masses</a>;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    para.<a class="code" href="structimf__integ__params.html#a2d69b6d46483a514c2052fc71b2269ee">metallicities</a> = <a class="code" href="metal__tables_8h.html#a61be6fb4a1f463c29c9c1f436ac02ae6">snii_metallicities</a>;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    para.<a class="code" href="structimf__integ__params.html#a5ef3b84941e9bc50d589e35e707928c0">metallicity</a> = stellarmetal;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    para.<a class="code" href="structimf__integ__params.html#a567ac849e47171ae06a1ee0673827c0b">weights</a> = snii_weights;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="comment">/* This happens if no bins in range had dying stars this timestep*/</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="keywordflow">if</span>(masslow &gt;= masshigh)</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    gsl_integration_qag(&amp;ff, masslow, masshigh, 1e-7, 1e-3, <a class="code" href="metal__tables_8h.html#a80e75542e47c3d4bb53f7c18ecfbf446">GSL_WORKSPACE</a>, GSL_INTEG_GAUSS61, gsl_work, &amp;yield, &amp;abserr);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="keywordflow">return</span> yield;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;}</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160; </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">/* Compute the total mass yield for this star in this timestep*/</span></div>
<div class="line"><a name="l00395"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a11ab16103547beec8342415acd5add34">  395</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code" href="metal__return_8c.html#a11ab16103547beec8342415acd5add34">mass_yield</a>(<span class="keywordtype">double</span> dtmyrstart, <span class="keywordtype">double</span> dtmyrend, <span class="keywordtype">double</span> stellarmetal, <span class="keywordtype">double</span> hub, <span class="keyword">struct</span> <a class="code" href="structinterps.html">interps</a> * <a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>, <span class="keywordtype">double</span> imf_norm, gsl_integration_workspace * gsl_work, <span class="keywordtype">double</span> masslow, <span class="keywordtype">double</span> masshigh)</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;{</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="comment">/* Number of AGB stars/SnII by integrating the IMF*/</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordtype">double</span> agbyield = <a class="code" href="metal__return_8c.html#ad1b2ebe4fbb8bd696bfaf675438fe550">compute_agb_yield</a>(<a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>-&gt;agb_mass_interp, <a class="code" href="metal__tables_8h.html#a9805eef500ca9d27dbf530685e27ba61">agb_total_mass</a>, stellarmetal, masslow, masshigh, gsl_work);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordtype">double</span> sniiyield = <a class="code" href="metal__return_8c.html#aa295d967ecdb8d2eb11cb8cf02386b41">compute_snii_yield</a>(<a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>-&gt;snii_mass_interp, <a class="code" href="metal__tables_8h.html#a94a003b7846207e7810e1e55b0244e42">snii_total_mass</a>, stellarmetal, masslow, masshigh, gsl_work);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="comment">/* Fraction of the IMF which goes off this timestep. Normalised by the total IMF so we get a fraction of the SSP.*/</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordtype">double</span> massyield = (agbyield + sniiyield)/imf_norm;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="comment">/* Mass yield from Sn1a*/</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordtype">double</span> Nsn1a = <a class="code" href="metal__return_8c.html#a76a8adf795460ecc25eb530e3c6e35cb">sn1a_number</a>(dtmyrstart, dtmyrend, hub);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    massyield += Nsn1a * <a class="code" href="metal__tables_8h.html#ac2471adaa3fa47747079522dff017cb7">sn1a_total_metals</a>;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="comment">//message(3, &quot;masslow %g masshigh %g stellarmetal %g dystart %g dtend %g agb %g snii %g sn1a %g imf_norm %g\n&quot;,</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="comment">//        masslow, masshigh, stellarmetal, dtmyrstart, dtmyrend, agbyield, sniiyield, Nsn1a * sn1a_total_metals, imf_norm);</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="keywordflow">return</span> massyield;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;}</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">/* Compute the total metal yield for this star in this timestep*/</span></div>
<div class="line"><a name="l00411"></a><span class="lineno"><a class="line" href="metal__return_8c.html#aee9d9017b5438971ffe6af27a81fa272">  411</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code" href="metal__return_8c.html#aee9d9017b5438971ffe6af27a81fa272">metal_yield</a>(<span class="keywordtype">double</span> dtmyrstart, <span class="keywordtype">double</span> dtmyrend, <span class="keywordtype">double</span> stellarmetal, <span class="keywordtype">double</span> hub, <span class="keyword">struct</span> <a class="code" href="structinterps.html">interps</a> * <a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>, <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> * MetalYields, <span class="keywordtype">double</span> imf_norm, gsl_integration_workspace * gsl_work, <span class="keywordtype">double</span> masslow, <span class="keywordtype">double</span> masshigh)</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;{</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordtype">double</span> MetalGenerated = 0;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="comment">/* Number of AGB stars/SnII by integrating the IMF*/</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    MetalGenerated += <a class="code" href="metal__return_8c.html#ad1b2ebe4fbb8bd696bfaf675438fe550">compute_agb_yield</a>(<a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>-&gt;agb_metallicity_interp, <a class="code" href="metal__tables_8h.html#aa38d6243b64cada879d9ecf59a02e527">agb_total_metals</a>, stellarmetal, masslow, masshigh, gsl_work);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    MetalGenerated += <a class="code" href="metal__return_8c.html#aa295d967ecdb8d2eb11cb8cf02386b41">compute_snii_yield</a>(<a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>-&gt;snii_metallicity_interp, <a class="code" href="metal__tables_8h.html#afa712d91edf737c0da969b49f4b9837f">snii_total_metals</a>, stellarmetal, masslow, masshigh, gsl_work);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    MetalGenerated /= imf_norm;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="slotsmanager_8h.html#ad07d3b873121463218a991d53512e49b">NMETALS</a>; i++)</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        MetalYields[i] = 0;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        MetalYields[i] += <a class="code" href="metal__return_8c.html#ad1b2ebe4fbb8bd696bfaf675438fe550">compute_agb_yield</a>(<a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>-&gt;agb_metals_interp[i], <a class="code" href="metal__tables_8h.html#ada35087703fd56a884bc7c79c2b26495">agb_yield</a>[i], stellarmetal, masslow, masshigh, gsl_work);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        MetalYields[i] += <a class="code" href="metal__return_8c.html#aa295d967ecdb8d2eb11cb8cf02386b41">compute_snii_yield</a>(<a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>-&gt;snii_metals_interp[i], <a class="code" href="metal__tables_8h.html#a17de36caa644e3741822c6196dbbcd9d">snii_yield</a>[i], stellarmetal, masslow, masshigh, gsl_work);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        MetalYields[i] /= imf_norm;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    }</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keywordtype">double</span> Nsn1a = <a class="code" href="metal__return_8c.html#a76a8adf795460ecc25eb530e3c6e35cb">sn1a_number</a>(dtmyrstart, dtmyrend, hub);</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="slotsmanager_8h.html#ad07d3b873121463218a991d53512e49b">NMETALS</a>; i++)</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        MetalYields[i] += Nsn1a * <a class="code" href="metal__tables_8h.html#aa2a6d47b82bf746279097654676fcf4e">sn1a_yields</a>[i];</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    MetalGenerated += Nsn1a * <a class="code" href="metal__tables_8h.html#ac2471adaa3fa47747079522dff017cb7">sn1a_total_metals</a>;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keywordflow">return</span> MetalGenerated;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;}</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160; </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">/* Initialise the private structure, finding stellar mass return and ages*/</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;int64_t</div>
<div class="line"><a name="l00437"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a2bc8aad8a4cd6b54c88ccd4321c6cfda">  437</a></span>&#160;<a class="code" href="metal__return_8c.html#a2bc8aad8a4cd6b54c88ccd4321c6cfda">metal_return_init</a>(<span class="keyword">const</span> <a class="code" href="structActiveParticles.html">ActiveParticles</a> * act, <a class="code" href="structCosmology.html">Cosmology</a> * <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, <span class="keyword">struct</span> <a class="code" href="structMetalReturnPriv.html">MetalReturnPriv</a> * priv, <span class="keyword">const</span> <span class="keywordtype">double</span> atime)</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;{</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keywordtype">int</span> nthread = omp_get_max_threads();</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    priv-&gt;<a class="code" href="structMetalReturnPriv.html#a1eed6c8d1077ff30b6e6855984159721">gsl_work</a> = <a class="code" href="mymalloc_8h.html#a52bc2c6ec78b17bb6d42957cbf642f15">ta_malloc</a>(<span class="stringliteral">&quot;gsl_work&quot;</span>, gsl_integration_workspace *, nthread);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="comment">/* Allocate a workspace for each thread*/</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">for</span>(i=0; i &lt; nthread; i++)</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        priv-&gt;<a class="code" href="structMetalReturnPriv.html#a1eed6c8d1077ff30b6e6855984159721">gsl_work</a>[i] = gsl_integration_workspace_alloc(<a class="code" href="metal__tables_8h.html#a80e75542e47c3d4bb53f7c18ecfbf446">GSL_WORKSPACE</a>);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    priv-&gt;<a class="code" href="structMetalReturnPriv.html#aff9a4d9cba76d657d12ef9e15e463979">hub</a> = <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#a4b79dcaa1e1c38d07258c3f539e2cb20">HubbleParam</a>;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160; </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="comment">/* Initialize*/</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <a class="code" href="metal__return_8c.html#a45c1e30e08ea1d55780815948138bdc6">setup_metal_table_interp</a>(&amp;priv-&gt;<a class="code" href="structMetalReturnPriv.html#ae3d5c753efbff8ad3bb8d344315b36d8">interp</a>);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    priv-&gt;<a class="code" href="structMetalReturnPriv.html#a4fc18b3395fd0b8c6c0c7a18ebbdf9c4">StellarAges</a> = (<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;StellarAges&quot;</span>, <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[4].<a class="code" href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">size</a> * <span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a>));</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    priv-&gt;<a class="code" href="structMetalReturnPriv.html#af3232cc5f66e274ab87edc401e1cac20">MassReturn</a> = (<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;MassReturn&quot;</span>, <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[4].<a class="code" href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">size</a> * <span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a>));</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    priv-&gt;<a class="code" href="structMetalReturnPriv.html#afbeb5062024e1f55af3c675c2feb6c78">LowDyingMass</a> = (<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;LowDyingMass&quot;</span>, <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[4].<a class="code" href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">size</a> * <span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a>));</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    priv-&gt;<a class="code" href="structMetalReturnPriv.html#a31658498bcfbc005e067dd1d7e3efc87">HighDyingMass</a> = (<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;HighDyingMass&quot;</span>, <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[4].<a class="code" href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">size</a> * <span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a>));</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    priv-&gt;<a class="code" href="structMetalReturnPriv.html#a29789d7f689208055997dd8e0189704b">StarVolumeSPH</a> = (<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;StarVolumeSPH&quot;</span>, <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[4].<a class="code" href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">size</a> * <span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a>));</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    priv-&gt;<a class="code" href="structMetalReturnPriv.html#a82b1ced3037c6edbc251d8606638e0a3">imf_norm</a> = <a class="code" href="metal__return_8c.html#ad2254b657bd9575bdc88bd5dd246ddd8">compute_imf_norm</a>(priv-&gt;<a class="code" href="structMetalReturnPriv.html#a1eed6c8d1077ff30b6e6855984159721">gsl_work</a>[0]);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="comment">/* Maximum possible mass return for below*/</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordtype">double</span> maxmassfrac = <a class="code" href="metal__return_8c.html#a11ab16103547beec8342415acd5add34">mass_yield</a>(0, 1/(<a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#a4b79dcaa1e1c38d07258c3f539e2cb20">HubbleParam</a>*<a class="code" href="physconst_8h.html#a5de72d8762faf787d06d4dd47daeddeb">HUBBLE</a> * <a class="code" href="physconst_8h.html#af2bfce8e844bbb3b120263471c6c329e">SEC_PER_MEGAYEAR</a>), <a class="code" href="metal__tables_8h.html#a61be6fb4a1f463c29c9c1f436ac02ae6">snii_metallicities</a>[<a class="code" href="metal__tables_8h.html#ab4b5721a1b3263ad6360bf5b874f7102">SNII_NMET</a>-1], <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#a4b79dcaa1e1c38d07258c3f539e2cb20">HubbleParam</a>, &amp;priv-&gt;<a class="code" href="structMetalReturnPriv.html#ae3d5c753efbff8ad3bb8d344315b36d8">interp</a>, priv-&gt;<a class="code" href="structMetalReturnPriv.html#a82b1ced3037c6edbc251d8606638e0a3">imf_norm</a>, priv-&gt;<a class="code" href="structMetalReturnPriv.html#a1eed6c8d1077ff30b6e6855984159721">gsl_work</a>[0],<a class="code" href="metal__tables_8h.html#a75fab227eb2c54a8c6a0dc8646b20586">agb_masses</a>[0], <a class="code" href="metal__tables_8h.html#ac62ec9985d76dc0b4dc569839bc926ef">MAXMASS</a>);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    int64_t haswork = 0;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="comment">/* First find the mass return as a fraction of the total mass and the age of the star.</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">     * This is done first so we can skip density computation for not active stars*/</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="preprocessor">    #pragma omp parallel for reduction(+: haswork)</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordflow">for</span>(i=0; i &lt; act-&gt;<a class="code" href="structActiveParticles.html#a847ab898fdabc62a4723c7c3a66038d4">NumActiveParticle</a>;i++)</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    {</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="keywordtype">int</span> p_i = act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a> ? act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a>[i] : i;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Type != 4)</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <span class="keywordtype">int</span> tid = omp_get_thread_num();</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> slot = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].PI;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        priv-&gt;<a class="code" href="structMetalReturnPriv.html#a4fc18b3395fd0b8c6c0c7a18ebbdf9c4">StellarAges</a>[slot] = <a class="code" href="metal__return_8c.html#ae51821f5a1163d9e641d2f59eea9a0de">atime_to_myr</a>(<a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(p_i).FormationTime, atime, priv-&gt;<a class="code" href="structMetalReturnPriv.html#a1eed6c8d1077ff30b6e6855984159721">gsl_work</a>[tid]);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="comment">/* Note this takes care of units*/</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <span class="keywordtype">double</span> initialmass = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Mass + <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(p_i).TotalMassReturned;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <a class="code" href="metal__return_8c.html#a137b224aee42a66c68cde0385dfb58d0">find_mass_bin_limits</a>(&amp;priv-&gt;<a class="code" href="structMetalReturnPriv.html#afbeb5062024e1f55af3c675c2feb6c78">LowDyingMass</a>[slot], &amp;priv-&gt;<a class="code" href="structMetalReturnPriv.html#a31658498bcfbc005e067dd1d7e3efc87">HighDyingMass</a>[slot], <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(p_i).LastEnrichmentMyr, priv-&gt;<a class="code" href="structMetalReturnPriv.html#a4fc18b3395fd0b8c6c0c7a18ebbdf9c4">StellarAges</a>[<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].PI], <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(p_i).Metallicity, priv-&gt;<a class="code" href="structMetalReturnPriv.html#ae3d5c753efbff8ad3bb8d344315b36d8">interp</a>.<a class="code" href="structinterps.html#ae60754dbad58a2b88fdb0db52dab97d0">lifetime_interp</a>);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        priv-&gt;<a class="code" href="structMetalReturnPriv.html#af3232cc5f66e274ab87edc401e1cac20">MassReturn</a>[slot] = initialmass * <a class="code" href="metal__return_8c.html#a11ab16103547beec8342415acd5add34">mass_yield</a>(<a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(p_i).LastEnrichmentMyr, priv-&gt;<a class="code" href="structMetalReturnPriv.html#a4fc18b3395fd0b8c6c0c7a18ebbdf9c4">StellarAges</a>[<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].PI], <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(p_i).Metallicity, <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>-&gt;<a class="code" href="structCosmology.html#a4b79dcaa1e1c38d07258c3f539e2cb20">HubbleParam</a>, &amp;priv-&gt;<a class="code" href="structMetalReturnPriv.html#ae3d5c753efbff8ad3bb8d344315b36d8">interp</a>, priv-&gt;<a class="code" href="structMetalReturnPriv.html#a82b1ced3037c6edbc251d8606638e0a3">imf_norm</a>, priv-&gt;<a class="code" href="structMetalReturnPriv.html#a1eed6c8d1077ff30b6e6855984159721">gsl_work</a>[tid],priv-&gt;<a class="code" href="structMetalReturnPriv.html#afbeb5062024e1f55af3c675c2feb6c78">LowDyingMass</a>[slot], priv-&gt;<a class="code" href="structMetalReturnPriv.html#a31658498bcfbc005e067dd1d7e3efc87">HighDyingMass</a>[slot]);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="comment">//message(3, &quot;Particle %d PI %d massgen %g mass %g initmass %g\n&quot;, p_i, P[p_i].PI, priv-&gt;MassReturn[P[p_i].PI], P[p_i].Mass, initialmass);</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <span class="comment">/* Guard against making a zero mass particle and warn since this should not happen.*/</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(p_i).TotalMassReturned + priv-&gt;<a class="code" href="structMetalReturnPriv.html#af3232cc5f66e274ab87edc401e1cac20">MassReturn</a>[slot] &gt; initialmass * maxmassfrac) {</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            <span class="keywordflow">if</span>(priv-&gt;<a class="code" href="structMetalReturnPriv.html#af3232cc5f66e274ab87edc401e1cac20">MassReturn</a>[slot] / <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(p_i).TotalMassReturned &gt; 0.01)</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(1, <span class="stringliteral">&quot;Large mass return id %ld %g from %d mass %g initial %g (maxfrac %g) age %g lastenrich %g metal %g dymass %g %g\n&quot;</span>,</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                    <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].ID, priv-&gt;<a class="code" href="structMetalReturnPriv.html#af3232cc5f66e274ab87edc401e1cac20">MassReturn</a>[slot], p_i, <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(p_i).TotalMassReturned, initialmass, maxmassfrac, priv-&gt;<a class="code" href="structMetalReturnPriv.html#a4fc18b3395fd0b8c6c0c7a18ebbdf9c4">StellarAges</a>[<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].PI], <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(p_i).LastEnrichmentMyr, <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(p_i).Metallicity, priv-&gt;<a class="code" href="structMetalReturnPriv.html#afbeb5062024e1f55af3c675c2feb6c78">LowDyingMass</a>[slot], priv-&gt;<a class="code" href="structMetalReturnPriv.html#a31658498bcfbc005e067dd1d7e3efc87">HighDyingMass</a>[slot]);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            priv-&gt;<a class="code" href="structMetalReturnPriv.html#af3232cc5f66e274ab87edc401e1cac20">MassReturn</a>[slot] = initialmass * maxmassfrac - <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(p_i).TotalMassReturned;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            <span class="keywordflow">if</span>(priv-&gt;<a class="code" href="structMetalReturnPriv.html#af3232cc5f66e274ab87edc401e1cac20">MassReturn</a>[slot] &lt; 0) {</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                priv-&gt;<a class="code" href="structMetalReturnPriv.html#af3232cc5f66e274ab87edc401e1cac20">MassReturn</a>[slot] = 0;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            }</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            <span class="comment">/* Ensure that we skip this step*/</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            <span class="keywordflow">if</span>(!<a class="code" href="metal__return_8c.html#ab5c3a1fb77d5aef2936539c084bb0273">metals_haswork</a>(p_i, priv-&gt;<a class="code" href="structMetalReturnPriv.html#af3232cc5f66e274ab87edc401e1cac20">MassReturn</a>))</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(p_i).LastEnrichmentMyr = priv-&gt;<a class="code" href="structMetalReturnPriv.html#a4fc18b3395fd0b8c6c0c7a18ebbdf9c4">StellarAges</a>[<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].PI];</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        }</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <span class="comment">/* Keep count of how much work we need to do*/</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="metal__return_8c.html#ab5c3a1fb77d5aef2936539c084bb0273">metals_haswork</a>(p_i, priv-&gt;<a class="code" href="structMetalReturnPriv.html#af3232cc5f66e274ab87edc401e1cac20">MassReturn</a>))</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;            haswork++;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    }</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordflow">return</span> haswork;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;}</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160; </div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">/* Free memory allocated by metal_return_init */</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00500"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a6bd8ed6c1f34beb2703996ba03572b8a">  500</a></span>&#160;<a class="code" href="metal__return_8c.html#a6bd8ed6c1f34beb2703996ba03572b8a">metal_return_priv_free</a>(<span class="keyword">struct</span> <a class="code" href="structMetalReturnPriv.html">MetalReturnPriv</a> * priv)</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;{</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(priv-&gt;<a class="code" href="structMetalReturnPriv.html#a29789d7f689208055997dd8e0189704b">StarVolumeSPH</a>);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(priv-&gt;<a class="code" href="structMetalReturnPriv.html#a31658498bcfbc005e067dd1d7e3efc87">HighDyingMass</a>);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(priv-&gt;<a class="code" href="structMetalReturnPriv.html#afbeb5062024e1f55af3c675c2feb6c78">LowDyingMass</a>);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(priv-&gt;<a class="code" href="structMetalReturnPriv.html#af3232cc5f66e274ab87edc401e1cac20">MassReturn</a>);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(priv-&gt;<a class="code" href="structMetalReturnPriv.html#a4fc18b3395fd0b8c6c0c7a18ebbdf9c4">StellarAges</a>);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keywordflow">for</span>(i=0; i &lt; omp_get_max_threads(); i++)</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        gsl_integration_workspace_free(priv-&gt;<a class="code" href="structMetalReturnPriv.html#a1eed6c8d1077ff30b6e6855984159721">gsl_work</a>[i]);</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160; </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <a class="code" href="mymalloc_8h.html#a84e2115e90e9c22e11d9663c019fc8bc">ta_free</a>(priv-&gt;<a class="code" href="structMetalReturnPriv.html#a1eed6c8d1077ff30b6e6855984159721">gsl_work</a>);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;}</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160; </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00517"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a7c817252ab7c0f679fea71bde6dea852">  517</a></span>&#160;<a class="code" href="metal__return_8c.html#a7c817252ab7c0f679fea71bde6dea852">metal_return</a>(<span class="keyword">const</span> <a class="code" href="structActiveParticles.html">ActiveParticles</a> * act, <a class="code" href="structDomainDecomp.html">DomainDecomp</a> * <span class="keyword">const</span> ddecomp, <a class="code" href="structCosmology.html">Cosmology</a> * <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, <span class="keyword">const</span> <span class="keywordtype">double</span> atime, <span class="keyword">const</span> <span class="keywordtype">double</span> AvgGasMass)</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;{</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="comment">/* Do nothing if no stars yet*/</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    int64_t totstar;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    MPI_Allreduce(&amp;<a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[4].<a class="code" href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">size</a>, &amp;totstar, 1, <a class="code" href="system_8h.html#abb95c0be39c73f8e6b0978a9a374d92b">MPI_INT64</a>, MPI_SUM, MPI_COMM_WORLD);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keywordflow">if</span>(totstar == 0)</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keyword">struct </span><a class="code" href="structMetalReturnPriv.html">MetalReturnPriv</a> priv[1];</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160; </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    int64_t nwork = <a class="code" href="metal__return_8c.html#a2bc8aad8a4cd6b54c88ccd4321c6cfda">metal_return_init</a>(act, <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, priv, atime);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160; </div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="comment">/* Maximum mass of a gas particle after enrichment: cap it at a few times the initial mass.</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">     * FIXME: Ideally we should here fork a new particle with a smaller gas mass. We should</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">     * figure out then how set the gas entropy. A possibly better idea is to add</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">     * a generic routine to split gas particles into the density code.*/</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    priv-&gt;<a class="code" href="structMetalReturnPriv.html#a4426a0c820476888c4a431bc473ea5e0">MaxGasMass</a> = 4* AvgGasMass;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160; </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    int64_t totwork;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    MPI_Allreduce(&amp;nwork, &amp;totwork, 1, <a class="code" href="system_8h.html#abb95c0be39c73f8e6b0978a9a374d92b">MPI_INT64</a>, MPI_SUM, MPI_COMM_WORLD);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160; </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/SPH/Metals/Init&quot;</span>);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160; </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="keywordflow">if</span>(totwork == 0) {</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <a class="code" href="metal__return_8c.html#a6bd8ed6c1f34beb2703996ba03572b8a">metal_return_priv_free</a>(priv);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    }</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160; </div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <a class="code" href="structForceTree.html">ForceTree</a> gasTree = {0};</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="comment">/* Just gas, no moments*/</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <a class="code" href="forcetree_8c.html#aa01061828cef34bc4c55ef9eaa7c03f5">force_tree_rebuild_mask</a>(&amp;gasTree, ddecomp, <a class="code" href="forcetree_8h.html#ad7d9abc3063766d4c2825954b8354f70">GASMASK</a>, 0, NULL);</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160; </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="comment">/* Compute total number of weights around each star for actively returning stars*/</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <a class="code" href="metal__return_8c.html#ac6208618c0ad5ad55e84bcfb213e7dcb">stellar_density</a>(act, priv-&gt;<a class="code" href="structMetalReturnPriv.html#a29789d7f689208055997dd8e0189704b">StarVolumeSPH</a>, priv-&gt;<a class="code" href="structMetalReturnPriv.html#af3232cc5f66e274ab87edc401e1cac20">MassReturn</a>, &amp;gasTree);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160; </div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="comment">/* Do the metal return*/</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <a class="code" href="structTreeWalk.html">TreeWalk</a> tw[1] = {{0}};</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#aa3ff3d4a5a82422609ac154aa4a461ea">ev_label</a> = <span class="stringliteral">&quot;METALS&quot;</span>;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#ab4e96e67f2e72ac33dca9dd06cdac6c0">visit</a> = (<a class="code" href="treewalk_8h.html#a01b18ab132aa3a45e2f2bed8aef94633">TreeWalkVisitFunction</a>) <a class="code" href="treewalk_8c.html#a145aa9608fd3824bec8049ee97da1c6f">treewalk_visit_ngbiter</a>;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#a96381f9f61cf2c56dac48927cd997ec3">ngbiter</a> = (<a class="code" href="treewalk_8h.html#aade20e4cc34b64ecf3bd6f5525465371">TreeWalkNgbIterFunction</a>) <a class="code" href="metal__return_8c.html#aed77dd49844be97101b610fcca622033">metal_return_ngbiter</a>;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#a36bf2eb0e0d65ace233ef30335e04659">ngbiter_type_elsize</a> = <span class="keyword">sizeof</span>(<a class="code" href="structTreeWalkNgbIterMetals.html">TreeWalkNgbIterMetals</a>);</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#a2f6bc842f407a44d99de52e9b5140454">haswork</a> = <a class="code" href="metal__return_8c.html#aae2dc62d04b08fb98b6b5e0549d595f9">metal_return_haswork</a>;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#ad0b91dafd46de132917e7993869514c5">fill</a> = (<a class="code" href="treewalk_8h.html#ac9a8ade7817c58b83859399364deb1a1">TreeWalkFillQueryFunction</a>) <a class="code" href="metal__return_8c.html#ac75463a2439d1e5657e6b759b79cf717">metal_return_copy</a>;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#aa08a0586a68d1f4f87e0caa1e59dcc5e">reduce</a> = NULL;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#a8c4dcda60d680c3d56423fca8647472f">postprocess</a> = (<a class="code" href="treewalk_8h.html#a80f59f147efe7c27b601024d819769db">TreeWalkProcessFunction</a>) <a class="code" href="metal__return_8c.html#a64bf0f58fb25b3c2ded7dbeb73088b3c">metal_return_postprocess</a>;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#affd5eae4b5a63dcce236ac15b00b4c7c">query_type_elsize</a> = <span class="keyword">sizeof</span>(<a class="code" href="structTreeWalkQueryMetals.html">TreeWalkQueryMetals</a>);</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#ac8c67faaf2c360ed510c4508f11f7c2d">result_type_elsize</a> = <span class="keyword">sizeof</span>(<a class="code" href="structTreeWalkResultMetals.html">TreeWalkResultMetals</a>);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#ab8c7809c8d29e0326dbdde88e8fa5dfb">repeatdisallowed</a> = 1;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#a8525705e365e7c07027f372b66aff149">tree</a> = &amp;gasTree;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#a2ae51082ebb6332e558024b6a45506b2">priv</a> = priv;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160; </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    priv-&gt;<a class="code" href="structMetalReturnPriv.html#af9acc610e067970d120fdece93b594cc">spin</a> = <a class="code" href="spinlocks_8c.html#ad80d4484f90fb93890f42054d0818447">init_spinlocks</a>(<a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[0].<a class="code" href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">size</a>);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <a class="code" href="treewalk_8c.html#a1e336844d7f92d15cd9248c81ecfb453">treewalk_run</a>(tw, act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a>, act-&gt;<a class="code" href="structActiveParticles.html#a847ab898fdabc62a4723c7c3a66038d4">NumActiveParticle</a>);</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <a class="code" href="spinlocks_8c.html#a4198c8f6839dabbd9351bacd76c463e6">free_spinlocks</a>(priv-&gt;<a class="code" href="structMetalReturnPriv.html#af9acc610e067970d120fdece93b594cc">spin</a>);</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160; </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <a class="code" href="forcetree_8c.html#aaa26dfea4b696133a8bc35c5e0c56037">force_tree_free</a>(&amp;gasTree);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <a class="code" href="metal__return_8c.html#a6bd8ed6c1f34beb2703996ba03572b8a">metal_return_priv_free</a>(priv);</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160; </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="comment">/* collect some timing information */</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/SPH/Metals/Yield&quot;</span>);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;}</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">/* This function is unusually important:</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment"> * it computes the total amount of metals to be returned in this timestep.*/</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00583"></a><span class="lineno"><a class="line" href="metal__return_8c.html#ac75463a2439d1e5657e6b759b79cf717">  583</a></span>&#160;<a class="code" href="metal__return_8c.html#ac75463a2439d1e5657e6b759b79cf717">metal_return_copy</a>(<span class="keywordtype">int</span> place, <a class="code" href="structTreeWalkQueryMetals.html">TreeWalkQueryMetals</a> * input, <a class="code" href="structTreeWalk.html">TreeWalk</a> * tw)</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;{</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    input-&gt;<a class="code" href="structTreeWalkQueryMetals.html#a699dbc8bcfebe93b75880a81975efcf9">Metallicity</a> = <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(place).Metallicity;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    input-&gt;<a class="code" href="structTreeWalkQueryMetals.html#aee2bc2e2c1f19d81d0111b351934de22">Mass</a> = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[place].Mass;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    input-&gt;<a class="code" href="structTreeWalkQueryMetals.html#aa91b40c5bbb212dac30473b5992f5304">Hsml</a> = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[place].Hsml;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordtype">int</span> pi = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[place].PI;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    input-&gt;<a class="code" href="structTreeWalkQueryMetals.html#a3291b51ca793d21c8e66c15794c3f4cf">StarVolumeSPH</a> = <a class="code" href="metal__return_8c.html#aad6b2bf60ee9eae8cc059ba4c50aedce">METALS_GET_PRIV</a>(tw)-&gt;StarVolumeSPH[pi];</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordtype">double</span> InitialMass = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[place].Mass + <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(place).TotalMassReturned;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordtype">double</span> dtmyrend = <a class="code" href="metal__return_8c.html#aad6b2bf60ee9eae8cc059ba4c50aedce">METALS_GET_PRIV</a>(tw)-&gt;StellarAges[pi];</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keywordtype">double</span> dtmyrstart = <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(place).LastEnrichmentMyr;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keywordtype">int</span> tid = omp_get_thread_num();</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="comment">/* This is the total mass returned from this stellar population this timestep. Note this is already in the desired units.*/</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    input-&gt;<a class="code" href="structTreeWalkQueryMetals.html#a69fe57f92a03ddb696eb1c764f1112f7">MassGenerated</a> = <a class="code" href="metal__return_8c.html#aad6b2bf60ee9eae8cc059ba4c50aedce">METALS_GET_PRIV</a>(tw)-&gt;MassReturn[pi];</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="comment">/* This returns the total amount of metal produced this timestep, and also fills out MetalSpeciesGenerated, which is an</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">     * element by element table of the metal produced by dying stars this timestep.*/</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordtype">double</span> total_z_yield = <a class="code" href="metal__return_8c.html#aee9d9017b5438971ffe6af27a81fa272">metal_yield</a>(dtmyrstart, dtmyrend, input-&gt;<a class="code" href="structTreeWalkQueryMetals.html#a699dbc8bcfebe93b75880a81975efcf9">Metallicity</a>, <a class="code" href="metal__return_8c.html#aad6b2bf60ee9eae8cc059ba4c50aedce">METALS_GET_PRIV</a>(tw)-&gt;<a class="code" href="structMetalReturnPriv.html#aff9a4d9cba76d657d12ef9e15e463979">hub</a>, &amp;<a class="code" href="metal__return_8c.html#aad6b2bf60ee9eae8cc059ba4c50aedce">METALS_GET_PRIV</a>(tw)-&gt;<a class="code" href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a>, input-&gt;<a class="code" href="structTreeWalkQueryMetals.html#ae2f34af218c3ab39c9825bbae4314640">MetalSpeciesGenerated</a>, <a class="code" href="metal__return_8c.html#aad6b2bf60ee9eae8cc059ba4c50aedce">METALS_GET_PRIV</a>(tw)-&gt;<a class="code" href="structMetalReturnPriv.html#a82b1ced3037c6edbc251d8606638e0a3">imf_norm</a>, <a class="code" href="metal__return_8c.html#aad6b2bf60ee9eae8cc059ba4c50aedce">METALS_GET_PRIV</a>(tw)-&gt;<a class="code" href="structMetalReturnPriv.html#a1eed6c8d1077ff30b6e6855984159721">gsl_work</a>[tid], <a class="code" href="metal__return_8c.html#aad6b2bf60ee9eae8cc059ba4c50aedce">METALS_GET_PRIV</a>(tw)-&gt;<a class="code" href="structMetalReturnPriv.html#afbeb5062024e1f55af3c675c2feb6c78">LowDyingMass</a>[pi], <a class="code" href="metal__return_8c.html#aad6b2bf60ee9eae8cc059ba4c50aedce">METALS_GET_PRIV</a>(tw)-&gt;<a class="code" href="structMetalReturnPriv.html#a31658498bcfbc005e067dd1d7e3efc87">HighDyingMass</a>[pi]);</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="comment">/* The total metal returned is the metal created this timestep, plus the metal which was already in the mass returned by the dying stars.*/</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    input-&gt;<a class="code" href="structTreeWalkQueryMetals.html#ac1c17d61b3d06092002ee77b60e8083e">MetalGenerated</a> = InitialMass * total_z_yield + <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(place).Metallicity * input-&gt;<a class="code" href="structTreeWalkQueryMetals.html#a69fe57f92a03ddb696eb1c764f1112f7">MassGenerated</a>;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="comment">//message(3, &quot;Particle %d PI %d z %g massgen %g metallicity %g\n&quot;, pi, P[pi].PI, total_z_yield, METALS_GET_PRIV(tw)-&gt;MassReturn[pi], STARP(place).Metallicity);</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="comment">/* It should be positive! If it is not, this is some integration error</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment">     * in the yield table as we cannot destroy metal which is not present.*/</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="keywordflow">if</span>(input-&gt;<a class="code" href="structTreeWalkQueryMetals.html#ac1c17d61b3d06092002ee77b60e8083e">MetalGenerated</a> &lt; 0)</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        input-&gt;<a class="code" href="structTreeWalkQueryMetals.html#ac1c17d61b3d06092002ee77b60e8083e">MetalGenerated</a> = 0;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="comment">/* Similarly for all the other metal species*/</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="slotsmanager_8h.html#ad07d3b873121463218a991d53512e49b">NMETALS</a>; i++) {</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        input-&gt;<a class="code" href="structTreeWalkQueryMetals.html#ae2f34af218c3ab39c9825bbae4314640">MetalSpeciesGenerated</a>[i] = InitialMass * input-&gt;<a class="code" href="structTreeWalkQueryMetals.html#ae2f34af218c3ab39c9825bbae4314640">MetalSpeciesGenerated</a>[i] + <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(place).Metals[i] * input-&gt;<a class="code" href="structTreeWalkQueryMetals.html#a69fe57f92a03ddb696eb1c764f1112f7">MassGenerated</a>;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keywordflow">if</span>(input-&gt;<a class="code" href="structTreeWalkQueryMetals.html#ae2f34af218c3ab39c9825bbae4314640">MetalSpeciesGenerated</a>[i] &lt; 0)</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            input-&gt;<a class="code" href="structTreeWalkQueryMetals.html#ae2f34af218c3ab39c9825bbae4314640">MetalSpeciesGenerated</a>[i] = 0;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    }</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;}</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160; </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment">/* Update the mass and enrichment variables for the star.</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment"> * Note that the stellar metallicity is not updated, as the</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment"> * metal-forming stars are now dead and their metals in the gas.*/</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00619"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a64bf0f58fb25b3c2ded7dbeb73088b3c">  619</a></span>&#160;<a class="code" href="metal__return_8c.html#a64bf0f58fb25b3c2ded7dbeb73088b3c">metal_return_postprocess</a>(<span class="keywordtype">int</span> place, <a class="code" href="structTreeWalk.html">TreeWalk</a> * tw)</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;{</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="comment">/* Conserve mass returned*/</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[place].Mass -= <a class="code" href="metal__return_8c.html#aad6b2bf60ee9eae8cc059ba4c50aedce">METALS_GET_PRIV</a>(tw)-&gt;MassReturn[<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[place].PI];</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(place).TotalMassReturned += <a class="code" href="metal__return_8c.html#aad6b2bf60ee9eae8cc059ba4c50aedce">METALS_GET_PRIV</a>(tw)-&gt;MassReturn[<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[place].PI];</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="comment">/* Update the last enrichment time*/</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(place).LastEnrichmentMyr = <a class="code" href="metal__return_8c.html#aad6b2bf60ee9eae8cc059ba4c50aedce">METALS_GET_PRIV</a>(tw)-&gt;StellarAges[<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[place].PI];</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;}</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160; </div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00633"></a><span class="lineno"><a class="line" href="metal__return_8c.html#aed77dd49844be97101b610fcca622033">  633</a></span>&#160;<a class="code" href="metal__return_8c.html#aed77dd49844be97101b610fcca622033">metal_return_ngbiter</a>(</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <a class="code" href="structTreeWalkQueryMetals.html">TreeWalkQueryMetals</a> * I,</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <a class="code" href="structTreeWalkResultMetals.html">TreeWalkResultMetals</a> * O,</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <a class="code" href="structTreeWalkNgbIterMetals.html">TreeWalkNgbIterMetals</a> * iter,</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <a class="code" href="structLocalTreeWalk.html">LocalTreeWalk</a> * lv</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;   )</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;{</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="keywordflow">if</span>(iter-&gt;<a class="code" href="structTreeWalkNgbIterMetals.html#a52b74d18ca74fbb1261f810e54446908">base</a>.<a class="code" href="structTreeWalkNgbIterBase.html#ac75baa8cbd1cd6a47dbf9fb136c901d3">other</a> == -1) {</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        <span class="comment">/* Only return metals to gas*/</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        iter-&gt;<a class="code" href="structTreeWalkNgbIterMetals.html#a52b74d18ca74fbb1261f810e54446908">base</a>.<a class="code" href="structTreeWalkNgbIterBase.html#a887aa48798bdfb5a8cca30be18c9a849">mask</a> = 1;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        iter-&gt;<a class="code" href="structTreeWalkNgbIterMetals.html#a52b74d18ca74fbb1261f810e54446908">base</a>.<a class="code" href="structTreeWalkNgbIterBase.html#a633d0a0d40776a7dcef5c6915bda2c56">Hsml</a> = I-&gt;<a class="code" href="structTreeWalkQueryMetals.html#aa91b40c5bbb212dac30473b5992f5304">Hsml</a>;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        iter-&gt;<a class="code" href="structTreeWalkNgbIterMetals.html#a52b74d18ca74fbb1261f810e54446908">base</a>.<a class="code" href="structTreeWalkNgbIterBase.html#aebe92fe57ee45b4ada2f95717b7cf12b">symmetric</a> = <a class="code" href="treewalk_8h.html#ae8d78c0b33a7736c7e75739976002dbda3b05fa287fdb7661dbb081cd20c00eb5">NGB_TREEFIND_ASYMMETRIC</a>;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <span class="comment">/* Initialise the mass lost by this star in this timestep*/</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        O-&gt;<a class="code" href="structTreeWalkResultMetals.html#a48ce1e01704b4b1f21cf597332a1e1bf">MassReturn</a> = 0;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <a class="code" href="densitykernel_8c.html#ac964db66f17e32a55c5137c884f4b76b">density_kernel_init</a>(&amp;iter-&gt;<a class="code" href="structTreeWalkNgbIterMetals.html#ac06f9ef0841f91d7f368e12f55f1a8e4">kernel</a>, I-&gt;<a class="code" href="structTreeWalkQueryMetals.html#aa91b40c5bbb212dac30473b5992f5304">Hsml</a>, <a class="code" href="density_8c.html#ac40e53af730ce9956d564e3dc18d6f0e">GetDensityKernelType</a>());</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    }</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> other = iter-&gt;<a class="code" href="structTreeWalkNgbIterMetals.html#a52b74d18ca74fbb1261f810e54446908">base</a>.<a class="code" href="structTreeWalkNgbIterBase.html#ac75baa8cbd1cd6a47dbf9fb136c901d3">other</a>;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> r2 = iter-&gt;<a class="code" href="structTreeWalkNgbIterMetals.html#a52b74d18ca74fbb1261f810e54446908">base</a>.<a class="code" href="structTreeWalkNgbIterBase.html#a70a2cc004aede46d1407c89d0cbb4616">r2</a>;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> r = iter-&gt;<a class="code" href="structTreeWalkNgbIterMetals.html#a52b74d18ca74fbb1261f810e54446908">base</a>.<a class="code" href="structTreeWalkNgbIterBase.html#a5b1a01a9a059a9429cf0e5cf92a4f53b">r</a>;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keywordflow">if</span>(r2 &gt; 0 &amp;&amp; r2 &lt; iter-&gt;<a class="code" href="lightcone_8c.html#a53356309f04e9e22e9631e0be5a97b36">kernel</a>.HH)</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    {</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="densitykernel_8c.html#a7c842435db8db5e6fe2c652b849af87f">wk</a> = 1;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> u = r * iter-&gt;<a class="code" href="structTreeWalkNgbIterMetals.html#ac06f9ef0841f91d7f368e12f55f1a8e4">kernel</a>.<a class="code" href="structDensityKernel.html#a96f937c0efd2485f2615419e3f28bab1">Hinv</a>;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160; </div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="metal__return_8c.html#a687f879a7550bbdfdc820d65b606cb36">MetalParams</a>.<a class="code" href="structmetal__return__params.html#a58452735fac8130955037b96e1c5c0ea">SPHWeighting</a>)</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;            <a class="code" href="densitykernel_8c.html#a7c842435db8db5e6fe2c652b849af87f">wk</a> = <a class="code" href="densitykernel_8c.html#afb1d08bb021ac0edae2020eca1a48ea5">density_kernel_wk</a>(&amp;iter-&gt;<a class="code" href="structTreeWalkNgbIterMetals.html#ac06f9ef0841f91d7f368e12f55f1a8e4">kernel</a>, u);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <span class="keywordtype">double</span> ThisMetals[<a class="code" href="slotsmanager_8h.html#ad07d3b873121463218a991d53512e49b">NMETALS</a>];</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="keywordflow">if</span>(I-&gt;<a class="code" href="structTreeWalkQueryMetals.html#a3291b51ca793d21c8e66c15794c3f4cf">StarVolumeSPH</a> ==0)</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;            <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(3, <span class="stringliteral">&quot;StarVolumeSPH %g hsml %g\n&quot;</span>, I-&gt;<a class="code" href="structTreeWalkQueryMetals.html#a3291b51ca793d21c8e66c15794c3f4cf">StarVolumeSPH</a>, I-&gt;<a class="code" href="structTreeWalkQueryMetals.html#aa91b40c5bbb212dac30473b5992f5304">Hsml</a>);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="keywordtype">double</span> newmass;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <span class="keywordtype">int</span> pi = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[other].PI;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <a class="code" href="spinlocks_8c.html#acce4c0c71b73531bf08e609e2b945015">lock_spinlock</a>(pi, <a class="code" href="metal__return_8c.html#aad6b2bf60ee9eae8cc059ba4c50aedce">METALS_GET_PRIV</a>(lv-&gt;<a class="code" href="structLocalTreeWalk.html#ae7a5a56205348bfd1bcd544e13c4b702">tw</a>)-&gt;spin);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        <span class="comment">/* Volume of particle weighted by the SPH kernel*/</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <span class="keywordtype">double</span> volume = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[other].Mass / <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(other).Density;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <span class="keywordtype">double</span> returnfraction = <a class="code" href="densitykernel_8c.html#a7c842435db8db5e6fe2c652b849af87f">wk</a> * volume / I-&gt;<a class="code" href="structTreeWalkQueryMetals.html#a3291b51ca793d21c8e66c15794c3f4cf">StarVolumeSPH</a>;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="slotsmanager_8h.html#ad07d3b873121463218a991d53512e49b">NMETALS</a>; i++)</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            ThisMetals[i] = returnfraction * I-&gt;<a class="code" href="structTreeWalkQueryMetals.html#ae2f34af218c3ab39c9825bbae4314640">MetalSpeciesGenerated</a>[i];</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        <span class="comment">/* Keep track of how much was returned for conservation purposes*/</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        <span class="keywordtype">double</span> thismass = returnfraction * I-&gt;<a class="code" href="structTreeWalkQueryMetals.html#a69fe57f92a03ddb696eb1c764f1112f7">MassGenerated</a>;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        O-&gt;<a class="code" href="structTreeWalkResultMetals.html#a48ce1e01704b4b1f21cf597332a1e1bf">MassReturn</a> += thismass;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        <span class="comment">/* Add metals weighted by SPH kernel*/</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        <span class="keywordtype">double</span> thismetal = returnfraction * I-&gt;<a class="code" href="structTreeWalkQueryMetals.html#ac1c17d61b3d06092002ee77b60e8083e">MetalGenerated</a>;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <span class="comment">/* Add the metals to the particle.*/</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="slotsmanager_8h.html#ad07d3b873121463218a991d53512e49b">NMETALS</a>; i++)</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(other).Metals[i] = (<a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(other).Metals[i] * <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[other].Mass + ThisMetals[i])/(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[other].Mass + thismass);</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <span class="comment">/* Update total metallicity*/</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(other).Metallicity = (<a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(other).Metallicity * <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[other].Mass + thismetal)/(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[other].Mass + thismass);</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        <span class="comment">/* Update mass*/</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="keywordtype">double</span> massfrac = (<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[other].Mass + thismass) / <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[other].Mass;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        <span class="comment">/* Ensure that the gas particles don&#39;t become overweight.</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment">         * If there are few gas particles around, the star clusters</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment">         * will hold onto their metals.*/</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[other].Mass + thismass &lt; <a class="code" href="metal__return_8c.html#aad6b2bf60ee9eae8cc059ba4c50aedce">METALS_GET_PRIV</a>(lv-&gt;<a class="code" href="structLocalTreeWalk.html#ae7a5a56205348bfd1bcd544e13c4b702">tw</a>)-&gt;MaxGasMass) {</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[other].Mass *= massfrac;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            <span class="comment">/* Density also needs a correction so the volume fraction is unchanged.</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="comment">             * This ensures that volume = Mass/Density is unchanged for the next particle</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="comment">             * and thus the weighting still sums to unity.*/</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(other).Density *= massfrac;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        }</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        newmass = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[other].Mass;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <a class="code" href="spinlocks_8c.html#aee13921a58d5a09edac1b36ff8c0f1d9">unlock_spinlock</a>(pi, <a class="code" href="metal__return_8c.html#aad6b2bf60ee9eae8cc059ba4c50aedce">METALS_GET_PRIV</a>(lv-&gt;<a class="code" href="structLocalTreeWalk.html#ae7a5a56205348bfd1bcd544e13c4b702">tw</a>)-&gt;spin);</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        <span class="keywordflow">if</span>(newmass &lt;= 0)</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(3, <span class="stringliteral">&quot;New mass %g new metal %g in particle %d id %ld from star mass %g metallicity %g\n&quot;</span>,</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                   newmass, <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(other).Metallicity, other, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[other].ID, I-&gt;<a class="code" href="structTreeWalkQueryMetals.html#aee2bc2e2c1f19d81d0111b351934de22">Mass</a>, I-&gt;<a class="code" href="structTreeWalkQueryMetals.html#a699dbc8bcfebe93b75880a81975efcf9">Metallicity</a>);</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    }</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;}</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160; </div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="comment">/* Find stars returning enough metals to the gas.</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="comment"> * This is a wrapper function to allow for</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment"> * different private structs in different treewalks*/</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l00708"></a><span class="lineno"><a class="line" href="metal__return_8c.html#ab5c3a1fb77d5aef2936539c084bb0273">  708</a></span>&#160;<a class="code" href="metal__return_8c.html#ab5c3a1fb77d5aef2936539c084bb0273">metals_haswork</a>(<span class="keywordtype">int</span> i, <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> * <a class="code" href="structMetalReturnPriv.html#af3232cc5f66e274ab87edc401e1cac20">MassReturn</a>)</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;{</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Type != 4)</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="keywordtype">int</span> pi = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].PI;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="comment">/* Don&#39;t do enrichment from all stars, just those with significant enrichment*/</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="structMetalReturnPriv.html#af3232cc5f66e274ab87edc401e1cac20">MassReturn</a>[pi] &lt; 1e-3 * (<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Mass + <a class="code" href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a>(i).TotalMassReturned))</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;}</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160; </div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line"><a name="l00720"></a><span class="lineno"><a class="line" href="metal__return_8c.html#aae2dc62d04b08fb98b6b5e0549d595f9">  720</a></span>&#160;<a class="code" href="metal__return_8c.html#aae2dc62d04b08fb98b6b5e0549d595f9">metal_return_haswork</a>(<span class="keywordtype">int</span> i, <a class="code" href="structTreeWalk.html">TreeWalk</a> * tw)</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;{</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="metal__return_8c.html#ab5c3a1fb77d5aef2936539c084bb0273">metals_haswork</a>(i, <a class="code" href="metal__return_8c.html#aad6b2bf60ee9eae8cc059ba4c50aedce">METALS_GET_PRIV</a>(tw)-&gt;<a class="code" href="structMetalReturnPriv.html#af3232cc5f66e274ab87edc401e1cac20">MassReturn</a>);</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;}</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160; </div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="comment">/* Number of densities to evaluate simultaneously*/</span></div>
<div class="line"><a name="l00726"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a3f020f76e26ad070cd0d2d9dca12c47f">  726</a></span>&#160;<span class="preprocessor">#define NHSML 10</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160; </div>
<div class="line"><a name="l00728"></a><span class="lineno"><a class="line" href="structTreeWalkNgbIterStellarDensity.html">  728</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line"><a name="l00729"></a><span class="lineno"><a class="line" href="structTreeWalkNgbIterStellarDensity.html#a8639b6bc60a4239db085aa98521f77eb">  729</a></span>&#160;    <a class="code" href="structTreeWalkNgbIterBase.html">TreeWalkNgbIterBase</a> <a class="code" href="structTreeWalkNgbIterStellarDensity.html#a8639b6bc60a4239db085aa98521f77eb">base</a>;</div>
<div class="line"><a name="l00730"></a><span class="lineno"><a class="line" href="structTreeWalkNgbIterStellarDensity.html#a5d8e37bccf7760b674a7549d926ba8ed">  730</a></span>&#160;    <a class="code" href="structDensityKernel.html">DensityKernel</a> <a class="code" href="lightcone_8c.html#a53356309f04e9e22e9631e0be5a97b36">kernel</a>[<a class="code" href="metal__return_8c.html#a3f020f76e26ad070cd0d2d9dca12c47f">NHSML</a>];</div>
<div class="line"><a name="l00731"></a><span class="lineno"><a class="line" href="structTreeWalkNgbIterStellarDensity.html#a9b8101ee80abef3f6a2290cd0878e602">  731</a></span>&#160;    <span class="keywordtype">double</span> kernel_volume[<a class="code" href="metal__return_8c.html#a3f020f76e26ad070cd0d2d9dca12c47f">NHSML</a>];</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;} <a class="code" href="structTreeWalkNgbIterStellarDensity.html">TreeWalkNgbIterStellarDensity</a>;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno"><a class="line" href="structTreeWalkQueryStellarDensity.html">  734</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;{</div>
<div class="line"><a name="l00736"></a><span class="lineno"><a class="line" href="structTreeWalkQueryStellarDensity.html#ac2b1f816345b648baff6d826c9f0ce5d">  736</a></span>&#160;    <a class="code" href="structTreeWalkQueryBase.html">TreeWalkQueryBase</a> <a class="code" href="structTreeWalkQueryStellarDensity.html#ac2b1f816345b648baff6d826c9f0ce5d">base</a>;</div>
<div class="line"><a name="l00737"></a><span class="lineno"><a class="line" href="structTreeWalkQueryStellarDensity.html#aa05abbe9f3ef6128ba71a3612226850a">  737</a></span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> Hsml[<a class="code" href="metal__return_8c.html#a3f020f76e26ad070cd0d2d9dca12c47f">NHSML</a>];</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;} <a class="code" href="structTreeWalkQueryStellarDensity.html">TreeWalkQueryStellarDensity</a>;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160; </div>
<div class="line"><a name="l00740"></a><span class="lineno"><a class="line" href="structTreeWalkResultStellarDensity.html">  740</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line"><a name="l00741"></a><span class="lineno"><a class="line" href="structTreeWalkResultStellarDensity.html#a8761c51be809fbb114048cfbd935f375">  741</a></span>&#160;    <a class="code" href="structTreeWalkResultBase.html">TreeWalkResultBase</a> <a class="code" href="structTreeWalkResultStellarDensity.html#a8761c51be809fbb114048cfbd935f375">base</a>;</div>
<div class="line"><a name="l00742"></a><span class="lineno"><a class="line" href="structTreeWalkResultStellarDensity.html#a384fd7ffbb15a481f1294f12be6e8c85">  742</a></span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> VolumeSPH[<a class="code" href="metal__return_8c.html#a3f020f76e26ad070cd0d2d9dca12c47f">NHSML</a>];</div>
<div class="line"><a name="l00743"></a><span class="lineno"><a class="line" href="structTreeWalkResultStellarDensity.html#ae6f6d6a3fda395d7b40687862fc66e9b">  743</a></span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> Ngb[<a class="code" href="metal__return_8c.html#a3f020f76e26ad070cd0d2d9dca12c47f">NHSML</a>];</div>
<div class="line"><a name="l00744"></a><span class="lineno"><a class="line" href="structTreeWalkResultStellarDensity.html#a5ba246c9312537814342cdb54dc40d9a">  744</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structTreeWalkResultStellarDensity.html#a5ba246c9312537814342cdb54dc40d9a">maxcmpte</a>;</div>
<div class="line"><a name="l00745"></a><span class="lineno"><a class="line" href="structTreeWalkResultStellarDensity.html#a6e72dacdb8df9b9a4bc19339df51509f">  745</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structTreeWalkResultStellarDensity.html#a6e72dacdb8df9b9a4bc19339df51509f">_alignment</a>;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;} <a class="code" href="structTreeWalkResultStellarDensity.html">TreeWalkResultStellarDensity</a>;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160; </div>
<div class="line"><a name="l00748"></a><span class="lineno"><a class="line" href="structStellarDensityPriv.html">  748</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structStellarDensityPriv.html">StellarDensityPriv</a> {</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="comment">/* Current number of neighbours*/</span></div>
<div class="line"><a name="l00750"></a><span class="lineno"><a class="line" href="structStellarDensityPriv.html#a683e5fa60875e852b78652cff9b5a013">  750</a></span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> (*<a class="code" href="structStellarDensityPriv.html#a683e5fa60875e852b78652cff9b5a013">NumNgb</a>)[<a class="code" href="metal__return_8c.html#a3f020f76e26ad070cd0d2d9dca12c47f">NHSML</a>];</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="comment">/* Lower and upper bounds on smoothing length*/</span></div>
<div class="line"><a name="l00752"></a><span class="lineno"><a class="line" href="structStellarDensityPriv.html#a1d7c9fe3b3ba37daed5404bb3029f0c1">  752</a></span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> *<a class="code" href="structStellarDensityPriv.html#a1d7c9fe3b3ba37daed5404bb3029f0c1">Left</a>, *<a class="code" href="structStellarDensityPriv.html#aed02a564276bbf7e8a623e3c71e6e04d">Right</a>;</div>
<div class="line"><a name="l00753"></a><span class="lineno"><a class="line" href="structStellarDensityPriv.html#ab804b3e8b691d869c09d30266cdd304d">  753</a></span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> (*<a class="code" href="structStellarDensityPriv.html#ab804b3e8b691d869c09d30266cdd304d">VolumeSPH</a>)[<a class="code" href="metal__return_8c.html#a3f020f76e26ad070cd0d2d9dca12c47f">NHSML</a>];</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="comment">/* For haswork*/</span></div>
<div class="line"><a name="l00755"></a><span class="lineno"><a class="line" href="structStellarDensityPriv.html#a8404dbc104ce789a069dd7b4e7316e59">  755</a></span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> *<a class="code" href="structStellarDensityPriv.html#a8404dbc104ce789a069dd7b4e7316e59">MassReturn</a>;</div>
<div class="line"><a name="l00757"></a><span class="lineno"><a class="line" href="structStellarDensityPriv.html#af197f57f37b4b2f938ffe3d09397105d">  757</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structStellarDensityPriv.html#af197f57f37b4b2f938ffe3d09397105d">DesNumNgb</a>;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="comment">/* Maximum index where NumNgb is valid. */</span></div>
<div class="line"><a name="l00759"></a><span class="lineno"><a class="line" href="structStellarDensityPriv.html#a498cdb1e038916f4d6df3bf51a1b26ea">  759</a></span>&#160;    <span class="keywordtype">int</span> * <a class="code" href="structStellarDensityPriv.html#a498cdb1e038916f4d6df3bf51a1b26ea">maxcmpte</a>;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;};</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160; </div>
<div class="line"><a name="l00762"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a29c034b7ca0de0b5fc12d1589605958e">  762</a></span>&#160;<span class="preprocessor">#define STELLAR_DENSITY_GET_PRIV(tw) ((struct StellarDensityPriv*) ((tw)-&gt;priv))</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160; </div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line"><a name="l00765"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a5142fdac0ab32dc3c63608bf785c7bcf">  765</a></span>&#160;<a class="code" href="metal__return_8c.html#a5142fdac0ab32dc3c63608bf785c7bcf">stellar_density_haswork</a>(<span class="keywordtype">int</span> i, <a class="code" href="structTreeWalk.html">TreeWalk</a> * tw)</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;{</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="metal__return_8c.html#ab5c3a1fb77d5aef2936539c084bb0273">metals_haswork</a>(i, <a class="code" href="metal__return_8c.html#a29c034b7ca0de0b5fc12d1589605958e">STELLAR_DENSITY_GET_PRIV</a>(tw)-&gt;MassReturn);</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;}</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160; </div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="comment">/* Get Hsml for one of the evaluations*/</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">double</span></div>
<div class="line"><a name="l00772"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a5b15dfb509db8f3e1973f5c10cf0873e">  772</a></span>&#160;<a class="code" href="metal__return_8c.html#a5b15dfb509db8f3e1973f5c10cf0873e">effhsml</a>(<span class="keywordtype">int</span> place, <span class="keywordtype">int</span> i, <a class="code" href="structTreeWalk.html">TreeWalk</a> * tw)</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;{</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="keywordtype">int</span> pi = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[place].PI;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="keywordtype">double</span> left = <a class="code" href="metal__return_8c.html#a29c034b7ca0de0b5fc12d1589605958e">STELLAR_DENSITY_GET_PRIV</a>(tw)-&gt;Left[pi];</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="keywordtype">double</span> right = <a class="code" href="metal__return_8c.html#a29c034b7ca0de0b5fc12d1589605958e">STELLAR_DENSITY_GET_PRIV</a>(tw)-&gt;Right[pi];</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="comment">/* If somehow Hsml has become zero through underflow, use something non-zero</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="comment">     * to make sure we converge. */</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordflow">if</span>(left == 0 &amp;&amp; right &gt; 0.99*tw-&gt;<a class="code" href="structTreeWalk.html#a8525705e365e7c07027f372b66aff149">tree</a>-&gt;<a class="code" href="structForceTree.html#a8915a4ff849c9e97448ae30089a05966">BoxSize</a> &amp;&amp; <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[place].Hsml == 0) {</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        <span class="keywordtype">int</span> fat = <a class="code" href="forcetree_8c.html#ab8a2310bd448851f4aa42ae6bcec2e01">force_get_father</a>(place, tw-&gt;<a class="code" href="structTreeWalk.html#a8525705e365e7c07027f372b66aff149">tree</a>);</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[place].Hsml = tw-&gt;<a class="code" href="structTreeWalk.html#a8525705e365e7c07027f372b66aff149">tree</a>-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[fat].<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a>;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[place].Hsml == 0)</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[place].Hsml = tw-&gt;<a class="code" href="structTreeWalk.html#a8525705e365e7c07027f372b66aff149">tree</a>-&gt;<a class="code" href="structForceTree.html#a8915a4ff849c9e97448ae30089a05966">BoxSize</a> / pow(<a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a>, 1./3)/4.;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    }</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="comment">/* Use slightly past the current Hsml as the right most boundary*/</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="keywordflow">if</span>(right &gt; 0.99*tw-&gt;<a class="code" href="structTreeWalk.html#a8525705e365e7c07027f372b66aff149">tree</a>-&gt;<a class="code" href="structForceTree.html#a8915a4ff849c9e97448ae30089a05966">BoxSize</a>)</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        right = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[place].Hsml * ((1.+<a class="code" href="metal__return_8c.html#a3f020f76e26ad070cd0d2d9dca12c47f">NHSML</a>)/<a class="code" href="metal__return_8c.html#a3f020f76e26ad070cd0d2d9dca12c47f">NHSML</a>);</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="comment">/* Use 1/2 of current Hsml for left. The asymmetry is because it is free</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="comment">     * to compute extra densities for h &lt; Hsml, but not for h &gt; Hsml.*/</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keywordflow">if</span>(left == 0)</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        left = 0.1 * <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[place].Hsml;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="comment">/* From left + 1/N  to right - 1/N, evenly spaced in volume,</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment">     * since NumNgb ~ h^3.*/</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keywordtype">double</span> rvol = pow(right, 3);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keywordtype">double</span> lvol = pow(left, 3);</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <span class="keywordflow">return</span> pow((1.*i+1)/(1.*<a class="code" href="metal__return_8c.html#a3f020f76e26ad070cd0d2d9dca12c47f">NHSML</a>+1) * (rvol - lvol) + lvol, 1./3);</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;}</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160; </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00800"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a9af02ff3c8c0ce8dade6b5710fcc9dee">  800</a></span>&#160;<a class="code" href="metal__return_8c.html#a9af02ff3c8c0ce8dade6b5710fcc9dee">stellar_density_copy</a>(<span class="keywordtype">int</span> place, <a class="code" href="structTreeWalkQueryStellarDensity.html">TreeWalkQueryStellarDensity</a> * I, <a class="code" href="structTreeWalk.html">TreeWalk</a> * tw)</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;{</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="metal__return_8c.html#a3f020f76e26ad070cd0d2d9dca12c47f">NHSML</a>; i++)</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        I-&gt;<a class="code" href="structTreeWalkQueryStellarDensity.html#aa05abbe9f3ef6128ba71a3612226850a">Hsml</a>[i] = <a class="code" href="metal__return_8c.html#a5b15dfb509db8f3e1973f5c10cf0873e">effhsml</a>(place, i, tw);</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;}</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160; </div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00808"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a1a46a94f15fef845c32f0bfe21e66ce3">  808</a></span>&#160;<a class="code" href="metal__return_8c.html#a1a46a94f15fef845c32f0bfe21e66ce3">stellar_density_reduce</a>(<span class="keywordtype">int</span> place, <a class="code" href="structTreeWalkResultStellarDensity.html">TreeWalkResultStellarDensity</a> * remote, <span class="keyword">enum</span> <a class="code" href="treewalk_8h.html#a504d8280eaa376504899398c68577cef">TreeWalkReduceMode</a> mode, <a class="code" href="structTreeWalk.html">TreeWalk</a> * tw)</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;{</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <span class="keywordtype">int</span> pi = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[place].PI;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordflow">if</span>(mode == 0 || <a class="code" href="metal__return_8c.html#a29c034b7ca0de0b5fc12d1589605958e">STELLAR_DENSITY_GET_PRIV</a>(tw)-&gt;maxcmpte[pi] &gt; remote-&gt;<a class="code" href="structTreeWalkResultStellarDensity.html#a5ba246c9312537814342cdb54dc40d9a">maxcmpte</a>)</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <a class="code" href="metal__return_8c.html#a29c034b7ca0de0b5fc12d1589605958e">STELLAR_DENSITY_GET_PRIV</a>(tw)-&gt;maxcmpte[pi] = remote-&gt;<a class="code" href="structTreeWalkResultStellarDensity.html#a5ba246c9312537814342cdb54dc40d9a">maxcmpte</a>;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; remote-&gt;<a class="code" href="structTreeWalkResultStellarDensity.html#a5ba246c9312537814342cdb54dc40d9a">maxcmpte</a>; i++) {</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <a class="code" href="treewalk_8h.html#adec418ab95919d7f9c11dbea86c32a0f">TREEWALK_REDUCE</a>(<a class="code" href="metal__return_8c.html#a29c034b7ca0de0b5fc12d1589605958e">STELLAR_DENSITY_GET_PRIV</a>(tw)-&gt;NumNgb[pi][i], remote-&gt;<a class="code" href="structTreeWalkResultStellarDensity.html#ae6f6d6a3fda395d7b40687862fc66e9b">Ngb</a>[i]);</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        <a class="code" href="treewalk_8h.html#adec418ab95919d7f9c11dbea86c32a0f">TREEWALK_REDUCE</a>(<a class="code" href="metal__return_8c.html#a29c034b7ca0de0b5fc12d1589605958e">STELLAR_DENSITY_GET_PRIV</a>(tw)-&gt;VolumeSPH[pi][i], remote-&gt;<a class="code" href="structTreeWalkResultStellarDensity.html#a384fd7ffbb15a481f1294f12be6e8c85">VolumeSPH</a>[i]);</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    }</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;}</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160; </div>
<div class="line"><a name="l00820"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a17b72849def018c74b52c243280021be">  820</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="metal__return_8c.html#a17b72849def018c74b52c243280021be">stellar_density_check_neighbours</a> (<span class="keywordtype">int</span> i, <a class="code" href="structTreeWalk.html">TreeWalk</a> * tw)</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;{</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> * Left = <a class="code" href="metal__return_8c.html#a29c034b7ca0de0b5fc12d1589605958e">STELLAR_DENSITY_GET_PRIV</a>(tw)-&gt;Left;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> * Right = <a class="code" href="metal__return_8c.html#a29c034b7ca0de0b5fc12d1589605958e">STELLAR_DENSITY_GET_PRIV</a>(tw)-&gt;Right;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160; </div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="keywordtype">int</span> pi = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].PI;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="keywordtype">int</span> tid = omp_get_thread_num();</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="keywordtype">double</span> desnumngb = <a class="code" href="metal__return_8c.html#a29c034b7ca0de0b5fc12d1589605958e">STELLAR_DENSITY_GET_PRIV</a>(tw)-&gt;DesNumNgb;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160; </div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> maxcmpt = <a class="code" href="metal__return_8c.html#a29c034b7ca0de0b5fc12d1589605958e">STELLAR_DENSITY_GET_PRIV</a>(tw)-&gt;maxcmpte[pi];</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="keywordtype">int</span> j;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="keywordtype">double</span> evalhsml[<a class="code" href="metal__return_8c.html#a3f020f76e26ad070cd0d2d9dca12c47f">NHSML</a>];</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordflow">for</span>(j = 0; j &lt; maxcmpt; j++)</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        evalhsml[j] = <a class="code" href="metal__return_8c.html#a5b15dfb509db8f3e1973f5c10cf0873e">effhsml</a>(i, j, tw);</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160; </div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="keywordtype">int</span> close = 0;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Hsml = <a class="code" href="treewalk_8c.html#a510761e6aead0135964f0f9b18a4f8e7">ngb_narrow_down</a>(&amp;Right[pi],&amp;Left[pi],evalhsml,<a class="code" href="metal__return_8c.html#a29c034b7ca0de0b5fc12d1589605958e">STELLAR_DENSITY_GET_PRIV</a>(tw)-&gt;NumNgb[pi],maxcmpt,desnumngb,&amp;close,tw-&gt;<a class="code" href="structTreeWalk.html#a8525705e365e7c07027f372b66aff149">tree</a>-&gt;<a class="code" href="structForceTree.html#a8915a4ff849c9e97448ae30089a05966">BoxSize</a>);</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <span class="keywordtype">double</span> numngb = <a class="code" href="metal__return_8c.html#a29c034b7ca0de0b5fc12d1589605958e">STELLAR_DENSITY_GET_PRIV</a>(tw)-&gt;NumNgb[pi][close];</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160; </div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="comment">/* Save VolumeSPH*/</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <a class="code" href="metal__return_8c.html#a29c034b7ca0de0b5fc12d1589605958e">STELLAR_DENSITY_GET_PRIV</a>(tw)-&gt;VolumeSPH[pi][0] = <a class="code" href="metal__return_8c.html#a29c034b7ca0de0b5fc12d1589605958e">STELLAR_DENSITY_GET_PRIV</a>(tw)-&gt;VolumeSPH[pi][close];</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160; </div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="comment">/* now check whether we had enough neighbours */</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="keywordflow">if</span>(numngb &lt; (desnumngb - <a class="code" href="metal__return_8c.html#a687f879a7550bbdfdc820d65b606cb36">MetalParams</a>.<a class="code" href="structmetal__return__params.html#a98d41f7181e04a04139a160eaf7a0236">MaxNgbDeviation</a>) ||</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;            (numngb &gt; (desnumngb + <a class="code" href="metal__return_8c.html#a687f879a7550bbdfdc820d65b606cb36">MetalParams</a>.<a class="code" href="structmetal__return__params.html#a98d41f7181e04a04139a160eaf7a0236">MaxNgbDeviation</a>)))</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    {</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        <span class="comment">/* This condition is here to prevent the density code looping forever if it encounters</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="comment">         * multiple particles at the same position. If this happens you likely have worse</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="comment">         * problems anyway, so warn also. */</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        <span class="keywordflow">if</span>((Right[pi] - Left[pi]) &lt; 1.0e-4 * Left[pi])</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        {</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;            <span class="comment">/* If this happens probably the exchange is screwed up and all your particles have moved to (0,0,0)*/</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;            <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(1, <span class="stringliteral">&quot;Very tight Hsml bounds for i=%d ID=%lu type %d Hsml=%g Left=%g Right=%g Ngbs=%g des = %g Right-Left=%g pos=(%g|%g|%g)\n&quot;</span>,</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;             i, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].ID, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Type, <a class="code" href="metal__return_8c.html#a5b15dfb509db8f3e1973f5c10cf0873e">effhsml</a>, Left[pi], Right[pi], numngb, desnumngb, Right[pi] - Left[pi], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Pos[0], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Pos[1], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Pos[2]);</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        }</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        <span class="comment">/* More work needed: add this particle to the redo queue*/</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        tw-&gt;<a class="code" href="structTreeWalk.html#a73d26f9b05f007c46bddb25f39f6bbf5">NPRedo</a>[tid][tw-&gt;<a class="code" href="structTreeWalk.html#ad9b63d13efa217c89748031b224f2346">NPLeft</a>[tid]] = i;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        tw-&gt;<a class="code" href="structTreeWalk.html#ad9b63d13efa217c89748031b224f2346">NPLeft</a>[tid] ++;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        <span class="keywordflow">if</span>(tw-&gt;<a class="code" href="structTreeWalk.html#a1d722afccb3091cb1697eaa973936f27">Niteration</a> &gt;= 10)</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;            <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(1, <span class="stringliteral">&quot;i=%d ID=%lu Hsml=%g lastdhsml=%g Left=%g Right=%g Ngbs=%g Right-Left=%g pos=(%g|%g|%g) fac = %g\n&quot;</span>,</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;             i, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].ID, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Hsml, evalhsml[close], Left[pi], Right[pi], numngb, Right[pi] - Left[pi], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Pos[0], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Pos[1], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Pos[2]);</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160; </div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    }</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keywordflow">if</span>(tw-&gt;<a class="code" href="structTreeWalk.html#a6fa5eb5767f35c98b86b396ae112482a">maxnumngb</a>[tid] &lt; numngb)</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        tw-&gt;<a class="code" href="structTreeWalk.html#a6fa5eb5767f35c98b86b396ae112482a">maxnumngb</a>[tid] = numngb;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    <span class="keywordflow">if</span>(tw-&gt;<a class="code" href="structTreeWalk.html#a1e7b97376d0c5242e5195e7173ab8ed8">minnumngb</a>[tid] &gt; numngb)</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        tw-&gt;<a class="code" href="structTreeWalk.html#a1e7b97376d0c5242e5195e7173ab8ed8">minnumngb</a>[tid] = numngb;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160; </div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;}</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160; </div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00872"></a><span class="lineno"><a class="line" href="metal__return_8c.html#a65644be78b16f3de65301143dd8d18be">  872</a></span>&#160;<a class="code" href="metal__return_8c.html#a65644be78b16f3de65301143dd8d18be">stellar_density_ngbiter</a>(</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        <a class="code" href="structTreeWalkQueryStellarDensity.html">TreeWalkQueryStellarDensity</a> * I,</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        <a class="code" href="structTreeWalkResultStellarDensity.html">TreeWalkResultStellarDensity</a> * O,</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        <a class="code" href="structTreeWalkNgbIterStellarDensity.html">TreeWalkNgbIterStellarDensity</a> * iter,</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        <a class="code" href="structLocalTreeWalk.html">LocalTreeWalk</a> * lv)</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;{</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="keywordflow">if</span>(iter-&gt;<a class="code" href="structTreeWalkNgbIterStellarDensity.html#a8639b6bc60a4239db085aa98521f77eb">base</a>.<a class="code" href="structTreeWalkNgbIterBase.html#ac75baa8cbd1cd6a47dbf9fb136c901d3">other</a> == -1) {</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="metal__return_8c.html#a3f020f76e26ad070cd0d2d9dca12c47f">NHSML</a>; i++) {</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;            <a class="code" href="densitykernel_8c.html#ac964db66f17e32a55c5137c884f4b76b">density_kernel_init</a>(&amp;iter-&gt;<a class="code" href="structTreeWalkNgbIterStellarDensity.html#a5d8e37bccf7760b674a7549d926ba8ed">kernel</a>[i], I-&gt;<a class="code" href="structTreeWalkQueryStellarDensity.html#aa05abbe9f3ef6128ba71a3612226850a">Hsml</a>[i], <a class="code" href="density_8c.html#ac40e53af730ce9956d564e3dc18d6f0e">GetDensityKernelType</a>());</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;            iter-&gt;<a class="code" href="structTreeWalkNgbIterStellarDensity.html#a9b8101ee80abef3f6a2290cd0878e602">kernel_volume</a>[i] = <a class="code" href="densitykernel_8c.html#ac4e5abd2c5d6459b39437185da18ee48">density_kernel_volume</a>(&amp;iter-&gt;<a class="code" href="structTreeWalkNgbIterStellarDensity.html#a5d8e37bccf7760b674a7549d926ba8ed">kernel</a>[i]);</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        }</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        iter-&gt;<a class="code" href="structTreeWalkNgbIterStellarDensity.html#a8639b6bc60a4239db085aa98521f77eb">base</a>.<a class="code" href="structTreeWalkNgbIterBase.html#a633d0a0d40776a7dcef5c6915bda2c56">Hsml</a> = I-&gt;<a class="code" href="structTreeWalkQueryStellarDensity.html#aa05abbe9f3ef6128ba71a3612226850a">Hsml</a>[<a class="code" href="metal__return_8c.html#a3f020f76e26ad070cd0d2d9dca12c47f">NHSML</a>-1];</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        iter-&gt;<a class="code" href="structTreeWalkNgbIterStellarDensity.html#a8639b6bc60a4239db085aa98521f77eb">base</a>.<a class="code" href="structTreeWalkNgbIterBase.html#a887aa48798bdfb5a8cca30be18c9a849">mask</a> = 1; <span class="comment">/* gas only */</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        iter-&gt;<a class="code" href="structTreeWalkNgbIterStellarDensity.html#a8639b6bc60a4239db085aa98521f77eb">base</a>.<a class="code" href="structTreeWalkNgbIterBase.html#aebe92fe57ee45b4ada2f95717b7cf12b">symmetric</a> = <a class="code" href="treewalk_8h.html#ae8d78c0b33a7736c7e75739976002dbda3b05fa287fdb7661dbb081cd20c00eb5">NGB_TREEFIND_ASYMMETRIC</a>;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        O-&gt;<a class="code" href="structTreeWalkResultStellarDensity.html#a5ba246c9312537814342cdb54dc40d9a">maxcmpte</a> = <a class="code" href="metal__return_8c.html#a3f020f76e26ad070cd0d2d9dca12c47f">NHSML</a>;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    }</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> other = iter-&gt;<a class="code" href="structTreeWalkNgbIterStellarDensity.html#a8639b6bc60a4239db085aa98521f77eb">base</a>.<a class="code" href="structTreeWalkNgbIterBase.html#ac75baa8cbd1cd6a47dbf9fb136c901d3">other</a>;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> r = iter-&gt;<a class="code" href="structTreeWalkNgbIterStellarDensity.html#a8639b6bc60a4239db085aa98521f77eb">base</a>.<a class="code" href="structTreeWalkNgbIterBase.html#a5b1a01a9a059a9429cf0e5cf92a4f53b">r</a>;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> r2 = iter-&gt;<a class="code" href="structTreeWalkNgbIterStellarDensity.html#a8639b6bc60a4239db085aa98521f77eb">base</a>.<a class="code" href="structTreeWalkNgbIterBase.html#a70a2cc004aede46d1407c89d0cbb4616">r2</a>;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160; </div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; O-&gt;<a class="code" href="structTreeWalkResultStellarDensity.html#a5ba246c9312537814342cdb54dc40d9a">maxcmpte</a>; i++) {</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        <span class="keywordflow">if</span>(r2 &lt; iter-&gt;<a class="code" href="lightcone_8c.html#a53356309f04e9e22e9631e0be5a97b36">kernel</a>[i].HH)</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        {</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> u = r * iter-&gt;<a class="code" href="structTreeWalkNgbIterStellarDensity.html#a5d8e37bccf7760b674a7549d926ba8ed">kernel</a>[i].<a class="code" href="structDensityKernel.html#a96f937c0efd2485f2615419e3f28bab1">Hinv</a>;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;            <span class="keywordtype">double</span> <a class="code" href="densitykernel_8c.html#a7c842435db8db5e6fe2c652b849af87f">wk</a> = <a class="code" href="densitykernel_8c.html#afb1d08bb021ac0edae2020eca1a48ea5">density_kernel_wk</a>(&amp;iter-&gt;<a class="code" href="structTreeWalkNgbIterStellarDensity.html#a5d8e37bccf7760b674a7549d926ba8ed">kernel</a>[i], u);</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            O-&gt;<a class="code" href="structTreeWalkResultStellarDensity.html#ae6f6d6a3fda395d7b40687862fc66e9b">Ngb</a>[i] += <a class="code" href="densitykernel_8c.html#a7c842435db8db5e6fe2c652b849af87f">wk</a> * iter-&gt;<a class="code" href="structTreeWalkNgbIterStellarDensity.html#a9b8101ee80abef3f6a2290cd0878e602">kernel_volume</a>[i];</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;            <span class="comment">/* For stars we need the total weighting, sum(w_k m_k / rho_k).*/</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;            <span class="keywordtype">double</span> thisvol = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[other].Mass / <a class="code" href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a>(other).Density;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="metal__return_8c.html#a687f879a7550bbdfdc820d65b606cb36">MetalParams</a>.<a class="code" href="structmetal__return__params.html#a58452735fac8130955037b96e1c5c0ea">SPHWeighting</a>)</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                thisvol *= <a class="code" href="densitykernel_8c.html#a7c842435db8db5e6fe2c652b849af87f">wk</a>;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;            O-&gt;<a class="code" href="structTreeWalkResultStellarDensity.html#a384fd7ffbb15a481f1294f12be6e8c85">VolumeSPH</a>[i] += thisvol;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        }</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    }</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    <span class="keywordtype">double</span> desnumngb = <a class="code" href="metal__return_8c.html#a29c034b7ca0de0b5fc12d1589605958e">STELLAR_DENSITY_GET_PRIV</a>(lv-&gt;<a class="code" href="structLocalTreeWalk.html#ae7a5a56205348bfd1bcd544e13c4b702">tw</a>)-&gt;DesNumNgb;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="comment">/* If there is an entry which is above desired DesNumNgb,</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="comment">     * we don&#39;t need to search past it. After this point</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="comment">     * all entries in the Ngb table above O-&gt;Ngb are invalid.*/</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="metal__return_8c.html#a3f020f76e26ad070cd0d2d9dca12c47f">NHSML</a>; i++) {</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        <span class="keywordflow">if</span>(O-&gt;<a class="code" href="structTreeWalkResultStellarDensity.html#ae6f6d6a3fda395d7b40687862fc66e9b">Ngb</a>[i] &gt; desnumngb) {</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;            O-&gt;<a class="code" href="structTreeWalkResultStellarDensity.html#a5ba246c9312537814342cdb54dc40d9a">maxcmpte</a> = i+1;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            iter-&gt;<a class="code" href="structTreeWalkNgbIterStellarDensity.html#a8639b6bc60a4239db085aa98521f77eb">base</a>.<a class="code" href="structTreeWalkNgbIterBase.html#a633d0a0d40776a7dcef5c6915bda2c56">Hsml</a> = I-&gt;<a class="code" href="structTreeWalkQueryStellarDensity.html#aa05abbe9f3ef6128ba71a3612226850a">Hsml</a>[i];</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        }</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    }</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160; </div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;}</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160; </div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00923"></a><span class="lineno"><a class="line" href="metal__return_8c.html#ac6208618c0ad5ad55e84bcfb213e7dcb">  923</a></span>&#160;<a class="code" href="metal__return_8c.html#ac6208618c0ad5ad55e84bcfb213e7dcb">stellar_density</a>(<span class="keyword">const</span> <a class="code" href="structActiveParticles.html">ActiveParticles</a> * act, <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> * StarVolumeSPH, <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> * MassReturn, <span class="keyword">const</span> <a class="code" href="structForceTree.html">ForceTree</a> * <span class="keyword">const</span> tree)</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;{</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <a class="code" href="structTreeWalk.html">TreeWalk</a> tw[1] = {{0}};</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    <span class="keyword">struct </span><a class="code" href="structStellarDensityPriv.html">StellarDensityPriv</a> priv[1];</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160; </div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#aa3ff3d4a5a82422609ac154aa4a461ea">ev_label</a> = <span class="stringliteral">&quot;STELLAR_DENSITY&quot;</span>;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#ab4e96e67f2e72ac33dca9dd06cdac6c0">visit</a> = <a class="code" href="treewalk_8c.html#a1878fddf49185074fd570a46f3eea372">treewalk_visit_nolist_ngbiter</a>;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#aafe4f27abb67d3959e711ef6787c9b75">NoNgblist</a> = 1;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#a36bf2eb0e0d65ace233ef30335e04659">ngbiter_type_elsize</a> = <span class="keyword">sizeof</span>(<a class="code" href="structTreeWalkNgbIterStellarDensity.html">TreeWalkNgbIterStellarDensity</a>);</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#a96381f9f61cf2c56dac48927cd997ec3">ngbiter</a> = (<a class="code" href="treewalk_8h.html#aade20e4cc34b64ecf3bd6f5525465371">TreeWalkNgbIterFunction</a>) <a class="code" href="metal__return_8c.html#a65644be78b16f3de65301143dd8d18be">stellar_density_ngbiter</a>;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#a2f6bc842f407a44d99de52e9b5140454">haswork</a> = <a class="code" href="metal__return_8c.html#a5142fdac0ab32dc3c63608bf785c7bcf">stellar_density_haswork</a>;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#ad0b91dafd46de132917e7993869514c5">fill</a> = (<a class="code" href="treewalk_8h.html#ac9a8ade7817c58b83859399364deb1a1">TreeWalkFillQueryFunction</a>) <a class="code" href="metal__return_8c.html#a9af02ff3c8c0ce8dade6b5710fcc9dee">stellar_density_copy</a>;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#aa08a0586a68d1f4f87e0caa1e59dcc5e">reduce</a> = (<a class="code" href="treewalk_8h.html#a2b5a07b25001ac6e9e628d4eb0493b8c">TreeWalkReduceResultFunction</a>) <a class="code" href="metal__return_8c.html#a1a46a94f15fef845c32f0bfe21e66ce3">stellar_density_reduce</a>;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#a8c4dcda60d680c3d56423fca8647472f">postprocess</a> = (<a class="code" href="treewalk_8h.html#a80f59f147efe7c27b601024d819769db">TreeWalkProcessFunction</a>) <a class="code" href="metal__return_8c.html#a17b72849def018c74b52c243280021be">stellar_density_check_neighbours</a>;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#affd5eae4b5a63dcce236ac15b00b4c7c">query_type_elsize</a> = <span class="keyword">sizeof</span>(<a class="code" href="structTreeWalkQueryStellarDensity.html">TreeWalkQueryStellarDensity</a>);</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#ac8c67faaf2c360ed510c4508f11f7c2d">result_type_elsize</a> = <span class="keyword">sizeof</span>(<a class="code" href="structTreeWalkResultStellarDensity.html">TreeWalkResultStellarDensity</a>);</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#a2ae51082ebb6332e558024b6a45506b2">priv</a> = priv;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    tw-&gt;<a class="code" href="structTreeWalk.html#a8525705e365e7c07027f372b66aff149">tree</a> = tree;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160; </div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160; </div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    priv-&gt;<a class="code" href="structStellarDensityPriv.html#a8404dbc104ce789a069dd7b4e7316e59">MassReturn</a> = <a class="code" href="structStellarDensityPriv.html#a8404dbc104ce789a069dd7b4e7316e59">MassReturn</a>;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160; </div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    priv-&gt;<a class="code" href="structStellarDensityPriv.html#a1d7c9fe3b3ba37daed5404bb3029f0c1">Left</a> = (<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;DENS_PRIV-&gt;Left&quot;</span>, <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[4].<a class="code" href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">size</a> * <span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a>));</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    priv-&gt;<a class="code" href="structStellarDensityPriv.html#aed02a564276bbf7e8a623e3c71e6e04d">Right</a> = (<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;DENS_PRIV-&gt;Right&quot;</span>, <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[4].<a class="code" href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">size</a> * <span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a>));</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    priv-&gt;<a class="code" href="structStellarDensityPriv.html#a683e5fa60875e852b78652cff9b5a013">NumNgb</a> = (<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> (*) [<a class="code" href="metal__return_8c.html#a3f020f76e26ad070cd0d2d9dca12c47f">NHSML</a>]) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;DENS_PRIV-&gt;NumNgb&quot;</span>, <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[4].<a class="code" href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">size</a> * <span class="keyword">sizeof</span>(priv-&gt;<a class="code" href="structStellarDensityPriv.html#a683e5fa60875e852b78652cff9b5a013">NumNgb</a>[0]));</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    priv-&gt;<a class="code" href="structStellarDensityPriv.html#ab804b3e8b691d869c09d30266cdd304d">VolumeSPH</a> = (<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> (*) [<a class="code" href="metal__return_8c.html#a3f020f76e26ad070cd0d2d9dca12c47f">NHSML</a>]) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;DENS_PRIV-&gt;VolumeSPH&quot;</span>, <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[4].<a class="code" href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">size</a> * <span class="keyword">sizeof</span>(priv-&gt;<a class="code" href="structStellarDensityPriv.html#ab804b3e8b691d869c09d30266cdd304d">VolumeSPH</a>[0]));</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    priv-&gt;<a class="code" href="structStellarDensityPriv.html#a498cdb1e038916f4d6df3bf51a1b26ea">maxcmpte</a> = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;maxcmpte&quot;</span>, <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[4].<a class="code" href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">size</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160; </div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    priv-&gt;<a class="code" href="structStellarDensityPriv.html#af197f57f37b4b2f938ffe3d09397105d">DesNumNgb</a> = <a class="code" href="density_8c.html#a23e510a287a10de773a4a0f14db2ff52">GetNumNgb</a>(<a class="code" href="density_8c.html#ac40e53af730ce9956d564e3dc18d6f0e">GetDensityKernelType</a>());</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160; </div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="preprocessor">    #pragma omp parallel for</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; act-&gt;<a class="code" href="structActiveParticles.html#a847ab898fdabc62a4723c7c3a66038d4">NumActiveParticle</a>; i++) {</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        <span class="keywordtype">int</span> a = act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a> ? act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a>[i] : i;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        <span class="comment">/* Skip the garbage particles */</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[a].IsGarbage)</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="metal__return_8c.html#a5142fdac0ab32dc3c63608bf785c7bcf">stellar_density_haswork</a>(a, tw))</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        <span class="keywordtype">int</span> pi = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[a].PI;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        priv-&gt;<a class="code" href="structStellarDensityPriv.html#a1d7c9fe3b3ba37daed5404bb3029f0c1">Left</a>[pi] = 0;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        priv-&gt;<a class="code" href="structStellarDensityPriv.html#aed02a564276bbf7e8a623e3c71e6e04d">Right</a>[pi] = tree-&gt;<a class="code" href="structForceTree.html#a8915a4ff849c9e97448ae30089a05966">BoxSize</a>;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    }</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160; </div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="comment">/* allocate buffers to arrange communication */</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160; </div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <a class="code" href="treewalk_8c.html#a72643adf5c7952933b8f5fbb27d45a97">treewalk_do_hsml_loop</a>(tw, act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a>, act-&gt;<a class="code" href="structActiveParticles.html#a847ab898fdabc62a4723c7c3a66038d4">NumActiveParticle</a>, 1);</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="preprocessor">    #pragma omp parallel for</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; act-&gt;<a class="code" href="structActiveParticles.html#a847ab898fdabc62a4723c7c3a66038d4">NumActiveParticle</a>; i++) {</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        <span class="keywordtype">int</span> a = act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a> ? act-&gt;<a class="code" href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticle</a>[i] : i;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        <span class="comment">/* Skip the garbage particles */</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[a].IsGarbage)</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="metal__return_8c.html#a5142fdac0ab32dc3c63608bf785c7bcf">stellar_density_haswork</a>(a, tw))</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        <span class="comment">/* Copy the Star Volume SPH*/</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        StarVolumeSPH[<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[a].PI] = priv-&gt;<a class="code" href="structStellarDensityPriv.html#ab804b3e8b691d869c09d30266cdd304d">VolumeSPH</a>[<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[a].PI][0];</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        <span class="keywordflow">if</span>(priv-&gt;<a class="code" href="structStellarDensityPriv.html#ab804b3e8b691d869c09d30266cdd304d">VolumeSPH</a>[<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[a].PI][0] == 0)</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;            <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(3, <span class="stringliteral">&quot;i = %d pi = %d StarVolumeSPH %g hsml %g\n&quot;</span>, a, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[a].PI, priv-&gt;<a class="code" href="structStellarDensityPriv.html#ab804b3e8b691d869c09d30266cdd304d">VolumeSPH</a>[<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[a].PI][0], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[a].Hsml);</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    }</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160; </div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(priv-&gt;<a class="code" href="structStellarDensityPriv.html#a498cdb1e038916f4d6df3bf51a1b26ea">maxcmpte</a>);</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(priv-&gt;<a class="code" href="structStellarDensityPriv.html#ab804b3e8b691d869c09d30266cdd304d">VolumeSPH</a>);</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(priv-&gt;<a class="code" href="structStellarDensityPriv.html#a683e5fa60875e852b78652cff9b5a013">NumNgb</a>);</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(priv-&gt;<a class="code" href="structStellarDensityPriv.html#aed02a564276bbf7e8a623e3c71e6e04d">Right</a>);</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(priv-&gt;<a class="code" href="structStellarDensityPriv.html#a1d7c9fe3b3ba37daed5404bb3029f0c1">Left</a>);</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160; </div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <span class="keywordtype">double</span> timeall = <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<a class="code" href="walltime_8h.html#a5cedff8706bf3a249bd5e3c365b67964">WALLTIME_IGNORE</a>);</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160; </div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="keywordtype">double</span> timecomp = tw-&gt;<a class="code" href="structTreeWalk.html#a714d0465e0498a5a8d0b698d37348ce6">timecomp3</a> + tw-&gt;<a class="code" href="structTreeWalk.html#ada69256fab1ba3b0e5ff0f837f749b2e">timecomp1</a> + tw-&gt;<a class="code" href="structTreeWalk.html#a6518c361d396be49a9d1c676d8769802">timecomp2</a>;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="keywordtype">double</span> timewait = tw-&gt;<a class="code" href="structTreeWalk.html#ae62aa594cbe693d40de9334cc0f7c820">timewait1</a> + tw-&gt;<a class="code" href="structTreeWalk.html#aacf67d9ea224563ae4006114d97e473c">timewait2</a>;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="keywordtype">double</span> timecomm = tw-&gt;<a class="code" href="structTreeWalk.html#a80f3ba2d463ce192ccb0f42eed264f56">timecommsumm1</a> + tw-&gt;<a class="code" href="structTreeWalk.html#ae663d6653b464f02c95c57ae4a5bdd3a">timecommsumm2</a>;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <a class="code" href="walltime_8h.html#a9266fc830d2aac1ad7d6e5322be6f489">walltime_add</a>(<span class="stringliteral">&quot;/SPH/Metals/Density/Compute&quot;</span>, timecomp);</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <a class="code" href="walltime_8h.html#a9266fc830d2aac1ad7d6e5322be6f489">walltime_add</a>(<span class="stringliteral">&quot;/SPH/Metals/Density/Wait&quot;</span>, timewait);</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    <a class="code" href="walltime_8h.html#a9266fc830d2aac1ad7d6e5322be6f489">walltime_add</a>(<span class="stringliteral">&quot;/SPH/Metals/Density/Comm&quot;</span>, timecomm);</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <a class="code" href="walltime_8h.html#a9266fc830d2aac1ad7d6e5322be6f489">walltime_add</a>(<span class="stringliteral">&quot;/SPH/Metals/Density/Misc&quot;</span>, timeall - (timecomp + timewait + timecomm));</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160; </div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;}</div>
<div class="ttc" id="acooling_8c_html_a9e60f3e57fde2b9b1c7fe2eab7334add"><div class="ttname"><a href="cooling_8c.html#a9e60f3e57fde2b9b1c7fe2eab7334add">MAXITER</a></div><div class="ttdeci">#define MAXITER</div><div class="ttdef"><b>Definition:</b> <a href="cooling_8c_source.html#l00046">cooling.c:46</a></div></div>
<div class="ttc" id="acooling__uvfluc_8c_html_a7a1e78ce837328347579b1910844b59d"><div class="ttname"><a href="cooling__uvfluc_8c.html#a7a1e78ce837328347579b1910844b59d">interp</a></div><div class="ttdeci">Interp interp</div><div class="ttdef"><b>Definition:</b> <a href="cooling__uvfluc_8c_source.html#l00019">cooling_uvfluc.c:19</a></div></div>
<div class="ttc" id="acosmology_8c_html_ab425f16e6fe06110e2fb4944065b81bb"><div class="ttname"><a href="cosmology_8c.html#ab425f16e6fe06110e2fb4944065b81bb">hubble_function</a></div><div class="ttdeci">double hubble_function(const Cosmology *CP, double a)</div><div class="ttdef"><b>Definition:</b> <a href="cosmology_8c_source.html#l00058">cosmology.c:58</a></div></div>
<div class="ttc" id="acosmology_8h_html"><div class="ttname"><a href="cosmology_8h.html">cosmology.h</a></div></div>
<div class="ttc" id="adensity_8c_html_a23e510a287a10de773a4a0f14db2ff52"><div class="ttname"><a href="density_8c.html#a23e510a287a10de773a4a0f14db2ff52">GetNumNgb</a></div><div class="ttdeci">double GetNumNgb(enum DensityKernelType KernelType)</div><div class="ttdef"><b>Definition:</b> <a href="density_8c_source.html#l00055">density.c:55</a></div></div>
<div class="ttc" id="adensity_8c_html_ac40e53af730ce9956d564e3dc18d6f0e"><div class="ttname"><a href="density_8c.html#ac40e53af730ce9956d564e3dc18d6f0e">GetDensityKernelType</a></div><div class="ttdeci">enum DensityKernelType GetDensityKernelType(void)</div><div class="ttdef"><b>Definition:</b> <a href="density_8c_source.html#l00055">density.c:63</a></div></div>
<div class="ttc" id="adensity_8h_html"><div class="ttname"><a href="density_8h.html">density.h</a></div></div>
<div class="ttc" id="adensitykernel_8c_html_a7c842435db8db5e6fe2c652b849af87f"><div class="ttname"><a href="densitykernel_8c.html#a7c842435db8db5e6fe2c652b849af87f">wk</a></div><div class="ttdeci">double(* wk)(DensityKernel *kernel, double q)</div><div class="ttdef"><b>Definition:</b> <a href="densitykernel_8c_source.html#l00094">densitykernel.c:94</a></div></div>
<div class="ttc" id="adensitykernel_8c_html_ac4e5abd2c5d6459b39437185da18ee48"><div class="ttname"><a href="densitykernel_8c.html#ac4e5abd2c5d6459b39437185da18ee48">density_kernel_volume</a></div><div class="ttdeci">double density_kernel_volume(DensityKernel *kernel)</div><div class="ttdef"><b>Definition:</b> <a href="densitykernel_8c_source.html#l00134">densitykernel.c:134</a></div></div>
<div class="ttc" id="adensitykernel_8c_html_ac964db66f17e32a55c5137c884f4b76b"><div class="ttname"><a href="densitykernel_8c.html#ac964db66f17e32a55c5137c884f4b76b">density_kernel_init</a></div><div class="ttdeci">void density_kernel_init(DensityKernel *kernel, double H, enum DensityKernelType type)</div><div class="ttdef"><b>Definition:</b> <a href="densitykernel_8c_source.html#l00157">densitykernel.c:157</a></div></div>
<div class="ttc" id="adensitykernel_8c_html_afb1d08bb021ac0edae2020eca1a48ea5"><div class="ttname"><a href="densitykernel_8c.html#afb1d08bb021ac0edae2020eca1a48ea5">density_kernel_wk</a></div><div class="ttdeci">double density_kernel_wk(DensityKernel *kernel, double u)</div><div class="ttdef"><b>Definition:</b> <a href="densitykernel_8c_source.html#l00116">densitykernel.c:116</a></div></div>
<div class="ttc" id="adensitykernel_8h_html"><div class="ttname"><a href="densitykernel_8h.html">densitykernel.h</a></div></div>
<div class="ttc" id="aendrun_8c_html_a6567cd867c5549fb6586e19ccd819764"><div class="ttname"><a href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a></div><div class="ttdeci">void message(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00175">endrun.c:175</a></div></div>
<div class="ttc" id="aendrun_8c_html_ad963d7efdb9f10f7a2298c8ccd222ab0"><div class="ttname"><a href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a></div><div class="ttdeci">void endrun(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00147">endrun.c:147</a></div></div>
<div class="ttc" id="aforcetree_8c_html_aa01061828cef34bc4c55ef9eaa7c03f5"><div class="ttname"><a href="forcetree_8c.html#aa01061828cef34bc4c55ef9eaa7c03f5">force_tree_rebuild_mask</a></div><div class="ttdeci">void force_tree_rebuild_mask(ForceTree *tree, DomainDecomp *ddecomp, int mask, const int HybridNuGrav, const char *EmergencyOutputDir)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00161">forcetree.c:161</a></div></div>
<div class="ttc" id="aforcetree_8c_html_aaa26dfea4b696133a8bc35c5e0c56037"><div class="ttname"><a href="forcetree_8c.html#aaa26dfea4b696133a8bc35c5e0c56037">force_tree_free</a></div><div class="ttdeci">void force_tree_free(ForceTree *tree)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l01409">forcetree.c:1409</a></div></div>
<div class="ttc" id="aforcetree_8c_html_ab8a2310bd448851f4aa42ae6bcec2e01"><div class="ttname"><a href="forcetree_8c.html#ab8a2310bd448851f4aa42ae6bcec2e01">force_get_father</a></div><div class="ttdeci">int force_get_father(int no, const ForceTree *tree)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00905">forcetree.c:905</a></div></div>
<div class="ttc" id="aforcetree_8h_html_ad7d9abc3063766d4c2825954b8354f70"><div class="ttname"><a href="forcetree_8h.html#ad7d9abc3063766d4c2825954b8354f70">GASMASK</a></div><div class="ttdeci">#define GASMASK</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00021">forcetree.h:21</a></div></div>
<div class="ttc" id="alightcone_8c_html_a53356309f04e9e22e9631e0be5a97b36"><div class="ttname"><a href="lightcone_8c.html#a53356309f04e9e22e9631e0be5a97b36">kernel</a></div><div class="ttdeci">static double kernel(double loga, void *params)</div><div class="ttdef"><b>Definition:</b> <a href="lightcone_8c_source.html#l00059">lightcone.c:59</a></div></div>
<div class="ttc" id="ametal__return_8c_html_a11ab16103547beec8342415acd5add34"><div class="ttname"><a href="metal__return_8c.html#a11ab16103547beec8342415acd5add34">mass_yield</a></div><div class="ttdeci">static double mass_yield(double dtmyrstart, double dtmyrend, double stellarmetal, double hub, struct interps *interp, double imf_norm, gsl_integration_workspace *gsl_work, double masslow, double masshigh)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00395">metal_return.c:395</a></div></div>
<div class="ttc" id="ametal__return_8c_html_a136faab0fe657ba92032f25f004098d9"><div class="ttname"><a href="metal__return_8c.html#a136faab0fe657ba92032f25f004098d9">set_metal_params</a></div><div class="ttdeci">void set_metal_params(double Sn1aN0)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00055">metal_return.c:55</a></div></div>
<div class="ttc" id="ametal__return_8c_html_a137b224aee42a66c68cde0385dfb58d0"><div class="ttname"><a href="metal__return_8c.html#a137b224aee42a66c68cde0385dfb58d0">find_mass_bin_limits</a></div><div class="ttdeci">void find_mass_bin_limits(double *masslow, double *masshigh, const double dtstart, const double dtend, double stellarmetal, gsl_interp2d *lifetime_tables)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00230">metal_return.c:230</a></div></div>
<div class="ttc" id="ametal__return_8c_html_a17b72849def018c74b52c243280021be"><div class="ttname"><a href="metal__return_8c.html#a17b72849def018c74b52c243280021be">stellar_density_check_neighbours</a></div><div class="ttdeci">void stellar_density_check_neighbours(int i, TreeWalk *tw)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00820">metal_return.c:820</a></div></div>
<div class="ttc" id="ametal__return_8c_html_a1a46a94f15fef845c32f0bfe21e66ce3"><div class="ttname"><a href="metal__return_8c.html#a1a46a94f15fef845c32f0bfe21e66ce3">stellar_density_reduce</a></div><div class="ttdeci">static void stellar_density_reduce(int place, TreeWalkResultStellarDensity *remote, enum TreeWalkReduceMode mode, TreeWalk *tw)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00808">metal_return.c:808</a></div></div>
<div class="ttc" id="ametal__return_8c_html_a24d45c4ab9d585e3eee454565470fc44"><div class="ttname"><a href="metal__return_8c.html#a24d45c4ab9d585e3eee454565470fc44">atime_integ</a></div><div class="ttdeci">double atime_integ(double atime, void *params)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00154">metal_return.c:154</a></div></div>
<div class="ttc" id="ametal__return_8c_html_a29c034b7ca0de0b5fc12d1589605958e"><div class="ttname"><a href="metal__return_8c.html#a29c034b7ca0de0b5fc12d1589605958e">STELLAR_DENSITY_GET_PRIV</a></div><div class="ttdeci">#define STELLAR_DENSITY_GET_PRIV(tw)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00762">metal_return.c:762</a></div></div>
<div class="ttc" id="ametal__return_8c_html_a2bc8aad8a4cd6b54c88ccd4321c6cfda"><div class="ttname"><a href="metal__return_8c.html#a2bc8aad8a4cd6b54c88ccd4321c6cfda">metal_return_init</a></div><div class="ttdeci">int64_t metal_return_init(const ActiveParticles *act, Cosmology *CP, struct MetalReturnPriv *priv, const double atime)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00437">metal_return.c:437</a></div></div>
<div class="ttc" id="ametal__return_8c_html_a3f020f76e26ad070cd0d2d9dca12c47f"><div class="ttname"><a href="metal__return_8c.html#a3f020f76e26ad070cd0d2d9dca12c47f">NHSML</a></div><div class="ttdeci">#define NHSML</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00726">metal_return.c:726</a></div></div>
<div class="ttc" id="ametal__return_8c_html_a45c1e30e08ea1d55780815948138bdc6"><div class="ttname"><a href="metal__return_8c.html#a45c1e30e08ea1d55780815948138bdc6">setup_metal_table_interp</a></div><div class="ttdeci">void setup_metal_table_interp(struct interps *interp)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00076">metal_return.c:76</a></div></div>
<div class="ttc" id="ametal__return_8c_html_a4aea3dd136365503eba1b3189dc8a453"><div class="ttname"><a href="metal__return_8c.html#a4aea3dd136365503eba1b3189dc8a453">do_rootfinding</a></div><div class="ttdeci">double do_rootfinding(struct massbin_find_params *p, double mass_low, double mass_high)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00194">metal_return.c:194</a></div></div>
<div class="ttc" id="ametal__return_8c_html_a5142fdac0ab32dc3c63608bf785c7bcf"><div class="ttname"><a href="metal__return_8c.html#a5142fdac0ab32dc3c63608bf785c7bcf">stellar_density_haswork</a></div><div class="ttdeci">static int stellar_density_haswork(int i, TreeWalk *tw)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00765">metal_return.c:765</a></div></div>
<div class="ttc" id="ametal__return_8c_html_a5b15dfb509db8f3e1973f5c10cf0873e"><div class="ttname"><a href="metal__return_8c.html#a5b15dfb509db8f3e1973f5c10cf0873e">effhsml</a></div><div class="ttdeci">static double effhsml(int place, int i, TreeWalk *tw)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00772">metal_return.c:772</a></div></div>
<div class="ttc" id="ametal__return_8c_html_a63f7c8d874ef7fd16f7fed060127acef"><div class="ttname"><a href="metal__return_8c.html#a63f7c8d874ef7fd16f7fed060127acef">massendlife</a></div><div class="ttdeci">double massendlife(double mass, void *params)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00185">metal_return.c:185</a></div></div>
<div class="ttc" id="ametal__return_8c_html_a64bf0f58fb25b3c2ded7dbeb73088b3c"><div class="ttname"><a href="metal__return_8c.html#a64bf0f58fb25b3c2ded7dbeb73088b3c">metal_return_postprocess</a></div><div class="ttdeci">static void metal_return_postprocess(int place, TreeWalk *tw)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00619">metal_return.c:619</a></div></div>
<div class="ttc" id="ametal__return_8c_html_a65644be78b16f3de65301143dd8d18be"><div class="ttname"><a href="metal__return_8c.html#a65644be78b16f3de65301143dd8d18be">stellar_density_ngbiter</a></div><div class="ttdeci">static void stellar_density_ngbiter(TreeWalkQueryStellarDensity *I, TreeWalkResultStellarDensity *O, TreeWalkNgbIterStellarDensity *iter, LocalTreeWalk *lv)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00872">metal_return.c:872</a></div></div>
<div class="ttc" id="ametal__return_8c_html_a687f879a7550bbdfdc820d65b606cb36"><div class="ttname"><a href="metal__return_8c.html#a687f879a7550bbdfdc820d65b606cb36">MetalParams</a></div><div class="ttdeci">static struct metal_return_params MetalParams</div></div>
<div class="ttc" id="ametal__return_8c_html_a6bd8ed6c1f34beb2703996ba03572b8a"><div class="ttname"><a href="metal__return_8c.html#a6bd8ed6c1f34beb2703996ba03572b8a">metal_return_priv_free</a></div><div class="ttdeci">void metal_return_priv_free(struct MetalReturnPriv *priv)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00500">metal_return.c:500</a></div></div>
<div class="ttc" id="ametal__return_8c_html_a76a8adf795460ecc25eb530e3c6e35cb"><div class="ttname"><a href="metal__return_8c.html#a76a8adf795460ecc25eb530e3c6e35cb">sn1a_number</a></div><div class="ttdeci">double sn1a_number(double dtmyrstart, double dtmyrend, double hub)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00324">metal_return.c:324</a></div></div>
<div class="ttc" id="ametal__return_8c_html_a7c817252ab7c0f679fea71bde6dea852"><div class="ttname"><a href="metal__return_8c.html#a7c817252ab7c0f679fea71bde6dea852">metal_return</a></div><div class="ttdeci">void metal_return(const ActiveParticles *act, DomainDecomp *const ddecomp, Cosmology *CP, const double atime, const double AvgGasMass)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00517">metal_return.c:517</a></div></div>
<div class="ttc" id="ametal__return_8c_html_a867fc3e21ae7aa831a63f2f3f5f20f57"><div class="ttname"><a href="metal__return_8c.html#a867fc3e21ae7aa831a63f2f3f5f20f57">set_metal_return_params</a></div><div class="ttdeci">void set_metal_return_params(ParameterSet *ps)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00062">metal_return.c:62</a></div></div>
<div class="ttc" id="ametal__return_8c_html_a9af02ff3c8c0ce8dade6b5710fcc9dee"><div class="ttname"><a href="metal__return_8c.html#a9af02ff3c8c0ce8dade6b5710fcc9dee">stellar_density_copy</a></div><div class="ttdeci">static void stellar_density_copy(int place, TreeWalkQueryStellarDensity *I, TreeWalk *tw)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00800">metal_return.c:800</a></div></div>
<div class="ttc" id="ametal__return_8c_html_aa295d967ecdb8d2eb11cb8cf02386b41"><div class="ttname"><a href="metal__return_8c.html#aa295d967ecdb8d2eb11cb8cf02386b41">compute_snii_yield</a></div><div class="ttdeci">double compute_snii_yield(gsl_interp2d *snii_interp, const double *snii_weights, double stellarmetal, double masslow, double masshigh, gsl_integration_workspace *gsl_work)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00368">metal_return.c:368</a></div></div>
<div class="ttc" id="ametal__return_8c_html_aad6b2bf60ee9eae8cc059ba4c50aedce"><div class="ttname"><a href="metal__return_8c.html#aad6b2bf60ee9eae8cc059ba4c50aedce">METALS_GET_PRIV</a></div><div class="ttdeci">#define METALS_GET_PRIV(tw)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00099">metal_return.c:99</a></div></div>
<div class="ttc" id="ametal__return_8c_html_aae2dc62d04b08fb98b6b5e0549d595f9"><div class="ttname"><a href="metal__return_8c.html#aae2dc62d04b08fb98b6b5e0549d595f9">metal_return_haswork</a></div><div class="ttdeci">static int metal_return_haswork(int n, TreeWalk *tw)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00720">metal_return.c:720</a></div></div>
<div class="ttc" id="ametal__return_8c_html_ab5c3a1fb77d5aef2936539c084bb0273"><div class="ttname"><a href="metal__return_8c.html#ab5c3a1fb77d5aef2936539c084bb0273">metals_haswork</a></div><div class="ttdeci">int metals_haswork(int i, MyFloat *MassReturn)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00708">metal_return.c:708</a></div></div>
<div class="ttc" id="ametal__return_8c_html_ab7106eacb849b554febe06ca0b7e920f"><div class="ttname"><a href="metal__return_8c.html#ab7106eacb849b554febe06ca0b7e920f">chabrier_imf_integ</a></div><div class="ttdeci">double chabrier_imf_integ(double mass, void *params)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00289">metal_return.c:289</a></div></div>
<div class="ttc" id="ametal__return_8c_html_ac6208618c0ad5ad55e84bcfb213e7dcb"><div class="ttname"><a href="metal__return_8c.html#ac6208618c0ad5ad55e84bcfb213e7dcb">stellar_density</a></div><div class="ttdeci">void stellar_density(const ActiveParticles *act, MyFloat *StarVolumeSPH, MyFloat *MassReturn, const ForceTree *const tree)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00923">metal_return.c:923</a></div></div>
<div class="ttc" id="ametal__return_8c_html_ac75463a2439d1e5657e6b759b79cf717"><div class="ttname"><a href="metal__return_8c.html#ac75463a2439d1e5657e6b759b79cf717">metal_return_copy</a></div><div class="ttdeci">static void metal_return_copy(int place, TreeWalkQueryMetals *input, TreeWalk *tw)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00583">metal_return.c:583</a></div></div>
<div class="ttc" id="ametal__return_8c_html_ad1b2ebe4fbb8bd696bfaf675438fe550"><div class="ttname"><a href="metal__return_8c.html#ad1b2ebe4fbb8bd696bfaf675438fe550">compute_agb_yield</a></div><div class="ttdeci">double compute_agb_yield(gsl_interp2d *agb_interp, const double *agb_weights, double stellarmetal, double masslow, double masshigh, gsl_integration_workspace *gsl_work)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00342">metal_return.c:342</a></div></div>
<div class="ttc" id="ametal__return_8c_html_ad2254b657bd9575bdc88bd5dd246ddd8"><div class="ttname"><a href="metal__return_8c.html#ad2254b657bd9575bdc88bd5dd246ddd8">compute_imf_norm</a></div><div class="ttdeci">double compute_imf_norm(gsl_integration_workspace *gsl_work)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00314">metal_return.c:314</a></div></div>
<div class="ttc" id="ametal__return_8c_html_ad39fbdf9929fece660e9555909b2de10"><div class="ttname"><a href="metal__return_8c.html#ad39fbdf9929fece660e9555909b2de10">chabrier_imf</a></div><div class="ttdeci">static double chabrier_imf(double mass)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00144">metal_return.c:144</a></div></div>
<div class="ttc" id="ametal__return_8c_html_ae51821f5a1163d9e641d2f59eea9a0de"><div class="ttname"><a href="metal__return_8c.html#ae51821f5a1163d9e641d2f59eea9a0de">atime_to_myr</a></div><div class="ttdeci">static double atime_to_myr(Cosmology *CP, double atime1, double atime2, gsl_integration_workspace *gsl_work)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00161">metal_return.c:161</a></div></div>
<div class="ttc" id="ametal__return_8c_html_aed77dd49844be97101b610fcca622033"><div class="ttname"><a href="metal__return_8c.html#aed77dd49844be97101b610fcca622033">metal_return_ngbiter</a></div><div class="ttdeci">static void metal_return_ngbiter(TreeWalkQueryMetals *I, TreeWalkResultMetals *O, TreeWalkNgbIterMetals *iter, LocalTreeWalk *lv)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00633">metal_return.c:633</a></div></div>
<div class="ttc" id="ametal__return_8c_html_aee9d9017b5438971ffe6af27a81fa272"><div class="ttname"><a href="metal__return_8c.html#aee9d9017b5438971ffe6af27a81fa272">metal_yield</a></div><div class="ttdeci">static double metal_yield(double dtmyrstart, double dtmyrend, double stellarmetal, double hub, struct interps *interp, MyFloat *MetalYields, double imf_norm, gsl_integration_workspace *gsl_work, double masslow, double masshigh)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00411">metal_return.c:411</a></div></div>
<div class="ttc" id="ametal__return_8c_html_aef53713bf77e1f8df00fcf003198cbd1"><div class="ttname"><a href="metal__return_8c.html#aef53713bf77e1f8df00fcf003198cbd1">chabrier_mass</a></div><div class="ttdeci">double chabrier_mass(double mass, void *params)</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00308">metal_return.c:308</a></div></div>
<div class="ttc" id="ametal__return_8h_html"><div class="ttname"><a href="metal__return_8h.html">metal_return.h</a></div></div>
<div class="ttc" id="ametal__tables_8h_html"><div class="ttname"><a href="metal__tables_8h.html">metal_tables.h</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_a009e5c702a99940896f57ca01379b6a1"><div class="ttname"><a href="metal__tables_8h.html#a009e5c702a99940896f57ca01379b6a1">LIFE_NMET</a></div><div class="ttdeci">#define LIFE_NMET</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00016">metal_tables.h:16</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_a17de36caa644e3741822c6196dbbcd9d"><div class="ttname"><a href="metal__tables_8h.html#a17de36caa644e3741822c6196dbbcd9d">snii_yield</a></div><div class="ttdeci">static const double snii_yield[NSPECIES][SNII_NMET *SNII_NMASS]</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00334">metal_tables.h:334</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_a4f784d3142b1103442b95109d99f1dd8"><div class="ttname"><a href="metal__tables_8h.html#a4f784d3142b1103442b95109d99f1dd8">AGB_NMET</a></div><div class="ttdeci">#define AGB_NMET</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00068">metal_tables.h:68</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_a61be6fb4a1f463c29c9c1f436ac02ae6"><div class="ttname"><a href="metal__tables_8h.html#a61be6fb4a1f463c29c9c1f436ac02ae6">snii_metallicities</a></div><div class="ttdeci">static const double snii_metallicities[SNII_NMET]</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00311">metal_tables.h:311</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_a6fd2c15826eef68647513456e6e50a3d"><div class="ttname"><a href="metal__tables_8h.html#a6fd2c15826eef68647513456e6e50a3d">LIFE_NMASS</a></div><div class="ttdeci">#define LIFE_NMASS</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00017">metal_tables.h:17</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_a72c6dc54510c0490ccc48ca6d1b6d5a3"><div class="ttname"><a href="metal__tables_8h.html#a72c6dc54510c0490ccc48ca6d1b6d5a3">SNII_NMASS</a></div><div class="ttdeci">#define SNII_NMASS</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00309">metal_tables.h:309</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_a75fab227eb2c54a8c6a0dc8646b20586"><div class="ttname"><a href="metal__tables_8h.html#a75fab227eb2c54a8c6a0dc8646b20586">agb_masses</a></div><div class="ttdeci">static const double agb_masses[AGB_NMASS]</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00070">metal_tables.h:70</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_a76c1c4ce8f3e324d728e5f9e2a17925f"><div class="ttname"><a href="metal__tables_8h.html#a76c1c4ce8f3e324d728e5f9e2a17925f">SNAGBSWITCH</a></div><div class="ttdeci">#define SNAGBSWITCH</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00013">metal_tables.h:13</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_a80e75542e47c3d4bb53f7c18ecfbf446"><div class="ttname"><a href="metal__tables_8h.html#a80e75542e47c3d4bb53f7c18ecfbf446">GSL_WORKSPACE</a></div><div class="ttdeci">#define GSL_WORKSPACE</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00426">metal_tables.h:426</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_a8f40898a35fecff6597e3f5b363426de"><div class="ttname"><a href="metal__tables_8h.html#a8f40898a35fecff6597e3f5b363426de">AGB_NMASS</a></div><div class="ttdeci">#define AGB_NMASS</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00069">metal_tables.h:69</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_a94a003b7846207e7810e1e55b0244e42"><div class="ttname"><a href="metal__tables_8h.html#a94a003b7846207e7810e1e55b0244e42">snii_total_mass</a></div><div class="ttdeci">static const double snii_total_mass[SNII_NMET *SNII_NMASS]</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00312">metal_tables.h:312</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_a9805eef500ca9d27dbf530685e27ba61"><div class="ttname"><a href="metal__tables_8h.html#a9805eef500ca9d27dbf530685e27ba61">agb_total_mass</a></div><div class="ttdeci">static const double agb_total_mass[AGB_NMET *AGB_NMASS]</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00072">metal_tables.h:72</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_aa21065ef7a16b9c8ff2f75824bed67d4"><div class="ttname"><a href="metal__tables_8h.html#aa21065ef7a16b9c8ff2f75824bed67d4">MINMASS</a></div><div class="ttdeci">#define MINMASS</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00011">metal_tables.h:11</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_aa2a6d47b82bf746279097654676fcf4e"><div class="ttname"><a href="metal__tables_8h.html#aa2a6d47b82bf746279097654676fcf4e">sn1a_yields</a></div><div class="ttdeci">static const double sn1a_yields[NSPECIES]</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00061">metal_tables.h:61</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_aa38d6243b64cada879d9ecf59a02e527"><div class="ttname"><a href="metal__tables_8h.html#aa38d6243b64cada879d9ecf59a02e527">agb_total_metals</a></div><div class="ttdeci">static const double agb_total_metals[AGB_NMET *AGB_NMASS]</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00094">metal_tables.h:94</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_aac3cc9648b91cf1489acba747f7c722d"><div class="ttname"><a href="metal__tables_8h.html#aac3cc9648b91cf1489acba747f7c722d">lifetime_metallicity</a></div><div class="ttdeci">static const double lifetime_metallicity[LIFE_NMET]</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00018">metal_tables.h:18</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_ab4b5721a1b3263ad6360bf5b874f7102"><div class="ttname"><a href="metal__tables_8h.html#ab4b5721a1b3263ad6360bf5b874f7102">SNII_NMET</a></div><div class="ttdeci">#define SNII_NMET</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00308">metal_tables.h:308</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_ac2471adaa3fa47747079522dff017cb7"><div class="ttname"><a href="metal__tables_8h.html#ac2471adaa3fa47747079522dff017cb7">sn1a_total_metals</a></div><div class="ttdeci">static const double sn1a_total_metals</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00060">metal_tables.h:60</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_ac626022f7ea397ad8b6309ab43229766"><div class="ttname"><a href="metal__tables_8h.html#ac626022f7ea397ad8b6309ab43229766">lifetime</a></div><div class="ttdeci">static const double lifetime[LIFE_NMASS *LIFE_NMET]</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00024">metal_tables.h:24</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_ac62ec9985d76dc0b4dc569839bc926ef"><div class="ttname"><a href="metal__tables_8h.html#ac62ec9985d76dc0b4dc569839bc926ef">MAXMASS</a></div><div class="ttdeci">#define MAXMASS</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00009">metal_tables.h:9</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_ada35087703fd56a884bc7c79c2b26495"><div class="ttname"><a href="metal__tables_8h.html#ada35087703fd56a884bc7c79c2b26495">agb_yield</a></div><div class="ttdeci">static const double agb_yield[NSPECIES][AGB_NMET *AGB_NMASS]</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00116">metal_tables.h:116</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_ae1387e9c35b052580b69af49c33068dd"><div class="ttname"><a href="metal__tables_8h.html#ae1387e9c35b052580b69af49c33068dd">snii_masses</a></div><div class="ttdeci">static const double snii_masses[SNII_NMASS]</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00310">metal_tables.h:310</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_ae29b0d26e01b69825f3d4bb0357170cd"><div class="ttname"><a href="metal__tables_8h.html#ae29b0d26e01b69825f3d4bb0357170cd">lifetime_masses</a></div><div class="ttdeci">static const double lifetime_masses[LIFE_NMASS]</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00020">metal_tables.h:20</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_afa712d91edf737c0da969b49f4b9837f"><div class="ttname"><a href="metal__tables_8h.html#afa712d91edf737c0da969b49f4b9837f">snii_total_metals</a></div><div class="ttdeci">static const double snii_total_metals[SNII_NMET *SNII_NMASS]</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00323">metal_tables.h:323</a></div></div>
<div class="ttc" id="ametal__tables_8h_html_affe9e55a7937d887e455b230d6debc72"><div class="ttname"><a href="metal__tables_8h.html#affe9e55a7937d887e455b230d6debc72">agb_metallicities</a></div><div class="ttdeci">static const double agb_metallicities[AGB_NMET]</div><div class="ttdef"><b>Definition:</b> <a href="metal__tables_8h_source.html#l00071">metal_tables.h:71</a></div></div>
<div class="ttc" id="amymalloc_8h_html_a3eb707b32b6ac69f2df085e4bc098cc4"><div class="ttname"><a href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a></div><div class="ttdeci">#define mymalloc(name, size)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00015">mymalloc.h:15</a></div></div>
<div class="ttc" id="amymalloc_8h_html_a52bc2c6ec78b17bb6d42957cbf642f15"><div class="ttname"><a href="mymalloc_8h.html#a52bc2c6ec78b17bb6d42957cbf642f15">ta_malloc</a></div><div class="ttdeci">#define ta_malloc(name, type, nele)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00025">mymalloc.h:25</a></div></div>
<div class="ttc" id="amymalloc_8h_html_a84e2115e90e9c22e11d9663c019fc8bc"><div class="ttname"><a href="mymalloc_8h.html#a84e2115e90e9c22e11d9663c019fc8bc">ta_free</a></div><div class="ttdeci">#define ta_free(p)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00028">mymalloc.h:28</a></div></div>
<div class="ttc" id="amymalloc_8h_html_af469c2f7e504a771f5d8a91ac9623240"><div class="ttname"><a href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a></div><div class="ttdeci">#define myfree(x)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00019">mymalloc.h:19</a></div></div>
<div class="ttc" id="aparamset_8c_html_a1ae36a31d95a8e2a9d2812bb9ecc9d49"><div class="ttname"><a href="paramset_8c.html#a1ae36a31d95a8e2a9d2812bb9ecc9d49">param_get_double</a></div><div class="ttdeci">double param_get_double(ParameterSet *ps, const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="paramset_8c_source.html#l00336">paramset.c:336</a></div></div>
<div class="ttc" id="aparamset_8c_html_a6228c17649c46aef53e74cd7ccb93fb0"><div class="ttname"><a href="paramset_8c.html#a6228c17649c46aef53e74cd7ccb93fb0">param_get_int</a></div><div class="ttdeci">int param_get_int(ParameterSet *ps, const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="paramset_8c_source.html#l00368">paramset.c:368</a></div></div>
<div class="ttc" id="apartmanager_8c_html_a6cef44682776e476d8f9f1b9e1f9fe16"><div class="ttname"><a href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a></div><div class="ttdeci">struct part_manager_type PartManager[1]</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8c_source.html#l00001">partmanager.c:11</a></div></div>
<div class="ttc" id="apartmanager_8h_html_a2748566f4c443ee77aa831e63dbb5ebe"><div class="ttname"><a href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a></div><div class="ttdeci">#define P</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00088">partmanager.h:88</a></div></div>
<div class="ttc" id="aphysconst_8h_html"><div class="ttname"><a href="physconst_8h.html">physconst.h</a></div></div>
<div class="ttc" id="aphysconst_8h_html_a5de72d8762faf787d06d4dd47daeddeb"><div class="ttname"><a href="physconst_8h.html#a5de72d8762faf787d06d4dd47daeddeb">HUBBLE</a></div><div class="ttdeci">#define HUBBLE</div><div class="ttdef"><b>Definition:</b> <a href="physconst_8h_source.html#l00025">physconst.h:25</a></div></div>
<div class="ttc" id="aphysconst_8h_html_af2bfce8e844bbb3b120263471c6c329e"><div class="ttname"><a href="physconst_8h.html#af2bfce8e844bbb3b120263471c6c329e">SEC_PER_MEGAYEAR</a></div><div class="ttdeci">#define SEC_PER_MEGAYEAR</div><div class="ttdef"><b>Definition:</b> <a href="physconst_8h_source.html#l00031">physconst.h:31</a></div></div>
<div class="ttc" id="apower_8c_html_aaca257a58f3e957a7db5fc91431eadf5"><div class="ttname"><a href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a></div><div class="ttdeci">static Cosmology * CP</div><div class="ttdef"><b>Definition:</b> <a href="power_8c_source.html#l00027">power.c:27</a></div></div>
<div class="ttc" id="aslotsmanager_8c_html_aa317621b6c60bc95c5f3e33c648e8392"><div class="ttname"><a href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a></div><div class="ttdeci">struct slots_manager_type SlotsManager[1]</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8c_source.html#l00001">slotsmanager.c:7</a></div></div>
<div class="ttc" id="aslotsmanager_8h_html"><div class="ttname"><a href="slotsmanager_8h.html">slotsmanager.h</a></div></div>
<div class="ttc" id="aslotsmanager_8h_html_a681d502f5cbf25161ff026312cd1498c"><div class="ttname"><a href="slotsmanager_8h.html#a681d502f5cbf25161ff026312cd1498c">SPHP</a></div><div class="ttdeci">#define SPHP(i)</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00124">slotsmanager.h:124</a></div></div>
<div class="ttc" id="aslotsmanager_8h_html_a9dd255c01b21dd0eff9b32811421bfc8"><div class="ttname"><a href="slotsmanager_8h.html#a9dd255c01b21dd0eff9b32811421bfc8">STARP</a></div><div class="ttdeci">#define STARP(i)</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00126">slotsmanager.h:126</a></div></div>
<div class="ttc" id="aslotsmanager_8h_html_ad07d3b873121463218a991d53512e49b"><div class="ttname"><a href="slotsmanager_8h.html#ad07d3b873121463218a991d53512e49b">NMETALS</a></div><div class="ttdeci">#define NMETALS</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00060">slotsmanager.h:60</a></div></div>
<div class="ttc" id="aspinlocks_8c_html_a4198c8f6839dabbd9351bacd76c463e6"><div class="ttname"><a href="spinlocks_8c.html#a4198c8f6839dabbd9351bacd76c463e6">free_spinlocks</a></div><div class="ttdeci">void free_spinlocks(struct SpinLocks *spin)</div><div class="ttdef"><b>Definition:</b> <a href="spinlocks_8c_source.html#l00070">spinlocks.c:70</a></div></div>
<div class="ttc" id="aspinlocks_8c_html_acce4c0c71b73531bf08e609e2b945015"><div class="ttname"><a href="spinlocks_8c.html#acce4c0c71b73531bf08e609e2b945015">lock_spinlock</a></div><div class="ttdeci">void lock_spinlock(int i, struct SpinLocks *spin)</div><div class="ttdef"><b>Definition:</b> <a href="spinlocks_8c_source.html#l00023">spinlocks.c:23</a></div></div>
<div class="ttc" id="aspinlocks_8c_html_ad80d4484f90fb93890f42054d0818447"><div class="ttname"><a href="spinlocks_8c.html#ad80d4484f90fb93890f42054d0818447">init_spinlocks</a></div><div class="ttdeci">struct SpinLocks * init_spinlocks(int NumLock)</div><div class="ttdef"><b>Definition:</b> <a href="spinlocks_8c_source.html#l00049">spinlocks.c:49</a></div></div>
<div class="ttc" id="aspinlocks_8c_html_aee13921a58d5a09edac1b36ff8c0f1d9"><div class="ttname"><a href="spinlocks_8c.html#aee13921a58d5a09edac1b36ff8c0f1d9">unlock_spinlock</a></div><div class="ttdeci">void unlock_spinlock(int i, struct SpinLocks *spin)</div><div class="ttdef"><b>Definition:</b> <a href="spinlocks_8c_source.html#l00030">spinlocks.c:30</a></div></div>
<div class="ttc" id="aspinlocks_8h_html"><div class="ttname"><a href="spinlocks_8h.html">spinlocks.h</a></div></div>
<div class="ttc" id="astring_8h_html"><div class="ttname"><a href="string_8h.html">string.h</a></div></div>
<div class="ttc" id="astructActiveParticles_html"><div class="ttname"><a href="structActiveParticles.html">ActiveParticles</a></div><div class="ttdef"><b>Definition:</b> <a href="timestep_8h_source.html#l00009">timestep.h:10</a></div></div>
<div class="ttc" id="astructActiveParticles_html_a1b0b230f3890d70bae976516719b7d07"><div class="ttname"><a href="structActiveParticles.html#a1b0b230f3890d70bae976516719b7d07">ActiveParticles::ActiveParticle</a></div><div class="ttdeci">int * ActiveParticle</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8h_source.html#l00013">timestep.h:13</a></div></div>
<div class="ttc" id="astructActiveParticles_html_a847ab898fdabc62a4723c7c3a66038d4"><div class="ttname"><a href="structActiveParticles.html#a847ab898fdabc62a4723c7c3a66038d4">ActiveParticles::NumActiveParticle</a></div><div class="ttdeci">int64_t NumActiveParticle</div><div class="ttdef"><b>Definition:</b> <a href="timestep_8h_source.html#l00012">timestep.h:12</a></div></div>
<div class="ttc" id="astructCosmology_html"><div class="ttname"><a href="structCosmology.html">Cosmology</a></div><div class="ttdef"><b>Definition:</b> <a href="cosmology_8h_source.html#l00008">cosmology.h:8</a></div></div>
<div class="ttc" id="astructCosmology_html_a4b79dcaa1e1c38d07258c3f539e2cb20"><div class="ttname"><a href="structCosmology.html#a4b79dcaa1e1c38d07258c3f539e2cb20">Cosmology::HubbleParam</a></div><div class="ttdeci">double HubbleParam</div><div class="ttdef"><b>Definition:</b> <a href="cosmology_8h_source.html#l00020">cosmology.h:20</a></div></div>
<div class="ttc" id="astructCosmology_html_ab98e5d1db0ac5adc89510264da3ab443"><div class="ttname"><a href="structCosmology.html#ab98e5d1db0ac5adc89510264da3ab443">Cosmology::UnitTime_in_s</a></div><div class="ttdeci">double UnitTime_in_s</div><div class="ttdef"><b>Definition:</b> <a href="cosmology_8h_source.html#l00022">cosmology.h:22</a></div></div>
<div class="ttc" id="astructDensityKernel_html"><div class="ttname"><a href="structDensityKernel.html">DensityKernel</a></div><div class="ttdef"><b>Definition:</b> <a href="densitykernel_8h_source.html#l00023">densitykernel.h:23</a></div></div>
<div class="ttc" id="astructDensityKernel_html_a96f937c0efd2485f2615419e3f28bab1"><div class="ttname"><a href="structDensityKernel.html#a96f937c0efd2485f2615419e3f28bab1">DensityKernel::Hinv</a></div><div class="ttdeci">double Hinv</div><div class="ttdef"><b>Definition:</b> <a href="densitykernel_8h_source.html#l00026">densitykernel.h:26</a></div></div>
<div class="ttc" id="astructDomainDecomp_html"><div class="ttname"><a href="structDomainDecomp.html">DomainDecomp</a></div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00033">domain.h:33</a></div></div>
<div class="ttc" id="astructForceTree_html"><div class="ttname"><a href="structForceTree.html">ForceTree</a></div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00076">forcetree.h:76</a></div></div>
<div class="ttc" id="astructForceTree_html_a8915a4ff849c9e97448ae30089a05966"><div class="ttname"><a href="structForceTree.html#a8915a4ff849c9e97448ae30089a05966">ForceTree::BoxSize</a></div><div class="ttdeci">double BoxSize</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00106">forcetree.h:106</a></div></div>
<div class="ttc" id="astructForceTree_html_abc4bf1553d516b1b9b9c672b0a371bb1"><div class="ttname"><a href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">ForceTree::Nodes</a></div><div class="ttdeci">struct NODE * Nodes</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00097">forcetree.h:97</a></div></div>
<div class="ttc" id="astructLocalTreeWalk_html"><div class="ttname"><a href="structLocalTreeWalk.html">LocalTreeWalk</a></div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00046">treewalk.h:46</a></div></div>
<div class="ttc" id="astructLocalTreeWalk_html_ae7a5a56205348bfd1bcd544e13c4b702"><div class="ttname"><a href="structLocalTreeWalk.html#ae7a5a56205348bfd1bcd544e13c4b702">LocalTreeWalk::tw</a></div><div class="ttdeci">TreeWalk * tw</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00047">treewalk.h:47</a></div></div>
<div class="ttc" id="astructMetalReturnPriv_html"><div class="ttname"><a href="structMetalReturnPriv.html">MetalReturnPriv</a></div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8h_source.html#l00026">metal_return.h:26</a></div></div>
<div class="ttc" id="astructMetalReturnPriv_html_a1eed6c8d1077ff30b6e6855984159721"><div class="ttname"><a href="structMetalReturnPriv.html#a1eed6c8d1077ff30b6e6855984159721">MetalReturnPriv::gsl_work</a></div><div class="ttdeci">gsl_integration_workspace ** gsl_work</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8h_source.html#l00027">metal_return.h:27</a></div></div>
<div class="ttc" id="astructMetalReturnPriv_html_a29789d7f689208055997dd8e0189704b"><div class="ttname"><a href="structMetalReturnPriv.html#a29789d7f689208055997dd8e0189704b">MetalReturnPriv::StarVolumeSPH</a></div><div class="ttdeci">MyFloat * StarVolumeSPH</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8h_source.html#l00037">metal_return.h:37</a></div></div>
<div class="ttc" id="astructMetalReturnPriv_html_a31658498bcfbc005e067dd1d7e3efc87"><div class="ttname"><a href="structMetalReturnPriv.html#a31658498bcfbc005e067dd1d7e3efc87">MetalReturnPriv::HighDyingMass</a></div><div class="ttdeci">MyFloat * HighDyingMass</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8h_source.html#l00031">metal_return.h:31</a></div></div>
<div class="ttc" id="astructMetalReturnPriv_html_a4426a0c820476888c4a431bc473ea5e0"><div class="ttname"><a href="structMetalReturnPriv.html#a4426a0c820476888c4a431bc473ea5e0">MetalReturnPriv::MaxGasMass</a></div><div class="ttdeci">double MaxGasMass</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8h_source.html#l00035">metal_return.h:35</a></div></div>
<div class="ttc" id="astructMetalReturnPriv_html_a4fc18b3395fd0b8c6c0c7a18ebbdf9c4"><div class="ttname"><a href="structMetalReturnPriv.html#a4fc18b3395fd0b8c6c0c7a18ebbdf9c4">MetalReturnPriv::StellarAges</a></div><div class="ttdeci">MyFloat * StellarAges</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8h_source.html#l00028">metal_return.h:28</a></div></div>
<div class="ttc" id="astructMetalReturnPriv_html_a82b1ced3037c6edbc251d8606638e0a3"><div class="ttname"><a href="structMetalReturnPriv.html#a82b1ced3037c6edbc251d8606638e0a3">MetalReturnPriv::imf_norm</a></div><div class="ttdeci">double imf_norm</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8h_source.html#l00032">metal_return.h:32</a></div></div>
<div class="ttc" id="astructMetalReturnPriv_html_ae3d5c753efbff8ad3bb8d344315b36d8"><div class="ttname"><a href="structMetalReturnPriv.html#ae3d5c753efbff8ad3bb8d344315b36d8">MetalReturnPriv::interp</a></div><div class="ttdeci">struct interps interp</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8h_source.html#l00037">metal_return.h:38</a></div></div>
<div class="ttc" id="astructMetalReturnPriv_html_af3232cc5f66e274ab87edc401e1cac20"><div class="ttname"><a href="structMetalReturnPriv.html#af3232cc5f66e274ab87edc401e1cac20">MetalReturnPriv::MassReturn</a></div><div class="ttdeci">MyFloat * MassReturn</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8h_source.html#l00029">metal_return.h:29</a></div></div>
<div class="ttc" id="astructMetalReturnPriv_html_af9acc610e067970d120fdece93b594cc"><div class="ttname"><a href="structMetalReturnPriv.html#af9acc610e067970d120fdece93b594cc">MetalReturnPriv::spin</a></div><div class="ttdeci">struct SpinLocks * spin</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8h_source.html#l00039">metal_return.h:39</a></div></div>
<div class="ttc" id="astructMetalReturnPriv_html_afbeb5062024e1f55af3c675c2feb6c78"><div class="ttname"><a href="structMetalReturnPriv.html#afbeb5062024e1f55af3c675c2feb6c78">MetalReturnPriv::LowDyingMass</a></div><div class="ttdeci">MyFloat * LowDyingMass</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8h_source.html#l00030">metal_return.h:30</a></div></div>
<div class="ttc" id="astructMetalReturnPriv_html_aff9a4d9cba76d657d12ef9e15e463979"><div class="ttname"><a href="structMetalReturnPriv.html#aff9a4d9cba76d657d12ef9e15e463979">MetalReturnPriv::hub</a></div><div class="ttdeci">double hub</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8h_source.html#l00033">metal_return.h:33</a></div></div>
<div class="ttc" id="astructNODE_html_ae6d6383dc0bc3e1660bbe700b77a85ab"><div class="ttname"><a href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">NODE::len</a></div><div class="ttdeci">MyFloat len</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00042">forcetree.h:42</a></div></div>
<div class="ttc" id="astructParameterSet_html"><div class="ttname"><a href="structParameterSet.html">ParameterSet</a></div><div class="ttdef"><b>Definition:</b> <a href="paramset_8c_source.html#l00095">paramset.c:95</a></div></div>
<div class="ttc" id="astructStellarDensityPriv_html"><div class="ttname"><a href="structStellarDensityPriv.html">StellarDensityPriv</a></div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00748">metal_return.c:748</a></div></div>
<div class="ttc" id="astructStellarDensityPriv_html_a1d7c9fe3b3ba37daed5404bb3029f0c1"><div class="ttname"><a href="structStellarDensityPriv.html#a1d7c9fe3b3ba37daed5404bb3029f0c1">StellarDensityPriv::Left</a></div><div class="ttdeci">MyFloat * Left</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00752">metal_return.c:752</a></div></div>
<div class="ttc" id="astructStellarDensityPriv_html_a498cdb1e038916f4d6df3bf51a1b26ea"><div class="ttname"><a href="structStellarDensityPriv.html#a498cdb1e038916f4d6df3bf51a1b26ea">StellarDensityPriv::maxcmpte</a></div><div class="ttdeci">int * maxcmpte</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00759">metal_return.c:759</a></div></div>
<div class="ttc" id="astructStellarDensityPriv_html_a683e5fa60875e852b78652cff9b5a013"><div class="ttname"><a href="structStellarDensityPriv.html#a683e5fa60875e852b78652cff9b5a013">StellarDensityPriv::NumNgb</a></div><div class="ttdeci">MyFloat(* NumNgb)[NHSML]</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00750">metal_return.c:750</a></div></div>
<div class="ttc" id="astructStellarDensityPriv_html_a8404dbc104ce789a069dd7b4e7316e59"><div class="ttname"><a href="structStellarDensityPriv.html#a8404dbc104ce789a069dd7b4e7316e59">StellarDensityPriv::MassReturn</a></div><div class="ttdeci">MyFloat * MassReturn</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00755">metal_return.c:755</a></div></div>
<div class="ttc" id="astructStellarDensityPriv_html_ab804b3e8b691d869c09d30266cdd304d"><div class="ttname"><a href="structStellarDensityPriv.html#ab804b3e8b691d869c09d30266cdd304d">StellarDensityPriv::VolumeSPH</a></div><div class="ttdeci">MyFloat(* VolumeSPH)[NHSML]</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00753">metal_return.c:753</a></div></div>
<div class="ttc" id="astructStellarDensityPriv_html_aed02a564276bbf7e8a623e3c71e6e04d"><div class="ttname"><a href="structStellarDensityPriv.html#aed02a564276bbf7e8a623e3c71e6e04d">StellarDensityPriv::Right</a></div><div class="ttdeci">MyFloat * Right</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00752">metal_return.c:752</a></div></div>
<div class="ttc" id="astructStellarDensityPriv_html_af197f57f37b4b2f938ffe3d09397105d"><div class="ttname"><a href="structStellarDensityPriv.html#af197f57f37b4b2f938ffe3d09397105d">StellarDensityPriv::DesNumNgb</a></div><div class="ttdeci">double DesNumNgb</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00757">metal_return.c:757</a></div></div>
<div class="ttc" id="astructTreeWalkNgbIterBase_html"><div class="ttname"><a href="structTreeWalkNgbIterBase.html">TreeWalkNgbIterBase</a></div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00036">treewalk.h:36</a></div></div>
<div class="ttc" id="astructTreeWalkNgbIterBase_html_a5b1a01a9a059a9429cf0e5cf92a4f53b"><div class="ttname"><a href="structTreeWalkNgbIterBase.html#a5b1a01a9a059a9429cf0e5cf92a4f53b">TreeWalkNgbIterBase::r</a></div><div class="ttdeci">double r</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00042">treewalk.h:42</a></div></div>
<div class="ttc" id="astructTreeWalkNgbIterBase_html_a633d0a0d40776a7dcef5c6915bda2c56"><div class="ttname"><a href="structTreeWalkNgbIterBase.html#a633d0a0d40776a7dcef5c6915bda2c56">TreeWalkNgbIterBase::Hsml</a></div><div class="ttdeci">double Hsml</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00039">treewalk.h:39</a></div></div>
<div class="ttc" id="astructTreeWalkNgbIterBase_html_a70a2cc004aede46d1407c89d0cbb4616"><div class="ttname"><a href="structTreeWalkNgbIterBase.html#a70a2cc004aede46d1407c89d0cbb4616">TreeWalkNgbIterBase::r2</a></div><div class="ttdeci">double r2</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00041">treewalk.h:41</a></div></div>
<div class="ttc" id="astructTreeWalkNgbIterBase_html_a887aa48798bdfb5a8cca30be18c9a849"><div class="ttname"><a href="structTreeWalkNgbIterBase.html#a887aa48798bdfb5a8cca30be18c9a849">TreeWalkNgbIterBase::mask</a></div><div class="ttdeci">int mask</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00038">treewalk.h:38</a></div></div>
<div class="ttc" id="astructTreeWalkNgbIterBase_html_ac75baa8cbd1cd6a47dbf9fb136c901d3"><div class="ttname"><a href="structTreeWalkNgbIterBase.html#ac75baa8cbd1cd6a47dbf9fb136c901d3">TreeWalkNgbIterBase::other</a></div><div class="ttdeci">int other</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00043">treewalk.h:43</a></div></div>
<div class="ttc" id="astructTreeWalkNgbIterBase_html_aebe92fe57ee45b4ada2f95717b7cf12b"><div class="ttname"><a href="structTreeWalkNgbIterBase.html#aebe92fe57ee45b4ada2f95717b7cf12b">TreeWalkNgbIterBase::symmetric</a></div><div class="ttdeci">enum NgbTreeFindSymmetric symmetric</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00027">treewalk.h:37</a></div></div>
<div class="ttc" id="astructTreeWalkNgbIterMetals_html"><div class="ttname"><a href="structTreeWalkNgbIterMetals.html">TreeWalkNgbIterMetals</a></div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00120">metal_return.c:120</a></div></div>
<div class="ttc" id="astructTreeWalkNgbIterMetals_html_a52b74d18ca74fbb1261f810e54446908"><div class="ttname"><a href="structTreeWalkNgbIterMetals.html#a52b74d18ca74fbb1261f810e54446908">TreeWalkNgbIterMetals::base</a></div><div class="ttdeci">TreeWalkNgbIterBase base</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00121">metal_return.c:121</a></div></div>
<div class="ttc" id="astructTreeWalkNgbIterMetals_html_ac06f9ef0841f91d7f368e12f55f1a8e4"><div class="ttname"><a href="structTreeWalkNgbIterMetals.html#ac06f9ef0841f91d7f368e12f55f1a8e4">TreeWalkNgbIterMetals::kernel</a></div><div class="ttdeci">DensityKernel kernel</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00122">metal_return.c:122</a></div></div>
<div class="ttc" id="astructTreeWalkNgbIterStellarDensity_html"><div class="ttname"><a href="structTreeWalkNgbIterStellarDensity.html">TreeWalkNgbIterStellarDensity</a></div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00728">metal_return.c:728</a></div></div>
<div class="ttc" id="astructTreeWalkNgbIterStellarDensity_html_a5d8e37bccf7760b674a7549d926ba8ed"><div class="ttname"><a href="structTreeWalkNgbIterStellarDensity.html#a5d8e37bccf7760b674a7549d926ba8ed">TreeWalkNgbIterStellarDensity::kernel</a></div><div class="ttdeci">DensityKernel kernel[NHSML]</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00730">metal_return.c:730</a></div></div>
<div class="ttc" id="astructTreeWalkNgbIterStellarDensity_html_a8639b6bc60a4239db085aa98521f77eb"><div class="ttname"><a href="structTreeWalkNgbIterStellarDensity.html#a8639b6bc60a4239db085aa98521f77eb">TreeWalkNgbIterStellarDensity::base</a></div><div class="ttdeci">TreeWalkNgbIterBase base</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00729">metal_return.c:729</a></div></div>
<div class="ttc" id="astructTreeWalkNgbIterStellarDensity_html_a9b8101ee80abef3f6a2290cd0878e602"><div class="ttname"><a href="structTreeWalkNgbIterStellarDensity.html#a9b8101ee80abef3f6a2290cd0878e602">TreeWalkNgbIterStellarDensity::kernel_volume</a></div><div class="ttdeci">double kernel_volume[NHSML]</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00731">metal_return.c:731</a></div></div>
<div class="ttc" id="astructTreeWalkQueryBase_html"><div class="ttname"><a href="structTreeWalkQueryBase.html">TreeWalkQueryBase</a></div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00022">treewalk.h:22</a></div></div>
<div class="ttc" id="astructTreeWalkQueryMetals_html"><div class="ttname"><a href="structTreeWalkQueryMetals.html">TreeWalkQueryMetals</a></div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00101">metal_return.c:101</a></div></div>
<div class="ttc" id="astructTreeWalkQueryMetals_html_a3291b51ca793d21c8e66c15794c3f4cf"><div class="ttname"><a href="structTreeWalkQueryMetals.html#a3291b51ca793d21c8e66c15794c3f4cf">TreeWalkQueryMetals::StarVolumeSPH</a></div><div class="ttdeci">MyFloat StarVolumeSPH</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00106">metal_return.c:106</a></div></div>
<div class="ttc" id="astructTreeWalkQueryMetals_html_a699dbc8bcfebe93b75880a81975efcf9"><div class="ttname"><a href="structTreeWalkQueryMetals.html#a699dbc8bcfebe93b75880a81975efcf9">TreeWalkQueryMetals::Metallicity</a></div><div class="ttdeci">MyFloat Metallicity</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00103">metal_return.c:103</a></div></div>
<div class="ttc" id="astructTreeWalkQueryMetals_html_a69fe57f92a03ddb696eb1c764f1112f7"><div class="ttname"><a href="structTreeWalkQueryMetals.html#a69fe57f92a03ddb696eb1c764f1112f7">TreeWalkQueryMetals::MassGenerated</a></div><div class="ttdeci">MyFloat MassGenerated</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00109">metal_return.c:109</a></div></div>
<div class="ttc" id="astructTreeWalkQueryMetals_html_aa91b40c5bbb212dac30473b5992f5304"><div class="ttname"><a href="structTreeWalkQueryMetals.html#aa91b40c5bbb212dac30473b5992f5304">TreeWalkQueryMetals::Hsml</a></div><div class="ttdeci">MyFloat Hsml</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00105">metal_return.c:105</a></div></div>
<div class="ttc" id="astructTreeWalkQueryMetals_html_aac20c5f1b2c23b44ee3f02a65d305a83"><div class="ttname"><a href="structTreeWalkQueryMetals.html#aac20c5f1b2c23b44ee3f02a65d305a83">TreeWalkQueryMetals::base</a></div><div class="ttdeci">TreeWalkQueryBase base</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00102">metal_return.c:102</a></div></div>
<div class="ttc" id="astructTreeWalkQueryMetals_html_ac1c17d61b3d06092002ee77b60e8083e"><div class="ttname"><a href="structTreeWalkQueryMetals.html#ac1c17d61b3d06092002ee77b60e8083e">TreeWalkQueryMetals::MetalGenerated</a></div><div class="ttdeci">MyFloat MetalGenerated</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00110">metal_return.c:110</a></div></div>
<div class="ttc" id="astructTreeWalkQueryMetals_html_ae2f34af218c3ab39c9825bbae4314640"><div class="ttname"><a href="structTreeWalkQueryMetals.html#ae2f34af218c3ab39c9825bbae4314640">TreeWalkQueryMetals::MetalSpeciesGenerated</a></div><div class="ttdeci">MyFloat MetalSpeciesGenerated[NMETALS]</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00108">metal_return.c:108</a></div></div>
<div class="ttc" id="astructTreeWalkQueryMetals_html_aee2bc2e2c1f19d81d0111b351934de22"><div class="ttname"><a href="structTreeWalkQueryMetals.html#aee2bc2e2c1f19d81d0111b351934de22">TreeWalkQueryMetals::Mass</a></div><div class="ttdeci">MyFloat Mass</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00104">metal_return.c:104</a></div></div>
<div class="ttc" id="astructTreeWalkQueryStellarDensity_html"><div class="ttname"><a href="structTreeWalkQueryStellarDensity.html">TreeWalkQueryStellarDensity</a></div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00734">metal_return.c:735</a></div></div>
<div class="ttc" id="astructTreeWalkQueryStellarDensity_html_aa05abbe9f3ef6128ba71a3612226850a"><div class="ttname"><a href="structTreeWalkQueryStellarDensity.html#aa05abbe9f3ef6128ba71a3612226850a">TreeWalkQueryStellarDensity::Hsml</a></div><div class="ttdeci">MyFloat Hsml[NHSML]</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00737">metal_return.c:737</a></div></div>
<div class="ttc" id="astructTreeWalkQueryStellarDensity_html_ac2b1f816345b648baff6d826c9f0ce5d"><div class="ttname"><a href="structTreeWalkQueryStellarDensity.html#ac2b1f816345b648baff6d826c9f0ce5d">TreeWalkQueryStellarDensity::base</a></div><div class="ttdeci">TreeWalkQueryBase base</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00736">metal_return.c:736</a></div></div>
<div class="ttc" id="astructTreeWalkResultBase_html"><div class="ttname"><a href="structTreeWalkResultBase.html">TreeWalkResultBase</a></div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00030">treewalk.h:30</a></div></div>
<div class="ttc" id="astructTreeWalkResultMetals_html"><div class="ttname"><a href="structTreeWalkResultMetals.html">TreeWalkResultMetals</a></div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00113">metal_return.c:113</a></div></div>
<div class="ttc" id="astructTreeWalkResultMetals_html_a48ce1e01704b4b1f21cf597332a1e1bf"><div class="ttname"><a href="structTreeWalkResultMetals.html#a48ce1e01704b4b1f21cf597332a1e1bf">TreeWalkResultMetals::MassReturn</a></div><div class="ttdeci">MyFloat MassReturn</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00117">metal_return.c:117</a></div></div>
<div class="ttc" id="astructTreeWalkResultMetals_html_aa3893094b5af28cc33b475fb83ed7d38"><div class="ttname"><a href="structTreeWalkResultMetals.html#aa3893094b5af28cc33b475fb83ed7d38">TreeWalkResultMetals::base</a></div><div class="ttdeci">TreeWalkResultBase base</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00114">metal_return.c:114</a></div></div>
<div class="ttc" id="astructTreeWalkResultStellarDensity_html"><div class="ttname"><a href="structTreeWalkResultStellarDensity.html">TreeWalkResultStellarDensity</a></div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00740">metal_return.c:740</a></div></div>
<div class="ttc" id="astructTreeWalkResultStellarDensity_html_a384fd7ffbb15a481f1294f12be6e8c85"><div class="ttname"><a href="structTreeWalkResultStellarDensity.html#a384fd7ffbb15a481f1294f12be6e8c85">TreeWalkResultStellarDensity::VolumeSPH</a></div><div class="ttdeci">MyFloat VolumeSPH[NHSML]</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00742">metal_return.c:742</a></div></div>
<div class="ttc" id="astructTreeWalkResultStellarDensity_html_a5ba246c9312537814342cdb54dc40d9a"><div class="ttname"><a href="structTreeWalkResultStellarDensity.html#a5ba246c9312537814342cdb54dc40d9a">TreeWalkResultStellarDensity::maxcmpte</a></div><div class="ttdeci">int maxcmpte</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00744">metal_return.c:744</a></div></div>
<div class="ttc" id="astructTreeWalkResultStellarDensity_html_a6e72dacdb8df9b9a4bc19339df51509f"><div class="ttname"><a href="structTreeWalkResultStellarDensity.html#a6e72dacdb8df9b9a4bc19339df51509f">TreeWalkResultStellarDensity::_alignment</a></div><div class="ttdeci">int _alignment</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00745">metal_return.c:745</a></div></div>
<div class="ttc" id="astructTreeWalkResultStellarDensity_html_a8761c51be809fbb114048cfbd935f375"><div class="ttname"><a href="structTreeWalkResultStellarDensity.html#a8761c51be809fbb114048cfbd935f375">TreeWalkResultStellarDensity::base</a></div><div class="ttdeci">TreeWalkResultBase base</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00741">metal_return.c:741</a></div></div>
<div class="ttc" id="astructTreeWalkResultStellarDensity_html_ae6f6d6a3fda395d7b40687862fc66e9b"><div class="ttname"><a href="structTreeWalkResultStellarDensity.html#ae6f6d6a3fda395d7b40687862fc66e9b">TreeWalkResultStellarDensity::Ngb</a></div><div class="ttdeci">MyFloat Ngb[NHSML]</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00743">metal_return.c:743</a></div></div>
<div class="ttc" id="astructTreeWalk_html"><div class="ttname"><a href="structTreeWalk.html">TreeWalk</a></div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00084">treewalk.h:84</a></div></div>
<div class="ttc" id="astructTreeWalk_html_a1d722afccb3091cb1697eaa973936f27"><div class="ttname"><a href="structTreeWalk.html#a1d722afccb3091cb1697eaa973936f27">TreeWalk::Niteration</a></div><div class="ttdeci">int64_t Niteration</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00142">treewalk.h:142</a></div></div>
<div class="ttc" id="astructTreeWalk_html_a1e7b97376d0c5242e5195e7173ab8ed8"><div class="ttname"><a href="structTreeWalk.html#a1e7b97376d0c5242e5195e7173ab8ed8">TreeWalk::minnumngb</a></div><div class="ttdeci">double * minnumngb</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00172">treewalk.h:172</a></div></div>
<div class="ttc" id="astructTreeWalk_html_a2ae51082ebb6332e558024b6a45506b2"><div class="ttname"><a href="structTreeWalk.html#a2ae51082ebb6332e558024b6a45506b2">TreeWalk::priv</a></div><div class="ttdeci">void * priv</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00085">treewalk.h:85</a></div></div>
<div class="ttc" id="astructTreeWalk_html_a2f6bc842f407a44d99de52e9b5140454"><div class="ttname"><a href="structTreeWalk.html#a2f6bc842f407a44d99de52e9b5140454">TreeWalk::haswork</a></div><div class="ttdeci">TreeWalkHasWorkFunction haswork</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00100">treewalk.h:100</a></div></div>
<div class="ttc" id="astructTreeWalk_html_a36bf2eb0e0d65ace233ef30335e04659"><div class="ttname"><a href="structTreeWalk.html#a36bf2eb0e0d65ace233ef30335e04659">TreeWalk::ngbiter_type_elsize</a></div><div class="ttdeci">size_t ngbiter_type_elsize</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00097">treewalk.h:97</a></div></div>
<div class="ttc" id="astructTreeWalk_html_a6518c361d396be49a9d1c676d8769802"><div class="ttname"><a href="structTreeWalk.html#a6518c361d396be49a9d1c676d8769802">TreeWalk::timecomp2</a></div><div class="ttdeci">double timecomp2</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00124">treewalk.h:124</a></div></div>
<div class="ttc" id="astructTreeWalk_html_a6fa5eb5767f35c98b86b396ae112482a"><div class="ttname"><a href="structTreeWalk.html#a6fa5eb5767f35c98b86b396ae112482a">TreeWalk::maxnumngb</a></div><div class="ttdeci">double * maxnumngb</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00171">treewalk.h:171</a></div></div>
<div class="ttc" id="astructTreeWalk_html_a714d0465e0498a5a8d0b698d37348ce6"><div class="ttname"><a href="structTreeWalk.html#a714d0465e0498a5a8d0b698d37348ce6">TreeWalk::timecomp3</a></div><div class="ttdeci">double timecomp3</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00125">treewalk.h:125</a></div></div>
<div class="ttc" id="astructTreeWalk_html_a73d26f9b05f007c46bddb25f39f6bbf5"><div class="ttname"><a href="structTreeWalk.html#a73d26f9b05f007c46bddb25f39f6bbf5">TreeWalk::NPRedo</a></div><div class="ttdeci">int ** NPRedo</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00168">treewalk.h:168</a></div></div>
<div class="ttc" id="astructTreeWalk_html_a80f3ba2d463ce192ccb0f42eed264f56"><div class="ttname"><a href="structTreeWalk.html#a80f3ba2d463ce192ccb0f42eed264f56">TreeWalk::timecommsumm1</a></div><div class="ttdeci">double timecommsumm1</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00126">treewalk.h:126</a></div></div>
<div class="ttc" id="astructTreeWalk_html_a8525705e365e7c07027f372b66aff149"><div class="ttname"><a href="structTreeWalk.html#a8525705e365e7c07027f372b66aff149">TreeWalk::tree</a></div><div class="ttdeci">const ForceTree * tree</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00088">treewalk.h:88</a></div></div>
<div class="ttc" id="astructTreeWalk_html_a8c4dcda60d680c3d56423fca8647472f"><div class="ttname"><a href="structTreeWalk.html#a8c4dcda60d680c3d56423fca8647472f">TreeWalk::postprocess</a></div><div class="ttdeci">TreeWalkProcessFunction postprocess</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00104">treewalk.h:104</a></div></div>
<div class="ttc" id="astructTreeWalk_html_a96381f9f61cf2c56dac48927cd997ec3"><div class="ttname"><a href="structTreeWalk.html#a96381f9f61cf2c56dac48927cd997ec3">TreeWalk::ngbiter</a></div><div class="ttdeci">TreeWalkNgbIterFunction ngbiter</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00103">treewalk.h:103</a></div></div>
<div class="ttc" id="astructTreeWalk_html_aa08a0586a68d1f4f87e0caa1e59dcc5e"><div class="ttname"><a href="structTreeWalk.html#aa08a0586a68d1f4f87e0caa1e59dcc5e">TreeWalk::reduce</a></div><div class="ttdeci">TreeWalkReduceResultFunction reduce</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00102">treewalk.h:102</a></div></div>
<div class="ttc" id="astructTreeWalk_html_aa3ff3d4a5a82422609ac154aa4a461ea"><div class="ttname"><a href="structTreeWalk.html#aa3ff3d4a5a82422609ac154aa4a461ea">TreeWalk::ev_label</a></div><div class="ttdeci">const char * ev_label</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00091">treewalk.h:91</a></div></div>
<div class="ttc" id="astructTreeWalk_html_aacf67d9ea224563ae4006114d97e473c"><div class="ttname"><a href="structTreeWalk.html#aacf67d9ea224563ae4006114d97e473c">TreeWalk::timewait2</a></div><div class="ttdeci">double timewait2</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00122">treewalk.h:122</a></div></div>
<div class="ttc" id="astructTreeWalk_html_aafe4f27abb67d3959e711ef6787c9b75"><div class="ttname"><a href="structTreeWalk.html#aafe4f27abb67d3959e711ef6787c9b75">TreeWalk::NoNgblist</a></div><div class="ttdeci">int NoNgblist</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00156">treewalk.h:156</a></div></div>
<div class="ttc" id="astructTreeWalk_html_ab4e96e67f2e72ac33dca9dd06cdac6c0"><div class="ttname"><a href="structTreeWalk.html#ab4e96e67f2e72ac33dca9dd06cdac6c0">TreeWalk::visit</a></div><div class="ttdeci">TreeWalkVisitFunction visit</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00099">treewalk.h:99</a></div></div>
<div class="ttc" id="astructTreeWalk_html_ab8c7809c8d29e0326dbdde88e8fa5dfb"><div class="ttname"><a href="structTreeWalk.html#ab8c7809c8d29e0326dbdde88e8fa5dfb">TreeWalk::repeatdisallowed</a></div><div class="ttdeci">int repeatdisallowed</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00117">treewalk.h:117</a></div></div>
<div class="ttc" id="astructTreeWalk_html_ac8c67faaf2c360ed510c4508f11f7c2d"><div class="ttname"><a href="structTreeWalk.html#ac8c67faaf2c360ed510c4508f11f7c2d">TreeWalk::result_type_elsize</a></div><div class="ttdeci">size_t result_type_elsize</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00096">treewalk.h:96</a></div></div>
<div class="ttc" id="astructTreeWalk_html_ad0b91dafd46de132917e7993869514c5"><div class="ttname"><a href="structTreeWalk.html#ad0b91dafd46de132917e7993869514c5">TreeWalk::fill</a></div><div class="ttdeci">TreeWalkFillQueryFunction fill</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00101">treewalk.h:101</a></div></div>
<div class="ttc" id="astructTreeWalk_html_ad9b63d13efa217c89748031b224f2346"><div class="ttname"><a href="structTreeWalk.html#ad9b63d13efa217c89748031b224f2346">TreeWalk::NPLeft</a></div><div class="ttdeci">size_t * NPLeft</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00167">treewalk.h:167</a></div></div>
<div class="ttc" id="astructTreeWalk_html_ada69256fab1ba3b0e5ff0f837f749b2e"><div class="ttname"><a href="structTreeWalk.html#ada69256fab1ba3b0e5ff0f837f749b2e">TreeWalk::timecomp1</a></div><div class="ttdeci">double timecomp1</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00123">treewalk.h:123</a></div></div>
<div class="ttc" id="astructTreeWalk_html_ae62aa594cbe693d40de9334cc0f7c820"><div class="ttname"><a href="structTreeWalk.html#ae62aa594cbe693d40de9334cc0f7c820">TreeWalk::timewait1</a></div><div class="ttdeci">double timewait1</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00121">treewalk.h:121</a></div></div>
<div class="ttc" id="astructTreeWalk_html_ae663d6653b464f02c95c57ae4a5bdd3a"><div class="ttname"><a href="structTreeWalk.html#ae663d6653b464f02c95c57ae4a5bdd3a">TreeWalk::timecommsumm2</a></div><div class="ttdeci">double timecommsumm2</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00127">treewalk.h:127</a></div></div>
<div class="ttc" id="astructTreeWalk_html_affd5eae4b5a63dcce236ac15b00b4c7c"><div class="ttname"><a href="structTreeWalk.html#affd5eae4b5a63dcce236ac15b00b4c7c">TreeWalk::query_type_elsize</a></div><div class="ttdeci">size_t query_type_elsize</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00095">treewalk.h:95</a></div></div>
<div class="ttc" id="astructimf__integ__params_html"><div class="ttname"><a href="structimf__integ__params.html">imf_integ_params</a></div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00279">metal_return.c:280</a></div></div>
<div class="ttc" id="astructimf__integ__params_html_a2d69b6d46483a514c2052fc71b2269ee"><div class="ttname"><a href="structimf__integ__params.html#a2d69b6d46483a514c2052fc71b2269ee">imf_integ_params::metallicities</a></div><div class="ttdeci">const double * metallicities</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00283">metal_return.c:283</a></div></div>
<div class="ttc" id="astructimf__integ__params_html_a567ac849e47171ae06a1ee0673827c0b"><div class="ttname"><a href="structimf__integ__params.html#a567ac849e47171ae06a1ee0673827c0b">imf_integ_params::weights</a></div><div class="ttdeci">const double * weights</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00284">metal_return.c:284</a></div></div>
<div class="ttc" id="astructimf__integ__params_html_a5ef3b84941e9bc50d589e35e707928c0"><div class="ttname"><a href="structimf__integ__params.html#a5ef3b84941e9bc50d589e35e707928c0">imf_integ_params::metallicity</a></div><div class="ttdeci">double metallicity</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00285">metal_return.c:285</a></div></div>
<div class="ttc" id="astructimf__integ__params_html_a6c90d1dcd404c55457d367d3ed7e46a4"><div class="ttname"><a href="structimf__integ__params.html#a6c90d1dcd404c55457d367d3ed7e46a4">imf_integ_params::interp</a></div><div class="ttdeci">gsl_interp2d * interp</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00281">metal_return.c:281</a></div></div>
<div class="ttc" id="astructimf__integ__params_html_acf3d030be4acb640012feded96d40a98"><div class="ttname"><a href="structimf__integ__params.html#acf3d030be4acb640012feded96d40a98">imf_integ_params::masses</a></div><div class="ttdeci">const double * masses</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00282">metal_return.c:282</a></div></div>
<div class="ttc" id="astructinterps_html"><div class="ttname"><a href="structinterps.html">interps</a></div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8h_source.html#l00011">metal_return.h:12</a></div></div>
<div class="ttc" id="astructinterps_html_ae60754dbad58a2b88fdb0db52dab97d0"><div class="ttname"><a href="structinterps.html#ae60754dbad58a2b88fdb0db52dab97d0">interps::lifetime_interp</a></div><div class="ttdeci">gsl_interp2d * lifetime_interp</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8h_source.html#l00013">metal_return.h:13</a></div></div>
<div class="ttc" id="astructmassbin__find__params_html"><div class="ttname"><a href="structmassbin__find__params.html">massbin_find_params</a></div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00173">metal_return.c:174</a></div></div>
<div class="ttc" id="astructmassbin__find__params_html_a2f353f39cf295dc80c1381664765e516"><div class="ttname"><a href="structmassbin__find__params.html#a2f353f39cf295dc80c1381664765e516">massbin_find_params::massacc</a></div><div class="ttdeci">gsl_interp_accel * massacc</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00179">metal_return.c:179</a></div></div>
<div class="ttc" id="astructmassbin__find__params_html_a3c735a960604b54b091f8eab1262abbe"><div class="ttname"><a href="structmassbin__find__params.html#a3c735a960604b54b091f8eab1262abbe">massbin_find_params::stellarmetal</a></div><div class="ttdeci">double stellarmetal</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00176">metal_return.c:176</a></div></div>
<div class="ttc" id="astructmassbin__find__params_html_a476105a6b9c3b8bfe42884c31cb95158"><div class="ttname"><a href="structmassbin__find__params.html#a476105a6b9c3b8bfe42884c31cb95158">massbin_find_params::metalacc</a></div><div class="ttdeci">gsl_interp_accel * metalacc</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00178">metal_return.c:178</a></div></div>
<div class="ttc" id="astructmassbin__find__params_html_a990fdfe9437ba5302bf0dce9f1a27e7d"><div class="ttname"><a href="structmassbin__find__params.html#a990fdfe9437ba5302bf0dce9f1a27e7d">massbin_find_params::lifetime_tables</a></div><div class="ttdeci">gsl_interp2d * lifetime_tables</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00177">metal_return.c:177</a></div></div>
<div class="ttc" id="astructmassbin__find__params_html_accf1b9447dc260087635a3fc03d7b3f9"><div class="ttname"><a href="structmassbin__find__params.html#accf1b9447dc260087635a3fc03d7b3f9">massbin_find_params::dtfind</a></div><div class="ttdeci">double dtfind</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00175">metal_return.c:175</a></div></div>
<div class="ttc" id="astructmetal__return__params_html"><div class="ttname"><a href="structmetal__return__params.html">metal_return_params</a></div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00047">metal_return.c:48</a></div></div>
<div class="ttc" id="astructmetal__return__params_html_a58452735fac8130955037b96e1c5c0ea"><div class="ttname"><a href="structmetal__return__params.html#a58452735fac8130955037b96e1c5c0ea">metal_return_params::SPHWeighting</a></div><div class="ttdeci">int SPHWeighting</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00050">metal_return.c:50</a></div></div>
<div class="ttc" id="astructmetal__return__params_html_a98d41f7181e04a04139a160eaf7a0236"><div class="ttname"><a href="structmetal__return__params.html#a98d41f7181e04a04139a160eaf7a0236">metal_return_params::MaxNgbDeviation</a></div><div class="ttdeci">double MaxNgbDeviation</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00051">metal_return.c:51</a></div></div>
<div class="ttc" id="astructmetal__return__params_html_aab6341aebf537227479a3df11c2a1339"><div class="ttname"><a href="structmetal__return__params.html#aab6341aebf537227479a3df11c2a1339">metal_return_params::Sn1aN0</a></div><div class="ttdeci">double Sn1aN0</div><div class="ttdef"><b>Definition:</b> <a href="metal__return_8c_source.html#l00049">metal_return.c:49</a></div></div>
<div class="ttc" id="astructpart__manager__type_html_a45e1f95715be50e4081af78f4ee99cb5"><div class="ttname"><a href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">part_manager_type::NumPart</a></div><div class="ttdeci">int64_t NumPart</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00076">partmanager.h:76</a></div></div>
<div class="ttc" id="astructslot__info_html_aa651c4c7d01687a0b313076c0266465f"><div class="ttname"><a href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">slot_info::size</a></div><div class="ttdeci">int64_t size</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00012">slotsmanager.h:12</a></div></div>
<div class="ttc" id="astructslots__manager__type_html_a2b662d46902bf6fffca8b3fa2534a4e4"><div class="ttname"><a href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">slots_manager_type::info</a></div><div class="ttdeci">struct slot_info info[6]</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00108">slotsmanager.h:112</a></div></div>
<div class="ttc" id="asystem_8h_html_abb95c0be39c73f8e6b0978a9a374d92b"><div class="ttname"><a href="system_8h.html#abb95c0be39c73f8e6b0978a9a374d92b">MPI_INT64</a></div><div class="ttdeci">#define MPI_INT64</div><div class="ttdef"><b>Definition:</b> <a href="system_8h_source.html#l00012">system.h:12</a></div></div>
<div class="ttc" id="atest__exchange_8c_html_a52c8c7d2abff436111942e02c5bb466a"><div class="ttname"><a href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a></div><div class="ttdeci">int ThisTask</div><div class="ttdef"><b>Definition:</b> <a href="test__exchange_8c_source.html#l00023">test_exchange.c:23</a></div></div>
<div class="ttc" id="atreewalk_8c_html_a145aa9608fd3824bec8049ee97da1c6f"><div class="ttname"><a href="treewalk_8c.html#a145aa9608fd3824bec8049ee97da1c6f">treewalk_visit_ngbiter</a></div><div class="ttdeci">int treewalk_visit_ngbiter(TreeWalkQueryBase *I, TreeWalkResultBase *O, LocalTreeWalk *lv)</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8c_source.html#l00924">treewalk.c:924</a></div></div>
<div class="ttc" id="atreewalk_8c_html_a1878fddf49185074fd570a46f3eea372"><div class="ttname"><a href="treewalk_8c.html#a1878fddf49185074fd570a46f3eea372">treewalk_visit_nolist_ngbiter</a></div><div class="ttdeci">int treewalk_visit_nolist_ngbiter(TreeWalkQueryBase *I, TreeWalkResultBase *O, LocalTreeWalk *lv)</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8c_source.html#l01143">treewalk.c:1143</a></div></div>
<div class="ttc" id="atreewalk_8c_html_a1e336844d7f92d15cd9248c81ecfb453"><div class="ttname"><a href="treewalk_8c.html#a1e336844d7f92d15cd9248c81ecfb453">treewalk_run</a></div><div class="ttdeci">void treewalk_run(TreeWalk *tw, int *active_set, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8c_source.html#l00619">treewalk.c:619</a></div></div>
<div class="ttc" id="atreewalk_8c_html_a510761e6aead0135964f0f9b18a4f8e7"><div class="ttname"><a href="treewalk_8c.html#a510761e6aead0135964f0f9b18a4f8e7">ngb_narrow_down</a></div><div class="ttdeci">double ngb_narrow_down(double *right, double *left, const double *radius, const double *numNgb, int maxcmpt, int desnumngb, int *closeidx, double BoxSize)</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8c_source.html#l01366">treewalk.c:1366</a></div></div>
<div class="ttc" id="atreewalk_8c_html_a72643adf5c7952933b8f5fbb27d45a97"><div class="ttname"><a href="treewalk_8c.html#a72643adf5c7952933b8f5fbb27d45a97">treewalk_do_hsml_loop</a></div><div class="ttdeci">void treewalk_do_hsml_loop(TreeWalk *tw, int *queue, int64_t queuesize, int update_hsml)</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8c_source.html#l01254">treewalk.c:1254</a></div></div>
<div class="ttc" id="atreewalk_8h_html"><div class="ttname"><a href="treewalk_8h.html">treewalk.h</a></div></div>
<div class="ttc" id="atreewalk_8h_html_a01b18ab132aa3a45e2f2bed8aef94633"><div class="ttname"><a href="treewalk_8h.html#a01b18ab132aa3a45e2f2bed8aef94633">TreeWalkVisitFunction</a></div><div class="ttdeci">int(* TreeWalkVisitFunction)(TreeWalkQueryBase *input, TreeWalkResultBase *output, LocalTreeWalk *lv)</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00068">treewalk.h:68</a></div></div>
<div class="ttc" id="atreewalk_8h_html_a2b5a07b25001ac6e9e628d4eb0493b8c"><div class="ttname"><a href="treewalk_8h.html#a2b5a07b25001ac6e9e628d4eb0493b8c">TreeWalkReduceResultFunction</a></div><div class="ttdeci">void(* TreeWalkReduceResultFunction)(const int j, TreeWalkResultBase *result, const enum TreeWalkReduceMode mode, TreeWalk *tw)</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00076">treewalk.h:76</a></div></div>
<div class="ttc" id="atreewalk_8h_html_a504d8280eaa376504899398c68577cef"><div class="ttname"><a href="treewalk_8h.html#a504d8280eaa376504899398c68577cef">TreeWalkReduceMode</a></div><div class="ttdeci">TreeWalkReduceMode</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00015">treewalk.h:15</a></div></div>
<div class="ttc" id="atreewalk_8h_html_a80f59f147efe7c27b601024d819769db"><div class="ttname"><a href="treewalk_8h.html#a80f59f147efe7c27b601024d819769db">TreeWalkProcessFunction</a></div><div class="ttdeci">void(* TreeWalkProcessFunction)(const int i, TreeWalk *tw)</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00073">treewalk.h:73</a></div></div>
<div class="ttc" id="atreewalk_8h_html_aade20e4cc34b64ecf3bd6f5525465371"><div class="ttname"><a href="treewalk_8h.html#aade20e4cc34b64ecf3bd6f5525465371">TreeWalkNgbIterFunction</a></div><div class="ttdeci">void(* TreeWalkNgbIterFunction)(TreeWalkQueryBase *input, TreeWalkResultBase *output, TreeWalkNgbIterBase *iter, LocalTreeWalk *lv)</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00070">treewalk.h:70</a></div></div>
<div class="ttc" id="atreewalk_8h_html_ac9a8ade7817c58b83859399364deb1a1"><div class="ttname"><a href="treewalk_8h.html#ac9a8ade7817c58b83859399364deb1a1">TreeWalkFillQueryFunction</a></div><div class="ttdeci">void(* TreeWalkFillQueryFunction)(const int j, TreeWalkQueryBase *query, TreeWalk *tw)</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00075">treewalk.h:75</a></div></div>
<div class="ttc" id="atreewalk_8h_html_adec418ab95919d7f9c11dbea86c32a0f"><div class="ttname"><a href="treewalk_8h.html#adec418ab95919d7f9c11dbea86c32a0f">TREEWALK_REDUCE</a></div><div class="ttdeci">#define TREEWALK_REDUCE(A, B)</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00189">treewalk.h:189</a></div></div>
<div class="ttc" id="atreewalk_8h_html_ae8d78c0b33a7736c7e75739976002dbda3b05fa287fdb7661dbb081cd20c00eb5"><div class="ttname"><a href="treewalk_8h.html#ae8d78c0b33a7736c7e75739976002dbda3b05fa287fdb7661dbb081cd20c00eb5">NGB_TREEFIND_ASYMMETRIC</a></div><div class="ttdeci">@ NGB_TREEFIND_ASYMMETRIC</div><div class="ttdef"><b>Definition:</b> <a href="treewalk_8h_source.html#l00012">treewalk.h:12</a></div></div>
<div class="ttc" id="atypes_8h_html_af1ada7381a1118c6d51bdbb0b5e72811"><div class="ttname"><a href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a></div><div class="ttdeci">LOW_PRECISION MyFloat</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00019">types.h:19</a></div></div>
<div class="ttc" id="awalltime_8h_html"><div class="ttname"><a href="walltime_8h.html">walltime.h</a></div></div>
<div class="ttc" id="awalltime_8h_html_a2d23071e44d020b4a0b3f2876667d370"><div class="ttname"><a href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a></div><div class="ttdeci">#define walltime_measure(name)</div><div class="ttdef"><b>Definition:</b> <a href="walltime_8h_source.html#l00008">walltime.h:8</a></div></div>
<div class="ttc" id="awalltime_8h_html_a5cedff8706bf3a249bd5e3c365b67964"><div class="ttname"><a href="walltime_8h.html#a5cedff8706bf3a249bd5e3c365b67964">WALLTIME_IGNORE</a></div><div class="ttdeci">#define WALLTIME_IGNORE</div><div class="ttdef"><b>Definition:</b> <a href="walltime_8h_source.html#l00006">walltime.h:6</a></div></div>
<div class="ttc" id="awalltime_8h_html_a9266fc830d2aac1ad7d6e5322be6f489"><div class="ttname"><a href="walltime_8h.html#a9266fc830d2aac1ad7d6e5322be6f489">walltime_add</a></div><div class="ttdeci">#define walltime_add(name, dt)</div><div class="ttdef"><b>Definition:</b> <a href="walltime_8h_source.html#l00009">walltime.h:9</a></div></div>
<div class="ttc" id="awinds_8h_html"><div class="ttname"><a href="winds_8h.html">winds.h</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
