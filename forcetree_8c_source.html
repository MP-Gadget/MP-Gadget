<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MP-Gadget: libgadget/forcetree.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MP-Gadget
   &#160;<span id="projectnumber">5.0.1.dev1-76bc7d4726-dirty</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_8db5bc7a24c620673ff2e44953ca6f6c.html">libgadget</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">forcetree.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="forcetree_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;mpi.h&gt;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="string_8h.html">string.h</a>&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;omp.h&gt;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160; </div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="slotsmanager_8h.html">slotsmanager.h</a>&quot;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="partmanager_8h.html">partmanager.h</a>&quot;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="domain_8h.html">domain.h</a>&quot;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="forcetree_8h.html">forcetree.h</a>&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="checkpoint_8h.html">checkpoint.h</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="walltime_8h.html">walltime.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="endrun_8h.html">utils/endrun.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="structforcetree__params.html">   31</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structforcetree__params.html">forcetree_params</a></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;{</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="comment">/* Each processor allocates a number of nodes which is TreeAllocFactor times</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">       the maximum(!) number of particles.  Note: A typical local tree for N</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">       particles needs usually about ~0.65*N nodes.</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">       If the allocated memory is not sufficient, this parameter will be increased.*/</span></div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="structforcetree__params.html#aa3adbfedf9fd5baac777f0d0b0d2b4bc">   37</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structforcetree__params.html#aa3adbfedf9fd5baac777f0d0b0d2b4bc">TreeAllocFactor</a>;</div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="structforcetree__params.html#aa41e5b06e8fc33bb6434cbec5fde7649">   39</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structforcetree__params.html#aa41e5b06e8fc33bb6434cbec5fde7649">FastParticleType</a>;</div>
<div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="forcetree_8c.html#afdf47b35e2cd40f171992ebf07dcbbb6">   40</a></span>&#160;} <a class="code" href="forcetree_8c.html#afdf47b35e2cd40f171992ebf07dcbbb6">ForceTreeParams</a>;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="forcetree_8c.html#aa58562a96bb05cdba9466ecedafece27">   43</a></span>&#160;<a class="code" href="forcetree_8c.html#aa58562a96bb05cdba9466ecedafece27">init_forcetree_params</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> FastParticleType)</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;{</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment">/* This was increased due to the extra nodes created by subtrees*/</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <a class="code" href="forcetree_8c.html#afdf47b35e2cd40f171992ebf07dcbbb6">ForceTreeParams</a>.<a class="code" href="structforcetree__params.html#aa3adbfedf9fd5baac777f0d0b0d2b4bc">TreeAllocFactor</a> = 0.9;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="forcetree_8c.html#afdf47b35e2cd40f171992ebf07dcbbb6">ForceTreeParams</a>.<a class="code" href="structforcetree__params.html#aa41e5b06e8fc33bb6434cbec5fde7649">FastParticleType</a> = FastParticleType;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;}</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keyword">static</span> <a class="code" href="structForceTree.html">ForceTree</a></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<a class="code" href="forcetree_8c.html#a0de0fec1cfeb5e2aad5f33a843de25e7">force_tree_build</a>(<span class="keywordtype">int</span> npart, <span class="keywordtype">int</span> mask, <a class="code" href="structDomainDecomp.html">DomainDecomp</a> * ddecomp, <span class="keyword">const</span> <span class="keywordtype">int</span> HybridNuGrav, <span class="keyword">const</span> <span class="keywordtype">int</span> DoMoments, <span class="keyword">const</span> <span class="keywordtype">char</span> * EmergencyOutputDir);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<a class="code" href="forcetree_8c.html#a17b712760ce589aaaf16d64abf4a65dc">force_treeupdate_pseudos</a>(<span class="keywordtype">int</span> no, <span class="keyword">const</span> <a class="code" href="structForceTree.html">ForceTree</a> * tree);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<a class="code" href="forcetree_8c.html#a4a6ff36eefac3d77669f28982e4f02b0">force_create_node_for_topnode</a>(<span class="keywordtype">int</span> no, <span class="keywordtype">int</span> topnode, <span class="keyword">struct</span> <a class="code" href="structNODE.html">NODE</a> * Nodes, <span class="keyword">const</span> <a class="code" href="structDomainDecomp.html">DomainDecomp</a> * ddecomp, <span class="keywordtype">int</span> bits, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> z, <span class="keywordtype">int</span> *nextfree, <span class="keyword">const</span> <span class="keywordtype">int</span> lastnode);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160; </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<a class="code" href="forcetree_8c.html#a9d7fd9824e1f0c1d268c43a85cffd153">force_exchange_pseudodata</a>(<a class="code" href="structForceTree.html">ForceTree</a> * tree, <span class="keyword">const</span> <a class="code" href="structDomainDecomp.html">DomainDecomp</a> * ddecomp);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<a class="code" href="forcetree_8c.html#aad5388b597f7a479c120f37a72d96a1f">force_insert_pseudo_particles</a>(<span class="keyword">const</span> <a class="code" href="structForceTree.html">ForceTree</a> * tree, <span class="keyword">const</span> <a class="code" href="structDomainDecomp.html">DomainDecomp</a> * ddecomp);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160; </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<a class="code" href="forcetree_8c.html#a569cd386bf7d67968fad6344898cb70c">add_particle_moment_to_node</a>(<span class="keyword">struct</span> <a class="code" href="structNODE.html">NODE</a> * pnode, <span class="keywordtype">int</span> i);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160; </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">/* Walk the constructed tree, validating sibling and nextnode as we go*/</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> force_validate_nextlist(<span class="keyword">const</span> <a class="code" href="structForceTree.html">ForceTree</a> * tree)</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;{</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordtype">int</span> no = tree-&gt;<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">while</span>(no != -1)</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> * current = &amp;tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no];</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="keywordflow">if</span>(current-&gt;<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a> != -1 &amp;&amp; !<a class="code" href="forcetree_8h.html#a822d99b8bfbdf4c010e2b974b4334409">node_is_node</a>(current-&gt;<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a>, tree))</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(5, <span class="stringliteral">&quot;Node %d (type %d) has sibling %d next %d father %d first %d final %d last %d ntop %d\n&quot;</span>, no, current-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a>, current-&gt;<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a>, current-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[0], current-&gt;<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a>, tree-&gt;<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>, tree-&gt;<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a> + tree-&gt;<a class="code" href="structForceTree.html#acd985b6d526df4466ad5f6850402c89e">numnodes</a>, tree-&gt;<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a>, tree-&gt;<a class="code" href="structForceTree.html#a2e227f51f43e9b318d9f9e67299da0ba">NTopLeaves</a>);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="keywordflow">if</span>(current-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> == <a class="code" href="forcetree_8h.html#aca0ae17134eee3f867d5d7579a97ba64">PSEUDO_NODE_TYPE</a>) {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            <span class="comment">/* pseudo particle: nextnode should be a pseudo particle, sibling should be a node. */</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            <span class="keywordflow">if</span>(!<a class="code" href="forcetree_8h.html#ae01cb41cc000acecd9213d69c7d15c32">node_is_pseudo_particle</a>(current-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[0], tree))</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(5, <span class="stringliteral">&quot;Pseudo Node %d has next node %d sibling %d father %d first %d final %d last %d ntop %d\n&quot;</span>, no, current-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[0], current-&gt;<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a>, current-&gt;<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a>, tree-&gt;<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>, tree-&gt;<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a> + tree-&gt;<a class="code" href="structForceTree.html#acd985b6d526df4466ad5f6850402c89e">numnodes</a>, tree-&gt;<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a>, tree-&gt;<a class="code" href="structForceTree.html#a2e227f51f43e9b318d9f9e67299da0ba">NTopLeaves</a>);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        }</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(current-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> == <a class="code" href="forcetree_8h.html#a3ad606200a7ba07b8766c7d37b2454c7">NODE_NODE_TYPE</a>) {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            <span class="comment">/* Next node should be another node */</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            <span class="keywordflow">if</span>(!<a class="code" href="forcetree_8h.html#a822d99b8bfbdf4c010e2b974b4334409">node_is_node</a>(current-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[0], tree))</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(5, <span class="stringliteral">&quot;Node Node %d has next node which is particle %d sibling %d father %d first %d final %d last %d ntop %d\n&quot;</span>, no, current-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[0], current-&gt;<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a>, current-&gt;<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a>, tree-&gt;<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>, tree-&gt;<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a> + tree-&gt;<a class="code" href="structForceTree.html#acd985b6d526df4466ad5f6850402c89e">numnodes</a>, tree-&gt;<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a>, tree-&gt;<a class="code" href="structForceTree.html#a2e227f51f43e9b318d9f9e67299da0ba">NTopLeaves</a>);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            no = current-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[0];</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        no = current-&gt;<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a>;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="comment">/* Every node should have a valid father: collect those that do not.*/</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">for</span>(no = tree-&gt;<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>; no &lt; tree-&gt;firstnode + tree-&gt;<a class="code" href="structForceTree.html#acd985b6d526df4466ad5f6850402c89e">numnodes</a>; no++)</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="forcetree_8h.html#a822d99b8bfbdf4c010e2b974b4334409">node_is_node</a>(tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a>, tree) &amp;&amp; tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a> &gt;= 0) {</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            <span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> *current = &amp;tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no];</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(1, <span class="stringliteral">&quot;Danger! no %d has father %d, next %d sib %d, (ptype = %d) len %g center (%g %g %g) mass %g cofm %g %g %g TL %d DLM %d ITL %d nocc %d suns %d %d %d %d\n&quot;</span>, no, current-&gt;<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a>, current-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[0], current-&gt;<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a>, current-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a>,</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                current-&gt;<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a>, current-&gt;<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[0], current-&gt;<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[1], current-&gt;<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[2],</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                current-&gt;<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a>, current-&gt;<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[0], current-&gt;<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[1], current-&gt;<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[2],</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                current-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#aa3b4bfc6b6c8c99d88860a5262679487">TopLevel</a>, current-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a1ff8c5e570722798d188c60455312fa2">DependsOnLocalMass</a>, current-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#ac63501e2f4f5076dfe3534268e89bc39">InternalTopLevel</a>, current-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a>,</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                current-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[0], current-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[1], current-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[2], current-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[3]);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        }</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    }</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;}</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="forcetree_8c.html#a6c833489d009e4b5e850dc5997214775">  110</a></span>&#160;<a class="code" href="forcetree_8c.html#a6c833489d009e4b5e850dc5997214775">force_tree_eh_slots_fork</a>(<a class="code" href="structEIBase.html">EIBase</a> * event, <span class="keywordtype">void</span> * userdata)</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;{</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment">/* after a fork, we will attach the new particle to the force tree. */</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <a class="code" href="structEISlotsFork.html">EISlotsFork</a> * ev = (<a class="code" href="structEISlotsFork.html">EISlotsFork</a>*) event;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordtype">int</span> parent = ev-&gt;<a class="code" href="structEISlotsFork.html#adfb224c6cc23cde340474c5d08b5b449">parent</a>;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordtype">int</span> child = ev-&gt;<a class="code" href="structEISlotsFork.html#acceff2e5aa9a8341512e4067f65c46de">child</a>;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <a class="code" href="structForceTree.html">ForceTree</a> * tree = (<a class="code" href="structForceTree.html">ForceTree</a> * ) userdata;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordtype">int</span> no = <a class="code" href="forcetree_8c.html#ab8a2310bd448851f4aa42ae6bcec2e01">force_get_father</a>(parent, tree);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> * nop = &amp;tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no];</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">/* FIXME: We lose particles if the node is full.</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">     * At the moment this does not matter, because</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">     * the only new particles are stars, which do not</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">     * participate in the SPH tree walk.*/</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordflow">if</span>(nop-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a> &lt; <a class="code" href="forcetree_8h.html#afcfeb1a32a47b8b7f8bce9222b542a9e">NMAXCHILD</a>) {</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;       nop-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[nop-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a>] = child;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;       nop-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#ac1593255d2d991cb18a3b4b0d5f4f7a6">Types</a> += <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[child].Type &lt;&lt; (3*nop-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a>);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;       nop-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a>++;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    }</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">if</span>(child &lt; tree-&gt;nfather &amp;&amp; child &gt;= 0)</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        tree-&gt;<a class="code" href="structForceTree.html#a9c794bfbfd1b1c68d201af6a8564fd13">Father</a>[child] = no;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;}</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l00134"></a><span class="lineno"><a class="line" href="forcetree_8c.html#a6676b2eba19512b1671a4c21fcb6e71d">  134</a></span>&#160;<a class="code" href="forcetree_8c.html#a6676b2eba19512b1671a4c21fcb6e71d">force_tree_allocated</a>(<span class="keyword">const</span> <a class="code" href="structForceTree.html">ForceTree</a> * tree)</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;{</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordflow">return</span> tree-&gt;<a class="code" href="structForceTree.html#a843ac282eda641c264da5de145287dbf">tree_allocated_flag</a>;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;}</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="forcetree_8c.html#a5156dae3aae56140d6e9ae0ab58867cc">  140</a></span>&#160;<a class="code" href="forcetree_8c.html#a5156dae3aae56140d6e9ae0ab58867cc">force_tree_rebuild</a>(<a class="code" href="structForceTree.html">ForceTree</a> * tree, <a class="code" href="structDomainDecomp.html">DomainDecomp</a> * ddecomp, <span class="keyword">const</span> <span class="keywordtype">int</span> HybridNuGrav, <span class="keyword">const</span> <span class="keywordtype">int</span> DoMoments, <span class="keyword">const</span> <span class="keywordtype">char</span> * EmergencyOutputDir)</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;{</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <a class="code" href="system_8h.html#a2ca58d338cd52c808ec1a86073940c49">MPIU_Barrier</a>(MPI_COMM_WORLD);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;Tree construction.  (presently allocated=%g MB)\n&quot;</span>, <a class="code" href="mymalloc_8h.html#ae51745d10f51ca300ad484ab4ecf7908">mymalloc_usedbytes</a>() / (1024.0 * 1024.0));</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#a6676b2eba19512b1671a4c21fcb6e71d">force_tree_allocated</a>(tree)) {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <a class="code" href="forcetree_8c.html#aaa26dfea4b696133a8bc35c5e0c56037">force_tree_free</a>(tree);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    }</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Misc&quot;</span>);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    *tree = <a class="code" href="forcetree_8c.html#a0de0fec1cfeb5e2aad5f33a843de25e7">force_tree_build</a>(<a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a>, <a class="code" href="forcetree_8h.html#a09c0db73b04ae32608387993001427ee">ALLMASK</a>, ddecomp, HybridNuGrav, DoMoments, EmergencyOutputDir);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <a class="code" href="event_8c.html#a3f548c264e5e5b9fe2bb8b10c177482a">event_listen</a>(&amp;<a class="code" href="event_8c.html#aafc3f0c1fffb6f0a19f5f3ecd24474c7">EventSlotsFork</a>, <a class="code" href="forcetree_8c.html#a6c833489d009e4b5e850dc5997214775">force_tree_eh_slots_fork</a>, tree);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Tree/Build/Moments&quot;</span>);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;Tree constructed (moments: %d). First node %d, number of nodes %d, first pseudo %d. NTopLeaves %d\n&quot;</span>,</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            tree-&gt;<a class="code" href="structForceTree.html#a4689b816563dd80b28c6a7de4d56e236">moments_computed_flag</a>, tree-&gt;<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>, tree-&gt;<a class="code" href="structForceTree.html#acd985b6d526df4466ad5f6850402c89e">numnodes</a>, tree-&gt;<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a>, tree-&gt;<a class="code" href="structForceTree.html#a2e227f51f43e9b318d9f9e67299da0ba">NTopLeaves</a>);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <a class="code" href="system_8h.html#a2ca58d338cd52c808ec1a86073940c49">MPIU_Barrier</a>(MPI_COMM_WORLD);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;}</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00161"></a><span class="lineno"><a class="line" href="forcetree_8c.html#aa01061828cef34bc4c55ef9eaa7c03f5">  161</a></span>&#160;<a class="code" href="forcetree_8c.html#aa01061828cef34bc4c55ef9eaa7c03f5">force_tree_rebuild_mask</a>(<a class="code" href="structForceTree.html">ForceTree</a> * tree, <a class="code" href="structDomainDecomp.html">DomainDecomp</a> * ddecomp, <span class="keywordtype">int</span> mask, <span class="keyword">const</span> <span class="keywordtype">int</span> HybridNuGrav, <span class="keyword">const</span> <span class="keywordtype">char</span> * EmergencyOutputDir)</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;{</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="system_8h.html#a2ca58d338cd52c808ec1a86073940c49">MPIU_Barrier</a>(MPI_COMM_WORLD);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;Tree construction for types: %d.\n&quot;</span>, mask);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#a6676b2eba19512b1671a4c21fcb6e71d">force_tree_allocated</a>(tree)) {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <a class="code" href="forcetree_8c.html#aaa26dfea4b696133a8bc35c5e0c56037">force_tree_free</a>(tree);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    }</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Misc&quot;</span>);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160; </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">/* No moments*/</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    *tree = <a class="code" href="forcetree_8c.html#a0de0fec1cfeb5e2aad5f33a843de25e7">force_tree_build</a>(<a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a>, mask, ddecomp, HybridNuGrav, 0, EmergencyOutputDir);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/SPH/Build&quot;</span>);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;Tree constructed (type mask: %d). First node %d, number of nodes %d, first pseudo %d. NTopLeaves %d\n&quot;</span>,</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            mask, tree-&gt;<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>, tree-&gt;<a class="code" href="structForceTree.html#acd985b6d526df4466ad5f6850402c89e">numnodes</a>, tree-&gt;<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a>, tree-&gt;<a class="code" href="structForceTree.html#a2e227f51f43e9b318d9f9e67299da0ba">NTopLeaves</a>);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="system_8h.html#a2ca58d338cd52c808ec1a86073940c49">MPIU_Barrier</a>(MPI_COMM_WORLD);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;}</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160; </div>
<div class="line"><a name="l00191"></a><span class="lineno"><a class="line" href="forcetree_8c.html#a0de0fec1cfeb5e2aad5f33a843de25e7">  191</a></span>&#160;<a class="code" href="structForceTree.html">ForceTree</a> <a class="code" href="forcetree_8c.html#a0de0fec1cfeb5e2aad5f33a843de25e7">force_tree_build</a>(<span class="keywordtype">int</span> npart, <span class="keywordtype">int</span> mask, <a class="code" href="structDomainDecomp.html">DomainDecomp</a> * ddecomp, <span class="keyword">const</span> <span class="keywordtype">int</span> HybridNuGrav, <span class="keyword">const</span> <span class="keywordtype">int</span> DoMoments, <span class="keyword">const</span> <span class="keywordtype">char</span> * EmergencyOutputDir)</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;{</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <a class="code" href="structForceTree.html">ForceTree</a> tree;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160; </div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordtype">int</span> TooManyNodes = 0;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    int64_t maxnodes = <a class="code" href="forcetree_8c.html#afdf47b35e2cd40f171992ebf07dcbbb6">ForceTreeParams</a>.<a class="code" href="structforcetree__params.html#aa3adbfedf9fd5baac777f0d0b0d2b4bc">TreeAllocFactor</a> * <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a> + ddecomp-&gt;<a class="code" href="structDomainDecomp.html#ad823b5b805fa027952689ce0c7c161c5">NTopNodes</a>;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    int64_t maxmaxnodes;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    MPI_Reduce(&amp;maxnodes, &amp;maxmaxnodes, 1, <a class="code" href="system_8h.html#abb95c0be39c73f8e6b0978a9a374d92b">MPI_INT64</a>, MPI_MAX,0, MPI_COMM_WORLD);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;Treebuild: Largest is %g MByte for %ld tree nodes. firstnode %ld. (presently allocated %g MB)\n&quot;</span>,</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;         maxmaxnodes * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structNODE.html">NODE</a>) / (1024.0 * 1024.0), maxmaxnodes, <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a5e24abb34f2c8998d8b35c217477d580">MaxPart</a>,</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;         <a class="code" href="mymalloc_8h.html#ae51745d10f51ca300ad484ab4ecf7908">mymalloc_usedbytes</a>() / (1024.0 * 1024.0));</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160; </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">do</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="comment">/* Allocate memory. */</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        tree = <a class="code" href="forcetree_8c.html#a68ccb093e6e43385d633074edd4aee40">force_treeallocate</a>(maxnodes, <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a5e24abb34f2c8998d8b35c217477d580">MaxPart</a>, ddecomp);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        tree.<a class="code" href="structForceTree.html#a8915a4ff849c9e97448ae30089a05966">BoxSize</a> = <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#afd51316d545eaf7f3f083aea9616858d">BoxSize</a>;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        tree.<a class="code" href="structForceTree.html#acd985b6d526df4466ad5f6850402c89e">numnodes</a> = <a class="code" href="forcetree_8c.html#a54c1bcfde446f424ff0b7f89199dde0a">force_tree_create_nodes</a>(tree, npart, mask, ddecomp, HybridNuGrav);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="keywordflow">if</span>(tree.<a class="code" href="structForceTree.html#acd985b6d526df4466ad5f6850402c89e">numnodes</a> &gt;= tree.<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a> - tree.<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>)</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(1, <span class="stringliteral">&quot;Not enough tree nodes (%ld) for %d particles. Created %d\n&quot;</span>, maxnodes, npart, tree.<a class="code" href="structForceTree.html#acd985b6d526df4466ad5f6850402c89e">numnodes</a>);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <a class="code" href="forcetree_8c.html#aaa26dfea4b696133a8bc35c5e0c56037">force_tree_free</a>(&amp;tree);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            maxnodes = <a class="code" href="forcetree_8c.html#afdf47b35e2cd40f171992ebf07dcbbb6">ForceTreeParams</a>.<a class="code" href="structforcetree__params.html#aa3adbfedf9fd5baac777f0d0b0d2b4bc">TreeAllocFactor</a> * <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a> + ddecomp-&gt;<a class="code" href="structDomainDecomp.html#ad823b5b805fa027952689ce0c7c161c5">NTopNodes</a>;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(1, <span class="stringliteral">&quot;TreeAllocFactor from %g to %g now %ld tree nodes\n&quot;</span>, <a class="code" href="forcetree_8c.html#afdf47b35e2cd40f171992ebf07dcbbb6">ForceTreeParams</a>.<a class="code" href="structforcetree__params.html#aa3adbfedf9fd5baac777f0d0b0d2b4bc">TreeAllocFactor</a>, <a class="code" href="forcetree_8c.html#afdf47b35e2cd40f171992ebf07dcbbb6">ForceTreeParams</a>.<a class="code" href="structforcetree__params.html#aa3adbfedf9fd5baac777f0d0b0d2b4bc">TreeAllocFactor</a>*1.15, maxnodes);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <a class="code" href="forcetree_8c.html#afdf47b35e2cd40f171992ebf07dcbbb6">ForceTreeParams</a>.<a class="code" href="structforcetree__params.html#aa3adbfedf9fd5baac777f0d0b0d2b4bc">TreeAllocFactor</a> *= 1.15;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#afdf47b35e2cd40f171992ebf07dcbbb6">ForceTreeParams</a>.<a class="code" href="structforcetree__params.html#aa3adbfedf9fd5baac777f0d0b0d2b4bc">TreeAllocFactor</a> &gt; 3.0) {</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                TooManyNodes = 1;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        }</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    }</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keywordflow">while</span>(tree.<a class="code" href="structForceTree.html#acd985b6d526df4466ad5f6850402c89e">numnodes</a> &gt;= tree.<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a> - tree.<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    tree.<a class="code" href="structForceTree.html#a8f8a71db8ce5aaaf883ddc43654832ea">mask</a> = mask;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160; </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="system_8c.html#ade2741449d03e719e2e91a6e511e07a4">MPIU_Any</a>(TooManyNodes, MPI_COMM_WORLD)) {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="comment">/* Assume scale factor = 1 for dump as position is not affected.*/</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordflow">if</span>(EmergencyOutputDir) {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            <a class="code" href="structCosmology.html">Cosmology</a> <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a> = {0};</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>.<a class="code" href="structCosmology.html#a43e0dba956c6dc4fad8b1aaf0fa84248">Omega0</a> = 0.3;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>.<a class="code" href="structCosmology.html#ac27ad0bd8a6135a2b7da6c49c375d73e">OmegaLambda</a> = 0.7;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            <a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>.<a class="code" href="structCosmology.html#a4b79dcaa1e1c38d07258c3f539e2cb20">HubbleParam</a> = 0.7;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            <a class="code" href="checkpoint_8c.html#a9b7b2e06591ff6f1fb5735a65f1efd78">dump_snapshot</a>(<span class="stringliteral">&quot;FORCETREE-DUMP&quot;</span>, 1, &amp;<a class="code" href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a>, EmergencyOutputDir);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(2, <span class="stringliteral">&quot;Required too many nodes, snapshot dumped\n&quot;</span>);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">if</span>(mask == <a class="code" href="forcetree_8h.html#a09c0db73b04ae32608387993001427ee">ALLMASK</a>)</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Tree/Build/Nodes&quot;</span>);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    force_validate_nextlist(&amp;tree);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="comment">/* insert the pseudo particles that represent the mass distribution of other ddecomps */</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <a class="code" href="forcetree_8c.html#aad5388b597f7a479c120f37a72d96a1f">force_insert_pseudo_particles</a>(&amp;tree, ddecomp);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    force_validate_nextlist(&amp;tree);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    tree.<a class="code" href="structForceTree.html#a4689b816563dd80b28c6a7de4d56e236">moments_computed_flag</a> = 0;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordflow">if</span>(DoMoments) {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="comment">/* now compute the multipole moments recursively */</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <a class="code" href="forcetree_8c.html#a8c06d93e6c1c1afab740e393528fa0f6">force_update_node_parallel</a>(&amp;tree, ddecomp);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        force_validate_nextlist(&amp;tree);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="comment">/* Exchange the pseudo-data*/</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <a class="code" href="forcetree_8c.html#a9d7fd9824e1f0c1d268c43a85cffd153">force_exchange_pseudodata</a>(&amp;tree, ddecomp);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160; </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <a class="code" href="forcetree_8c.html#a17b712760ce589aaaf16d64abf4a65dc">force_treeupdate_pseudos</a>(<a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a5e24abb34f2c8998d8b35c217477d580">MaxPart</a>, &amp;tree);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        tree.<a class="code" href="structForceTree.html#a4689b816563dd80b28c6a7de4d56e236">moments_computed_flag</a> = 1;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        tree.<a class="code" href="structForceTree.html#ab0144192c151b0695bb436cf874f464a">hmax_computed_flag</a> = 1;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    }</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    tree.<a class="code" href="structForceTree.html#a9b388efae8d9d4be5e14030d65a17819">Nodes_base</a> = (<span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> *) <a class="code" href="mymalloc_8h.html#a81d253773ecedbda7d865554e707489f">myrealloc</a>(tree.<a class="code" href="structForceTree.html#a9b388efae8d9d4be5e14030d65a17819">Nodes_base</a>, (tree.<a class="code" href="structForceTree.html#acd985b6d526df4466ad5f6850402c89e">numnodes</a> +1) * <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a>));</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="comment">/*Update the oct-tree struct so it knows about the memory change*/</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    tree.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a> = tree.<a class="code" href="structForceTree.html#a9b388efae8d9d4be5e14030d65a17819">Nodes_base</a> - tree.<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        force_validate_nextlist(&amp;tree);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">return</span> tree;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;}</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">/* Get the subnode for a given particle and parent node.</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment"> * This splits a parent node into 8 subregions depending on the particle position.</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment"> * node is the parent node to split, p_i is the index of the particle we</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment"> * are currently inserting</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment"> * Returns a value between 0 and 7.</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment"> * */</span></div>
<div class="line"><a name="l00281"></a><span class="lineno"><a class="line" href="forcetree_8c.html#a95095093b87159c1b23a2cb267d9940a">  281</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="forcetree_8c.html#a95095093b87159c1b23a2cb267d9940a">get_subnode</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structNODE.html">NODE</a> * node, <span class="keyword">const</span> <span class="keywordtype">int</span> p_i)</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;{</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">/*Loop is unrolled to help out the compiler,which normally only manages it at -O3*/</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;     <span class="keywordflow">return</span> (<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Pos[0] &gt; node-&gt;<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[0]) +</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            ((<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Pos[1] &gt; node-&gt;<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[1]) &lt;&lt; 1) +</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            ((<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Pos[2] &gt; node-&gt;<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[2]) &lt;&lt; 2);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;}</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">/*Check whether a particle is inside the volume covered by a node,</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment"> * by checking whether each dimension is close enough to center (L1 metric).*/</span></div>
<div class="line"><a name="l00291"></a><span class="lineno"><a class="line" href="forcetree_8c.html#ab3ee27767a982ea77a18f5f4983e4344">  291</a></span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="forcetree_8c.html#ab3ee27767a982ea77a18f5f4983e4344">inside_node</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structNODE.html">NODE</a> * node, <span class="keyword">const</span> <span class="keywordtype">int</span> p_i)</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;{</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="comment">/*One can also use a loop, but the compiler unrolls it only at -O3,</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">     *so this is a little faster*/</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordtype">int</span> inside =</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        (fabs(2*(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Pos[0] - node-&gt;<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[0])) &lt;= node-&gt;<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a>) *</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        (fabs(2*(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Pos[1] - node-&gt;<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[1])) &lt;= node-&gt;<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a>) *</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        (fabs(2*(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Pos[2] - node-&gt;<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[2])) &lt;= node-&gt;<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a>);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">return</span> inside;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;}</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">/*Initialise an internal node at nfreep. The parent is assumed to be locked, and</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment"> * we have assured that nothing else will change nfreep while we are here.*/</span></div>
<div class="line"><a name="l00304"></a><span class="lineno"><a class="line" href="forcetree_8c.html#a068d7c90773680cb8c9b0684d584420d">  304</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="forcetree_8c.html#a068d7c90773680cb8c9b0684d584420d">init_internal_node</a>(<span class="keyword">struct</span> <a class="code" href="structNODE.html">NODE</a> *nfreep, <span class="keyword">struct</span> <a class="code" href="structNODE.html">NODE</a> *parent, <span class="keywordtype">int</span> subnode)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;{</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordtype">int</span> j;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keyword">const</span> <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> lenhalf = 0.25 * parent-&gt;<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a>;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    nfreep-&gt;<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a> = 0.5 * parent-&gt;<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a>;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    nfreep-&gt;<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a> = -10;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    nfreep-&gt;<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a> = -10;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    nfreep-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#aa3b4bfc6b6c8c99d88860a5262679487">TopLevel</a> = 0;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    nfreep-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#ac63501e2f4f5076dfe3534268e89bc39">InternalTopLevel</a> = 0;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    nfreep-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a1ff8c5e570722798d188c60455312fa2">DependsOnLocalMass</a> = 0;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    nfreep-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> = <a class="code" href="forcetree_8h.html#ac342a8bc2bb97849655e3ea50d3c5494">PARTICLE_NODE_TYPE</a>;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    nfreep-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a85ba1893599828fd008829ac46e5a234">unused</a> = 0;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160; </div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++) {</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="comment">/* Detect which quadrant we are in by testing the bits of subnode:</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">         * if (subnode &amp; [1,2,4]) is true we add lenhalf, otherwise subtract lenhalf*/</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> sign = (subnode &amp; (1 &lt;&lt; j)) ? 1 : -1;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[j] = parent-&gt;<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[j] + sign*lenhalf;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">for</span>(j = 0; j &lt; <a class="code" href="forcetree_8h.html#afcfeb1a32a47b8b7f8bce9222b542a9e">NMAXCHILD</a>; j++)</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[j] = -1;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    nfreep-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a> = 0;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    nfreep-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#ac1593255d2d991cb18a3b4b0d5f4f7a6">Types</a> = 0;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    memset(&amp;(nfreep-&gt;<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>),0,3*<span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a>));</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    nfreep-&gt;<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a> = 0;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    nfreep-&gt;<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a> = 0;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;}</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160; </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">/* Size of the free Node thread cache.</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment"> * 12 8-node rows (works out at 8kB) was found</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment"> * to be optimal for an Intel skylake and</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment"> * an AMD Zen2 with 12 threads.*/</span></div>
<div class="line"><a name="l00336"></a><span class="lineno"><a class="line" href="forcetree_8c.html#ae9d22ac96be9a18932a00837b0a78f30">  336</a></span>&#160;<span class="preprocessor">#define NODECACHE_SIZE (8*12)</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">/*Structure containing thread-local parameters of the tree build*/</span></div>
<div class="line"><a name="l00339"></a><span class="lineno"><a class="line" href="structNodeCache.html">  339</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structNodeCache.html">NodeCache</a> {</div>
<div class="line"><a name="l00340"></a><span class="lineno"><a class="line" href="structNodeCache.html#a9486e11f8687f7f5797654f117a50c8c">  340</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structNodeCache.html#a9486e11f8687f7f5797654f117a50c8c">nnext_thread</a>;</div>
<div class="line"><a name="l00341"></a><span class="lineno"><a class="line" href="structNodeCache.html#a34fe9100da8a71f0b571f12bb85a3c70">  341</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structNodeCache.html#a34fe9100da8a71f0b571f12bb85a3c70">nrem_thread</a>;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;};</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">/*Get a pointer to memory for 8 free nodes, from our node cache. */</span></div>
<div class="line"><a name="l00345"></a><span class="lineno"><a class="line" href="forcetree_8c.html#a6710cf447fc53308c513b002cf446ebf">  345</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="forcetree_8c.html#a6710cf447fc53308c513b002cf446ebf">get_freenode</a>(<span class="keywordtype">int</span> * nnext, <span class="keyword">struct</span> <a class="code" href="structNodeCache.html">NodeCache</a> *nc)</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;{</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="comment">/*Get memory for an extra node from our cache.*/</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordflow">if</span>(nc-&gt;<a class="code" href="structNodeCache.html#a34fe9100da8a71f0b571f12bb85a3c70">nrem_thread</a> &lt; 8) {</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        nc-&gt;<a class="code" href="structNodeCache.html#a9486e11f8687f7f5797654f117a50c8c">nnext_thread</a> = <a class="code" href="system_8h.html#a00eeba7aebd7952f4c0ecebb60fbeca2">atomic_fetch_and_add</a>(nnext, <a class="code" href="forcetree_8c.html#ae9d22ac96be9a18932a00837b0a78f30">NODECACHE_SIZE</a>);</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        nc-&gt;<a class="code" href="structNodeCache.html#a34fe9100da8a71f0b571f12bb85a3c70">nrem_thread</a> = <a class="code" href="forcetree_8c.html#ae9d22ac96be9a18932a00837b0a78f30">NODECACHE_SIZE</a>;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    }</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> ninsert = nc-&gt;<a class="code" href="structNodeCache.html#a9486e11f8687f7f5797654f117a50c8c">nnext_thread</a>;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    nc-&gt;<a class="code" href="structNodeCache.html#a9486e11f8687f7f5797654f117a50c8c">nnext_thread</a> += 8;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    nc-&gt;<a class="code" href="structNodeCache.html#a34fe9100da8a71f0b571f12bb85a3c70">nrem_thread</a> -= 8;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">return</span> ninsert;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;}</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">/* Add a particle to a node in a known empty location.</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment"> * Parent is assumed to be locked.*/</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line"><a name="l00361"></a><span class="lineno"><a class="line" href="forcetree_8c.html#adb744eb97469a1f65a702c05bc71cee1">  361</a></span>&#160;<a class="code" href="forcetree_8c.html#adb744eb97469a1f65a702c05bc71cee1">modify_internal_node</a>(<span class="keywordtype">int</span> parent, <span class="keywordtype">int</span> subnode, <span class="keywordtype">int</span> p_toplace, <span class="keyword">const</span> <a class="code" href="structForceTree.html">ForceTree</a> tb, <span class="keyword">const</span> <span class="keywordtype">int</span> HybridNuGrav)</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;{</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    tb.<a class="code" href="structForceTree.html#a9c794bfbfd1b1c68d201af6a8564fd13">Father</a>[p_toplace] = parent;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[parent].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[subnode] = p_toplace;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="comment">/* Encode the type in the Types array*/</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[parent].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#ac1593255d2d991cb18a3b4b0d5f4f7a6">Types</a> += <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_toplace].Type &lt;&lt; (3*subnode);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">if</span>(!HybridNuGrav || <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_toplace].Type != <a class="code" href="forcetree_8c.html#afdf47b35e2cd40f171992ebf07dcbbb6">ForceTreeParams</a>.<a class="code" href="structforcetree__params.html#aa41e5b06e8fc33bb6434cbec5fde7649">FastParticleType</a>)</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <a class="code" href="forcetree_8c.html#a569cd386bf7d67968fad6344898cb70c">add_particle_moment_to_node</a>(&amp;tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[parent], p_toplace);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;}</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160; </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">/* Create a new layer of nodes beneath the current node, and place the particle.</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment"> * Must have node lock.*/</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line"><a name="l00376"></a><span class="lineno"><a class="line" href="forcetree_8c.html#aa2a5e7409df1552470bd55312d9d1e17">  376</a></span>&#160;<a class="code" href="forcetree_8c.html#aa2a5e7409df1552470bd55312d9d1e17">create_new_node_layer</a>(<span class="keywordtype">int</span> firstparent, <span class="keywordtype">int</span> p_toplace,</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> HybridNuGrav, <span class="keyword">const</span> <a class="code" href="structForceTree.html">ForceTree</a> tb, <span class="keywordtype">int</span> *nnext, <span class="keyword">struct</span> <a class="code" href="structNodeCache.html">NodeCache</a> *nc)</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;{</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="comment">/* This is so we can defer changing</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">     * the type of the existing node until the end.*/</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordtype">int</span> parent = firstparent;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> *nprnt = &amp;tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[parent];</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160; </div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <span class="comment">/* Braces to scope oldsuns and newsuns*/</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        {</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="keywordtype">int</span> newsuns[<a class="code" href="forcetree_8h.html#afcfeb1a32a47b8b7f8bce9222b542a9e">NMAXCHILD</a>];</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160; </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        <span class="keywordtype">int</span> * oldsuns = nprnt-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160; </div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="comment">/*We have two particles here, so create a new child node to store them both.*/</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="comment">/* if we are here the node must be large enough, thus contain exactly one child. */</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <span class="comment">/* The parent is already a leaf, need to split */</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="comment">/* Get memory for 8 extra nodes from our cache.*/</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        newsuns[0] = <a class="code" href="forcetree_8c.html#a6710cf447fc53308c513b002cf446ebf">get_freenode</a>(nnext, nc);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="comment">/*If we already have too many nodes, exit loop.*/</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="keywordflow">if</span>(nc-&gt;<a class="code" href="structNodeCache.html#a9486e11f8687f7f5797654f117a50c8c">nnext_thread</a> &gt;= tb.<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a>) {</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            <span class="comment">/* This means that we have &gt; NMAXCHILD particles in the same place,</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">            * which usually indicates a bug in the particle evolution. Print some helpful debug information.*/</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(1, <span class="stringliteral">&quot;Failed placing %d at %g %g %g, type %d, ID %ld. Others were %d (%g %g %g, t %d ID %ld) and %d (%g %g %g, t %d ID %ld). next %d last %d\n&quot;</span>,</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                p_toplace, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_toplace].Pos[0], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_toplace].Pos[1], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_toplace].Pos[2], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_toplace].Type, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_toplace].ID,</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                oldsuns[0], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[oldsuns[0]].Pos[0], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[oldsuns[0]].Pos[1], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[oldsuns[0]].Pos[2], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[oldsuns[0]].Type, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[oldsuns[0]].ID,</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                oldsuns[1], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[oldsuns[1]].Pos[0], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[oldsuns[1]].Pos[1], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[oldsuns[1]].Pos[2], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[oldsuns[1]].Type, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[oldsuns[1]].ID</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            );</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            nc-&gt;<a class="code" href="structNodeCache.html#a9486e11f8687f7f5797654f117a50c8c">nnext_thread</a> = tb.<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a> + 10 * <a class="code" href="forcetree_8c.html#ae9d22ac96be9a18932a00837b0a78f30">NODECACHE_SIZE</a>;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <span class="comment">/* If this is not the first layer created,</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">                * we need to mark the overall parent as a node node</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">                * while marking this one as a particle node */</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            <span class="keywordflow">if</span>(firstparent != parent)</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            {</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                nprnt-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> = <a class="code" href="forcetree_8h.html#ac342a8bc2bb97849655e3ea50d3c5494">PARTICLE_NODE_TYPE</a>;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                nprnt-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a> = <a class="code" href="forcetree_8h.html#afcfeb1a32a47b8b7f8bce9222b542a9e">NMAXCHILD</a>;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[firstparent].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> = <a class="code" href="forcetree_8h.html#a3ad606200a7ba07b8766c7d37b2454c7">NODE_NODE_TYPE</a>;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[firstparent].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a> = (1&lt;&lt;16);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            }</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keywordflow">for</span>(i=0; i&lt;8; i++) {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            newsuns[i] = newsuns[0] + i;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            <span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> *nfreep = &amp;tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[newsuns[i]];</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <span class="comment">/* We create a new leaf node.*/</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            <a class="code" href="forcetree_8c.html#a068d7c90773680cb8c9b0684d584420d">init_internal_node</a>(nfreep, nprnt, i);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            <span class="comment">/*Set father of new node*/</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            nfreep-&gt;<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a> = parent;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        }</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="comment">/*Initialize the remaining entries to empty*/</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <span class="keywordflow">for</span>(i=8; i&lt;<a class="code" href="forcetree_8h.html#afcfeb1a32a47b8b7f8bce9222b542a9e">NMAXCHILD</a>;i++)</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            newsuns[i] = -1;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <span class="keywordflow">for</span>(i=0; i &lt; <a class="code" href="forcetree_8h.html#afcfeb1a32a47b8b7f8bce9222b542a9e">NMAXCHILD</a>; i++) {</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            <span class="comment">/* Re-attach each particle to the appropriate new leaf.</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">            * Notice that since we have NMAXCHILD slots on each child and NMAXCHILD particles,</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">            * we will always have a free slot. */</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            <span class="keywordtype">int</span> subnode = <a class="code" href="forcetree_8c.html#a95095093b87159c1b23a2cb267d9940a">get_subnode</a>(nprnt, oldsuns[i]);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            <span class="keywordtype">int</span> child = newsuns[subnode];</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            <span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> * nchild = &amp;tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[child];</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            <a class="code" href="forcetree_8c.html#adb744eb97469a1f65a702c05bc71cee1">modify_internal_node</a>(child, nchild-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a>, oldsuns[i], tb, HybridNuGrav);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            nchild-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a>++;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        }</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="comment">/* Copy the new node array into the node*/</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        memcpy(nprnt-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>, newsuns, <a class="code" href="forcetree_8h.html#afcfeb1a32a47b8b7f8bce9222b542a9e">NMAXCHILD</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        } <span class="comment">/* After this brace oldsuns and newsuns are invalid*/</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="comment">/* Set sibling for the new rank. Since empty at this point, point onwards.*/</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="keywordflow">for</span>(i=0; i&lt;7; i++) {</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            <span class="keywordtype">int</span> child = nprnt-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[i];</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            <span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> * nchild = &amp;tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[child];</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            nchild-&gt;<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a> = nprnt-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[i+1];</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        }</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="comment">/* Final child needs special handling: set to the parent&#39;s sibling.*/</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[nprnt-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[7]].<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a> = nprnt-&gt;<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a>;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <span class="comment">/* Zero the momenta for the parent*/</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        memset(&amp;nprnt-&gt;<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>, 0, <span class="keyword">sizeof</span>(nprnt-&gt;<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>));</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <span class="comment">/* Now try again to add the new particle*/</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="keywordtype">int</span> subnode = <a class="code" href="forcetree_8c.html#a95095093b87159c1b23a2cb267d9940a">get_subnode</a>(nprnt, p_toplace);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="keywordtype">int</span> child = nprnt-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[subnode];</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> * nchild = &amp;tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[child];</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="keywordflow">if</span>(nchild-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a> &lt; <a class="code" href="forcetree_8h.html#afcfeb1a32a47b8b7f8bce9222b542a9e">NMAXCHILD</a>) {</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            <a class="code" href="forcetree_8c.html#adb744eb97469a1f65a702c05bc71cee1">modify_internal_node</a>(child, nchild-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a>, p_toplace, tb, HybridNuGrav);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            nchild-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a>++;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        }</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <span class="comment">/* The attached particles are already within one subnode of the new node.</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">         * Iterate, creating a new layer beneath.*/</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            <span class="comment">/* The current child is going to have new nodes created beneath it,</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">             * so mark it a Node-containing node. It cannot be accessed until</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">             * we mark the top-level parent, so no need for atomics.*/</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[child].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> = <a class="code" href="forcetree_8h.html#a3ad606200a7ba07b8766c7d37b2454c7">NODE_NODE_TYPE</a>;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[child].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a> = (1&lt;&lt;16);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            parent = child;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        }</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    } <span class="keywordflow">while</span>(1);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="comment">/* A new node is created. Mark the (original) parent as an internal node with node children.</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">     * This goes last so that we don&#39;t access the child before it is constructed.*/</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[firstparent].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> = <a class="code" href="forcetree_8h.html#a3ad606200a7ba07b8766c7d37b2454c7">NODE_NODE_TYPE</a>;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[firstparent].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a> = (1&lt;&lt;16);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;}</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">/* Add a particle to the tree, extending the tree as necessary. Locking is done,</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment"> * so may be called from a threaded context*/</span></div>
<div class="line"><a name="l00487"></a><span class="lineno"><a class="line" href="forcetree_8c.html#aa745b024ee4449af60e622e8c2bc32c1">  487</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="forcetree_8c.html#aa745b024ee4449af60e622e8c2bc32c1">add_particle_to_tree</a>(<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> cur_start, <span class="keyword">const</span> <a class="code" href="structForceTree.html">ForceTree</a> tb, <span class="keyword">const</span> <span class="keywordtype">int</span> HybridNuGrav, <span class="keyword">struct</span> <a class="code" href="structNodeCache.html">NodeCache</a> *nc, <span class="keywordtype">int</span>* nnext)</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;{</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordtype">int</span> child, nocc;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordtype">int</span> cur = cur_start;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="comment">/*Walk the main tree until we get something that isn&#39;t an internal node.*/</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">do</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    {</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <span class="comment">/*No lock needed: if we have an internal node here it will be stable*/</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        nocc = tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[cur].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a>;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160; </div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="comment">/* This node still has space for a particle (or needs conversion)*/</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <span class="keywordflow">if</span>(nocc &lt; (1 &lt;&lt; 16))</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160; </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="comment">/* This node has child subnodes: find them.*/</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="keywordtype">int</span> subnode = <a class="code" href="forcetree_8c.html#a95095093b87159c1b23a2cb267d9940a">get_subnode</a>(&amp;tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[cur], i);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <span class="comment">/*No lock needed: if we have an internal node here it will be stable*/</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        child = tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[cur].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[subnode];</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <span class="keywordflow">if</span>(child &gt; tb.<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a> || child &lt; tb.<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>)</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(1,<span class="stringliteral">&quot;Corruption in tree build: N[%d].[%d] = %d &gt; lastnode (%d)\n&quot;</span>,cur, subnode, child, tb.<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a>);</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        cur = child;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    }</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordflow">while</span>(child &gt;= tb.<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>);</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160; </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="comment">/* We have a guaranteed spot.*/</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    nocc = tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[cur].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a>;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[cur].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a>++;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160; </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="comment">/* Now we have something that isn&#39;t an internal node. We can place the particle! */</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keywordflow">if</span>(nocc &lt; <a class="code" href="forcetree_8h.html#afcfeb1a32a47b8b7f8bce9222b542a9e">NMAXCHILD</a>)</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <a class="code" href="forcetree_8c.html#adb744eb97469a1f65a702c05bc71cee1">modify_internal_node</a>(cur, nocc, i, tb, HybridNuGrav);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="comment">/* In this case we need to create a new layer of nodes beneath this one*/</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(nocc &lt; 1&lt;&lt;16) {</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#aa2a5e7409df1552470bd55312d9d1e17">create_new_node_layer</a>(cur, i, HybridNuGrav, tb, nnext, nc))</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    } <span class="keywordflow">else</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(2, <span class="stringliteral">&quot;Tried to convert already converted node %d with nocc = %d\n&quot;</span>, cur, nocc);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordflow">return</span> cur;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;}</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160; </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">/* Merge two partial trees together. Trees are walked simultaneously.</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment"> * A merge is done when a particle node is encountered in one of the side trees.</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment"> * The merge rule is that the node node is attached to the</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment"> * left-most old parent and the particles are re-attached to the node node*/</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l00533"></a><span class="lineno"><a class="line" href="forcetree_8c.html#a43eea1e716d44d6b38a732d94df1b4ce">  533</a></span>&#160;<a class="code" href="forcetree_8c.html#a43eea1e716d44d6b38a732d94df1b4ce">merge_partial_force_trees</a>(<span class="keywordtype">int</span> left, <span class="keywordtype">int</span> right, <span class="keyword">struct</span> <a class="code" href="structNodeCache.html">NodeCache</a> * nc, <span class="keywordtype">int</span> * nnext, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structForceTree.html">ForceTree</a> tb, <span class="keywordtype">int</span> HybridNuGrav)</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;{</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordtype">int</span> this_left = left;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordtype">int</span> this_right = right;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> left_end = tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[left].<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a>;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> right_end = tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[right].<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a>;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">//     message(5, &quot;Ends: %d %d\n&quot;, left_end, right_end);</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="keywordflow">while</span>(this_left != left_end &amp;&amp; this_right != right_end)</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    {</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <span class="keywordflow">if</span>(this_left &lt; tb.<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a> || this_right &lt; tb.<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>)</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(10, <span class="stringliteral">&quot;Encountered invalid node: %d %d &lt; first %d\n&quot;</span>, this_left, this_right, tb.<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>);</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> * nleft = &amp;tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[this_left];</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> * nright = &amp;tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[this_right];</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <span class="keywordflow">if</span>(nc-&gt;<a class="code" href="structNodeCache.html#a9486e11f8687f7f5797654f117a50c8c">nnext_thread</a> &gt;= tb.<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a>)</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="comment">/* Stop when we reach another topnode*/</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <span class="keywordflow">if</span>((nleft-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#aa3b4bfc6b6c8c99d88860a5262679487">TopLevel</a> &amp;&amp; this_left != left) || (nright-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#aa3b4bfc6b6c8c99d88860a5262679487">TopLevel</a> &amp;&amp; this_right != right))</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(6, <span class="stringliteral">&quot;Encountered another topnode: left %d == right %d! type %d\n&quot;</span>, this_left, this_right, nleft-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a>);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <span class="keywordflow">if</span>(this_left == this_right)</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(6, <span class="stringliteral">&quot;Odd: left %d == right %d! type %d\n&quot;</span>, this_left, this_right, nleft-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a>);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">//         message(1, &quot;left %d right %d\n&quot;, this_left, this_right);</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="comment">/* Trees should be synced*/</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <span class="keywordflow">if</span>(fabs(nleft-&gt;<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a> / nright-&gt;<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a>-1) &gt; 1e-6)</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(6, <span class="stringliteral">&quot;Merge unsynced trees: %d %d len %g %g\n&quot;</span>, this_left, this_right, nleft-&gt;<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a>, nright-&gt;<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a>);</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="comment">/* Two node nodes: keep walking down*/</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        <span class="keywordflow">if</span>(nleft-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> == <a class="code" href="forcetree_8h.html#a3ad606200a7ba07b8766c7d37b2454c7">NODE_NODE_TYPE</a> &amp;&amp; nright-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> == <a class="code" href="forcetree_8h.html#a3ad606200a7ba07b8766c7d37b2454c7">NODE_NODE_TYPE</a>) {</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            <span class="keywordflow">if</span>(tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[nleft-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[0]].<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a> &lt; 0 || tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[nright-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[0]].<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a> &lt; 0)</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(7, <span class="stringliteral">&quot;Walking to nodes (%d %d) from (%d %d) fathers (%d %d)\n&quot;</span>,</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                       nleft-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[0], nright-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[0], this_left, this_right, tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[nleft-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[0]].<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a>, tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[nright-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[0]].<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a>);</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            this_left = nleft-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[0];</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            this_right = nright-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[0];</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        }</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <span class="comment">/* If the right node has particles, add them to the left node, go to sibling on right and left.*/</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(nright-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> == <a class="code" href="forcetree_8h.html#ac342a8bc2bb97849655e3ea50d3c5494">PARTICLE_NODE_TYPE</a>) {</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            <span class="keywordflow">for</span>(i = 0; i &lt; nright-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a>; i++) {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                <span class="keywordflow">if</span>(nright-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[i] &gt;= tb.<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>)</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                    <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(8, <span class="stringliteral">&quot;Bad child %d of %d\n&quot;</span>, i, nright-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[i], this_right);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#aa745b024ee4449af60e622e8c2bc32c1">add_particle_to_tree</a>(nright-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[i], this_left, tb, HybridNuGrav, nc, nnext) &lt; 0)</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            }</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            <span class="comment">/* Make sure that nodes which have</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">             * this_right as a sibling (there will</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">             * be a max of one, as it is a particle node</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">             * with no children) point to the replacement</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">             * on the left*/</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            <span class="comment">/* This condition is checking for the root node, which has no siblings*/</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            <span class="keywordflow">if</span>(this_right &gt; right) {</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                <span class="comment">/* Find the father, then the next child*/</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                <span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> * fat = &amp;tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[nright-&gt;<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a>];</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                <span class="comment">/* Find the position of this child in the father*/</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                <span class="keywordtype">int</span> sunloc = 0;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                <span class="keywordflow">for</span>(i = 0; i &lt; 8; i++)</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                {</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                    <span class="keywordflow">if</span>(fat-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[i] == this_right) {</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                        sunloc = i;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                    }</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                }</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                <span class="comment">/* Change the sibling of the child next to this one*/</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                <span class="keywordflow">if</span>(sunloc &gt; 0) {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                    <span class="keywordflow">if</span>(tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[fat-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[i-1]].<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a> == this_right)</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                        tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[fat-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[i-1]].<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a> = this_left;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                }</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            }</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            <span class="comment">/* Mark the right node as now invalid*/</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            nright-&gt;<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a> = -5;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            <span class="comment">/* Now go to sibling*/</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            this_left = nleft-&gt;<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a>;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            this_right = nright-&gt;<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a>;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        }</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <span class="comment">/* If the left node has particles, add them to the right node,</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">         * then copy the right node over the left node and go to (old) sibling on right and left.*/</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(nleft-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> == <a class="code" href="forcetree_8h.html#ac342a8bc2bb97849655e3ea50d3c5494">PARTICLE_NODE_TYPE</a> &amp;&amp; nright-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> == <a class="code" href="forcetree_8h.html#a3ad606200a7ba07b8766c7d37b2454c7">NODE_NODE_TYPE</a>) {</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            <span class="comment">/* Add the left particles to the right*/</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;            <span class="keywordflow">for</span>(i = 0; i &lt; nleft-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a>; i++) {</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                <span class="keywordflow">if</span>(nleft-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[i] &gt;= tb.<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>)</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                    <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(8, <span class="stringliteral">&quot;Bad child %d of %d\n&quot;</span>, i, nleft-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[i], this_left);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#aa745b024ee4449af60e622e8c2bc32c1">add_particle_to_tree</a>(nleft-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[i], this_right, tb, HybridNuGrav, nc, nnext) &lt; 0)</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            }</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;            <span class="comment">/* Copy the right node over the left*/</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            memmove(&amp;nleft-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>, &amp;nright-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>, <span class="keyword">sizeof</span>(nleft-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>));</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            nleft-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> = <a class="code" href="forcetree_8h.html#a3ad606200a7ba07b8766c7d37b2454c7">NODE_NODE_TYPE</a>;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            <span class="comment">/* Zero the momenta for the parent*/</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            memset(&amp;nleft-&gt;<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>, 0, <span class="keyword">sizeof</span>(nleft-&gt;<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>));</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            <span class="comment">/* Reset children to the new parent:</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">             * this assumes nright is a NODE NODE*/</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            <span class="keywordflow">for</span>(i = 0; i &lt; 8; i++) {</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                <span class="keywordtype">int</span> child = nleft-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[i];</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[child].<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a> = this_left;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            }</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            <span class="comment">/* Make sure final child points to the parent&#39;s sibling.*/</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            <span class="keywordtype">int</span> oldsib = tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[nleft-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[7]].<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a>;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            <span class="comment">/* Walk downwards making sure all the children point to the new sibling.</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">             * Note also changes last particle node child. */</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            <span class="keywordtype">int</span> nn = this_left;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            <span class="keywordflow">while</span>(tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[nn].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> == <a class="code" href="forcetree_8h.html#a3ad606200a7ba07b8766c7d37b2454c7">NODE_NODE_TYPE</a>) {</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                nn = tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[nn].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[7];</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                <span class="keywordflow">if</span>(tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[nn].<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a> != oldsib)</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                    <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(20, <span class="stringliteral">&quot;Not the expected sibling %d != %d\n&quot;</span>,tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[nn].<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a>, oldsib);</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[nn].<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a> = nleft-&gt;<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a>;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;            }</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            <span class="comment">/* Mark the right node as now invalid*/</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            nright-&gt;<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a> = -5;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            <span class="comment">/* Next iteration is going to sibling*/</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            this_left = nleft-&gt;<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a>;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            this_right = nright-&gt;<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a>;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        }</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(6, <span class="stringliteral">&quot;Nodes %d %d have unexpected type %d %d\n&quot;</span>, this_left, this_right, nleft-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a>, nright-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a>);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    }</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;}</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00661"></a><span class="lineno"><a class="line" href="forcetree_8c.html#a54c1bcfde446f424ff0b7f89199dde0a">  661</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="forcetree_8c.html#a54c1bcfde446f424ff0b7f89199dde0a">force_tree_create_nodes</a>(<span class="keyword">const</span> <a class="code" href="structForceTree.html">ForceTree</a> tb, <span class="keyword">const</span> <span class="keywordtype">int</span> npart, <span class="keywordtype">int</span> mask, <a class="code" href="structDomainDecomp.html">DomainDecomp</a> * ddecomp, <span class="keyword">const</span> <span class="keywordtype">int</span> HybridNuGrav)</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;{</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="keywordtype">int</span> nnext = tb.<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>;       <span class="comment">/* index of first free node */</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160; </div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="comment">/* create an empty root node  */</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        <span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> *nfreep = &amp;tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[nnext]; <span class="comment">/* select first node */</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160; </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a> = <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#afd51316d545eaf7f3f083aea9616858d">BoxSize</a>*1.001;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordflow">for</span>(i = 0; i &lt; 3; i++)</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;            nfreep-&gt;<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[i] = <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#afd51316d545eaf7f3f083aea9616858d">BoxSize</a>/2.;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="forcetree_8h.html#afcfeb1a32a47b8b7f8bce9222b542a9e">NMAXCHILD</a>; i++)</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            nfreep-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[i] = -1;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#ac1593255d2d991cb18a3b4b0d5f4f7a6">Types</a> = 0;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a> = 0;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a> = -1;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a> = -1;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#aa3b4bfc6b6c8c99d88860a5262679487">TopLevel</a> = 1;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#ac63501e2f4f5076dfe3534268e89bc39">InternalTopLevel</a> = 0;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a1ff8c5e570722798d188c60455312fa2">DependsOnLocalMass</a> = 0;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> = <a class="code" href="forcetree_8h.html#ac342a8bc2bb97849655e3ea50d3c5494">PARTICLE_NODE_TYPE</a>;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a85ba1893599828fd008829ac46e5a234">unused</a> = 0;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        memset(&amp;(nfreep-&gt;<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>),0,3*<span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a>));</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a> = 0;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a> = 0;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        nnext++;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        <span class="comment">/* create a set of empty nodes corresponding to the top-level ddecomp</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="comment">         * grid. We need to generate these nodes first to make sure that we have a</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="comment">         * complete top-level tree which allows the easy insertion of the</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="comment">         * pseudo-particles in the right place */</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        <a class="code" href="forcetree_8c.html#a4a6ff36eefac3d77669f28982e4f02b0">force_create_node_for_topnode</a>(tb.<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>, 0, tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>, ddecomp, 1, 0, 0, 0, &amp;nnext, tb.<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a>);</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    }</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="comment">/* Set up thread-local copies of the topnodes to anchor the subtrees. */</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>, j, t;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    MPI_Comm_rank(MPI_COMM_WORLD, &amp;<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>);</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> StartLeaf = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">Tasks</a>[<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>].<a class="code" href="structtask__data.html#adb9ec65f9257aa87c1811f283061ef4b">StartLeaf</a>;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> EndLeaf = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">Tasks</a>[<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>].<a class="code" href="structtask__data.html#a3282c0a233e6ab985c0c9568f2589a6f">EndLeaf</a>;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> nthr = omp_get_max_threads();</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="keywordtype">int</span> * topnodes = <a class="code" href="mymalloc_8h.html#a52bc2c6ec78b17bb6d42957cbf642f15">ta_malloc</a>(<span class="stringliteral">&quot;topnodes&quot;</span>, <span class="keywordtype">int</span>, (EndLeaf - StartLeaf) * nthr);</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="comment">/* Topnodes for each thread. For tid 0, just use the real tree. Saves copying the tree back.*/</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keywordflow">for</span>(j = 0; j &lt; EndLeaf - StartLeaf; j++)</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        topnodes[j] = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#adcfdab38d4690533d89c93b927df477f">TopLeaves</a>[j + StartLeaf].<a class="code" href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">treenode</a>;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="comment">/* Other threads need a copy*/</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="keywordflow">for</span>(t = 1; t &lt; nthr; t++) {</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <span class="keywordflow">for</span>(j = 0; j &lt; EndLeaf - StartLeaf; j++) {</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            <span class="comment">/* Make a local copy*/</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            topnodes[j + t * (EndLeaf - StartLeaf)] = nnext;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            memmove(&amp;tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[nnext], &amp;tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[topnodes[j]], <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structNODE.html">NODE</a>));</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            nnext++;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        }</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    }</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160; </div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="comment">/*     double tstart = second(); */</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> first_free = nnext;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="comment">/* Increment nnext for the threads we are about to initialise.*/</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    nnext += <a class="code" href="forcetree_8c.html#ae9d22ac96be9a18932a00837b0a78f30">NODECACHE_SIZE</a> * nthr;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="comment">/* now we insert all particles */</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="preprocessor">    #pragma omp parallel</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    {</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="comment">/* Local topnodes*/</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <span class="keywordtype">int</span> tid = omp_get_thread_num();</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> * <span class="keyword">const</span> local_topnodes = topnodes + tid * (EndLeaf - StartLeaf);</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160; </div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <span class="comment">/* This implements a small thread-local free Node cache.</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="comment">         * The cache ensures that Nodes from the same (or close) particles</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment">         * are created close to each other on the Node list and thus</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment">         * helps cache locality. I tried each thread getting a separate</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="comment">         * part of the tree, and it wasted too much memory. */</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        <span class="keyword">struct </span><a class="code" href="structNodeCache.html">NodeCache</a> nc;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        nc.<a class="code" href="structNodeCache.html#a9486e11f8687f7f5797654f117a50c8c">nnext_thread</a> = first_free + tid * <a class="code" href="forcetree_8c.html#ae9d22ac96be9a18932a00837b0a78f30">NODECACHE_SIZE</a>;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        nc.<a class="code" href="structNodeCache.html#a34fe9100da8a71f0b571f12bb85a3c70">nrem_thread</a> = <a class="code" href="forcetree_8c.html#ae9d22ac96be9a18932a00837b0a78f30">NODECACHE_SIZE</a>;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160; </div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        <span class="comment">/* Stores the last-seen node on this thread.</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="comment">         * Since most particles are close to each other, this should save a number of tree walks.*/</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        <span class="keywordtype">int</span> this_acc = local_topnodes[0];</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        <span class="comment">// message(1, &quot;Topnodes %d real %d\n&quot;, local_topnodes[0], topnodes[0]);</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160; </div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <span class="comment">/* The default schedule is static with a chunk 1/4 the total.</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="comment">         * However, particles are sorted by type and then by peano order.</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment">         * Since we need to merge trees, it is advantageous to have all particles</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="comment">         * spatially close be processed by the same thread. This means that the threads should</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment">         * process particles at a constant offset from the start of the type.</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="comment">         * We do this with a static schedule. */</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        <span class="keywordtype">int</span> chnksz = <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a>/nthr;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[0].<a class="code" href="structslot__info.html#a29b1b6c4eae612eca7f1125a0c854436">enabled</a> &amp;&amp; <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[0].<a class="code" href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">size</a> &gt; 0)</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            chnksz = <a class="code" href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a>-&gt;<a class="code" href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">info</a>[0].<a class="code" href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">size</a>/nthr;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="keywordflow">if</span>(chnksz &lt; 1000)</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            chnksz = 1000;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="preprocessor">        #pragma omp for schedule(static, chnksz)</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="keywordflow">for</span>(i = 0; i &lt; npart; i++)</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        {</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            <span class="comment">/*Can&#39;t break from openmp for*/</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            <span class="keywordflow">if</span>(nc.<a class="code" href="structNodeCache.html#a9486e11f8687f7f5797654f117a50c8c">nnext_thread</a> &gt;= tb.<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a>)</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160; </div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            <span class="comment">/* Do not add types that do not have their mask bit set.*/</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            <span class="keywordflow">if</span>(!((1&lt;&lt;<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Type) &amp; mask)) {</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            }</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            <span class="comment">/* Do not add garbage/swallowed particles to the tree*/</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].IsGarbage || (<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Swallowed &amp;&amp; <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Type==5))</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Mass == 0)</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(12, <span class="stringliteral">&quot;Zero mass particle %d type %d id %ld pos %g %g %g\n&quot;</span>, i, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Type, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].ID, <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Pos[0], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Pos[1], <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Pos[2]);</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            <span class="comment">/*First find the Node for the TopLeaf */</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            <span class="keywordtype">int</span> cur;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#ab3ee27767a982ea77a18f5f4983e4344">inside_node</a>(&amp;tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[this_acc], i)) {</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                cur = this_acc;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                <span class="comment">/* Get the topnode to which a particle belongs. Each local tree</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="comment">                 * has a local set of treenodes copying the global topnodes, except tid 0</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="comment">                 * which has the real topnodes.*/</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> topleaf = <a class="code" href="domain_8h.html#aa7470209c061c08a6f7a32ad9c3610a5">domain_get_topleaf</a>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Key, ddecomp);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                <span class="comment">//int treenode = ddecomp-&gt;TopLeaves[topleaf].treenode;</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                cur = local_topnodes[topleaf - StartLeaf];</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            }</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160; </div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            this_acc = <a class="code" href="forcetree_8c.html#aa745b024ee4449af60e622e8c2bc32c1">add_particle_to_tree</a>(i, cur, tb, HybridNuGrav, &amp;nc, &amp;nnext);</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        }</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        <span class="comment">/* The implicit omp-barrier is important here!*/</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="comment">/*         double tend = second(); */</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="comment">/*         message(0, &quot;Initial insertion: %.3g ms. First node %d\n&quot;, (tend - tstart)*1000, local_topnodes[0]); */</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160; </div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="comment">/* Merge each topnode separately, using a for loop.</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="comment">         * This wastes threads if NTHREAD &gt; NTOPNODES, but it</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="comment">         * means only one merge is done per subtree and</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment">         * it requires no locking.*/</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="preprocessor">        #pragma omp for schedule(static, 1)</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <span class="keywordflow">for</span>(i = 0; i &lt; EndLeaf - StartLeaf; i++) {</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;            <span class="keywordtype">int</span> t;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            <span class="comment">/* These are the addresses of the real topnodes*/</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> target = topnodes[i];</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;            <span class="keywordflow">if</span>(nc.<a class="code" href="structNodeCache.html#a9486e11f8687f7f5797654f117a50c8c">nnext_thread</a> &gt;= tb.<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a>)</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;            <span class="keywordflow">for</span>(t = 1; t &lt; nthr; t++) {</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> righttop = topnodes[i + t * (EndLeaf - StartLeaf)];</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment">//                  message(1, &quot;tid = %d i = %d t = %d Merging %d to %d addresses are %lx - %lx end is %lx\n&quot;, omp_get_thread_num(), i, t, righttop, target, &amp;tb.Nodes[righttop], &amp;tb.Nodes[target], &amp;tb.Nodes[nnext]);</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#a43eea1e716d44d6b38a732d94df1b4ce">merge_partial_force_trees</a>(target, righttop, &amp;nc, &amp;nnext, tb, HybridNuGrav))</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            }</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        }</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    }</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160; </div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <a class="code" href="mymalloc_8h.html#a84e2115e90e9c22e11d9663c019fc8bc">ta_free</a>(topnodes);</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordflow">return</span> nnext - tb.<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;}</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160; </div>
<div class="line"><a name="l00818"></a><span class="lineno"><a class="line" href="forcetree_8c.html#a4a6ff36eefac3d77669f28982e4f02b0">  818</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="forcetree_8c.html#a4a6ff36eefac3d77669f28982e4f02b0">force_create_node_for_topnode</a>(<span class="keywordtype">int</span> no, <span class="keywordtype">int</span> topnode, <span class="keyword">struct</span> <a class="code" href="structNODE.html">NODE</a> * Nodes, <span class="keyword">const</span> <a class="code" href="structDomainDecomp.html">DomainDecomp</a> * ddecomp, <span class="keywordtype">int</span> bits, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> z, <span class="keywordtype">int</span> *nextfree, <span class="keyword">const</span> <span class="keywordtype">int</span> lastnode)</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;{</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keywordtype">int</span> i, j, k;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160; </div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="comment">/*We reached the leaf of the toptree*/</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <span class="keywordflow">if</span>(ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a223388382f723d03b4613b5880536f72">TopNodes</a>[topnode].<a class="code" href="structtopnode__data.html#ad2e76e39d74f3c299b38fa680ecdb794">Daughter</a> &lt; 0)</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160; </div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; 2; i++)</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        <span class="keywordflow">for</span>(j = 0; j &lt; 2; j++)</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;            <span class="keywordflow">for</span>(k = 0; k &lt; 2; k++)</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;            {</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                <span class="keywordtype">int</span> sub = 7 &amp; <a class="code" href="peano_8c.html#a2b98881a670e236ef744e3283ebe71a4">peano_hilbert_key</a>((x &lt;&lt; 1) + i, (y &lt;&lt; 1) + j, (z &lt;&lt; 1) + k, bits);</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160; </div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                <span class="keywordtype">int</span> count = i + 2 * j + 4 * k;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160; </div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;                Nodes[no].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#ac1593255d2d991cb18a3b4b0d5f4f7a6">Types</a> = 0;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                Nodes[no].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[count] = *nextfree;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;                <span class="comment">/*We are an internal top level node as we now have a child top level.*/</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;                Nodes[no].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#ac63501e2f4f5076dfe3534268e89bc39">InternalTopLevel</a> = 1;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;                Nodes[no].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> = <a class="code" href="forcetree_8h.html#a3ad606200a7ba07b8766c7d37b2454c7">NODE_NODE_TYPE</a>;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;                Nodes[no].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a> = (1&lt;&lt;16);</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160; </div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                <span class="comment">/* We create a new leaf node.*/</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;                <a class="code" href="forcetree_8c.html#a068d7c90773680cb8c9b0684d584420d">init_internal_node</a>(&amp;Nodes[*nextfree], &amp;Nodes[no], count);</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                <span class="comment">/*Set father of new node*/</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                Nodes[*nextfree].<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a> = no;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                <span class="comment">/*All nodes here are top level nodes*/</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                Nodes[*nextfree].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#aa3b4bfc6b6c8c99d88860a5262679487">TopLevel</a> = 1;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160; </div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtopnode__data.html">topnode_data</a> curtopnode = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a223388382f723d03b4613b5880536f72">TopNodes</a>[ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a223388382f723d03b4613b5880536f72">TopNodes</a>[topnode].<a class="code" href="structtopnode__data.html#ad2e76e39d74f3c299b38fa680ecdb794">Daughter</a> + sub];</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                <span class="keywordflow">if</span>(curtopnode.<a class="code" href="structtopnode__data.html#ad2e76e39d74f3c299b38fa680ecdb794">Daughter</a> == -1) {</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                    ddecomp-&gt;<a class="code" href="structDomainDecomp.html#adcfdab38d4690533d89c93b927df477f">TopLeaves</a>[curtopnode.<a class="code" href="structtopnode__data.html#aa5c48f2ae0bd1e2ed8ca069e4eeb29cd">Leaf</a>].<a class="code" href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">treenode</a> = *nextfree;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                }</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160; </div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;                (*nextfree)++;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160; </div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;                <span class="keywordflow">if</span>(*nextfree &gt;= lastnode)</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;                    <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(11, <span class="stringliteral">&quot;Not enough force nodes to topnode grid: need %d\n&quot;</span>,lastnode);</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            }</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="comment">/* Set sibling on the child*/</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keywordflow">for</span>(j=0; j&lt;7; j++) {</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        <span class="keywordtype">int</span> chld = Nodes[no].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[j];</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        Nodes[chld].<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a> = Nodes[no].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[j+1];</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    }</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    Nodes[Nodes[no].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[7]].<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a> = Nodes[no].<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a>;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; 2; i++)</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        <span class="keywordflow">for</span>(j = 0; j &lt; 2; j++)</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            <span class="keywordflow">for</span>(k = 0; k &lt; 2; k++)</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            {</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                <span class="keywordtype">int</span> sub = 7 &amp; <a class="code" href="peano_8c.html#a2b98881a670e236ef744e3283ebe71a4">peano_hilbert_key</a>((x &lt;&lt; 1) + i, (y &lt;&lt; 1) + j, (z &lt;&lt; 1) + k, bits);</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                <span class="keywordtype">int</span> count = i + 2 * j + 4 * k;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                <a class="code" href="forcetree_8c.html#a4a6ff36eefac3d77669f28982e4f02b0">force_create_node_for_topnode</a>(Nodes[no].s.suns[count], ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a223388382f723d03b4613b5880536f72">TopNodes</a>[topnode].<a class="code" href="structtopnode__data.html#ad2e76e39d74f3c299b38fa680ecdb794">Daughter</a> + sub, Nodes, ddecomp,</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                        bits + 1, 2 * x + i, 2 * y + j, 2 * z + k, nextfree, lastnode);</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            }</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160; </div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;}</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160; </div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00883"></a><span class="lineno"><a class="line" href="forcetree_8c.html#aad5388b597f7a479c120f37a72d96a1f">  883</a></span>&#160;<a class="code" href="forcetree_8c.html#aad5388b597f7a479c120f37a72d96a1f">force_insert_pseudo_particles</a>(<span class="keyword">const</span> <a class="code" href="structForceTree.html">ForceTree</a> * tree, <span class="keyword">const</span> <a class="code" href="structDomainDecomp.html">DomainDecomp</a> * ddecomp)</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;{</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="keywordtype">int</span> i, index;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> firstpseudo = tree-&gt;<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a>;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    MPI_Comm_rank(MPI_COMM_WORLD, &amp;<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>);</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160; </div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; ddecomp-&gt;<a class="code" href="structDomainDecomp.html#ae063710516bbb9f1fa1350b5b3c02a93">NTopLeaves</a>; i++)</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    {</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        index = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#adcfdab38d4690533d89c93b927df477f">TopLeaves</a>[i].<a class="code" href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">treenode</a>;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        <span class="keywordflow">if</span>(ddecomp-&gt;<a class="code" href="structDomainDecomp.html#adcfdab38d4690533d89c93b927df477f">TopLeaves</a>[i].<a class="code" href="structtopleaf__data.html#aac3bdb4c81e2029d92196ff60d650b8b">Task</a> != <a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>) {</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;            <span class="keywordflow">if</span>(tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[index].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a> != 0)</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(5, <span class="stringliteral">&quot;In node %d, overwriting %d child particles (i = %d etc) with pseudo particle %d\n&quot;</span>,</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                       index, tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[index].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a>, tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[index].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[0], i);</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;            tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[index].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> = <a class="code" href="forcetree_8h.html#aca0ae17134eee3f867d5d7579a97ba64">PSEUDO_NODE_TYPE</a>;</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            <span class="comment">/* This node points to the pseudo particle*/</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;            tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[index].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[0] = firstpseudo + i;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        }</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    }</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;}</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160; </div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l00905"></a><span class="lineno"><a class="line" href="forcetree_8c.html#ab8a2310bd448851f4aa42ae6bcec2e01">  905</a></span>&#160;<a class="code" href="forcetree_8c.html#ab8a2310bd448851f4aa42ae6bcec2e01">force_get_father</a>(<span class="keywordtype">int</span> no, <span class="keyword">const</span> <a class="code" href="structForceTree.html">ForceTree</a> * tree)</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;{</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <span class="keywordflow">if</span>(no &gt;= tree-&gt;<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>)</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <span class="keywordflow">return</span> tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a>;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <span class="keywordflow">return</span> tree-&gt;<a class="code" href="structForceTree.html#a9c794bfbfd1b1c68d201af6a8564fd13">Father</a>[no];</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;}</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160; </div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00914"></a><span class="lineno"><a class="line" href="forcetree_8c.html#a569cd386bf7d67968fad6344898cb70c">  914</a></span>&#160;<a class="code" href="forcetree_8c.html#a569cd386bf7d67968fad6344898cb70c">add_particle_moment_to_node</a>(<span class="keyword">struct</span> <a class="code" href="structNODE.html">NODE</a> * pnode, <span class="keywordtype">int</span> i)</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;{</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="keywordtype">int</span> k;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    pnode-&gt;<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a> += (<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Mass);</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    <span class="keywordflow">for</span>(k=0; k&lt;3; k++)</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        pnode-&gt;<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[k] += (<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Mass * <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Pos[k]);</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160; </div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Type == 0)</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    {</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        <span class="keywordtype">int</span> j;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        <span class="comment">/* Maximal distance any of the member particles peek out from the side of the node.</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="comment">         * May be at most hmax, as |Pos - Center| &lt; len.*/</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++) {</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;            pnode-&gt;<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a> = <a class="code" href="test__interp_8c.html#ac06514a27a2843d8325c1e46ad595b39">DMAX</a>(pnode-&gt;<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a>, fabs(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Pos[j] - pnode-&gt;<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[j]) + <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Hsml - pnode-&gt;<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a>);</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        }</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    }</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;}</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160; </div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="comment">/*Get the sibling of a node, using the suns array. Only to be used in the tree build, before update_node_recursive is called.*/</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line"><a name="l00934"></a><span class="lineno"><a class="line" href="forcetree_8c.html#a9561f4d1c37823ef1082ea39cd2dc0f3">  934</a></span>&#160;<a class="code" href="forcetree_8c.html#a9561f4d1c37823ef1082ea39cd2dc0f3">force_get_sibling</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> sib, <span class="keyword">const</span> <span class="keywordtype">int</span> j, <span class="keyword">const</span> <span class="keywordtype">int</span> * suns)</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;{</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="comment">/* check if we have a sibling on the same level */</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="keywordtype">int</span> jj;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    <span class="keywordtype">int</span> nextsib = sib;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <span class="keywordflow">for</span>(jj = j + 1; jj &lt; 8; jj++) {</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        <span class="keywordflow">if</span>(suns[jj] &gt;= 0) {</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            nextsib = suns[jj];</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        }</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    }</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    <span class="keywordflow">return</span> nextsib;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;}</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160; </div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="comment">/* Set the center of mass of the current node*/</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00950"></a><span class="lineno"><a class="line" href="forcetree_8c.html#ac8445ebf6810e2fed2bcfea994a668bf">  950</a></span>&#160;<a class="code" href="forcetree_8c.html#ac8445ebf6810e2fed2bcfea994a668bf">force_update_particle_node</a>(<span class="keywordtype">int</span> no, <span class="keyword">const</span> <a class="code" href="structForceTree.html">ForceTree</a> * tree)</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;{</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="keywordflow">if</span>(tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> != <a class="code" href="forcetree_8h.html#ac342a8bc2bb97849655e3ea50d3c5494">PARTICLE_NODE_TYPE</a>)</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(3, <span class="stringliteral">&quot;force_update_particle_node called on node %d of wrong type!\n&quot;</span>, no);</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <span class="keywordtype">int</span> j;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="comment">/*Set the center of mass moments*/</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> mass = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a>;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="comment">/* Be careful about empty nodes*/</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <span class="keywordflow">if</span>(mass &gt; 0) {</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;            tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[j] /= mass;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    }</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;            tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[j] = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[j];</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    }</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;}</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160; </div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line"><a name="l00982"></a><span class="lineno"><a class="line" href="forcetree_8c.html#accd80e6d7d45105a1af51e093c771aae">  982</a></span>&#160;<a class="code" href="forcetree_8c.html#accd80e6d7d45105a1af51e093c771aae">force_update_node_recursive</a>(<span class="keywordtype">int</span> no, <span class="keywordtype">int</span> sib, <span class="keywordtype">int</span> level, <span class="keyword">const</span> <a class="code" href="structForceTree.html">ForceTree</a> * tree)</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;{</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="keywordflow">if</span>(tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> != <a class="code" href="forcetree_8h.html#a3ad606200a7ba07b8766c7d37b2454c7">NODE_NODE_TYPE</a>)</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(3, <span class="stringliteral">&quot;force_update_node_recursive called on node %d of type %d != %d!\n&quot;</span>, no, tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a>, <a class="code" href="forcetree_8h.html#a3ad606200a7ba07b8766c7d37b2454c7">NODE_NODE_TYPE</a>);</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="keywordtype">int</span> j;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="keywordtype">int</span> * suns = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160; </div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    <span class="keywordtype">int</span> childcnt = 0;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="comment">/* Remove any empty children, moving the suns array around</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="comment">     * so non-empty entries are contiguous at the beginning of the array.</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="comment">     * This sharply reduces the size of the tree.</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="comment">     * Also count the node children for thread balancing.*/</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <span class="keywordtype">int</span> jj = 0;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    <span class="keywordflow">for</span>(j=0; j &lt; 8; j++, jj++) {</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        <span class="comment">/* Never remove empty top-level nodes so we don&#39;t</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="comment">         * mess up the pseudo-data exchange.</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment">         * This may happen for a pseudo particle host or, in very rare cases,</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="comment">         * when one of the local domains is empty. */</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        <span class="keywordflow">while</span>(jj &lt; 8 &amp;&amp; !tree-&gt;Nodes[suns[jj]].f.TopLevel &amp;&amp;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;            tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[suns[jj]].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> == <a class="code" href="forcetree_8h.html#ac342a8bc2bb97849655e3ea50d3c5494">PARTICLE_NODE_TYPE</a> &amp;&amp;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[suns[jj]].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">noccupied</a> == 0) {</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;                    jj++;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        }</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        <span class="keywordflow">if</span>(jj &lt; 8)</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            suns[j] = suns[jj];</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            suns[j] = -1;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        <span class="keywordflow">if</span>(suns[j] &gt;= 0 &amp;&amp; tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[suns[j]].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> == <a class="code" href="forcetree_8h.html#a3ad606200a7ba07b8766c7d37b2454c7">NODE_NODE_TYPE</a>)</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;            childcnt++;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    }</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160; </div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="comment">/*First do the children*/</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    <span class="keywordflow">for</span>(j = 0; j &lt; 8; j++)</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    {</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        <span class="keywordtype">int</span> p = suns[j];</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        <span class="comment">/*Empty slot*/</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        <span class="keywordflow">if</span>(p &lt; 0)</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> nextsib = <a class="code" href="forcetree_8c.html#a9561f4d1c37823ef1082ea39cd2dc0f3">force_get_sibling</a>(sib, j, suns);</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        <span class="comment">/* This is set in create_nodes but needed because we may remove empty nodes above.*/</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a> = nextsib;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        <span class="comment">/* Nodes containing particles or pseudo-particles*/</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        <span class="keywordflow">if</span>(tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> == <a class="code" href="forcetree_8h.html#ac342a8bc2bb97849655e3ea50d3c5494">PARTICLE_NODE_TYPE</a>)</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;            <a class="code" href="forcetree_8c.html#ac8445ebf6810e2fed2bcfea994a668bf">force_update_particle_node</a>(p, tree);</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        <span class="keywordflow">if</span>(tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> == <a class="code" href="forcetree_8h.html#a3ad606200a7ba07b8766c7d37b2454c7">NODE_NODE_TYPE</a>) {</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;            <span class="comment">/* Don&#39;t spawn a new task if we are deep enough that we already spawned a lot.*/</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;            <span class="keywordflow">if</span>(childcnt &gt; 1 &amp;&amp; level &lt; 512) {</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="preprocessor">                #pragma omp task default(none) shared(level, childcnt, tree) firstprivate(nextsib, p)</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                <a class="code" href="forcetree_8c.html#accd80e6d7d45105a1af51e093c771aae">force_update_node_recursive</a>(p, nextsib, level*childcnt, tree);</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;            }</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                <a class="code" href="forcetree_8c.html#accd80e6d7d45105a1af51e093c771aae">force_update_node_recursive</a>(p, nextsib, level, tree);</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        }</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    }</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160; </div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    <span class="comment">/*Make sure all child nodes are done*/</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="preprocessor">    #pragma omp taskwait</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160; </div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <span class="comment">/*Now we do the moments*/</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="keywordflow">for</span>(j = 0; j &lt; 8; j++)</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    {</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> p = suns[j];</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;        <span class="keywordflow">if</span>(p &lt; 0)</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a> += (tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a>);</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[0] += (tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a> * tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[0]);</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[1] += (tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a> * tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[1]);</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[2] += (tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a> * tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[2]);</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        <span class="keywordflow">if</span>(tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a> &gt; tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a>)</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;            tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a> = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a>;</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    }</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160; </div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <span class="comment">/*Set the center of mass moments*/</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> mass = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a>;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <span class="comment">/* In principle all the children could be pseudo-particles*/</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    <span class="keywordflow">if</span>(mass &gt; 0) {</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[0] /= mass;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[1] /= mass;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[2] /= mass;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    }</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160; </div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;}</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160; </div>
<div class="line"><a name="l01081"></a><span class="lineno"><a class="line" href="forcetree_8c.html#a8c06d93e6c1c1afab740e393528fa0f6"> 1081</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="forcetree_8c.html#a8c06d93e6c1c1afab740e393528fa0f6">force_update_node_parallel</a>(<span class="keyword">const</span> <a class="code" href="structForceTree.html">ForceTree</a> * tree, <span class="keyword">const</span> <a class="code" href="structDomainDecomp.html">DomainDecomp</a> * ddecomp)</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;{</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    MPI_Comm_rank(MPI_COMM_WORLD, &amp;<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>);</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160; </div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="preprocessor">#pragma omp parallel</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="preprocessor">#pragma omp single nowait</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    {</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <span class="keywordflow">for</span>(i = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">Tasks</a>[<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>].<a class="code" href="structtask__data.html#adb9ec65f9257aa87c1811f283061ef4b">StartLeaf</a>; i &lt; ddecomp-&gt;Tasks[<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>].EndLeaf; i ++) {</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> no = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#adcfdab38d4690533d89c93b927df477f">TopLeaves</a>[i].<a class="code" href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">treenode</a>;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;            <span class="comment">/* Nodes containing other nodes: the overwhelmingly likely case.*/</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            <span class="keywordflow">if</span>(tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> == <a class="code" href="forcetree_8h.html#a3ad606200a7ba07b8766c7d37b2454c7">NODE_NODE_TYPE</a>) {</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="preprocessor">                #pragma omp task default(none) shared(tree) firstprivate(no)</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;                <a class="code" href="forcetree_8c.html#accd80e6d7d45105a1af51e093c771aae">force_update_node_recursive</a>(no, tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a>, 1, tree);</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;            }</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> == <a class="code" href="forcetree_8h.html#ac342a8bc2bb97849655e3ea50d3c5494">PARTICLE_NODE_TYPE</a>)</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                <a class="code" href="forcetree_8c.html#ac8445ebf6810e2fed2bcfea994a668bf">force_update_particle_node</a>(no, tree);</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> == <a class="code" href="forcetree_8h.html#aca0ae17134eee3f867d5d7579a97ba64">PSEUDO_NODE_TYPE</a>)</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(5, <span class="stringliteral">&quot;Error, found pseudo node %d but domain entry %d says on task %d\n&quot;</span>, no, i, <a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>);</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        }</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    }</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;}</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160; </div>
<div class="line"><a name="l01109"></a><span class="lineno"><a class="line" href="forcetree_8c.html#a9d7fd9824e1f0c1d268c43a85cffd153"> 1109</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="forcetree_8c.html#a9d7fd9824e1f0c1d268c43a85cffd153">force_exchange_pseudodata</a>(<a class="code" href="structForceTree.html">ForceTree</a> * tree, <span class="keyword">const</span> <a class="code" href="structDomainDecomp.html">DomainDecomp</a> * ddecomp)</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;{</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="test__exchange_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>, <a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <span class="keywordtype">int</span> i, no, ta, recvTask;</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="keywordtype">int</span> *recvcounts, *recvoffset;</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <span class="keyword">struct </span>topleaf_momentsdata</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    {</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> s[3];</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> mass;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;        <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> hmax;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    }</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    *TopLeafMoments;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160; </div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    MPI_Comm_size(MPI_COMM_WORLD, &amp;<a class="code" href="test__exchange_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>);</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    MPI_Comm_rank(MPI_COMM_WORLD, &amp;<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>);</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160; </div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    TopLeafMoments = (<span class="keyword">struct </span>topleaf_momentsdata *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;TopLeafMoments&quot;</span>, ddecomp-&gt;<a class="code" href="structDomainDecomp.html#ae063710516bbb9f1fa1350b5b3c02a93">NTopLeaves</a> * <span class="keyword">sizeof</span>(TopLeafMoments[0]));</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    memset(&amp;TopLeafMoments[0], 0, <span class="keyword">sizeof</span>(TopLeafMoments[0]) * ddecomp-&gt;<a class="code" href="structDomainDecomp.html#ae063710516bbb9f1fa1350b5b3c02a93">NTopLeaves</a>);</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160; </div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    <span class="keywordflow">for</span>(i = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">Tasks</a>[<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>].<a class="code" href="structtask__data.html#adb9ec65f9257aa87c1811f283061ef4b">StartLeaf</a>; i &lt; ddecomp-&gt;Tasks[<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>].EndLeaf; i ++) {</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        no = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#adcfdab38d4690533d89c93b927df477f">TopLeaves</a>[i].<a class="code" href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">treenode</a>;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        <span class="keywordflow">if</span>(ddecomp-&gt;<a class="code" href="structDomainDecomp.html#adcfdab38d4690533d89c93b927df477f">TopLeaves</a>[i].<a class="code" href="structtopleaf__data.html#aac3bdb4c81e2029d92196ff60d650b8b">Task</a> != <a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>)</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;            <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(131231231, <span class="stringliteral">&quot;TopLeaf %d Task table is corrupted: task is %d\n&quot;</span>, i, ddecomp-&gt;<a class="code" href="structDomainDecomp.html#adcfdab38d4690533d89c93b927df477f">TopLeaves</a>[i].<a class="code" href="structtopleaf__data.html#aac3bdb4c81e2029d92196ff60d650b8b">Task</a>);</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160; </div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;        <span class="comment">/* read out the multipole moments from the local base cells */</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;        TopLeafMoments[i].s[0] = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[0];</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;        TopLeafMoments[i].s[1] = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[1];</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        TopLeafMoments[i].s[2] = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[2];</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;        TopLeafMoments[i].mass = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a>;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;        TopLeafMoments[i].hmax = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a>;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160; </div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;        <span class="comment">/*Set the local base nodes dependence on local mass*/</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;        <span class="keywordflow">while</span>(no &gt;= 0)</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        {</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;            <span class="keywordflow">if</span>(tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">ChildType</a> == <a class="code" href="forcetree_8h.html#aca0ae17134eee3f867d5d7579a97ba64">PSEUDO_NODE_TYPE</a>)</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;                <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(333, <span class="stringliteral">&quot;Pseudo node %d parent of a leaf on this processor %d\n&quot;</span>, no, ddecomp-&gt;<a class="code" href="structDomainDecomp.html#adcfdab38d4690533d89c93b927df477f">TopLeaves</a>[i].<a class="code" href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">treenode</a>);</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;            <span class="keywordflow">if</span>(tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a1ff8c5e570722798d188c60455312fa2">DependsOnLocalMass</a>)</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160; </div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;            tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#a1ff8c5e570722798d188c60455312fa2">DependsOnLocalMass</a> = 1;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160; </div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;            no = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a>;</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;        }</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    }</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160; </div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    <span class="comment">/* share the pseudo-particle data across CPUs */</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160; </div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    recvcounts = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;recvcounts&quot;</span>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * <a class="code" href="test__exchange_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>);</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    recvoffset = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;recvoffset&quot;</span>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * <a class="code" href="test__exchange_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>);</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160; </div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <span class="keywordflow">for</span>(recvTask = 0; recvTask &lt; <a class="code" href="test__exchange_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; recvTask++)</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    {</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        recvoffset[recvTask] = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">Tasks</a>[recvTask].<a class="code" href="structtask__data.html#adb9ec65f9257aa87c1811f283061ef4b">StartLeaf</a> * <span class="keyword">sizeof</span>(TopLeafMoments[0]);</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        recvcounts[recvTask] = (ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">Tasks</a>[recvTask].<a class="code" href="structtask__data.html#a3282c0a233e6ab985c0c9568f2589a6f">EndLeaf</a> - ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">Tasks</a>[recvTask].<a class="code" href="structtask__data.html#adb9ec65f9257aa87c1811f283061ef4b">StartLeaf</a>) * <span class="keyword">sizeof</span>(TopLeafMoments[0]);</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    }</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160; </div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    MPI_Allgatherv(MPI_IN_PLACE, 0, MPI_DATATYPE_NULL,</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;            &amp;TopLeafMoments[0], recvcounts, recvoffset,</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;            MPI_BYTE, MPI_COMM_WORLD);</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160; </div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(recvoffset);</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(recvcounts);</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160; </div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160; </div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    <span class="keywordflow">for</span>(ta = 0; ta &lt; <a class="code" href="test__exchange_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; ta++) {</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;        <span class="keywordflow">if</span>(ta == <a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>) <span class="keywordflow">continue</span>; <span class="comment">/* bypass ThisTask since it is already up to date */</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160; </div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;        <span class="keywordflow">for</span>(i = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">Tasks</a>[ta].<a class="code" href="structtask__data.html#adb9ec65f9257aa87c1811f283061ef4b">StartLeaf</a>; i &lt; ddecomp-&gt;Tasks[ta].EndLeaf; i ++) {</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;            no = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#adcfdab38d4690533d89c93b927df477f">TopLeaves</a>[i].<a class="code" href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">treenode</a>;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160; </div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;            tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[0] = TopLeafMoments[i].s[0];</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;            tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[1] = TopLeafMoments[i].s[1];</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;            tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[2] = TopLeafMoments[i].s[2];</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;            tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a> = TopLeafMoments[i].mass;</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;            tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a> = TopLeafMoments[i].hmax;</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;         }</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    }</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(TopLeafMoments);</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;}</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160; </div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160; </div>
<div class="line"><a name="l01195"></a><span class="lineno"><a class="line" href="forcetree_8c.html#a17b712760ce589aaaf16d64abf4a65dc"> 1195</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="forcetree_8c.html#a17b712760ce589aaaf16d64abf4a65dc">force_treeupdate_pseudos</a>(<span class="keywordtype">int</span> no, <span class="keyword">const</span> <a class="code" href="structForceTree.html">ForceTree</a> * tree)</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;{</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    <span class="keywordtype">int</span> j, p;</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> hmax;</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> s[3], mass;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160; </div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    mass = 0;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    s[0] = 0;</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    s[1] = 0;</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    s[2] = 0;</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    hmax = 0;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160; </div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <span class="comment">/* This happens if we have a trivial domain with only one entry*/</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    <span class="keywordflow">if</span>(!tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#ac63501e2f4f5076dfe3534268e89bc39">InternalTopLevel</a>)</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160; </div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    p = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">s</a>.<a class="code" href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">suns</a>[0];</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160; </div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <span class="comment">/* since we are dealing with top-level nodes, we know that there are 8 consecutive daughter nodes */</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <span class="keywordflow">for</span>(j = 0; j &lt; 8; j++)</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    {</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;        <span class="comment">/*This may not happen as we are an internal top level node*/</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;        <span class="keywordflow">if</span>(p &lt; tree-&gt;firstnode || p &gt;= tree-&gt;<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a>)</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;            <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(6767, <span class="stringliteral">&quot;Updating pseudos: %d -&gt; %d which is not an internal node between %d and %d.&quot;</span>,no, p, tree-&gt;<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a>, tree-&gt;<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a>);</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;        <span class="comment">/* Check we don&#39;t move to another part of the tree*/</span></div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        <span class="keywordflow">if</span>(tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a> != no)</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;            <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(6767, <span class="stringliteral">&quot;Tried to update toplevel node %d with parent %d != expected %d\n&quot;</span>, p, tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a>, no);</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160; </div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;        <span class="keywordflow">if</span>(tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">f</a>.<a class="code" href="structNODE.html#ac63501e2f4f5076dfe3534268e89bc39">InternalTopLevel</a>)</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;            <a class="code" href="forcetree_8c.html#a17b712760ce589aaaf16d64abf4a65dc">force_treeupdate_pseudos</a>(p, tree);</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160; </div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;        mass += (tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a>);</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;        s[0] += (tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a> * tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[0]);</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        s[1] += (tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a> * tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[1]);</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        s[2] += (tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a> * tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[2]);</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160; </div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        <span class="keywordflow">if</span>(tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a> &gt; hmax)</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;            hmax = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a>;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160; </div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;        p = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[p].<a class="code" href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">sibling</a>;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    }</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160; </div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    <span class="keywordflow">if</span>(mass)</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    {</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;        s[0] /= mass;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;        s[1] /= mass;</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        s[2] /= mass;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    }</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    {</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        s[0] = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[0];</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;        s[1] = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[1];</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;        s[2] = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[2];</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    }</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160; </div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[0] = s[0];</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[1] = s[1];</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">cofm</a>[2] = s[2];</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a> = mass;</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160; </div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a> = hmax;</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;}</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160; </div>
<div class="line"><a name="l01271"></a><span class="lineno"><a class="line" href="forcetree_8c.html#a965954b38afd36a3ce1047406d23cc22"> 1271</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="forcetree_8c.html#a965954b38afd36a3ce1047406d23cc22">force_update_hmax</a>(<span class="keywordtype">int</span> * activeset, <span class="keywordtype">int</span> size, <a class="code" href="structForceTree.html">ForceTree</a> * tree, <a class="code" href="structDomainDecomp.html">DomainDecomp</a> * ddecomp)</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;{</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="test__exchange_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>, <a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>, recvTask;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <span class="keywordtype">int</span> i, ta;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    <span class="keywordtype">int</span> *recvcounts, *recvoffset;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160; </div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Misc&quot;</span>);</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160; </div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <span class="comment">/* If hmax has not yet been computed, do all particles*/</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    <span class="keywordflow">if</span>(!tree-&gt;<a class="code" href="structForceTree.html#ab0144192c151b0695bb436cf874f464a">hmax_computed_flag</a>) {</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;        activeset = NULL;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        size = <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">NumPart</a>;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    }</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    MPI_Comm_size(MPI_COMM_WORLD, &amp;<a class="code" href="test__exchange_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>);</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    MPI_Comm_rank(MPI_COMM_WORLD, &amp;<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>);</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160; </div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="preprocessor">    #pragma omp parallel for</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; size; i++)</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    {</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> p_i = activeset ? activeset[i] : i;</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160; </div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Type != 0 || <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].IsGarbage)</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160; </div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        <span class="keywordtype">int</span> no = tree-&gt;<a class="code" href="structForceTree.html#a9c794bfbfd1b1c68d201af6a8564fd13">Father</a>[p_i];</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160; </div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        <span class="keywordflow">while</span>(no &gt;= 0)</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        {</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;            <span class="comment">/* How much does this particle peek beyond this node?</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="comment">             * Note len does not change so we can read it without a lock or atomic. */</span></div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;            <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> readhmax, newhmax = 0;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;            <span class="keywordtype">int</span> j, done = 0;</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++) {</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;                <span class="comment">/* Compute each direction independently and take the maximum.</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="comment">                 * This is the largest possible distance away from node center within a cube bounding hsml.</span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="comment">                 * Note that because Pos - Center &lt; len, the maximum value this can have is Hsml.*/</span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;                newhmax = <a class="code" href="test__interp_8c.html#ac06514a27a2843d8325c1e46ad595b39">DMAX</a>(newhmax, fabs(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Pos[j] - tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[j]) + <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Hsml - tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a>);</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;            }</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;            <span class="comment">/* Most particles will lie fully inside a node. No need then for the atomic! */</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;            <span class="keywordflow">if</span>(newhmax &lt;= 0)</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160; </div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="preprocessor">            #pragma omp atomic read</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;            readhmax = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a>;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;            <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;                <span class="keywordflow">if</span>(newhmax &lt;= readhmax) {</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;                    done = 1;</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;                }</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;                <span class="comment">/* Swap in the new hmax only if the old one hasn&#39;t changed. */</span></div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;            } <span class="keywordflow">while</span>(!__atomic_compare_exchange(&amp;(tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a>), &amp;readhmax, &amp;newhmax, 0, __ATOMIC_RELAXED, __ATOMIC_RELAXED));</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160; </div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;            <span class="keywordflow">if</span>(done)</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;            no = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a>;</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;        }</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    }</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160; </div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    <span class="keywordtype">double</span> * TopLeafhmax = (<span class="keywordtype">double</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;TopLeafMoments&quot;</span>, ddecomp-&gt;<a class="code" href="structDomainDecomp.html#ae063710516bbb9f1fa1350b5b3c02a93">NTopLeaves</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    memset(&amp;TopLeafhmax[0], 0, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * ddecomp-&gt;<a class="code" href="structDomainDecomp.html#ae063710516bbb9f1fa1350b5b3c02a93">NTopLeaves</a>);</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160; </div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    <span class="keywordflow">for</span>(i = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">Tasks</a>[<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>].<a class="code" href="structtask__data.html#adb9ec65f9257aa87c1811f283061ef4b">StartLeaf</a>; i &lt; ddecomp-&gt;Tasks[<a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>].EndLeaf; i ++) {</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        <span class="keywordtype">int</span> no = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#adcfdab38d4690533d89c93b927df477f">TopLeaves</a>[i].<a class="code" href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">treenode</a>;</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;        TopLeafhmax[i] = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a>;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    }</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160; </div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    <span class="comment">/* share the hmax-data of the dirty nodes accross CPUs */</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    recvcounts = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;recvcounts&quot;</span>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * <a class="code" href="test__exchange_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>);</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    recvoffset = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;recvoffset&quot;</span>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * <a class="code" href="test__exchange_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>);</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160; </div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <span class="keywordflow">for</span>(recvTask = 0; recvTask &lt; <a class="code" href="test__exchange_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; recvTask++)</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    {</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;        recvoffset[recvTask] = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">Tasks</a>[recvTask].<a class="code" href="structtask__data.html#adb9ec65f9257aa87c1811f283061ef4b">StartLeaf</a>;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;        recvcounts[recvTask] = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">Tasks</a>[recvTask].<a class="code" href="structtask__data.html#a3282c0a233e6ab985c0c9568f2589a6f">EndLeaf</a> - ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">Tasks</a>[recvTask].<a class="code" href="structtask__data.html#adb9ec65f9257aa87c1811f283061ef4b">StartLeaf</a>;</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    }</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160; </div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    MPI_Allgatherv(MPI_IN_PLACE, 0, MPI_DATATYPE_NULL,</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;            &amp;TopLeafhmax[0], recvcounts, recvoffset,</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;            MPI_DOUBLE, MPI_COMM_WORLD);</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160; </div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(recvoffset);</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(recvcounts);</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160; </div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <span class="keywordflow">for</span>(ta = 0; ta &lt; <a class="code" href="test__exchange_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; ta++) {</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;        <span class="keywordflow">if</span>(ta == <a class="code" href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>)</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;            <span class="keywordflow">continue</span>; <span class="comment">/* bypass ThisTask since it is already up to date */</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;        <span class="keywordflow">for</span>(i = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">Tasks</a>[ta].<a class="code" href="structtask__data.html#adb9ec65f9257aa87c1811f283061ef4b">StartLeaf</a>; i &lt; ddecomp-&gt;Tasks[ta].EndLeaf; i ++) {</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;            <span class="keywordtype">int</span> no = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#adcfdab38d4690533d89c93b927df477f">TopLeaves</a>[i].<a class="code" href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">treenode</a>;</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;            tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a> = TopLeafhmax[i];</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160; </div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;            <span class="keywordflow">while</span>(no &gt;= 0)</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;            {</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;                <span class="keywordflow">if</span>(TopLeafhmax[i] &lt;= tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a>)</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;                tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a14f3123f334264157f4b2e74828cc644">mom</a>.<a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a> = TopLeafhmax[i];</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                no = tree-&gt;<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a>[no].<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a>;</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;            }</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;         }</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    }</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(TopLeafhmax);</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160; </div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    tree-&gt;<a class="code" href="structForceTree.html#ab0144192c151b0695bb436cf874f464a">hmax_computed_flag</a> = 1;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Tree/HmaxUpdate&quot;</span>);</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;}</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160; </div>
<div class="line"><a name="l01381"></a><span class="lineno"><a class="line" href="forcetree_8c.html#a68ccb093e6e43385d633074edd4aee40"> 1381</a></span>&#160;<a class="code" href="structForceTree.html">ForceTree</a> <a class="code" href="forcetree_8c.html#a68ccb093e6e43385d633074edd4aee40">force_treeallocate</a>(int64_t maxnodes, int64_t maxpart, <a class="code" href="structDomainDecomp.html">DomainDecomp</a> * ddecomp)</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;{</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    <a class="code" href="structForceTree.html">ForceTree</a> tb;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160; </div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    tb.<a class="code" href="structForceTree.html#a9c794bfbfd1b1c68d201af6a8564fd13">Father</a> = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;Father&quot;</span>, maxpart * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    tb.<a class="code" href="structForceTree.html#a17359d4c68615adc605baa984a584e78">nfather</a> = maxpart;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    memset(tb.<a class="code" href="structForceTree.html#a9c794bfbfd1b1c68d201af6a8564fd13">Father</a>, -1, maxpart * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    tb.<a class="code" href="structForceTree.html#a9b388efae8d9d4be5e14030d65a17819">Nodes_base</a> = (<span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;Nodes_base&quot;</span>, (maxnodes + 1) * <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a>));</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    memset(tb.<a class="code" href="structForceTree.html#a9b388efae8d9d4be5e14030d65a17819">Nodes_base</a>, -1, (maxnodes + 1) * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structNODE.html">NODE</a>));</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    tb.<a class="code" href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">firstnode</a> = maxpart;</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    tb.<a class="code" href="structForceTree.html#ae724473c76c778705c3f287c769b287f">lastnode</a> = maxpart + maxnodes;</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    <span class="keywordflow">if</span>(maxpart + maxnodes &gt;= 1L&lt;&lt;30)</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;        <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(5, <span class="stringliteral">&quot;Size of tree overflowed for maxpart = %ld, maxnodes = %ld!\n&quot;</span>, maxpart, maxnodes);</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    tb.<a class="code" href="structForceTree.html#acd985b6d526df4466ad5f6850402c89e">numnodes</a> = 0;</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    tb.<a class="code" href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">Nodes</a> = tb.<a class="code" href="structForceTree.html#a9b388efae8d9d4be5e14030d65a17819">Nodes_base</a> - maxpart;</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    tb.<a class="code" href="structForceTree.html#a843ac282eda641c264da5de145287dbf">tree_allocated_flag</a> = 1;</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    tb.<a class="code" href="structForceTree.html#a2e227f51f43e9b318d9f9e67299da0ba">NTopLeaves</a> = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#ae063710516bbb9f1fa1350b5b3c02a93">NTopLeaves</a>;</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    tb.<a class="code" href="structForceTree.html#ab986dcdbb47389ec6863651e899acc15">TopLeaves</a> = ddecomp-&gt;<a class="code" href="structDomainDecomp.html#adcfdab38d4690533d89c93b927df477f">TopLeaves</a>;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <span class="keywordflow">return</span> tb;</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;}</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160; </div>
<div class="line"><a name="l01409"></a><span class="lineno"><a class="line" href="forcetree_8c.html#aaa26dfea4b696133a8bc35c5e0c56037"> 1409</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="forcetree_8c.html#aaa26dfea4b696133a8bc35c5e0c56037">force_tree_free</a>(<a class="code" href="structForceTree.html">ForceTree</a> * tree)</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;{</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    <a class="code" href="event_8c.html#a4b5347d345f55b1b454c1eeb02916ca8">event_unlisten</a>(&amp;<a class="code" href="event_8c.html#aafc3f0c1fffb6f0a19f5f3ecd24474c7">EventSlotsFork</a>, <a class="code" href="forcetree_8c.html#a6c833489d009e4b5e850dc5997214775">force_tree_eh_slots_fork</a>, tree);</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160; </div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="forcetree_8c.html#a6676b2eba19512b1671a4c21fcb6e71d">force_tree_allocated</a>(tree))</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(tree-&gt;<a class="code" href="structForceTree.html#a9b388efae8d9d4be5e14030d65a17819">Nodes_base</a>);</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(tree-&gt;<a class="code" href="structForceTree.html#a9c794bfbfd1b1c68d201af6a8564fd13">Father</a>);</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    tree-&gt;<a class="code" href="structForceTree.html#a843ac282eda641c264da5de145287dbf">tree_allocated_flag</a> = 0;</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;}</div>
<div class="ttc" id="acheckpoint_8c_html_a9b7b2e06591ff6f1fb5735a65f1efd78"><div class="ttname"><a href="checkpoint_8c.html#a9b7b2e06591ff6f1fb5735a65f1efd78">dump_snapshot</a></div><div class="ttdeci">void dump_snapshot(const char *dump, const double Time, const Cosmology *CP, const char *OutputDir)</div><div class="ttdef"><b>Definition:</b> <a href="checkpoint_8c_source.html#l00052">checkpoint.c:52</a></div></div>
<div class="ttc" id="acheckpoint_8h_html"><div class="ttname"><a href="checkpoint_8h.html">checkpoint.h</a></div></div>
<div class="ttc" id="adomain_8h_html"><div class="ttname"><a href="domain_8h.html">domain.h</a></div></div>
<div class="ttc" id="adomain_8h_html_aa7470209c061c08a6f7a32ad9c3610a5"><div class="ttname"><a href="domain_8h.html#aa7470209c061c08a6f7a32ad9c3610a5">domain_get_topleaf</a></div><div class="ttdeci">static int domain_get_topleaf(const peano_t key, const DomainDecomp *ddecomp)</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00074">domain.h:74</a></div></div>
<div class="ttc" id="aendrun_8c_html_a6567cd867c5549fb6586e19ccd819764"><div class="ttname"><a href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a></div><div class="ttdeci">void message(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00175">endrun.c:175</a></div></div>
<div class="ttc" id="aendrun_8c_html_ad963d7efdb9f10f7a2298c8ccd222ab0"><div class="ttname"><a href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a></div><div class="ttdeci">void endrun(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00147">endrun.c:147</a></div></div>
<div class="ttc" id="aendrun_8h_html"><div class="ttname"><a href="endrun_8h.html">endrun.h</a></div></div>
<div class="ttc" id="aevent_8c_html_a3f548c264e5e5b9fe2bb8b10c177482a"><div class="ttname"><a href="event_8c.html#a3f548c264e5e5b9fe2bb8b10c177482a">event_listen</a></div><div class="ttdeci">int event_listen(EventSpec *eh, eventfunc func, void *userdata)</div><div class="ttdef"><b>Definition:</b> <a href="event_8c_source.html#l00006">event.c:6</a></div></div>
<div class="ttc" id="aevent_8c_html_a4b5347d345f55b1b454c1eeb02916ca8"><div class="ttname"><a href="event_8c.html#a4b5347d345f55b1b454c1eeb02916ca8">event_unlisten</a></div><div class="ttdeci">int event_unlisten(EventSpec *eh, eventfunc func, void *userdata)</div><div class="ttdef"><b>Definition:</b> <a href="event_8c_source.html#l00026">event.c:26</a></div></div>
<div class="ttc" id="aevent_8c_html_aafc3f0c1fffb6f0a19f5f3ecd24474c7"><div class="ttname"><a href="event_8c.html#aafc3f0c1fffb6f0a19f5f3ecd24474c7">EventSlotsFork</a></div><div class="ttdeci">EventSpec EventSlotsFork</div><div class="ttdef"><b>Definition:</b> <a href="event_8c_source.html#l00054">event.c:54</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a068d7c90773680cb8c9b0684d584420d"><div class="ttname"><a href="forcetree_8c.html#a068d7c90773680cb8c9b0684d584420d">init_internal_node</a></div><div class="ttdeci">static void init_internal_node(struct NODE *nfreep, struct NODE *parent, int subnode)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00304">forcetree.c:304</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a0de0fec1cfeb5e2aad5f33a843de25e7"><div class="ttname"><a href="forcetree_8c.html#a0de0fec1cfeb5e2aad5f33a843de25e7">force_tree_build</a></div><div class="ttdeci">static ForceTree force_tree_build(int npart, int mask, DomainDecomp *ddecomp, const int HybridNuGrav, const int DoMoments, const char *EmergencyOutputDir)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00191">forcetree.c:191</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a17b712760ce589aaaf16d64abf4a65dc"><div class="ttname"><a href="forcetree_8c.html#a17b712760ce589aaaf16d64abf4a65dc">force_treeupdate_pseudos</a></div><div class="ttdeci">static void force_treeupdate_pseudos(int no, const ForceTree *tree)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l01195">forcetree.c:1195</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a43eea1e716d44d6b38a732d94df1b4ce"><div class="ttname"><a href="forcetree_8c.html#a43eea1e716d44d6b38a732d94df1b4ce">merge_partial_force_trees</a></div><div class="ttdeci">int merge_partial_force_trees(int left, int right, struct NodeCache *nc, int *nnext, const struct ForceTree tb, int HybridNuGrav)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00533">forcetree.c:533</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a4a6ff36eefac3d77669f28982e4f02b0"><div class="ttname"><a href="forcetree_8c.html#a4a6ff36eefac3d77669f28982e4f02b0">force_create_node_for_topnode</a></div><div class="ttdeci">static void force_create_node_for_topnode(int no, int topnode, struct NODE *Nodes, const DomainDecomp *ddecomp, int bits, int x, int y, int z, int *nextfree, const int lastnode)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00818">forcetree.c:818</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a5156dae3aae56140d6e9ae0ab58867cc"><div class="ttname"><a href="forcetree_8c.html#a5156dae3aae56140d6e9ae0ab58867cc">force_tree_rebuild</a></div><div class="ttdeci">void force_tree_rebuild(ForceTree *tree, DomainDecomp *ddecomp, const int HybridNuGrav, const int DoMoments, const char *EmergencyOutputDir)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00140">forcetree.c:140</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a54c1bcfde446f424ff0b7f89199dde0a"><div class="ttname"><a href="forcetree_8c.html#a54c1bcfde446f424ff0b7f89199dde0a">force_tree_create_nodes</a></div><div class="ttdeci">int force_tree_create_nodes(const ForceTree tb, const int npart, int mask, DomainDecomp *ddecomp, const int HybridNuGrav)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00661">forcetree.c:661</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a569cd386bf7d67968fad6344898cb70c"><div class="ttname"><a href="forcetree_8c.html#a569cd386bf7d67968fad6344898cb70c">add_particle_moment_to_node</a></div><div class="ttdeci">static void add_particle_moment_to_node(struct NODE *pnode, int i)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00914">forcetree.c:914</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a6676b2eba19512b1671a4c21fcb6e71d"><div class="ttname"><a href="forcetree_8c.html#a6676b2eba19512b1671a4c21fcb6e71d">force_tree_allocated</a></div><div class="ttdeci">int force_tree_allocated(const ForceTree *tree)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00134">forcetree.c:134</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a6710cf447fc53308c513b002cf446ebf"><div class="ttname"><a href="forcetree_8c.html#a6710cf447fc53308c513b002cf446ebf">get_freenode</a></div><div class="ttdeci">int get_freenode(int *nnext, struct NodeCache *nc)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00345">forcetree.c:345</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a68ccb093e6e43385d633074edd4aee40"><div class="ttname"><a href="forcetree_8c.html#a68ccb093e6e43385d633074edd4aee40">force_treeallocate</a></div><div class="ttdeci">ForceTree force_treeallocate(int64_t maxnodes, int64_t maxpart, DomainDecomp *ddecomp)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l01381">forcetree.c:1381</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a6c833489d009e4b5e850dc5997214775"><div class="ttname"><a href="forcetree_8c.html#a6c833489d009e4b5e850dc5997214775">force_tree_eh_slots_fork</a></div><div class="ttdeci">static int force_tree_eh_slots_fork(EIBase *event, void *userdata)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00110">forcetree.c:110</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a8c06d93e6c1c1afab740e393528fa0f6"><div class="ttname"><a href="forcetree_8c.html#a8c06d93e6c1c1afab740e393528fa0f6">force_update_node_parallel</a></div><div class="ttdeci">void force_update_node_parallel(const ForceTree *tree, const DomainDecomp *ddecomp)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l01081">forcetree.c:1081</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a95095093b87159c1b23a2cb267d9940a"><div class="ttname"><a href="forcetree_8c.html#a95095093b87159c1b23a2cb267d9940a">get_subnode</a></div><div class="ttdeci">int get_subnode(const struct NODE *node, const int p_i)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00281">forcetree.c:281</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a9561f4d1c37823ef1082ea39cd2dc0f3"><div class="ttname"><a href="forcetree_8c.html#a9561f4d1c37823ef1082ea39cd2dc0f3">force_get_sibling</a></div><div class="ttdeci">static int force_get_sibling(const int sib, const int j, const int *suns)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00934">forcetree.c:934</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a965954b38afd36a3ce1047406d23cc22"><div class="ttname"><a href="forcetree_8c.html#a965954b38afd36a3ce1047406d23cc22">force_update_hmax</a></div><div class="ttdeci">void force_update_hmax(int *activeset, int size, ForceTree *tree, DomainDecomp *ddecomp)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l01271">forcetree.c:1271</a></div></div>
<div class="ttc" id="aforcetree_8c_html_a9d7fd9824e1f0c1d268c43a85cffd153"><div class="ttname"><a href="forcetree_8c.html#a9d7fd9824e1f0c1d268c43a85cffd153">force_exchange_pseudodata</a></div><div class="ttdeci">static void force_exchange_pseudodata(ForceTree *tree, const DomainDecomp *ddecomp)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l01109">forcetree.c:1109</a></div></div>
<div class="ttc" id="aforcetree_8c_html_aa01061828cef34bc4c55ef9eaa7c03f5"><div class="ttname"><a href="forcetree_8c.html#aa01061828cef34bc4c55ef9eaa7c03f5">force_tree_rebuild_mask</a></div><div class="ttdeci">void force_tree_rebuild_mask(ForceTree *tree, DomainDecomp *ddecomp, int mask, const int HybridNuGrav, const char *EmergencyOutputDir)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00161">forcetree.c:161</a></div></div>
<div class="ttc" id="aforcetree_8c_html_aa2a5e7409df1552470bd55312d9d1e17"><div class="ttname"><a href="forcetree_8c.html#aa2a5e7409df1552470bd55312d9d1e17">create_new_node_layer</a></div><div class="ttdeci">static int create_new_node_layer(int firstparent, int p_toplace, const int HybridNuGrav, const ForceTree tb, int *nnext, struct NodeCache *nc)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00376">forcetree.c:376</a></div></div>
<div class="ttc" id="aforcetree_8c_html_aa58562a96bb05cdba9466ecedafece27"><div class="ttname"><a href="forcetree_8c.html#aa58562a96bb05cdba9466ecedafece27">init_forcetree_params</a></div><div class="ttdeci">void init_forcetree_params(const int FastParticleType)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00043">forcetree.c:43</a></div></div>
<div class="ttc" id="aforcetree_8c_html_aa745b024ee4449af60e622e8c2bc32c1"><div class="ttname"><a href="forcetree_8c.html#aa745b024ee4449af60e622e8c2bc32c1">add_particle_to_tree</a></div><div class="ttdeci">int add_particle_to_tree(int i, int cur_start, const ForceTree tb, const int HybridNuGrav, struct NodeCache *nc, int *nnext)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00487">forcetree.c:487</a></div></div>
<div class="ttc" id="aforcetree_8c_html_aaa26dfea4b696133a8bc35c5e0c56037"><div class="ttname"><a href="forcetree_8c.html#aaa26dfea4b696133a8bc35c5e0c56037">force_tree_free</a></div><div class="ttdeci">void force_tree_free(ForceTree *tree)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l01409">forcetree.c:1409</a></div></div>
<div class="ttc" id="aforcetree_8c_html_aad5388b597f7a479c120f37a72d96a1f"><div class="ttname"><a href="forcetree_8c.html#aad5388b597f7a479c120f37a72d96a1f">force_insert_pseudo_particles</a></div><div class="ttdeci">static void force_insert_pseudo_particles(const ForceTree *tree, const DomainDecomp *ddecomp)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00883">forcetree.c:883</a></div></div>
<div class="ttc" id="aforcetree_8c_html_ab3ee27767a982ea77a18f5f4983e4344"><div class="ttname"><a href="forcetree_8c.html#ab3ee27767a982ea77a18f5f4983e4344">inside_node</a></div><div class="ttdeci">static int inside_node(const struct NODE *node, const int p_i)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00291">forcetree.c:291</a></div></div>
<div class="ttc" id="aforcetree_8c_html_ab8a2310bd448851f4aa42ae6bcec2e01"><div class="ttname"><a href="forcetree_8c.html#ab8a2310bd448851f4aa42ae6bcec2e01">force_get_father</a></div><div class="ttdeci">int force_get_father(int no, const ForceTree *tree)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00905">forcetree.c:905</a></div></div>
<div class="ttc" id="aforcetree_8c_html_ac8445ebf6810e2fed2bcfea994a668bf"><div class="ttname"><a href="forcetree_8c.html#ac8445ebf6810e2fed2bcfea994a668bf">force_update_particle_node</a></div><div class="ttdeci">static void force_update_particle_node(int no, const ForceTree *tree)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00950">forcetree.c:950</a></div></div>
<div class="ttc" id="aforcetree_8c_html_accd80e6d7d45105a1af51e093c771aae"><div class="ttname"><a href="forcetree_8c.html#accd80e6d7d45105a1af51e093c771aae">force_update_node_recursive</a></div><div class="ttdeci">static int force_update_node_recursive(int no, int sib, int level, const ForceTree *tree)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00982">forcetree.c:982</a></div></div>
<div class="ttc" id="aforcetree_8c_html_adb744eb97469a1f65a702c05bc71cee1"><div class="ttname"><a href="forcetree_8c.html#adb744eb97469a1f65a702c05bc71cee1">modify_internal_node</a></div><div class="ttdeci">static int modify_internal_node(int parent, int subnode, int p_toplace, const ForceTree tb, const int HybridNuGrav)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00361">forcetree.c:361</a></div></div>
<div class="ttc" id="aforcetree_8c_html_ae9d22ac96be9a18932a00837b0a78f30"><div class="ttname"><a href="forcetree_8c.html#ae9d22ac96be9a18932a00837b0a78f30">NODECACHE_SIZE</a></div><div class="ttdeci">#define NODECACHE_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00336">forcetree.c:336</a></div></div>
<div class="ttc" id="aforcetree_8c_html_afdf47b35e2cd40f171992ebf07dcbbb6"><div class="ttname"><a href="forcetree_8c.html#afdf47b35e2cd40f171992ebf07dcbbb6">ForceTreeParams</a></div><div class="ttdeci">static struct forcetree_params ForceTreeParams</div></div>
<div class="ttc" id="aforcetree_8h_html"><div class="ttname"><a href="forcetree_8h.html">forcetree.h</a></div></div>
<div class="ttc" id="aforcetree_8h_html_a09c0db73b04ae32608387993001427ee"><div class="ttname"><a href="forcetree_8h.html#a09c0db73b04ae32608387993001427ee">ALLMASK</a></div><div class="ttdeci">#define ALLMASK</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00020">forcetree.h:20</a></div></div>
<div class="ttc" id="aforcetree_8h_html_a3ad606200a7ba07b8766c7d37b2454c7"><div class="ttname"><a href="forcetree_8h.html#a3ad606200a7ba07b8766c7d37b2454c7">NODE_NODE_TYPE</a></div><div class="ttdeci">#define NODE_NODE_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00016">forcetree.h:16</a></div></div>
<div class="ttc" id="aforcetree_8h_html_a822d99b8bfbdf4c010e2b974b4334409"><div class="ttname"><a href="forcetree_8h.html#a822d99b8bfbdf4c010e2b974b4334409">node_is_node</a></div><div class="ttdeci">static int node_is_node(int no, const ForceTree *tree)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00145">forcetree.h:145</a></div></div>
<div class="ttc" id="aforcetree_8h_html_ac342a8bc2bb97849655e3ea50d3c5494"><div class="ttname"><a href="forcetree_8h.html#ac342a8bc2bb97849655e3ea50d3c5494">PARTICLE_NODE_TYPE</a></div><div class="ttdeci">#define PARTICLE_NODE_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00015">forcetree.h:15</a></div></div>
<div class="ttc" id="aforcetree_8h_html_aca0ae17134eee3f867d5d7579a97ba64"><div class="ttname"><a href="forcetree_8h.html#aca0ae17134eee3f867d5d7579a97ba64">PSEUDO_NODE_TYPE</a></div><div class="ttdeci">#define PSEUDO_NODE_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00017">forcetree.h:17</a></div></div>
<div class="ttc" id="aforcetree_8h_html_ae01cb41cc000acecd9213d69c7d15c32"><div class="ttname"><a href="forcetree_8h.html#ae01cb41cc000acecd9213d69c7d15c32">node_is_pseudo_particle</a></div><div class="ttdeci">static int node_is_pseudo_particle(int no, const ForceTree *tree)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00133">forcetree.h:133</a></div></div>
<div class="ttc" id="aforcetree_8h_html_afcfeb1a32a47b8b7f8bce9222b542a9e"><div class="ttname"><a href="forcetree_8h.html#afcfeb1a32a47b8b7f8bce9222b542a9e">NMAXCHILD</a></div><div class="ttdeci">#define NMAXCHILD</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00012">forcetree.h:12</a></div></div>
<div class="ttc" id="amymalloc_8h_html_a3eb707b32b6ac69f2df085e4bc098cc4"><div class="ttname"><a href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a></div><div class="ttdeci">#define mymalloc(name, size)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00015">mymalloc.h:15</a></div></div>
<div class="ttc" id="amymalloc_8h_html_a52bc2c6ec78b17bb6d42957cbf642f15"><div class="ttname"><a href="mymalloc_8h.html#a52bc2c6ec78b17bb6d42957cbf642f15">ta_malloc</a></div><div class="ttdeci">#define ta_malloc(name, type, nele)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00025">mymalloc.h:25</a></div></div>
<div class="ttc" id="amymalloc_8h_html_a81d253773ecedbda7d865554e707489f"><div class="ttname"><a href="mymalloc_8h.html#a81d253773ecedbda7d865554e707489f">myrealloc</a></div><div class="ttdeci">#define myrealloc(ptr, size)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00018">mymalloc.h:18</a></div></div>
<div class="ttc" id="amymalloc_8h_html_a84e2115e90e9c22e11d9663c019fc8bc"><div class="ttname"><a href="mymalloc_8h.html#a84e2115e90e9c22e11d9663c019fc8bc">ta_free</a></div><div class="ttdeci">#define ta_free(p)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00028">mymalloc.h:28</a></div></div>
<div class="ttc" id="amymalloc_8h_html_ae51745d10f51ca300ad484ab4ecf7908"><div class="ttname"><a href="mymalloc_8h.html#ae51745d10f51ca300ad484ab4ecf7908">mymalloc_usedbytes</a></div><div class="ttdeci">#define mymalloc_usedbytes()</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00032">mymalloc.h:32</a></div></div>
<div class="ttc" id="amymalloc_8h_html_af469c2f7e504a771f5d8a91ac9623240"><div class="ttname"><a href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a></div><div class="ttdeci">#define myfree(x)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00019">mymalloc.h:19</a></div></div>
<div class="ttc" id="apartmanager_8c_html_a6cef44682776e476d8f9f1b9e1f9fe16"><div class="ttname"><a href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a></div><div class="ttdeci">struct part_manager_type PartManager[1]</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8c_source.html#l00001">partmanager.c:11</a></div></div>
<div class="ttc" id="apartmanager_8h_html"><div class="ttname"><a href="partmanager_8h.html">partmanager.h</a></div></div>
<div class="ttc" id="apartmanager_8h_html_a2748566f4c443ee77aa831e63dbb5ebe"><div class="ttname"><a href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a></div><div class="ttdeci">#define P</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00088">partmanager.h:88</a></div></div>
<div class="ttc" id="apeano_8c_html_a2b98881a670e236ef744e3283ebe71a4"><div class="ttname"><a href="peano_8c.html#a2b98881a670e236ef744e3283ebe71a4">peano_hilbert_key</a></div><div class="ttdeci">peano_t peano_hilbert_key(int x, int y, int z, int bits)</div><div class="ttdef"><b>Definition:</b> <a href="peano_8c_source.html#l00119">peano.c:119</a></div></div>
<div class="ttc" id="apower_8c_html_aaca257a58f3e957a7db5fc91431eadf5"><div class="ttname"><a href="power_8c.html#aaca257a58f3e957a7db5fc91431eadf5">CP</a></div><div class="ttdeci">static Cosmology * CP</div><div class="ttdef"><b>Definition:</b> <a href="power_8c_source.html#l00027">power.c:27</a></div></div>
<div class="ttc" id="aslotsmanager_8c_html_aa317621b6c60bc95c5f3e33c648e8392"><div class="ttname"><a href="slotsmanager_8c.html#aa317621b6c60bc95c5f3e33c648e8392">SlotsManager</a></div><div class="ttdeci">struct slots_manager_type SlotsManager[1]</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8c_source.html#l00001">slotsmanager.c:7</a></div></div>
<div class="ttc" id="aslotsmanager_8h_html"><div class="ttname"><a href="slotsmanager_8h.html">slotsmanager.h</a></div></div>
<div class="ttc" id="astring_8h_html"><div class="ttname"><a href="string_8h.html">string.h</a></div></div>
<div class="ttc" id="astructCosmology_html"><div class="ttname"><a href="structCosmology.html">Cosmology</a></div><div class="ttdef"><b>Definition:</b> <a href="cosmology_8h_source.html#l00008">cosmology.h:8</a></div></div>
<div class="ttc" id="astructCosmology_html_a43e0dba956c6dc4fad8b1aaf0fa84248"><div class="ttname"><a href="structCosmology.html#a43e0dba956c6dc4fad8b1aaf0fa84248">Cosmology::Omega0</a></div><div class="ttdeci">double Omega0</div><div class="ttdef"><b>Definition:</b> <a href="cosmology_8h_source.html#l00010">cosmology.h:10</a></div></div>
<div class="ttc" id="astructCosmology_html_a4b79dcaa1e1c38d07258c3f539e2cb20"><div class="ttname"><a href="structCosmology.html#a4b79dcaa1e1c38d07258c3f539e2cb20">Cosmology::HubbleParam</a></div><div class="ttdeci">double HubbleParam</div><div class="ttdef"><b>Definition:</b> <a href="cosmology_8h_source.html#l00020">cosmology.h:20</a></div></div>
<div class="ttc" id="astructCosmology_html_ac27ad0bd8a6135a2b7da6c49c375d73e"><div class="ttname"><a href="structCosmology.html#ac27ad0bd8a6135a2b7da6c49c375d73e">Cosmology::OmegaLambda</a></div><div class="ttdeci">double OmegaLambda</div><div class="ttdef"><b>Definition:</b> <a href="cosmology_8h_source.html#l00014">cosmology.h:14</a></div></div>
<div class="ttc" id="astructDomainDecomp_html"><div class="ttname"><a href="structDomainDecomp.html">DomainDecomp</a></div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00033">domain.h:33</a></div></div>
<div class="ttc" id="astructDomainDecomp_html_a223388382f723d03b4613b5880536f72"><div class="ttname"><a href="structDomainDecomp.html#a223388382f723d03b4613b5880536f72">DomainDecomp::TopNodes</a></div><div class="ttdeci">struct topnode_data * TopNodes</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00036">domain.h:36</a></div></div>
<div class="ttc" id="astructDomainDecomp_html_a77ea7d828deab5bbd9714c0691c2e3ee"><div class="ttname"><a href="structDomainDecomp.html#a77ea7d828deab5bbd9714c0691c2e3ee">DomainDecomp::Tasks</a></div><div class="ttdeci">struct task_data * Tasks</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00041">domain.h:41</a></div></div>
<div class="ttc" id="astructDomainDecomp_html_ad823b5b805fa027952689ce0c7c161c5"><div class="ttname"><a href="structDomainDecomp.html#ad823b5b805fa027952689ce0c7c161c5">DomainDecomp::NTopNodes</a></div><div class="ttdeci">int NTopNodes</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00039">domain.h:39</a></div></div>
<div class="ttc" id="astructDomainDecomp_html_adcfdab38d4690533d89c93b927df477f"><div class="ttname"><a href="structDomainDecomp.html#adcfdab38d4690533d89c93b927df477f">DomainDecomp::TopLeaves</a></div><div class="ttdeci">struct topleaf_data * TopLeaves</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00037">domain.h:37</a></div></div>
<div class="ttc" id="astructDomainDecomp_html_ae063710516bbb9f1fa1350b5b3c02a93"><div class="ttname"><a href="structDomainDecomp.html#ae063710516bbb9f1fa1350b5b3c02a93">DomainDecomp::NTopLeaves</a></div><div class="ttdeci">int NTopLeaves</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00040">domain.h:40</a></div></div>
<div class="ttc" id="astructEIBase_html"><div class="ttname"><a href="structEIBase.html">EIBase</a></div><div class="ttdef"><b>Definition:</b> <a href="event_8h_source.html#l00008">event.h:8</a></div></div>
<div class="ttc" id="astructEISlotsFork_html"><div class="ttname"><a href="structEISlotsFork.html">EISlotsFork</a></div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00148">slotsmanager.h:148</a></div></div>
<div class="ttc" id="astructEISlotsFork_html_acceff2e5aa9a8341512e4067f65c46de"><div class="ttname"><a href="structEISlotsFork.html#acceff2e5aa9a8341512e4067f65c46de">EISlotsFork::child</a></div><div class="ttdeci">int64_t child</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00151">slotsmanager.h:151</a></div></div>
<div class="ttc" id="astructEISlotsFork_html_adfb224c6cc23cde340474c5d08b5b449"><div class="ttname"><a href="structEISlotsFork.html#adfb224c6cc23cde340474c5d08b5b449">EISlotsFork::parent</a></div><div class="ttdeci">int parent</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00150">slotsmanager.h:150</a></div></div>
<div class="ttc" id="astructForceTree_html"><div class="ttname"><a href="structForceTree.html">ForceTree</a></div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00076">forcetree.h:76</a></div></div>
<div class="ttc" id="astructForceTree_html_a17359d4c68615adc605baa984a584e78"><div class="ttname"><a href="structForceTree.html#a17359d4c68615adc605baa984a584e78">ForceTree::nfather</a></div><div class="ttdeci">int nfather</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00104">forcetree.h:104</a></div></div>
<div class="ttc" id="astructForceTree_html_a2e227f51f43e9b318d9f9e67299da0ba"><div class="ttname"><a href="structForceTree.html#a2e227f51f43e9b318d9f9e67299da0ba">ForceTree::NTopLeaves</a></div><div class="ttdeci">int NTopLeaves</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00094">forcetree.h:94</a></div></div>
<div class="ttc" id="astructForceTree_html_a4689b816563dd80b28c6a7de4d56e236"><div class="ttname"><a href="structForceTree.html#a4689b816563dd80b28c6a7de4d56e236">ForceTree::moments_computed_flag</a></div><div class="ttdeci">int moments_computed_flag</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00082">forcetree.h:82</a></div></div>
<div class="ttc" id="astructForceTree_html_a843ac282eda641c264da5de145287dbf"><div class="ttname"><a href="structForceTree.html#a843ac282eda641c264da5de145287dbf">ForceTree::tree_allocated_flag</a></div><div class="ttdeci">int tree_allocated_flag</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00078">forcetree.h:78</a></div></div>
<div class="ttc" id="astructForceTree_html_a8915a4ff849c9e97448ae30089a05966"><div class="ttname"><a href="structForceTree.html#a8915a4ff849c9e97448ae30089a05966">ForceTree::BoxSize</a></div><div class="ttdeci">double BoxSize</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00106">forcetree.h:106</a></div></div>
<div class="ttc" id="astructForceTree_html_a8f8a71db8ce5aaaf883ddc43654832ea"><div class="ttname"><a href="structForceTree.html#a8f8a71db8ce5aaaf883ddc43654832ea">ForceTree::mask</a></div><div class="ttdeci">int mask</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00090">forcetree.h:90</a></div></div>
<div class="ttc" id="astructForceTree_html_a9b388efae8d9d4be5e14030d65a17819"><div class="ttname"><a href="structForceTree.html#a9b388efae8d9d4be5e14030d65a17819">ForceTree::Nodes_base</a></div><div class="ttdeci">struct NODE * Nodes_base</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00101">forcetree.h:101</a></div></div>
<div class="ttc" id="astructForceTree_html_a9c794bfbfd1b1c68d201af6a8564fd13"><div class="ttname"><a href="structForceTree.html#a9c794bfbfd1b1c68d201af6a8564fd13">ForceTree::Father</a></div><div class="ttdeci">int * Father</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00103">forcetree.h:103</a></div></div>
<div class="ttc" id="astructForceTree_html_ab0144192c151b0695bb436cf874f464a"><div class="ttname"><a href="structForceTree.html#ab0144192c151b0695bb436cf874f464a">ForceTree::hmax_computed_flag</a></div><div class="ttdeci">int hmax_computed_flag</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00080">forcetree.h:80</a></div></div>
<div class="ttc" id="astructForceTree_html_ab986dcdbb47389ec6863651e899acc15"><div class="ttname"><a href="structForceTree.html#ab986dcdbb47389ec6863651e899acc15">ForceTree::TopLeaves</a></div><div class="ttdeci">struct topleaf_data * TopLeaves</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00092">forcetree.h:92</a></div></div>
<div class="ttc" id="astructForceTree_html_abc4bf1553d516b1b9b9c672b0a371bb1"><div class="ttname"><a href="structForceTree.html#abc4bf1553d516b1b9b9c672b0a371bb1">ForceTree::Nodes</a></div><div class="ttdeci">struct NODE * Nodes</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00097">forcetree.h:97</a></div></div>
<div class="ttc" id="astructForceTree_html_abf7b0590c6127d64c7596ea0363d6f7e"><div class="ttname"><a href="structForceTree.html#abf7b0590c6127d64c7596ea0363d6f7e">ForceTree::firstnode</a></div><div class="ttdeci">int firstnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00084">forcetree.h:84</a></div></div>
<div class="ttc" id="astructForceTree_html_acd985b6d526df4466ad5f6850402c89e"><div class="ttname"><a href="structForceTree.html#acd985b6d526df4466ad5f6850402c89e">ForceTree::numnodes</a></div><div class="ttdeci">int numnodes</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00088">forcetree.h:88</a></div></div>
<div class="ttc" id="astructForceTree_html_ae724473c76c778705c3f287c769b287f"><div class="ttname"><a href="structForceTree.html#ae724473c76c778705c3f287c769b287f">ForceTree::lastnode</a></div><div class="ttdeci">int lastnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00086">forcetree.h:86</a></div></div>
<div class="ttc" id="astructNODE_html"><div class="ttname"><a href="structNODE.html">NODE</a></div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00038">forcetree.h:39</a></div></div>
<div class="ttc" id="astructNODE_html_a0e5a3f58232208e4ad8570f801bf5713"><div class="ttname"><a href="structNODE.html#a0e5a3f58232208e4ad8570f801bf5713">NODE::sibling</a></div><div class="ttdeci">int sibling</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00040">forcetree.h:40</a></div></div>
<div class="ttc" id="astructNODE_html_a14f3123f334264157f4b2e74828cc644"><div class="ttname"><a href="structNODE.html#a14f3123f334264157f4b2e74828cc644">NODE::mom</a></div><div class="ttdeci">struct NODE::@9 mom</div></div>
<div class="ttc" id="astructNODE_html_a1ff8c5e570722798d188c60455312fa2"><div class="ttname"><a href="structNODE.html#a1ff8c5e570722798d188c60455312fa2">NODE::DependsOnLocalMass</a></div><div class="ttdeci">unsigned int DependsOnLocalMass</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00048">forcetree.h:48</a></div></div>
<div class="ttc" id="astructNODE_html_a3460a1b4f9607fe15e6adc40a737d947"><div class="ttname"><a href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">NODE::center</a></div><div class="ttdeci">MyFloat center[3]</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00043">forcetree.h:43</a></div></div>
<div class="ttc" id="astructNODE_html_a57b0c9ea5dcf02231f24ecbae9b5d492"><div class="ttname"><a href="structNODE.html#a57b0c9ea5dcf02231f24ecbae9b5d492">NODE::ChildType</a></div><div class="ttdeci">unsigned int ChildType</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00049">forcetree.h:49</a></div></div>
<div class="ttc" id="astructNODE_html_a5f599abbea1f0fc03e09d98232c740a8"><div class="ttname"><a href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">NODE::mass</a></div><div class="ttdeci">MyFloat mass</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00056">forcetree.h:56</a></div></div>
<div class="ttc" id="astructNODE_html_a85ba1893599828fd008829ac46e5a234"><div class="ttname"><a href="structNODE.html#a85ba1893599828fd008829ac46e5a234">NODE::unused</a></div><div class="ttdeci">unsigned int unused</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00051">forcetree.h:51</a></div></div>
<div class="ttc" id="astructNODE_html_a99422a4018ea66f6dbc395d9a7babd70"><div class="ttname"><a href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">NODE::hmax</a></div><div class="ttdeci">MyFloat hmax</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00057">forcetree.h:57</a></div></div>
<div class="ttc" id="astructNODE_html_a9a1b7edbe811165e40220f63a38f2d16"><div class="ttname"><a href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">NODE::father</a></div><div class="ttdeci">int father</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00041">forcetree.h:41</a></div></div>
<div class="ttc" id="astructNODE_html_a9cb41ac11c7c89d9a2b9429163057fb9"><div class="ttname"><a href="structNODE.html#a9cb41ac11c7c89d9a2b9429163057fb9">NODE::cofm</a></div><div class="ttdeci">MyFloat cofm[3]</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00055">forcetree.h:55</a></div></div>
<div class="ttc" id="astructNODE_html_aa3b4bfc6b6c8c99d88860a5262679487"><div class="ttname"><a href="structNODE.html#aa3b4bfc6b6c8c99d88860a5262679487">NODE::TopLevel</a></div><div class="ttdeci">unsigned int TopLevel</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00047">forcetree.h:47</a></div></div>
<div class="ttc" id="astructNODE_html_ac33651457a5203e28e3506ab7b1fc6b4"><div class="ttname"><a href="structNODE.html#ac33651457a5203e28e3506ab7b1fc6b4">NODE::s</a></div><div class="ttdeci">struct NodeChild s</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00043">forcetree.h:66</a></div></div>
<div class="ttc" id="astructNODE_html_ac63501e2f4f5076dfe3534268e89bc39"><div class="ttname"><a href="structNODE.html#ac63501e2f4f5076dfe3534268e89bc39">NODE::InternalTopLevel</a></div><div class="ttdeci">unsigned int InternalTopLevel</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00046">forcetree.h:46</a></div></div>
<div class="ttc" id="astructNODE_html_ae1b65804a87e4675c77339a0d03f2063"><div class="ttname"><a href="structNODE.html#ae1b65804a87e4675c77339a0d03f2063">NODE::f</a></div><div class="ttdeci">struct NODE::@8 f</div></div>
<div class="ttc" id="astructNODE_html_ae6d6383dc0bc3e1660bbe700b77a85ab"><div class="ttname"><a href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">NODE::len</a></div><div class="ttdeci">MyFloat len</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00042">forcetree.h:42</a></div></div>
<div class="ttc" id="astructNodeCache_html"><div class="ttname"><a href="structNodeCache.html">NodeCache</a></div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00339">forcetree.c:339</a></div></div>
<div class="ttc" id="astructNodeCache_html_a34fe9100da8a71f0b571f12bb85a3c70"><div class="ttname"><a href="structNodeCache.html#a34fe9100da8a71f0b571f12bb85a3c70">NodeCache::nrem_thread</a></div><div class="ttdeci">int nrem_thread</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00341">forcetree.c:341</a></div></div>
<div class="ttc" id="astructNodeCache_html_a9486e11f8687f7f5797654f117a50c8c"><div class="ttname"><a href="structNodeCache.html#a9486e11f8687f7f5797654f117a50c8c">NodeCache::nnext_thread</a></div><div class="ttdeci">int nnext_thread</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00340">forcetree.c:340</a></div></div>
<div class="ttc" id="astructNodeChild_html_a43cab418056b25e2b5b28a1d6b4d045a"><div class="ttname"><a href="structNodeChild.html#a43cab418056b25e2b5b28a1d6b4d045a">NodeChild::noccupied</a></div><div class="ttdeci">int noccupied</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00035">forcetree.h:35</a></div></div>
<div class="ttc" id="astructNodeChild_html_a82c1937a3bd5a4b54d8679e7fe76788b"><div class="ttname"><a href="structNodeChild.html#a82c1937a3bd5a4b54d8679e7fe76788b">NodeChild::suns</a></div><div class="ttdeci">int suns[NMAXCHILD]</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00032">forcetree.h:32</a></div></div>
<div class="ttc" id="astructNodeChild_html_ac1593255d2d991cb18a3b4b0d5f4f7a6"><div class="ttname"><a href="structNodeChild.html#ac1593255d2d991cb18a3b4b0d5f4f7a6">NodeChild::Types</a></div><div class="ttdeci">unsigned int Types</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00030">forcetree.h:30</a></div></div>
<div class="ttc" id="astructforcetree__params_html"><div class="ttname"><a href="structforcetree__params.html">forcetree_params</a></div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00031">forcetree.c:32</a></div></div>
<div class="ttc" id="astructforcetree__params_html_aa3adbfedf9fd5baac777f0d0b0d2b4bc"><div class="ttname"><a href="structforcetree__params.html#aa3adbfedf9fd5baac777f0d0b0d2b4bc">forcetree_params::TreeAllocFactor</a></div><div class="ttdeci">double TreeAllocFactor</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00037">forcetree.c:37</a></div></div>
<div class="ttc" id="astructforcetree__params_html_aa41e5b06e8fc33bb6434cbec5fde7649"><div class="ttname"><a href="structforcetree__params.html#aa41e5b06e8fc33bb6434cbec5fde7649">forcetree_params::FastParticleType</a></div><div class="ttdeci">int FastParticleType</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00039">forcetree.c:39</a></div></div>
<div class="ttc" id="astructpart__manager__type_html_a45e1f95715be50e4081af78f4ee99cb5"><div class="ttname"><a href="structpart__manager__type.html#a45e1f95715be50e4081af78f4ee99cb5">part_manager_type::NumPart</a></div><div class="ttdeci">int64_t NumPart</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00076">partmanager.h:76</a></div></div>
<div class="ttc" id="astructpart__manager__type_html_a5e24abb34f2c8998d8b35c217477d580"><div class="ttname"><a href="structpart__manager__type.html#a5e24abb34f2c8998d8b35c217477d580">part_manager_type::MaxPart</a></div><div class="ttdeci">int64_t MaxPart</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00078">partmanager.h:78</a></div></div>
<div class="ttc" id="astructpart__manager__type_html_afd51316d545eaf7f3f083aea9616858d"><div class="ttname"><a href="structpart__manager__type.html#afd51316d545eaf7f3f083aea9616858d">part_manager_type::BoxSize</a></div><div class="ttdeci">double BoxSize</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00084">partmanager.h:84</a></div></div>
<div class="ttc" id="astructslot__info_html_a29b1b6c4eae612eca7f1125a0c854436"><div class="ttname"><a href="structslot__info.html#a29b1b6c4eae612eca7f1125a0c854436">slot_info::enabled</a></div><div class="ttdeci">int enabled</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00014">slotsmanager.h:14</a></div></div>
<div class="ttc" id="astructslot__info_html_aa651c4c7d01687a0b313076c0266465f"><div class="ttname"><a href="structslot__info.html#aa651c4c7d01687a0b313076c0266465f">slot_info::size</a></div><div class="ttdeci">int64_t size</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00012">slotsmanager.h:12</a></div></div>
<div class="ttc" id="astructslots__manager__type_html_a2b662d46902bf6fffca8b3fa2534a4e4"><div class="ttname"><a href="structslots__manager__type.html#a2b662d46902bf6fffca8b3fa2534a4e4">slots_manager_type::info</a></div><div class="ttdeci">struct slot_info info[6]</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00108">slotsmanager.h:112</a></div></div>
<div class="ttc" id="astructtask__data_html_a3282c0a233e6ab985c0c9568f2589a6f"><div class="ttname"><a href="structtask__data.html#a3282c0a233e6ab985c0c9568f2589a6f">task_data::EndLeaf</a></div><div class="ttdeci">int EndLeaf</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00030">domain.h:30</a></div></div>
<div class="ttc" id="astructtask__data_html_adb9ec65f9257aa87c1811f283061ef4b"><div class="ttname"><a href="structtask__data.html#adb9ec65f9257aa87c1811f283061ef4b">task_data::StartLeaf</a></div><div class="ttdeci">int StartLeaf</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00029">domain.h:29</a></div></div>
<div class="ttc" id="astructtopleaf__data_html_aac3bdb4c81e2029d92196ff60d650b8b"><div class="ttname"><a href="structtopleaf__data.html#aac3bdb4c81e2029d92196ff60d650b8b">topleaf_data::Task</a></div><div class="ttdeci">int Task</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00021">domain.h:21</a></div></div>
<div class="ttc" id="astructtopleaf__data_html_ab948aab0a7ca32817caaaec832643645"><div class="ttname"><a href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">topleaf_data::treenode</a></div><div class="ttdeci">int treenode</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00024">domain.h:24</a></div></div>
<div class="ttc" id="astructtopnode__data_html"><div class="ttname"><a href="structtopnode__data.html">topnode_data</a></div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00012">domain.h:13</a></div></div>
<div class="ttc" id="astructtopnode__data_html_aa5c48f2ae0bd1e2ed8ca069e4eeb29cd"><div class="ttname"><a href="structtopnode__data.html#aa5c48f2ae0bd1e2ed8ca069e4eeb29cd">topnode_data::Leaf</a></div><div class="ttdeci">int Leaf</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00017">domain.h:17</a></div></div>
<div class="ttc" id="astructtopnode__data_html_ad2e76e39d74f3c299b38fa680ecdb794"><div class="ttname"><a href="structtopnode__data.html#ad2e76e39d74f3c299b38fa680ecdb794">topnode_data::Daughter</a></div><div class="ttdeci">int Daughter</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00015">domain.h:15</a></div></div>
<div class="ttc" id="asystem_8c_html_ade2741449d03e719e2e91a6e511e07a4"><div class="ttname"><a href="system_8c.html#ade2741449d03e719e2e91a6e511e07a4">MPIU_Any</a></div><div class="ttdeci">int MPIU_Any(int condition, MPI_Comm comm)</div><div class="ttdef"><b>Definition:</b> <a href="system_8c_source.html#l00545">system.c:545</a></div></div>
<div class="ttc" id="asystem_8h_html_a00eeba7aebd7952f4c0ecebb60fbeca2"><div class="ttname"><a href="system_8h.html#a00eeba7aebd7952f4c0ecebb60fbeca2">atomic_fetch_and_add</a></div><div class="ttdeci">static int atomic_fetch_and_add(int *ptr, int value)</div><div class="ttdef"><b>Definition:</b> <a href="system_8h_source.html#l00078">system.h:78</a></div></div>
<div class="ttc" id="asystem_8h_html_a2ca58d338cd52c808ec1a86073940c49"><div class="ttname"><a href="system_8h.html#a2ca58d338cd52c808ec1a86073940c49">MPIU_Barrier</a></div><div class="ttdeci">#define MPIU_Barrier(comm)</div><div class="ttdef"><b>Definition:</b> <a href="system_8h_source.html#l00103">system.h:103</a></div></div>
<div class="ttc" id="asystem_8h_html_abb95c0be39c73f8e6b0978a9a374d92b"><div class="ttname"><a href="system_8h.html#abb95c0be39c73f8e6b0978a9a374d92b">MPI_INT64</a></div><div class="ttdeci">#define MPI_INT64</div><div class="ttdef"><b>Definition:</b> <a href="system_8h_source.html#l00012">system.h:12</a></div></div>
<div class="ttc" id="atest__exchange_8c_html_a52c8c7d2abff436111942e02c5bb466a"><div class="ttname"><a href="test__exchange_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a></div><div class="ttdeci">int ThisTask</div><div class="ttdef"><b>Definition:</b> <a href="test__exchange_8c_source.html#l00023">test_exchange.c:23</a></div></div>
<div class="ttc" id="atest__exchange_8c_html_a675acdcd149f5993271a1fdc11673b65"><div class="ttname"><a href="test__exchange_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a></div><div class="ttdeci">int NTask</div><div class="ttdef"><b>Definition:</b> <a href="test__exchange_8c_source.html#l00023">test_exchange.c:23</a></div></div>
<div class="ttc" id="atest__interp_8c_html_ac06514a27a2843d8325c1e46ad595b39"><div class="ttname"><a href="test__interp_8c.html#ac06514a27a2843d8325c1e46ad595b39">DMAX</a></div><div class="ttdeci">#define DMAX(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="test__interp_8c_source.html#l00011">test_interp.c:11</a></div></div>
<div class="ttc" id="atypes_8h_html_af1ada7381a1118c6d51bdbb0b5e72811"><div class="ttname"><a href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a></div><div class="ttdeci">LOW_PRECISION MyFloat</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00019">types.h:19</a></div></div>
<div class="ttc" id="awalltime_8h_html"><div class="ttname"><a href="walltime_8h.html">walltime.h</a></div></div>
<div class="ttc" id="awalltime_8h_html_a2d23071e44d020b4a0b3f2876667d370"><div class="ttname"><a href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a></div><div class="ttdeci">#define walltime_measure(name)</div><div class="ttdef"><b>Definition:</b> <a href="walltime_8h_source.html#l00008">walltime.h:8</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
